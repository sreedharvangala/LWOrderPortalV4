/*!
* Data Aquarium Framework - Core
* Copyright 2008-2018 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function nt(n){t&&t.busy(n)}function et(n){return JSON.stringify(n)}function d(n,t){return n.isInstanceOfType(t)}function ii(n){n.Type||(n.Type="String");n.Type!="DataView"||t||(n.Hidden=!0);ri(n,bi,!0);ri(n,ki,0);n.HeaderText=n.HeaderText||n.Label||n.Name;var i=n.Tag,r=i&&i.match(/survey-(form|data)+/);r&&(n.Tag+=" input-type-"+r[0].replace("-",""));n.Items==null&&(n.Items=[])}function ri(n,t,i){for(var u,r=0;r<t.length;r++)u=t[r],n[u]==null&&(n[u]=i)}function ei(n,t){if(!t){var i=Web.Menu.Nodes;for(var r in i)t=i[r]}return $(t).each(function(){var t=this;return n.apply(t)==!1?!1:t.children&&!ei(n,t.children)?!1:void 0}),!0}function oi(){var n=!1;return ei(function(){if(this.url&&this.url.match(/\/membership(\.aspx)?$/i))return n=!0,!1}),n}function kt(){var n=l.HoverMonitor,t=n&&n._instance;t&&t.close()}function tt(n){return parseInt(n,10)}function gi(i){for(var s=i.coords,e=n.Geo={latitude:s.latitude,longitude:s.longitude,acquired:!0},h=null,u=0,f=n.GeoQueue,r,o;u<f.length;)if(r=p(f[u].dv),r==null||r._geoCookie!==f[u].cookie)f.splice(u,1);else if(!r._busy()){if(o=r.findField(f[u].field),h=o.tagged("modified-latitude","created-latitude")?e.latitude:o.tagged("modified-longitude","created-longitude")?e.longitude:e.latitude+","+e.longitude,r.editing())try{t?n.input.execute({dataView:r,values:[{Name:o.Name,NewValue:h}],raiseCalculate:!1}):r._updateCalculatedFields(result)}catch(c){t&&t.notify("Unable to update geolocation.")}u++}!f.length&&yt&&(bt.clearWatch(yt),yt=null)}function si(n,t){t.splice(0,0,[null,n.tagged("lookup-null-value-any")?s.AnyValue:n.tagged("lookup-null-value-placeholder")?n.Watermark:w])}function nr(n){return n&&n.getTimezoneOffset&&!isNaN(+n)}function hi(n,t){return n.Handler&&(t.Handler=n.Handler),n.session&&(t.session=n.session),t}function ci(n){var t=null;return $(n).each(function(){var n=this;return n.selected?(t=n,!1):n.children&&(t=ci(n.children),t)?!1:void 0}),t}function li(n,t){$(t).each(function(){var t=this,i=t.url,f,r,e=$("<li/>").appendTo(n),u;i?(r=i.match(/^(_\w+):(.+)$/),r&&(i=r[2],f=r[1]),u=$("<a/>").attr({href:i,title:t.description,target:f})):u=$("<span/>");u.appendTo(e).text(t.title);t.children&&li($("<ul/>").appendTo(e),t.children)})}function ai(t){return n._deserializeDates!==!1?t.replace(/\"(\d{4}\-\d{2}\-\d{2}T\d{2}\:\d{2}\:\d{2}\.\d{3})Z?\"/g,'Date.fromUTCString("$1")'):t}function vi(n){for(var i=[],r=0,o=/\$(row|master|context)\s*\.\s*(\w+)(\s*=(=|(\s*([\S\s]+?)\s*;)))?/gm,t,u,f,e;t=o.exec(n);)u=t[1],f=t[2],e=t[6],i.push(n.substr(r,t.index-r)),u==="row"&&(u=null),e?i.push(String.format('this.updateFieldValue("{0}",{1});',f,vi(e))):(i.push(String.format('this.fieldValue("{0}"{1})',f,u?',"'+u+'"':"")),t[4]==="="&&i.push("==")),r=t.index+t[0].length;return r<n.length&&i.push(n.substr(r)),i.join("").replace(/\$(row|master|context)/g,'this.dataView().data("$1")')}function dt(i,r,u){function f(n,t){return i.findField((t&&r||"")+n)}function c(n,t){e&&(h.push({Name:e.Name,NewValue:n}),e._blobField=t+":"+r)}var o=i._pendingUploads,l,s,e,a={Values:[],Errors:[]},h=a.Values;o||(o=i._pendingUploads=[]);$(o).each(function(n){var t=this;if(t.fieldName==r)return l=!0,u?t.files=u:(t.files=null,o.splice(n,1)),!1});!l&&u&&o.push({fieldName:r,files:u});var v=null,y=null,p=null;u&&(s=u[0],s&&(v=s.name,y=s.type,p=s.size));e=f("FileName",!0)||f("FILENAME",!0)||f("FILE_NAME",!0)||f("filename",!0)||f("file_name",!0)||f("FileName")||f("FILENAME")||f("FILE_NAME")||f("filename")||f("file_name");c(v,"name");e=f("ContentType",!0)||f("CONTENTTYPE",!0)||f("CONTENT_TYPE",!0)||f("contenttype",!0)||f("conent_type",!0)||f("ContentType")||f("CONTENTTYPE")||f("CONTENT_TYPE")||f("contenttype")||f("content_type");c(y,"type");e=f("Length",!0)||f("LENGTH",!0)||f("length",!0)||f("Length")||f("LENGTH")||f("length");c(p,"size");h.length&&(t?(n.input.execute({dataView:i,values:h}),n.input.focus({fieldName:r})):i._updateCalculatedFields(a))}function yi(n,i){return $(t?t.page(n._id):n._container).find(".drop-box-"+i.Index)}function pi(n){if(n==null)return"";var t,i;return n>1024?n>1e6?(t=n>1e7?n>1e8?"{0:N0}":"{0:N1}":"{0:N2}",n/=1048576,i=a.MB):(t=n>10240?n>102400?"{0:N0}":"{0:N1}":"{0:N2}",n/=1024,i=a.KB):(t="{0}",i=a.Bytes),String.format(t,n)+" "+i}function wi(n){return n.match(/[a-z]/)&&n.match(/[A-Z]/)&&(n=n.replace(/([A-Z]+|\d+)/g," $1")),n.match(/\_/)&&(n=n.replace(/\_/g," ")),n.trim()}var r,y,n,at,it,pt,wt;Type.registerNamespace("Web");var c=window,rt=$(c),l=c.Web,gt="",lt=Sys.Serialization.JavaScriptSerializer,ot=lt.serialize,e=Sys.Browser,ui=/\{([\s\S]+?)\}/,o=Sys.CultureInfo.CurrentCulture.dateTimeFormat,u=l.DataViewResources,s=Web.DataViewResources.Data,st=s.Filters,ut=st.Labels,h=u.HeaderFilter,ft=u.ModalPopup,b=u.Pager,ht=u.Mobile,a=ht.Files,g=u.Validator,ni=u.Actions.Scopes,k=u.Grid,ti=k.PerformAdvancedSearch,vt=ut.Clear,w=s.NullValueInForms,ct=s.NullValue,fi=ni.Form.Update.WhenLastCommandName.BatchEdit,bi=["AllowQBE","AllowSorting","FormatOnClient","HtmlEncode"],ki=["Len","Rows","Columns","Search","ItemsPageSize","Aggregate","OnDemandStyle","TextMode","MaskType","AutoCompletePrefixLength","CategoryIndex"],di=["Fields","Views","Categories","ActionGroups","Filter"],p,t,bt,yt;l.DataViewMode={View:"View",Lookup:"Lookup"};l.DynamicExpressionScope={Field:0,ViewRowStyle:1,CategoryVisibility:2,DataFieldVisibility:3,DefaultValues:4,ReadOnly:5,Rule:6};l.AutoHideMode={Nothing:0,Self:1,Container:2};l.DynamicExpressionType={RegularExpression:0,ClientScript:1,ServerExpression:2,CSharp:3,VisualBasic:4,Any:4};l.DataViewAggregates=["None","Sum","Count","Avg","Max","Min"];l.FieldSearchMode={Default:0,Required:1,Suggested:2,Allowed:3,Forbidden:4};l.PageState={};l.PageState._init=function(){var n=this,i,t;n._state||(i=n._ostate=$("#__COTSTATE"),t=i.val(),n._state=t?lt.deserialize(t):{})};l.PageState._save=function(){this._ostate.length&&this._ostate.val(ot(this._state))};l.PageState.read=function(n){return this._init(),this._state[n]};l.PageState.write=function(n,t){this._init();this._state[n]=t;this._save()};Sys.StringBuilder.prototype.appendFormat=function(){this.append(String._toFormattedString(!1,arguments))};r=String.isNullOrEmpty=function(n){return n==null||n.length==0};y=String.isBlank=function(t){return t==null||typeof t=="string"&&t.match(n._blankRegex)!=null};String._wordTrimRegex=/(\S{16})\S+/g;String._tagRegex=/<\/?\w.*?>/g;String.trimLongWords=function(n,t){var r,e;if(n==null)return n;if(r=this._wordTrimRegex,t!=null&&(r=new RegExp(String.format("(\\S{{{0}}})\\S+",t),"g")),e=n.replace(r,"$1..."),n.match(String._tagRegex)){for(var u=new Sys.StringBuilder,o=String._tagRegex,i=o.exec(n),f=0;i;)tag=i[0],i.index>0&&u.append(n.substring(f,i.index).replace(r,"$1...")),f=i.index+tag.length,u.append(tag),i=o.exec(n);f<n.length&&u.append(n.substring(f));e=u.toString()}return e};String.htmlEncode=function(t){return typeof t=="string"&&t.match(n._htmlTest)?t:n.htmlEncode(t)};String.isJavaScriptNull=function(n){return n==="%js%null"||n==="null"};String.jsNull="%js%null";l.DataView=function(t){var i=this;n.initializeBase(i,[t]);i._controller=null;i._viewId=null;i._servicePath=null;i._baseUrl=null;i._pageIndex=-1;i._pageSize=b.PageSizes[0];i._sortExpression=null;i._filter=[];i._externalFilter=[];i._categories=null;i._fields=null;i._allFields=null;i._rows=null;i._totalRowCount=0;i._firstPageButtonIndex=0;i._pageCount=0;i._views=[];i._actionGroups=[];i._selectedKey=[];i._selectedKeyFilter=[];i._lastCommandName=null;i._lastViewId=null;i._lookupField=null;i._filterFields=null;i._filterSource=null;i._mode=Web.DataViewMode.View;i._lookupPostBackExpression=null;i._domFilterSource=null;i._selectedKeyList=[];i._pageSizes=b.PageSizes};n=Web.DataView;n.cache={};n.functions={};n.controllerSyncMap={};n.rules={};c.$app=c.$appfactory=n;RegExp.escape=function(n){return n.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")};n._blankRegex=/^\s*$/;n._fieldMapRegex=/(\w+)\s*=\s*(\w+)/g;n._fieldFilterRegex=/([\w\.\,]+):([\s\S]*)/;n._filterRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)$/;n._filterIteratorRegex=/(\*|~|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*?)(\0|$)/g;n._keepCapitalization=/^\$(month|quarter|true|false)/;n._listRegex=/\$and\$|\$or\$/;n._simpleListRegex=/\s*,\s*/;n._htmlTest=/<\w+.*?>/;n.serializer=lt;Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)==="[object Array]"});n.cssToIcon=function(n){var t=n&&n.match(/glyphicon-([\w\-]+)/);return t?"glyphicon "+t[0]:n};n.toHexString=function(t){if(t){var i=["0x"];Array.isArray(t)||(t=t.toString().split(n._simpleListRegex));$(t).each(function(){i.push(parseInt(this).toString(16))});t=i.join("")}return t};n.online=function(){return navigator.onLine===!0};n.htmlEncode=function(n){return n!=null&&typeof n!="string"&&(n=n.toString()),n?n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):n};n.toAjaxData=function(t){return n.htmlEncode(JSON?et(t):ot(t))};n.htmlAttributeEncode=function(n){return n!=null&&typeof n=="string"?n.replace(/\x27/g,"&#39;").replace(/\x22/g,"&quot;"):n};n.pageVar=function(t,i){var r=location.pathname,u;if(n.host&&(u=r.match(/apps\/(.+?)\/(.+?)(\.html)?$/),u&&(r=u[2])),t=r.replace(/\W/g,"_").toLowerCase()+"_"+t,arguments.length==1)return n.userVar(t);n.userVar(t,i)};n.sessionVar=function(n,t){try{if(arguments.length==1)return JSON.parse(sessionStorage.getItem(n));sessionStorage.setItem(n,et(t))}catch(i){}};n.userVar=function(t,i){if(gt||(gt=__settings.appInfo.replace(/\W/g,"_")),n.host||(t=gt+"_"+t),arguments.length===1){try{return i=n.storage.get(t),i!=null&&(i=JSON.parse(i)),i}catch(r){}return null}if(i==null)n.storage.remove(t);else try{n.storage.set(t,et(i))}catch(r){}};n.isIE6=e.agent==e.InternetExplorer&&e.version<7;n.prototype={get_controller:function(){return this._controller},set_controller:function(n){this._controller=n},useCase:function(n){return this.get_useCase()==n},get_useCase:function(){return this._useCase},set_useCase:function(n){this._useCase=n},get_survey:function(){return this._survey},set_survey:function(n){this._survey=n},get_viewId:function(){!this._viewId&&this._views.length>0&&(this._viewId=this._views[0].Id);var n=this._viewId;return n||(n=""),n},set_viewId:function(n){this._viewId=n},get_newViewId:function(){return this._newViewId},set_newViewId:function(n){this._newViewId=n},get_servicePath:function(){return this._servicePath||(typeof __servicePath=="string"?__servicePath:"")},set_servicePath:function(t){this._servicePath=this.resolveClientUrl(t);n._servicePath||(n._servicePath=t)},get_baseUrl:function(){return this._baseUrl||(typeof __baseUrl=="string"?__baseUrl:"")},set_baseUrl:function(t){t=="~"&&(t="/");this._baseUrl=t;n._baseUrl||(n._baseUrl=t)},get_siteUrl:function(){var t=this.get_servicePath(),n=t.match(/(^.+?\/)\w+\/\w+\.asmx/);return n||(n=t.match(/(^.+?\/)appservices\/_invoke$/)),n?n[1]:""},resolveClientUrl:function(t){return n.resolveClientUrl(t,this.get_baseUrl())},get_hideExternalFilterFields:function(){return this._hideExternalFilterFields!=!1},set_hideExternalFilterFields:function(n){this._hideExternalFilterFields=n},get_backOnCancel:function(){return this._backOnCancel==!0},set_backOnCancel:function(n){this._backOnCancel=n},get_confirmContext:function(){return this._confirmContext},set_confirmContext:function(n){this._confirmContext=n},get_startPage:function(){return this._startPage},set_startPage:function(n){this._startPage=n},get_startCommandName:function(){return this._startCommandName},set_startCommandName:function(n){this._startCommandName=n},get_startCommandArgument:function(){return this._startCommandArgument},set_startCommandArgument:function(n){this._startCommandArgument=n},get_exitModalStateCommands:function(){return this._exitModalStateCommands},set_exitModalStateCommands:function(n){this._exitModalStateCommands=n},get_showActionBar:function(){var t=this.extension(),n;return t&&(n=t.options(),n.actionBar!=null)?n.actionBar==!0:this._showActionBar!=!1},set_showActionBar:function(n){this._showActionBar=n},get_showActionButtons:function(){var n=this._showActionButtons;return n||(n=t?"Auto":"TopAndBottom",this._showActionButtons=n),n},set_showActionButtons:function(n){this._showActionButtons=n},get_showSearchBar:function(){return this._showSearchBar==!0&&!(__tf!=4)},set_showSearchBar:function(n){this._showSearchBar=n},get_searchOnStart:function(){return this._searchOnStart==!0},set_searchOnStart:function(n){this._searchOnStart=n;n&&this.set_searchBarIsVisible(!0)},get_searchBarIsVisible:function(){return this._searchBarIsVisible==!0},set_searchBarIsVisible:function(n){this._searchBarIsVisible=n},get_showModalForms:function(){return t?!0:this._showModalForms==!0},set_showModalForms:function(n){this._showModalForms=n},get_showDescription:function(){var n=this.extension(),t;return n?(t=n.options(),t.description==!0):this._showDescription!=!1},set_showDescription:function(n){this._showDescription=n},get_showFirstLetters:function(){return this._showFirstLetters==!0},set_showFirstLetters:function(n){this._showFirstLetters=n},get_autoSelectFirstRow:function(){return this._autoSelectFirstRow==!0},set_autoSelectFirstRow:function(n){this._autoSelectFirstRow=n},get_autoHighlightFirstRow:function(){return this._autoHighlightFirstRow==!0},set_autoHighlightFirstRow:function(n){this._autoHighlightFirstRow=n},get_refreshInterval:function(){return this._refreshInterval},set_refreshInterval:function(n){this._refreshInterval=(__tf!=4)?0:n},get_showViewSelector:function(){return this._showViewSelector!=!1},set_showViewSelector:function(n){this._showViewSelector=n},get_showPager:function(){var n=this._showPager;return n==null||n==!0?(n="Bottom",this._showPager=n):n==!1&&(n="None"),n},set_showPager:function(n){this._showPager=n},get_showPageSize:function(){return this._showPageSize!=!1},set_showPageSize:function(n){this._showPageSize=n},get_selectionMode:function(){return this._selectionMode},set_selectionMode:function(n){this._selectionMode=n},multiSelect:function(n){var i=this,r=i._multiSelect,u;if(arguments.length)i._multiSelect=n,t&&i.pageProp("selectionMode",n?"Multiple":"Single");else return r==null&&(u=t&&i.pageProp("selectionMode"),r=i._multiSelect=(u||i._selectionMode)=="Multiple"),r},get_pagerButtonCount:function(n){if(!this._pagerButtonCount||n){var t=b.PageButtonCount;this.get_pageCount()>t&&(t=t-3,t<5&&(t=5));this._pagerButtonCount=t}return this._pagerButtonCount},get_pageIndex:function(){return this._pageIndex},set_pageIndex:function(n){if(this._pageIndex=n,n>=0){var t=this.get_pagerButtonCount();n>=this._firstPageButtonIndex+t?this._firstPageButtonIndex=n:n<this._firstPageButtonIndex&&(this._firstPageButtonIndex-=t,n<this._firstPageButtonIndex&&(this._firstPageButtonIndex=n));this._firstPageButtonIndex<0&&(this._firstPageButtonIndex=0);this.get_pageCount()-this._firstPageButtonIndex<t&&(this._firstPageButtonIndex=this.get_pageCount()-t);this._firstPageButtonIndex<0&&(this._firstPageButtonIndex=0)}n==-2&&(this._pageOffset=0)},get_pageOffset:function(){return this.get_isDataSheet()?this._pageOffset==null?0:this._pageOffset:0},set_pageOffset:function(n){this._pageOffset=n},get_categoryTabIndex:function(){return this._categoryTabIndex},set_categoryTabIndex:function(n){n!=this._categoryTabIndex&&(this._categoryTabIndex=n,t||(this._updateTabbedCategoryVisibility(),n!=-1&&(this._modalPopup&&(this._resizeContainerBounds(),this._modalPopup.show()),_body_performResize(),this.editing()&&(this._focusedFieldName=null,this._focus()))))},get_enabled:function(){return this._enabled==null?!0:this._enabled},set_enabled:function(n){this._enabled=n},get_showInSummary:function(){return this._showInSummary},set_showInSummary:function(n){this._showInSummary=n},get_summaryFieldCount:function(){return this._summaryFieldCount},set_summaryFieldCount:function(n){this._summaryFieldCount=n},get_showLEVs:function(){return this._showLEVs},set_showLEVs:function(n){this._showLEVs=n},get_tags:function(){return this._tag},set_tags:function(n){this._tag=n},get_tag:function(){return this._tag},set_tag:function(n){this._tag=n;this._tagList=null},get_pageSize:function(){return this._pageSize},set_pageSize:function(n){this._pagerSize=n;this._pageSize=n;this._pageOffset=0;delete this._viewColumnSettings;Array.indexOf(this._pageSizes,n)===-1&&(this._pageSizes=Array.clone(this._pageSizes),Array.insert(this._pageSizes,0,n));this._fields!=null&&this.refreshData()},get_groupExpression:function(){return this._groupExpression},set_groupExpression:function(n){this._groupExpression=n;this._checkedSortGroup=!1},get_sortExpression:function(){var t=this._sortExpression,r,u=this._groupExpression,i=0,f,e;if(!this._checkedSortGroup&&u){for(t||(t=""),this._checkedSortGroup=!0,u=u.trim().split(n._simpleListRegex),r=t.trim().split(n._simpleListRegex);i<u.length;)f=u[i],i<r.length?(e=r[i].split(/\s+/),f!=e[0]&&r.splice(i,0,f)):r.splice(i,0,f),i++;t=r.join(",");t.match(/,$/)&&(t=t.substring(0,t.length-1));this._sortExpression=t}return t},set_sortExpression:function(n){if(this._checkedSortGroup=!1,n&&n.length!=0){var t=n.match(/^(\w+)\s*((asc|desc)|$)/i);this._sortExpression=t&&t[2].length==0?r(this._sortExpression)||this._sortExpression.match(/^(\w+)\s*/)[1]!=t[1]?n+" asc":this._sortExpression.endsWith(" asc")?n+" desc":n+" asc":n}else this._sortExpression=null},set_id:function(n){this._id||(this._id=n)},get_appId:function(){return this._id},set_appId:function(n){t&&(this._id=n)},get_appFilterSource:function(){return this._filterSource},set_appFilterSource:function(n){t&&(this._filterSource=n)},get_filterSource:function(){return this._filterSource},set_filterSource:function(n){this._filterSource||(this._filterSource=n)},get_filterFields:function(){return this._filterFields},set_filterFields:function(n){this._filterFields=n},get_visibleWhen:function(){return this._visibleWhen},set_visibleWhen:function(n){this._visibleWhen=n},get_showQuickFind:function(){return this._showQuickFind!=!1},get_quickFindText:function(){return r(this._quickFindText)?k.QuickFindText:this._quickFindText},set_quickFindText:function(n){this._quickFindText=n},get_quickFindElement:function(){return $get(this.get_id()+"_QuickFind")},set_showQuickFind:function(n){this._showQuickFind=n},get_showRowNumber:function(){return this._showRowNumber===!0},set_showRowNumber:function(n){this._showRowNumber=n},get_filter:function(){var i=this,e,s,u,f,o,r;if(i.get_lookupField()==null&&(i.get_pageIndex()==-1&&!i._allFields||i._externalFilter.length>0&&!i._filter.length)){if(i.get_domFilterSource())for(i._externalFilter=[],e=i.get_filterFields().split(n._simpleListRegex),s=i.get_domFilterSource().value.split(n._simpleListRegex),u=0;u<e.length;u++)Array.add(i._externalFilter,{Name:e[u],Value:s[u]});else if(f=n._commandLine.match(/\?([\s\S]+)/),f&&i.get_filterSource()!="None"&&i.get_filterSource()==null&&!i.get_useCase())for(i._externalFilter=[],o=/(\w+)=([\S\s]*?)(&|$)/g,r=o.exec(f[1]);r;)r[1]!="ReturnUrl"&&Array.add(i._externalFilter,{Name:r[1],Value:r[2].length==0?String.jsNull:decodeURIComponent(r[2])}),r=o.exec(f[1]);i.applyExternalFilter(i.get_isModal()||(t||i.useCase("$app"))&&i._filter)}else i.get_filterSource()=="Context"&&i._externalFilter.length>0&&i.applyExternalFilter(!0);return i._startupFilter&&(i.readContext("disableStartFilter")!=!0&&(Array.addRange(i._filter,i._startupFilter),i.writeContext("disableStartFilter",!0)),i._startupFilter=null),i._filter},set_filter:function(n){this._filter=n},get_startupFilter:function(){return this._startupFilter},set_startupFilter:function(n){this._startupFilter=n},get_externalFilter:function(){return this._externalFilter},set_externalFilter:function(n){this._externalFilter=n?n:[]},get_ditto:function(){return this._ditto},set_ditto:function(n){this._ditto=n},get_modalAnchor:function(){return this._modalAnchor},set_modalAnchor:function(n){this._modalAnchor=n},get_description:function(){return this._description},set_description:function(n){this._description=n},get_isModal:function(){return this._modalPopup!=null||this._isModal},get_categories:function(){return this._categories},get_fields:function(){return this._fields},get_rows:function(){return this._rows},data:function(n){function f(t){var i={},r=0,u=n==="filter"?t._filter:n==="combined"?t.combinedFilter():t._combinedFilter([]);return u&&u.forEach(function(n){var o=n.match(/(.+?)\:(=|<>|>=|<=|>|<|(\$\w+\$))(.*?)\0?$/),u,s,f,e;o?(u=o[1],f=o[2],e=o[4],u==="_match_"||u==="_donotmatch_"?i["_Match"+(++r).toString()]=(u==="_match_"?"$match":"$donotmatch")+f.substring(1,4):(s=t.findField(u),f.match(/\$$/)&&(f=f.substring(0,f.length-1)),r>0&&(u="_Match"+r.toString()+"_"+u),f.match(/^\$(month|quarter)\d+$/i)?(i[u+"_op2"]=f,i[u+"_op"]="all-dates-in-period"):i[u+"_op"]=f,e&&(e=e.split(/\$and\$|\$or\$/g),e.forEach(function(n,i){e[i]=t.convertStringToFieldValue(s,n)}),i[u]=e[0],f==="$between"?i[u+"_v2"]=e[1]:e.length>1&&(i[u]=e)))):n.match(/^_quickfind_:~/)&&(i.QuickFind=JSON.parse(n.substring(17)))}),i}var t=this,r,u,i;return n==="master"?(r=t.get_master(),r?r.data():null):n==="context"?(u=t.get_parentDataView(),u?u.data():null):n&&n.match(/^(filter|search|combined)$/)?f(t):n==="parameters"?($(t._searchParamValues||[]).each(function(){var n=this;n.Modified&&(i||(i={}),i[n.Name.substring(11)]=n.NewValue)}),i):t.survey("data")},row:function(){return this.survey("row")},values:function(){return this.survey("values")},survey:function(n){var i=this,r,u;if(n==="row")return t?r=i.editRow():(r=[],u=i._collectFieldValues(),i._validateFieldValues(u,!1),$(u).each(function(){var n=this,t=i.findField(n.Name);t&&(r[t.Index]=n.NewValue)})),$(i._pendingUploads).each(function(){var n=this,t=i.findField(n.fieldName);r[t.Index]=n.files}),r;if(n==="data"){r=i.row();var f={_modified:{}},o=i._allFields,e=i._originalRow;return $(o).each(function(n){var i=this,t=i.Name,u;n=i.Index;t==="sys_pk_"||t==="Status"&&n===o.length-1||(u=f[t]=r[n],e&&e[n]!==u&&(f._modified[t]=e[n]))}),f}return n==="values"?i._collectFieldValues():i._survey},changed:function(){var n=this,t,r=n.odp,u=n._unchangedRow,f=n._editRow,i;if(arguments.length>0&&arguments[0]==="ignore"){if(i=n.changed()||r&&r.root(n)&&r.is(":dirty"),arguments.length===1)return!i||n.tagged("discard-changes-prompt-none")||n._ignoreUnsavedChanges;n._ignoreUnsavedChanges=arguments[1]}else if(n.editing())if(n._pendingUploads&&n._pendingUploads.length)i=!0;else if(u&&n.editing())for(t=0;t<u.length;t++)if(f[t]!==u[t]){i=!0;break}return i},editRow:function(){var t=this,i,r,e,n=t._editRow,u,f;return n||(t.inserting()?(n=(t._newRow||[]).slice(0),$(t._externalFilter).each(function(){var i=this,r;i&&(r=t.findField(i.name||i.Name),!r||r.IsPrimaryKey&&r.ReadOnly||n[r.Index]!=null||(n[r.Index]=i.name?i.value:i.Value))}),i=t.get_master(),i&&(f=i.editRow(),e=t.get_externalFilter(),$(e).each(function(){var e=this,o=!0,r=t.findField(e.Name),u;r&&(r.ItemsDataValueField&&(u=i.findField(r.ItemsDataValueField),u&&(o=!1,n[r.Index]=f[u.Index])),r.Index!=r.AliasIndex&&r.ItemsDataTextField&&(u=i.findField(r.ItemsDataTextField),u&&(n[r.AliasIndex]=f[u.Index])),o&&(n[r.Index]=t.convertStringToFieldValue(r,e.Value)))})),u=[],$(n).each(function(i){u[i]=t._survey?n[i]:null})):(r=t.extension(),n=r&&r.commandRow?r.commandRow():[],n||(n=[]),u=n.slice(0)),n=n.slice(0),t.get_isForm()&&(t._editRow=n),t._originalRow=u),n},headerField:function(){var n=this;return headerField=n._headerField,headerField||$(n._fields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return headerField=n,!1}),headerField&&(headerField=n._allFields[headerField.AliasIndex]),headerField},context:function(n){var i=this,t=i._filterSource?p(i._filterSource):i.get_parentDataView(i),r,u={};if(arguments.length){if(t.get_isForm()){if(t._survey)return t.survey(n);r=t.editRow()}else r=t.get_selectedRow();return n==="row"?r:($(t._allFields).each(function(){var n=this;u[n.Name]=r[n.Index]}),u)}return t},originalRow:function(){return this._originalRow},get_selectedRow:function(){var n=this,i=n.extension();return i?t?n.row():n._selectedRow:n._rows?n._rows[n._selectedRowIndex!=null?n._selectedRowIndex:0]:[]},get_pageCount:function(){return this._pageCount},get_aggregates:function(){return this._aggregates},get_views:function(){return this._views},actionGroups:function(n){var s=this,h=[],c=s._actionGroups,i,r,u,t,e,f,o;for(typeof n=="string"&&(n=[n]),u=0;u<n.length;u++)for(o=n[u],i=0;i<c.length;i++)if(t=c[i],f=null,t.Scope==o||t.Id==o)for(r=0;r<t.Actions.length;r++)e=t.Actions[r],s._isActionAvailable(e)&&(f||h.push(f={Scope:t.Scope,HeaderText:t.HeaderText,Flat:t.Flat,Id:t.Id,Actions:[]}),f.Actions.push(e));return h},actions:function(n){var t=this.actionGroups(n);return t.length?t[0].Actions:null},get_actionGroups:function(n,t){for(var r,u,f,e=[],i=0;i<this._actionGroups.length;i++)if(this._actionGroups[i].Scope==n){if(r=this._actionGroups[i],u=t?r:null,!t)for(f=0;f<r.Actions.length;f++)if(this._isActionAvailable(r.Actions[f])){u=this._actionGroups[i];break}u&&Array.add(e,u)}return e},get_actions:function(n,t){for(var r,u=[],i=0;i<this._actionGroups.length;i++)if(this._actionGroups[i].Scope==n)if(r=this._actionGroups[i],t)Array.addRange(u,r.Actions);else return r.Actions;return u},get_action:function(n){for(var t,i,u,f=n.split(/\//),r=0;r<this._actionGroups.length;r++)if(t=this._actionGroups[r],t.Id==f[0])for(i=0;i<t.Actions.length;i++)if(u=t.Actions[i],u.Id==f[1])return u;return null},get_selectedKey:function(){return this._selectedKey},set_selectedKey:function(n){this._selectedKey=n},get_selectedKeyFilter:function(){return this._selectedKeyFilter},set_selectedKeyFilter:function(n){this._selectedKeyFilter=n},_get_selectedValueElement:function(){var n=this._selectedValueElement;return n||(n=this._selectedValueElement=$(String.format("#{0}_{1}_SelectedValue",this.get_id(),this.get_controller()))),n.length?n[0]:null},get_selectedValue:function(){var t=this.readContext("SelectedValue"),n;return t?t:(n=this._get_selectedValueElement(),n?n.value:"")},set_selectedValue:function(n){if(!this._hasSearchAction){this.writeContext("SelectedValue",n.toString());var t=this._get_selectedValueElement();t&&(t.value=n!=null?n:"")}},get_keyRef:function(){var i=this.get_selectedKey(),t,n;if(!i)return null;for(t="",n=0;n<this._keyFields.length;n++)n>0&&(t+="&"),t=String.format("{0}{1}={2}",t,this._keyFields[n].Name,i[n]);return t},get_showIcons:function(){return this._icons!=null&&this._lookupField==null||this.get_showRowNumber()},get_showMultipleSelection:function(){return this.multiSelect()&&this._hasKey()},get_sysColCount:function(){var n=0;return this.get_showIcons()&&n++,this.get_showMultipleSelection()&&n++,this.get_isDataSheet()&&n++,n},_createRowKey:function(n){for(var f=typeof n=="number"?this._rows[n]:arguments[0],t="",u,r,i=0;i<this._keyFields.length;i++)u=this._keyFields[i],t.length>0&&(t+=","),r=f[u.Index],t+=r==null?"null":r.toString();return t},batchEdit:function(i,r){function b(t,i){var u=t.ContextFields,f,e=[],r;if(u){while(f=n._fieldMapRegex.exec(u))e.push(f);$(e).each(function(){var n=this;r=p[n[2]];r&&!r._depends&&(r._depends=!0,i.push(r),b(r,i))})}}var e=this,l=i||e._viewId,f,p,w,c,a;if(r){var v=[],y=[],o=[],h=[],k={text:e.get_view().Label,text2:ni.Grid.BatchEdit.HeaderText,parent:e._id,controller:e._id+"_"+l+"_BatchEdit",context:{controller:e._controller,view:l},topics:[{description:String.format(ht.ItemsSelectedMany,e._selectedKeyList.length)+". "+String.format(u.Views.DefaultCategoryDescriptions.$DefaultEditDescription,e.get_view().Label),questions:h}],options:{discardChangesPrompt:!1,materialIcon:"edit"},submit:"batcheditsubmit.dataview.app",submitText:fi.HeaderText};if($(r.fields).each(function(){var n=this,t=n.Tag;n.Hidden||_field_isReadOnly.call(n)||n.OnDemand||n.Type=="DataView"||(o.push(n),t&&(t.match(/\bbatch\-edit\-disabled\b/)?v.push(n):t.match(/\bbatch\-edit\b/)&&y.push(n)))}),y.length)o=y;else if(v.length)for(f=0;f<o.length;)v.indexOf(o[f])!=-1?o.splice(f,1):f++;if(o.length){for(p={},w={},$(o).each(function(){var n=this;p[n.Name]=n}),$(o.slice(0).reverse()).each(function(){var n=this,t;n.ContextFields&&!n._depends&&(t=w[n.Name]=[],b(n,t),t=t.reverse())}),$(o).each(function(){var n=this,c=n.AllowNulls===!0,f=n.Name,l="$row."+f+"_BatchEdit==true",e={name:f+"_BatchEdit",type:"bool",value:!1,required:!t,text:n.HeaderText||n.Label,items:{style:"CheckBox"},options:{lookup:{autoAdvance:!0}}},u={name:f,type:n.Type,len:n.Len,placeholder:c?g.Optional:g.Required,text:!1,columns:n.Columns,rows:n.Rows,visibleWhen:l,extended:{allowNulls:c},format:n.DataFormatString,context:n.ContextFields,options:{clearOnHide:!0}},o=n.ItemsStyle,i={};o&&(i.style=o,n.ItemsDataController?(i.controller=n.ItemsDataController,i.view=n.ItemsDataView,i.dataValueField=n.ItemsDataValueField,i.dataTextField=n.ItemsDataTextField,i.newView=n.ItemsNewDataView,i.targetController=n.ItemsTargetController):(i.list=[],$(n.Items).each(function(){var n=this;i.list.push({value:n[0],text:n[1]})})),u.items=i,n.AliasName&&$(r.fields).each(function(){var t=this;if(t.Name===n.AliasName)return e.text=t.Label||t.HeaderText,u.altText=e.text,!1}));(o||n.Type==="Boolean")&&(u.options.lookup={nullValue:!1});n._depends?(u.placeholder=e.text,n._question=u):h.push(e,u);i.targetController&&h.push({name:f+"_BatchKeep",type:"bool",value:!0,text:!1,required:!0,items:{style:"DropDownList",list:[{value:!0,text:s.KeepOriginalSel},{value:!1,text:s.DeleteOriginalSel}]},visibleWhen:l+" && $row."+f+"!=null",options:{lookup:{openOnTap:!0}}})}),f=1;f<h.length;)c=h[f],a=w[c.name],a&&(c.placeholder=h[f-1].text,c.text=!1,c.extended.dependency=a,$(a).each(function(){var n=this._question;n.visibleWhen=c.visibleWhen;n.text="";h.splice(f++,0,n)})),f+=2;n.survey(k)}}else n.execute({controller:e._controller,view:l,requiresMetadata:!0,requiresData:!1}).done(function(n){e.batchEdit(l,n)})},toggleSelectedRow:function(n){for(var s=n!=null?n:0,h=n!=null?n:this._rows.length-1,c=$get(this.get_id()+"_ToggleButton"),f,e,u,i,t,o,r=s;r<=h;r++)if(e=this._createRowKey(r),f=Array.indexOf(this._selectedKeyList,e),f!=-1&&Array.removeAt(this._selectedKeyList,f),u=n==null?c.checked:f==-1,u&&Array.add(this._selectedKeyList,e),i=$get(this.get_id()+"_CheckBox"+r),i){for(i.checked=u,u?$(i).addClass("Selected"):$(i).removeClass("Selected"),t=i;t&&t.tagName!="TR";)t=t.parentNode;u?$(t).addClass("MultiSelectedRow"):$(t).removeClass("MultiSelectedRow")}this._skipCellFocus=this.get_isDataSheet();this.set_selectedValue(this._selectedKeyList.join(";"));o=$get(this.get_id()+"$SelectionInfo");o&&(o.innerHTML=this._selectedKeyList.length==0?"":String.format(b.SelectionInfo,this._selectedKeyList.length));n>=0?this.executeRowCommand(n,"Select"):this.delayedRefresh()},delayedRefresh:function(t,i){if(i||(i=1e3),t)delete this._delayedRefreshTimer,this._isBusy||n._navigated||Sys.Application._disposing||this.refresh(!0);else{this._delayedRefreshTimer&&clearTimeout(this._delayedRefreshTimer);var r=this;this._delayedRefreshTimer=setTimeout(function(){r.delayedRefresh(!0)},i)}},get_view:function(n){if(n||(n=this.get_viewId()),!this._view||this._view.Id!=n)for(var t=0;t<this._views.length;t++)if(this._views[t].Id==n){this._view=this._views[t];break}return this._view},get_viewType:function(n){var t=this.get_view(n),i;return this._viewTypes&&(i=this._viewTypes[t?t.Id:n],i!=null)?i:t?t.Type:null},get_isGrid:function(n){var t=this.get_viewType(n);return t=="Grid"||t=="DataSheet"},get_isForm:function(n){var t=this.get_viewType(n);return t=="Form"},get_isDataSheet:function(n){var i=this.get_viewType(n),t;return __tf!=4?!1:(this._viewTypes&&(t=this._viewTypes[this.get_viewId()],t!=null&&(i=t)),i=="DataSheet")},get_isChart:function(){return this.get_viewType()=="Chart"},get_lastViewId:function(){return this._lastViewId},set_lastViewId:function(n){this._lastViewId=n},get_lastCommandName:function(){return this._lastCommandName},set_lastCommandName:function(n){this._lastCommandName=n;this._lastCommandArgument=null;$closeHovers()},get_lastCommandArgument:function(){return this._lastCommandArgument},set_lastCommandArgument:function(n){this._lastCommandArgument=n},get_isEditing:function(){return this.editing()},editing:function(){var t=this,n=t._lastCommandName,i=t._editing;return i==null&&(n=="Edit"||n=="New"||n=="Duplicate")||i==!0},get_isInserting:function(){return this.inserting()},inserting:function(){var n=this._lastCommandName;return n=="New"||n=="Duplicate"},get_lookupField:function(){return this.get_mode()==Web.DataViewMode.View?this._lookupField:this._fields[0]},set_lookupField:function(n){this._lookupField=n},get_lookupContext:function(){var n=this,i=n._lookupContext,t=n._lookupInfo?n._lookupInfo.field:n.get_lookupField();return i?i:t?{FieldName:t.Name,Controller:t._dataView.get_controller(),View:t._dataView.get_viewId()}:null},get_mode:function(){return this._mode},set_mode:function(n){this._mode=n},get_lookupValue:function(){return this._lookupValue},set_lookupValue:function(n){this._lookupValue=n},get_lookupText:function(){return this._lookupText},set_lookupText:function(n){this._lookupText=n},get_lookupPostBackExpression:function(){return this._lookupPostBackExpression},set_lookupPostBackExpression:function(n){this._lookupPostBackExpression=n},get_domFilterSource:function(){return this._domFilterSource},set_domFilterSource:function(n){this._domFilterSource=n},get_showDetailsInListMode:function(){return this._showDetailsInListMode!=!1},set_showDetailsInListMode:function(n){this._showDetailsInListMode=n},get_autoHide:function(){return!r(this.get_visibleWhen())&&this._autoHide==Web.AutoHideMode.Nothing?Web.AutoHideMode.Self:this._autoHide==null?Web.AutoHideMode.Nothing:this._autoHide},set_autoHide:function(n){this._autoHide=n},initialize:function(){n.callBaseMethod(this,"initialize");this._bodyKeydownHandler=Function.createDelegate(this,this._bodyKeydown);this._filterSourceSelectedHandler=Function.createDelegate(this,this._filterSourceSelected);this._quickFindHandlers={focus:this._quickFind_focus,blur:this._quickFind_blur,keydown:this._quickFind_keydown};this._checkMaxLengthHandler=function(n){var t=tt(this.getAttribute("maxlength"));this.value.length>t&&(this.value=this.value.substr(0,t),n.preventDefault(),n.stopPropagation())}},dispose:function(){var i=this,u=i._survey,r=i.odp,f,e;if(i._disposePendingUploads(),t||Sys.Application._disposing||($(i._element).find("iframe").remove(),i._detachBehaviors()),(i._container||t)&&(f=this.extension(),f&&f.dispose&&f.dispose()),i._wsRequest=null,i._stopInputListener(),i._disposeModalPopup(),i._disposeFieldFilter(),i._disposeSearchBarExtenders(),i._disposeImport(),i._disposeFields(),i._lookupField=null,i._parentDataView=null,i._bodyKeydownHandler=null,i._filterSourceSelectedHandler=null,i._restoreEmbeddedViews(),delete i._container,i._cancelCallback=null,i._doneCallback=null,u){for(e in u)typeof u[e]=="function"&&(u[e]=null);i._survey=null}clearTimeout(i._valueChangedTimeout);r&&r._dataView===i&&(r._data=null,r._log=null,r._dataLoadedKeys=null);n.callBaseMethod(i,"dispose")},get_master:function(){var t=this.get_filterSource();return t?n.findDataView(t):null},tag:function(n){n&&(this._tag=n+" "+(this._tag||"").replace(/,/g," ").trim(),this._tagList=null)},untag:function(n){var t=this,i,r;t._tag&&(t.get_isTagged(""),i=t._tagList,r=Array.indexOf(i,n),r>=0&&i.splice(r,1),t._tag=i.join(" "));t._tagList=null},get_isTagged:function(n){var i=this,t=i._tagList,r={};return t||(t=i._tag,t&&(t=i._tagList=t.split(/\s+|,/).filter(function(n){return n in r?!1:r[n]=!0}))),t&&t.indexOf(n)!==-1},tagged:function(n){var i=this,r=n.ignoreCase!=null,t;if(arguments.length===1)return r||n.match(/\-$/)?(i._tag||"").match(r?n:typeof new RegExp(n)):i.get_isTagged(n);for(t=0;t<n.length;t++)if(i.get_isTagged(n[t]))return!0;return!1},updated:function(){var e,h,o,i,a,u,f,s,c,l;(n.callBaseMethod(this,"updated"),this._controller)&&((this.get_servicePath().startsWith("http")&&this.set_baseUrl(this.get_siteUrl()),e=this.get_selectedValue(),e.length>0&&(t||(this.set_autoHighlightFirstRow(!1),this.set_autoSelectFirstRow(!1)),this.multiSelect()?this._selectedKeyList=e.split(";"):(this._selectedKey=e.split(","),this._pendingSelectedEvent=!0)),this._container||t||(this.get_element().innerHTML="",this._container=document.createElement("div"),this.get_element().appendChild(this._container),$(this._container).addClass("DataViewContainer"),h=this._element.id,o=h.split(/_/),Sys.UI.DomElement.addCssClass(this._container,o?o[o.length-1]:h),this.get_showActionBar()||$(this._container).addClass("ActionBarHidden"),this.get_showDescription()||$(this._container).addClass("DescriptionHidden")),this.get_filterSource()&&this.get_filterSource()!="Context"?(i=this.get_master(),i?(this._hasParent=!0,i.add_selected(this._filterSourceSelectedHandler),i._pendingSelectedEvent&&!t?(this._source=i,a=this,this._afterUpdateTimerId=setInterval(function(){a._afterUpdate()},250)):this._forceVisible||(this._hidden=!0)):(i=$get(this.get_filterSource()),i&&$addHandler(i,"change",this._filterSourceSelectedHandler),this.set_domFilterSource(i)),this._externalFilter.length==0&&this._createExternalFilter(),this._filter.length==0&&(this._source||this.applyExternalFilter())):(this._hidden=!this._evaluateVisibility(),this._hidden&&this._updateLayoutContainerVisibility(!1)),t||!this.get_modalAnchor()||this.get_isModal()||this._initializeModalPopup(),i!=null&&this.get_autoHide()!=Web.AutoHideMode.Nothing&&this._updateLayoutContainerVisibility(!1),u=(n.get_commandLine()||"").replace(/#.+?$/,""),f=u.match(/_commandName=(.+?)&_commandArgument=(.*?)(&|$)/),f||(f=u.match(/_command=(.+?)&_argument=(.*?)(&|$)/)),!f||!(r(this.get_startCommandName())||__designer())||this.get_filterSource()||this.get_isModal()||this.get_lookupField()||(s=u.match(/_controller=(\w+)/),c=u.match(/_view=(\w+)/),s&&s[1]!=this.get_controller()||c&&c[1]!=this.get_view()?this._filterSource||(this._visibleWhen="false",this._updateLayoutContainerVisibility(!1)):(this._trySecondCommand=!r(s),this.set_startCommandName(f[1]),this.set_startCommandArgument(f[2]),r(this._viewId)||(this._replaceTriggerViewId=this._viewId),this._skipTriggeredView=!0,l=u.match(/\b_sync=(.+?)(&|$)/),l&&(this._syncKey=l[1].split(",")))),this.useCase("$app"))||(this.get_startCommandName()?(this.set_searchOnStart(!1),this.set_lastCommandName(this.get_startCommandName()),this.set_lastCommandArgument(this.get_startCommandArgument()),this.get_startCommandName().match(/New|Edit|Select/)&&this.set_viewId(this.get_startCommandArgument()),this.set_startCommandName(null),this.set_startCommandArgument(null),this._rows=[],t||this._survey||this._loadPage()):this.loadPage(),t&&this.mobileUpdated()))},_afterUpdate:function(){if((!this._delayedLoading||!this._source._pendingSelectedEvent)&&!this._source._isBusy){clearInterval(this._afterUpdateTimerId);var n=this._source;this._source=null;this._filterSourceSelected(n,Sys.EventArgs.Empty,!0)}},dataAttr:function(n,t,i){var r=$(n),u="data-"+t;if(i)r.attr(u,i);else return i=r.attr(u),i||(i=r.attr("factory:"+t)),i},_updateLayoutContainerVisibility:function(i){var f=this,u,o,s,h,e,c,l,v,w,y,p,a;if(t){f._hidden=!i;i&&f._hiddenEcho&&(f._hiddenEcho=!1,$('.app-echo[data-for="'+f._id+'"]').show());return}if(f._forceVisible&&(i=!0),u=f._element.parentNode,r(u.getAttribute("data-visibility-controller"))&&u.setAttribute("data-visibility-controller",f.get_id()),o=r(f.dataAttr(u,"activator"))?null:f.dataAttr(u,"activator").match(/^\s*(\w+)\s*\|\s*(.+?)\s*(\|\s*(.+)\s*)?$/),f.get_autoHide()==Web.AutoHideMode.Self){for(f._element.style.display=i?"":"none",i||(i=$(f._element).siblings().is(":visible")),s=u.parentNode.childNodes[0];s.tagName!="DIV";)s=s.nextSibling;if(o&&o[1]=="Tab"&&Sys.UI.DomElement.containsCssClass(s,"TabBar")){if(u.getAttribute("data-visibility-controller")==f.get_id()){for(h=-1,e=0;e<u.parentNode.childNodes.length;e++)if(c=u.parentNode.childNodes[e],c.className&&Sys.UI.DomElement.containsCssClass(c,"TabBody")&&h++,u==c)break;if(h!=-1&&(l=s.getElementsByTagName("td"),v=l[h],v.style.display=i?"":"none",!i&&Sys.UI.DomElement.containsCssClass(v,"Selected")))for(w=s.getElementsByTagName("a"),e=0;e<l.length;e++)if($common.getVisible(l[e])){$find(u.parentNode.id+"$ActivatorMenu").select(e,w[e]);break}}}else f.dataAttr(u,"hidden",!i)}else for(o&&o[1]=="SideBarTask"&&f.dataAttr(u,"hidden",!0);u;){if(!r(f.dataAttr(u,"flow"))){u.style.display=i?"":"none";break}u=u.parentNode}if(y=$get("PageContentSideBar"),y&&o)for(p=y.getElementsByTagName("a"),e=0;e<p.length;e++)if(a=p[e],Sys.UI.DomElement.containsCssClass(a.parentNode,"Task")&&a.innerHTML==o[2]){a.parentNode.style.display=i?"":"none";break}n._loaded&&_body_resize()},loadPage:function(){if(!t){var i=this.get_isDisplayed();this._showWait(!i);this.get_mode()==Web.DataViewMode.View&&!this.get_lookupField()&&(this._delayedLoading=!i)?Array.contains(n._delayedLoadingViews,this)||(Array.add(n._delayedLoadingViews,this),n._startDelayedLoading()):this._source||this._loadPage()}},get_isDisplayed:function(){if(this._hidden)return!1;var t=this.get_element(),n;if(!t)return!1;for(n=t&&t.parentNode;n!=null;){if(n.getAttribute&&n.tagName!="TABLE"&&this.dataAttr(n,"activator")&&!n._activated||n.style&&n.style.display=="none")return!1;n=n.parentNode}return!0},goToPage:function(n,t){this._isBusy||(t&&(this._pageOffset=0),this.set_pageIndex(n),this._loadPage())},sort:function(n){this._isBusy||(this._clearCache(),this.get_sortExpression()==n&&(n=""),this.set_sortExpression(n),this.get_selectedKey().length>0?(this._saveViewVitals(),this._sync()):(this.set_pageIndex(0),this._loadPage()))},groupExpression:function(){var t=this.get_groupExpression();return t?t.trim().split(n._simpleListRegex):null},groupBy:function(){var n=this;$(n.groupExpression()).each(function(){var t=n.findField(this);t&&(t.GroupBy=!0)})},applyFilterByIndex:function(n,t){if(t==-1)this.removeFromFilterByIndex(n);else{var i=this._allFields[n],r=this.findFieldUnderAlias(i);this.applyFilter(i,t>=0?"=":null,t>=0?r._listOfValues[t]:null)}},findFieldUnderAlias:function(n){return(typeof n=="string"&&(n=this.findField(n)),n.Hidden)?this._allFields[n.OriginalIndex]:n},removeFromFilterByIndex:function(n){n==-1?this.removeQuickFind():(field=this._allFields[n],this.removeFromFilter(field));this.sync()},removeQuickFind:function(){var n=this;$(n._filter).each(function(t){this.match(/^_quickfind_\:\~/)&&n._filter.splice(t,1)})},removeFromFilter:function(n){typeof n!="string"&&(n=n.Name);for(var t=0;t<this._filter.length;t++)if(this._filter[t].match(/^(\w+):/)[1]==n){Array.removeAt(this._filter,t);break}},clearFilter:function(n){for(var t,u,r,i=0;i<this._allFields.length;i++)t=this._allFields[i],u=this.findFieldUnderAlias(t),this.filterOf(t)==null||this.filterIsExternal(t.Name)||this.removeFromFilter(t);n&&(r=this.get_quickFindElement(),r!=null?(r.value="",this.quickFind()):(this.set_quickFindText(null),this._executeQuickFind(null)))},beginFilter:function(){this._filtering=!0},endFilter:function(){this._filtering=!1;this.refreshData()},applyFilter:function(n,t,i){var u,r;for(this._clearCache(),this.removeFromFilter(n),t==":"?i&&this._filter.push(n.Name+":"+i):t&&this._filter.push((t=="~"?"_quickfind_":n.Name)+":"+t+this.convertFieldValueToString(n,i)),u=this._filter.length==1&&this._filter[0].match(/(\w+):/)[1]==n.Name,n=this.findFieldUnderAlias(n),r=0;r<this._allFields.length;r++)u&&this._allFields[r].Name==n.Name||(this._allFields[r]._listOfValues=null);this._filtering!=!0&&this._sync()},applyExternalFilter:function(n){var i,r,t;for(n&&this._filter||(this._filter=[]),this._selectedRowIndex=null,i=0;i<this._externalFilter.length;i++){if(r=this._externalFilter[i],n)for(t=0;t<this._filter.length;t++)if(this._filter[t].startsWith(r.Name+":=")){Array.removeAt(this._filter,t);break}Array.add(this._filter,r.Name+":="+r.Value)}},applyFieldFilter:function(n,t,i,r){var u,f,e;if(n==null&&(n=this._filterFieldIndex),t||(t=this._filterFieldFunc),u=this._allFields[n],this.removeFromFilter(u),$(this._allFields).each(function(){this._listOfValues=null}),f=String.format("{0}:",u.Name,u.Type),i&&i[0]==h.EmptyValue&&(i[0]=String.jsNull),i)if(t=="$between")f+="$between$"+this.convertFieldValueToString(u,i[0])+"$and$"+this.convertFieldValueToString(u,i[1])+'\0';else for(e=0;e<i.length;e++)f+=t+(t.startsWith("$")?"$":"")+this.convertFieldValueToString(u,i[e])+'\0';else f+=t+'$\0';f.indexOf('\0')>0&&Array.add(this._filter,f);r||this.refreshData();this._forgetSelectedRow(!0)},get_fieldFilter:function(n,t){for(var u,i,r=0;r<this._filter.length;r++)if(u=this._filter[r].match(/(\w+):(\*|\$\w+\$|=|~|>=?|<(=|>){0,1})([\s\S]*)/),u[1]==n.Name)return t?(i=u[2],i.startsWith("$")?i.substring(0,i.length-1):i):u[4];return null},_createFieldInputExtender:function(n,t,i,r){var u=null;return t.Type.startsWith("DateTime")?(u=$create(AjaxControlToolkit.CalendarBehavior,{id:String.format("{0}_{1}Calendar{2}_{3}",this.get_id(),n,t.Index,r),button:i.nextSibling},null,null,i),u.set_format(t.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])):t.AllowQBE&&t.Type=="String"&&t.AllowAutoComplete!=!1&&(u=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0}:{1},{2}",n,this.get_id(),t.Name),delimiterCharacters:";",id:String.format("{0}_{1}AutoComplete{2}_{3}",this.get_id(),n,t.Index,r),minimumPrefixLength:t.AutoCompletePrefixLength==0?1:t.AutoCompletePrefixLength,serviceMethod:"GetListOfValues",servicePath:this.get_servicePath(),useContextKey:!0,enableCaching:n!="SearchBar",typeCssClass:n},null,null,i),u._updateClearButton()),u},showFieldFilter:function(t,i,r){var f,u,c,e,o,l,h,s,v,a;for(this._filterExtenders||(this._filterExtenders=[]),f=this._allFields[t],u=this.get_fieldFilter(f),u&&(c=u.match(/^([\s\S]*?)(\0|$)/),c&&(u=c[1])),u=u&&!String.isJavaScriptNull(u)?u.split(n._listRegex):[""],this._filterFieldIndex=t,this._filterFieldFunc=i,e=this._filterElement=document.createElement("div"),e.id=this.get_id()+"$FieldFilter",e.className="FieldFilter",o=new Sys.StringBuilder,l=f.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",o.appendFormat('<div class="Field"><div class="Label"><span class="Name">{0}<\/span> <span class="Function">{1}<\/span><\/div><div class="Value"><input type="text" value="{2}"/>{3}<\/div><\/div>',f.HeaderText,r.toLowerCase(),n.htmlAttributeEncode(f.format(this.convertStringToFieldValue(f,u[0]))),l),i=="$between"&&o.appendFormat('<div class="Field"><div class="Label"><span class="Function">{0}<\/span><\/div><div class="Value"><input type="text" value="{1}"/>{2}<\/div><\/div>',ut.And,n.htmlAttributeEncode(u[1]?f.format(this.convertStringToFieldValue(f,u[1])):""),l),o.appendFormat('<div class="Buttons"><button onclick="$find(\'{0}\').closeFieldFilter(true);return false">{1}<\/button><button onclick="$find(\'{0}\').closeFieldFilter(false);return false">{2}<\/button><\/div>',this.get_id(),ft.OkButton,ft.CancelButton),e.innerHTML=o.toString(),this._appendModalPanel(e),this._filterPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$FilterPopup",PopupControlID:e.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]),h=e.getElementsByTagName("input"),s=0;s<h.length;s++)v=h[s],a=this._createFieldInputExtender("Filter",f,v,s),a&&Array.add(this._filterExtenders,a);this._saveTabIndexes();this._filterPopup.show();Sys.UI.DomElement.setFocus(h[0]);$(e).find("input:text").keydown(function(n){n.which==13&&(n.preventDefault(),$(e).find("button:first").click())})},closeFieldFilter:function(n){var e=this._filterElement.getElementsByTagName("input"),o=[],r,i,t,u,f;if(n)for(r=this._allFields[this._filterFieldIndex],i=0;i<e.length;i++){if(t=e[i],y(t.value)){alert(g.RequiredField);Sys.UI.DomElement.setFocus(t);return}if(this._formatSearchField(t,this._filterFieldIndex),u={NewValue:t.value.trim()},f=this._validateFieldValueFormat(r,u),f){alert(f);Sys.UI.DomElement.setFocus(t);return}Array.add(o,r.Type.startsWith("DateTime")?t.value.trim():u.NewValue)}this._disposeFieldFilter();this._restoreTabIndexes();n&&this.applyFieldFilter(null,null,o)},_disposeSearchBarExtenders:function(){if(this._searchBarExtenders){for(var n=0;n<this._searchBarExtenders.length;n++)this._searchBarExtenders[n].dispose();Array.clear(this._searchBarExtenders)}},_disposeFieldFilter:function(){if(this._filterExtenders){for(var n=0;n<this._filterExtenders.length;n++)this._filterExtenders[n].dispose();Array.clear(this._filterExtenders)}this._filterElement&&(this._filterPopup.hide(),this._filterPopup.dispose(),this._filterPopup=null,this._filterElement.parentNode.removeChild(this._filterElement),delete this._filterElement)},_showSearchBarFilter:function(n,t){if(this._searchBarVisibleIndex=t,n==-1){var i=this._get("$SearchBarValue$",t);i.value="";this._searchBarFuncChanged(t);this._searchBarVisibleIndex=null}else this.showCustomFilter(n)},_appendModalPanel:function(n){var t=this.get_element();t&&t.appendChild(n)},showCustomFilter:function(t){var f=this._allFields[t],r=this._customFilterPanel=document.createElement("div"),i;this._appendModalPanel(r);r.className="CustomFilterDialog";r.id=this.get_id()+"_CustomFilterPanel";i=new Sys.StringBuilder;i.appendFormat('<div><span class="Highlight">{0}<\/span> {1}:<\/div>',n.htmlEncode(f.Label),ut.Includes);i.append('<table cellpadding="0" cellspacing="0">');i.appendFormat('<tr><td colspan="2"><div id="{0}$CustomFilterItemList${1}" class="CustomFilterItems">{2}<\/div><\/td><\/tr>',this.get_id(),t,u.Common.WaitHtml);i.appendFormat('<tr><td><\/td><td align="right"><button id="{0}Ok">{1}<\/button> <button id="{0}Cancel">{2}<\/button><\/td><\/tr>',this.get_id(),ft.OkButton,ft.CancelButton);i.append("<\/table>");r.innerHTML=i.toString();i.clear();this._customFilterField=f;this._customFilterModalPopupBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{OkControlID:this.get_id()+"Ok",CancelControlID:this.get_id()+"Cancel",OnOkScript:String.format('$find("{0}").applyCustomFilter()',this.get_id()),OnCancelScript:String.format('$find("{0}").closeCustomFilter()',this.get_id()),PopupControlID:r.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._customFilterModalPopupBehavior.show();$addHandler(document.body,"keydown",this._bodyKeydownHandler);this._loadFilterListOfValues(f.Name)},_loadFilterListOfValues:function(n){this._busy(!0);var t=this.get_lookupContext();this._invoke("GetListOfValues",this._createArgsForListOfValues(n),Function.createDelegate(this,this._onGetFilterListOfValuesComplete),{fieldName:n})},_renderFilterOption:function(n,t,i,r,u){var f=this._findItemByValue(t,i);f&&(i=f[1]);n.appendFormat('<tr><td class="Input"><input type="checkbox" id="{0}$CustomFilterItem{1}${2}"{4}/><\/td><td class="Label"><label for="{0}$CustomFilterItem{1}${2}">{3}<\/label><\/td><\/tr>',this.get_id(),t.Index,r,i,u?' checked="checked"':"")},_onGetFilterListOfValuesComplete:function(t,i){var f,c,y,l,r,o,e,a,u,s,k,g;if(this._busy(!1),f=this.findField(i.fieldName),t[t.length-1]==null&&(Array.insert(t,0,t[t.length-1]),Array.removeAt(t,t.length-1)),c=this._get("$CustomFilterItemList$",f.Index),c){for(y=this._searchBarVisibleIndex!=null?this._createSearchBarFilter(!0):this._filter,l=null,this.findFieldUnderAlias(f)._listOfValues=t,r=0;r<y.length;r++)if(o=y[r].match(n._fieldFilterRegex),o[1]==f.Name){l=o[2];break}if(e=null,a="$in$",l&&(o=l.match(n._filterRegex),o))for(o[1].match(/\$(in|notin|between)\$/)?(a=o[1],e=o[3].split(n._listRegex)):e=[o[3]],r=0;r<e.length;r++)u=e[r],String.isJavaScriptNull(u)?e[r]=h.EmptyValue:(u=this.convertStringToFieldValue(f,u),e[r]=f.format(u));s=new Sys.StringBuilder;s.appendFormat('<table class="FilterItems" cellpadding="0" cellspacing="0"><tr><td><input type="CheckBox" onclick="$find(\'{0}\')._selectAllFilterItems({1})" id="{0}$CustomFilterItemList$SelectAll"/><\/td><td><label for="{0}$CustomFilterItemList$SelectAll">{2}<\/label><\/td><\/tr>',this.get_id(),f.Index,ut.SelectAll);var p=[],v=[],d=[],w=[],b=this.findFieldUnderAlias(f);for(r=0;r<t.length;r++)u=t[r],k=u,u==null?u=h.EmptyValue:(u=n.htmlEncode(f.format(u)),u==""&&(u=h.BlankValue)),g=e&&(a=="$in$"&&Array.contains(e,u)||a=="$notin$"&&!Array.contains(e,u)),g?(Array.add(v,u),Array.add(p,k)):(Array.add(w,u),Array.add(d,k));for(r=0;r<v.length;r++)this._renderFilterOption(s,f,v[r],r,!0);for(r=0;r<w.length;r++)this._renderFilterOption(s,f,w[r],r+v.length,!1);s.append("<\/table>");c.innerHTML=s.toString();Sys.UI.DomElement.setFocus(c.getElementsByTagName("input")[0]);p.length>0&&(b._listOfValues=[],Array.addRange(b._listOfValues,p),Array.addRange(b._listOfValues,d))}},_selectAllFilterItems:function(n){for(var r=this._get("$CustomFilterItemList$",n),t=r.getElementsByTagName("input"),i=1;i<t.length;i++)t[i].checked=t[0].checked},applyCustomFilter:function(){var r=this._customFilterField,u=this._searchBarVisibleIndex!=null?this._get("$SearchBarValue$",this._searchBarVisibleIndex):null,s=u?this._get("$SearchBarFunction$",this._searchBarVisibleIndex):null,t,o;this.removeFromFilter(r);var n=null,h=this._get("$CustomFilterItemList$",r.Index),i=h.getElementsByTagName("input"),e=this.findFieldUnderAlias(r),f=0;for(t=1;t<i.length;t++)i[t].checked&&(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]),f++);if(n&&(f<=10||f!=i.length-1))if(f<=10||f<=(i.length-1)/2)u?s.value="$in,true":Array.add(this._filter,String.format('{0}:$in${1}\0',this._customFilterField.Name,n));else{for(n=null,t=1;t<i.length;t++)i[t].checked||(n?n+="$or$":n="",n+=this.convertFieldValueToString(r,e._listOfValues[t-1]));u?s.value="$notin,true":Array.add(this._filter,String.format('{0}:$notin${1}\0',this._customFilterField.Name,n))}else n=null;for(t=0;t<this._allFields.length;t++)o=this._allFields[t],o!=e&&(o._listOfValues=null);u?(u.value=n?n:"",this._searchBarFuncChanged(this._searchBarVisibleIndex)):(this._forceSync(),this.refreshData());this.closeCustomFilter()},closeCustomFilter:function(){this._customFilterModalPopupBehavior&&(this._customFilterModalPopupBehavior.dispose(),this._customFilterModalPopupBehavior=null,this._customFilterField=null);this._customFilterPanel&&(this._customFilterPanel.parentNode.removeChild(this._customFilterPanel),delete this._customFilterPanel);$removeHandler(document.body,"keydown",this._bodyKeydownHandler);this._customFilterField=null;this._searchBarVisibleIndex=null},convertFieldValueToString:function(t,i){return typeof i=="string"&&(i.match(n._listRegex)||i.startsWith("%js%"))?i:(t.Type!=="String"&&i!=null&&typeof i=="string"&&(i=this.convertStringToFieldValue2(t,i)),d(Date,i)&&(i=n.stringifyDate(i)),String.format("%js%{0}",ot(i)))},convertFieldValueToString2:function(n,t){return n.Type.startsWith("DateTime")&&!r(n.DataFormatString)?t==null?null:String.localeFormat(n.DataFormatString,t):n.Type=="Boolean"?t==null?null:t.toString():t.toString()},convertStringToFieldValue:function(t,i){return typeof i!="string"?i:i!=null&&i.startsWith("%js%")?(i=lt.deserialize(i.substring(4)),n.isISO8601DateString(i)&&(i=new Date(i)),i):this.convertStringToFieldValue2(t,i)},convertStringToFieldValue2:function(n,t){var i,r;if(t==null)return t;switch(n.Type){case"DateTime":if(i=n.DataFormatString&&n.DataFormatString.length?Date.parseLocale(t,n.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1]):Date.parse(t),!isNaN(i)&&i!=null)return i;break;case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":if(r=Number.parseLocale(t),!isNaN(r))return r}return t},goToView:function(n){var h,c,f,i,e,o,s;if(!n&&this._doneCallback){this._doneCallback(this);return}if(!r(this._replaceTriggerViewId)&&this._replaceTriggerViewId==n){this._skipTriggeredView&&(this._skipTriggeredView=!1);location.replace(location.href);return}if(h=this._ditto&&this._ditto.slice(0),this._clearCache(!0),this._ditto=h,c=this.get_filter(),f=this.get_view().Group,n=="form")for(i=0;i<this.get_views().length;i++)if(this.get_views()[i].Type=="Form"){n=this.get_views()[i].Id;break}this._disposePendingUploads();this._detachBehaviors();this.get_isForm()||(this._lastViewId=this.get_viewId(),this._selectedRowIndex=0);var a=this.get_view().Id,u=a!=n,l,v=this.extension();u&&(this._focusedFieldName=null,l=this.get_isForm(),this.get_isGrid()||this.writeContext("vitals",null));this.set_viewId(n);e=this.get_view();e.Type!="Form"&&(this._lastViewId=n,this._restorePosition(),u&&l&&t&&v._dispose(!0));this.set_pageIndex(-1);o=e.Type=="Form"?this.get_selectedKeyFilter():!r(f)&&this.get_view().Group==f||!u?c:[];this._requestedFilter&&(o=this._requestedFilter,this._requestedFilter=null);s=u?null:this.get_sortExpression();this._requestedSortExpression&&(s=this._requestedSortExpression,this._requestedSortExpression=null);this.set_filter(o);this.set_sortExpression(s);this._loadPage();this._raiseSelectedDelayed=!0;u&&(this._scrollIntoView=!0,this._focusedCell=null)},filterOf:function(n){for(var i,u=(r(n.AliasName)?n.Name:n.AliasName)+":",t=0;t<this._filter.length;t++)if(i=this._filter[t],i.startsWith(u)&&!i.match(":~"))return this._filter[t].substr(u.length);return null},findField:function(n){return this._mapOfAllFields[n]},findCategory:function(n){for(var i,t=0;t<this._categories.length;t++)if(i=this._categories[t],i.Id===n)return i;return null},_isInInstantDetailsMode:function(){return location.href.match(n.DetailsRegex)},_closeInstantDetails:function(){return this._isInInstantDetailsMode()&&u.Lookup.ShowDetailsInPopup?(close(),!0):!1},_confirm:function(i,r){var u=this,k=/(_(\w+))\s*=\s*(.+?)(\s*\r|;|\n|$)/gi,d=i.action,h=d.Confirmation,s=!0,f,l=k.exec(h),e,o,c,b,it,rt,v,a;if(!l||__tf!==4)h=u._parseText(h,u.get_currentRow()),r?r(h):confirm(h)||(s=!1);else{for(var y=null,w=null,g="",nt="New",tt="";l;)e=l[2],o=l[3],e==="survey"&&(y=o),e==="controller"&&(w=o),e==="view"&&(g=o),e==="commandName"&&(nt=o),e==="commandArgument"&&(tt=o),e==="width"&&(i.MaxWidth=o),e==="title"&&(i.WindowTitle=o),l=k.exec(h);if(c=u.get_isModal()?null:p(w,"Controller"),b=d.CausesValidation!==!1,t&&n.input.cancel(!0),!t||n.input.valid())if(c&&!c.get_isModal())f=c._collectFieldValues(),s=c._validateFieldValues(f,b),s&&(u._convertValuesToParameters(f),u._paramValues=f);else if(f=u._collectFieldValues(),it=i.Values=[],rt=u.get_servicePath(),s=u._validateFieldValues(f,b),s){for(v=0;v<f.length;v++)a=f[v],Array.add(it,{Name:"Context_"+a.Name,Value:a.Modified?a.NewValue:a.OldValue});y?n.survey({controller:y,parent:u._id,confirmContext:i}):c=n.showModal(this,w,g,nt,tt,__baseUrl,rt,[],{confirmContext:i,showSearchBar:u.get_showSearchBar(),tag:"discard-changes-prompt-none"});s=!1}}return s},executeAction:function(t,i,u,f,e,o){var c,s,h;if(!this._isBusy){if(n.hideMessage(),!o){if(c=this.get_lookupField()!=null,s=c&&this._lookupActionProcessing()?null:t==="ActionBar"?this.get_actionGroups(t)[f].Actions:this.get_actions(t),i<0&&s){for(h=0;h<s.length;h++)if(this._isActionAvailable(s[h],u)){i=h;break}if(i<0)return}o=s?s[i]:null}if(!o||r(o.Confirmation)||(!this.get_isGrid()||this.get_isDataSheet()||this.get_lastCommandName()==="BatchEdit"||c||this.executeRowCommand(u,"Select"),e||this._confirm({action:o,scope:t,actionIndex:i,rowIndex:u,groupIndex:f}))){var l=o?o.CommandName:"Select",a=o?o.CommandArgument:null,v=o?o.CausesValidation:!0,y=o?o.Path:null;this.executeRowCommand(u,l,a,v,y)}}},delegateCommand:function(n,i){var r=this,e=r.get_isForm(),u,f;return t&&(n.match(/New/)||n.match(/Select|Edit/)&&i&&r._viewId!==i||n==="Select"&&i&&r.editing())&&e&&(f=r._parentDataViewId,f?(u=p(f),u.get_isForm()&&(u=r)):u=r,u&&r._controller===u._controller?t.pageInfo(r).deleted=!0:u=null),u},executeRowCommand:function(i,u,f,e,o){var s=this,c,h,l,a;if(c=s.delegateCommand(u,f),c&&c!==s)c.executeRowCommand(i,u,f,e,o);else{if(h=s.extension(),i!=null&&i>=0&&(s._selectedRowIndex=i,s._raiseSelectedDelayed=!(u==="Select"&&r(f)),h&&(s._selectedRow=s._rows[i]),s._selectKeyByRowIndex(i)),l={commandName:u,commandArgument:f?f:"",path:o,causesValidation:e?!0:!1},!t&&s.get_isDataSheet()&&u.match(/Select|New|Edit|Duplicate/)&&s._rows.length>0&&(h==null||n.Extensions.active(h)?s._get_focusedCell()||s._startInputListenerOnCell(0,0):n.Extensions.active(h,!0)),!s.executeCommand(l))return;u==="ClientScript"?s._raiseSelectedDelayed||(a=s,setTimeout(function(){a.refresh(!0)},10)):u!=="Select"||f!=null||s.get_isGrid()||s._render()}},rowCommand:function(t,i,u,f,e){var s,o,h;(this._raiseSelectedDelayed=!(i==="Select"&&r(u)),this._selectKeyByRow(t),s={commandName:i,commandArgument:u?u:"",path:e,causesValidation:f?!0:!1},this.get_isDataSheet()&&i.match(/Select|New|Edit|Duplicate/)&&(o=this.extension(),o==null||n.Extensions.active(o)||n.Extensions.active(o,!0)),this.executeCommand(s))&&(i==="ClientScript"?this._raiseSelectedDelayed||(h=this,setTimeout(function(){h.refresh(!0)},10)):i!=="Select"||u!=null||this.get_isGrid()||this._render())},_applySelectionFilter:function(n){this.multiSelect()&&this._selectedKeyList.length>0&&this._keyFields.length==1&&(n.Filter=Array.clone(n.Filter),Array.add(n.Filter,String.format("{0}:$in${1}",this._keyFields[0].Name,this._selectedKeyList.join("$or$"))))},get_appRootPath:function(){var n=this.get_servicePath();return typeof __cothost!="undefined"&&(__cothost=="DotNetNuke"&&n.match(/DesktopModules\//i)||__cothost=="SharePoint"&&n.match(/_layouts\//i))?n.replace(/Service\.asmx$/i,""):"~/"},executeReport:function(i){var f,u,o,c,s,h,a,l,e;if(this._cancelConfirmation(),f={target:"",action:this.resolveClientUrl(this.get_appRootPath()+"Report.ashx"),request:this._createParams(!0),command:i.commandName,argument:i.commandArgument},u=f.request,u.Controller=this.get_controller(),u.View=this.get_viewId(),o=i.commandArgument,r(o)||(o.startsWith("_")&&(f.f.target=o),c=o.split(n._simpleListRegex),o=c[0],c.length==3&&(u.Controller=c[1],u.View=c[2])),f.argument=o,u.Filter.length>0&&this.get_viewType()!="Form"){if(s=new Sys.StringBuilder,this.useCase("$app"))s.append(this._filterDetailsText);else if(this._renderFilterDetails(s,u.Filter),h=this.get_master(),h)for(a=h.get_selectedRow(),l=0;l<h._allFields.length;l++)e=h._allFields[l],e.ShowInSummary&&!e.OnDemand&&(e=h._allFields[e.AliasIndex],s.isEmpty()||s.append(" "),s.appendFormat("{0} {1} {2}.",e.HeaderText,ut.Equals,e.format(a[e.Index])));u.FilterDetails=s.toString()}this._viewMessages&&(u.FilterDetails=String.format("{0} {1}",this._viewMessages[this.get_viewId()],u.FilterDetails));u.FilterDetails&&(u.FilterDetails=u.FilterDetails.replace(/(<b class=\"String\">([\s\S]*?)<\/b>)/g,'"$2"').replace(/(&amp;)/g,"&").replace(/(<.+?>)|&nbsp;/g,""));u.FilterDetails&&t&&(u.filterDetails=this.extension().filterStatus());this._applySelectionFilter(u);f.actionArgs=this._createArguments(i);this._validateFieldValues(f.actionArgs.Values,!0);f.actionArgs.ExternalFilter=u.ExternalFilter;this._showDownloadProgress();this._downloadFile(f)},_downloadFile:function(t){var i=this._get_dataRequestForm(),r=n.AccountManager.current();i.target=t.target;i.action=t.action;$get("c",i).value=t.command;$get("a",i).value=t.argument;$get("q",i).value=ot(t.request);r&&r.access_token&&($get("t",i).value=r.access_token);t.actionArgs&&($get("aa",i).value=n.htmlEncode(ot(t.actionArgs)));i.submit()},_get_dataRequestForm:function(){var n=$get("_dataRequest_form");return n||(n=document.createElement("form"),n.id="_dataRequest_form",n.method="post",n.innerHTML='<input type="hidden" name="q" id="q"/><input type="hidden" name="aa" id="aa"/><input type="hidden" name="c" id="c"/><input type="hidden" name="a" id="a"/><input type="hidden" name="t" id="t"/>',document.body.appendChild(n)),n},_showDownloadProgress:function(){this._busy(!0);var n=this;return n._onLoadComplete(n.get_id()).done(function(){n._stopWaiting=!1;n._busy(!1);var t=n._pendingExecuteComplete;if(t)return n._pendingExecuteComplete=null,n._onExecuteComplete(t.result,t.context)})},_onLoadComplete:function(n){var i=$.Deferred(),u=this,t="APPFACTORYDOWNLOADTOKEN",f;return document.cookie=String.format("{0}={1}; path=/",t,encodeURIComponent(n)),f=setInterval(function(){var e,n,o,s;if(!r(document.cookie))for(e=document.cookie.split(";"),n=0;n<e.length;n++)o=e[n].trim(),o.startsWith(t)&&(s=o.substring(t.length+1).split(","),(s.length==2&&s[0]==u.get_id()||u._stopWaiting)&&(document.cookie=String.format("{0}=; expires={1}; path=/",t,new Date(0).toUTCString()),clearInterval(f),i.resolve()))},500),i.promise()},executeExport:function(n){var t={target:n.commandName=="ExportRss"?"_blank":"",action:this.resolveClientUrl(this.get_appRootPath()+"Export.ashx"),command:n.commandName,argument:n.commandArgument,request:n},i=this._createParams(!0);this._applySelectionFilter(i);t.request.Controller=this.get_controller();t.request.View=this.get_viewId();t.request.Filter=i.Filter;t.request.SortExpression=i.SortExpression;this._downloadFile(t)},_clearDynamicItems:function(){for(var t,n=0;n<this._allFields.length;n++)t=this._allFields[n],t.DynamicItems&&(t.DynamicItems=null,t.ItemCache=null)},_copyLookupValues:function(t,i,r,u){var o=u||[],f,s,e;if(i.Copy)while(f=n._fieldMapRegex.exec(i.Copy))if(i._dataView.findField(f[1]))if(f[2]=="null")Array.add(o,{name:f[1],value:null});else if(t)s=this.findField(f[2]),s&&Array.add(o,{name:f[1],value:t[s.Index]});else if(r)for(e=0;e<r.length;e++)if(r[e].Name==f[2]){Array.add(o,{name:f[1],value:r[e].NewValue});break}u||(i._dataView._skipFocus=!0,i._dataView.refresh(!0,o),i._dataView._focus(),i._dataView._skipFocus=!1)},_copyExternalLookupValues:function(){var n,u,f,t,i;if(this.get_filterSource()&&this.get_filterSource()!="Context"&&(n=this.get_master(),n)){for(u=[],f=this.get_externalFilter(),t=0;t<f.length;t++)i=this.findField(f[t].Name),i&&!r(i.Copy)&&n._copyLookupValues(n.get_currentRow(),i,null,u);this._ditto=u}},_processSelectedLookupValues:function(){var i=[],u=[],f=this.get_lookupField(),o=this.findField(f.ItemsDataValueField),e=this.findField(f.ItemsDataTextField),r=this.get_selectedRow(),n,t;if(o)Array.add(i,r[o.Index]);else for(n=0;n<this._allFields.length;n++)this._allFields[n].IsPrimaryKey&&Array.add(i,r[this._allFields[n].Index]);if(e)Array.add(u,e.format(r[e.Index]));else{for(n=0;n<this.get_fields().length;n++)if(t=this.get_fields()[n],!t.Hidden&&t.Type=="String"){Array.add(u,t.format(r[t.AliasIndex]));break}if(u.length==0)for(n=0;n<i.length;n++)if(t=this.get_fields()[n],!t.Hidden){Array.add(u,t.format(r[t.AliasIndex]));break}}this._copyLookupValues(r,f);f._dataView.changeLookupValue(f.Index,i.length==1?i[0]:i,u.join(";"))},_showModal:function(i){var r=this,e=r.get_tag(),s=r.get_lastViewId(),u=i.commandName,o=i.commandArgument,f;r.set_lastCommandName(null);r.set_lastCommandArgument(null);r._render();i.commandName=="Duplicate"&&(i.commandName="New");t&&r.get_isGrid()&&(u!="Edit"&&u!="New"||u&&o!=s||(e=(e||"")+" view-type-inline-editor"));f=n.showModal(this,r.get_controller(),o,u,o,r.get_baseUrl(),r.get_servicePath(),r.get_hasParent()||r._lookupInfo?r._externalFilter:null,{filter:r.get_selectedKeyFilter(),ditto:r.get_ditto(),lastViewId:s,filterSource:r.get_filterSource(),filterFields:r.get_filterFields(),showSearchBar:r.get_showSearchBar(),tag:e,showActionButtons:r.get_showActionButtons()});r.set_ditto(null);r._savePosition();f&&!f.inserting()&&(f._position=r._position);r._restorePosition()},_savePosition:function(){this.get_isForm()||this._selectedRowIndex==null||(this._position={index:this._pageSize*this._pageIndex+this._selectedRowIndex,count:this._totalRowCount,filter:this.get_filter(),sortExpression:this.get_sortExpression(),key:Array.clone(this._selectedKey),keyFilter:this._selectedKeyFilter,active:!1})},_restorePosition:function(){this._position&&(this._selectedKey=this._position.key,this._selectedKeyFilter=this._position.keyFilter,this._position=null)},_advance:function(n){this._isBusy||!this._position||n==-1&this._position.index==0||n==1&&this._position.index==this._position.count-1||(this._position.index+=n,this._position.changing=!0,this._position.changed=!0,this._loadPage(),this._position.changing=!1)},discard:function(){this.tag("discard-changes-prompt-none")},cancel:function(){var n=this,i;if(n._cancelCallback)n._cancelCallback(this);else if(!n._closeInstantDetails()){if(n.endModalState("Cancel"))return;n.get_backOnCancel()||!r(n._replaceTriggerViewId)?(n.goBack(!1),setTimeout(function(){location.replace(location.href)},500)):(i=n._lastCommandName,n.set_lastCommandName("Cancel"),n._pendingSelectedEvent=!0,n.get_isForm()||n.inserting()?t?location.replace(location.href):(n._forceSync(),n.goToView(n._lastViewId)):n._totalRowCount<0?n.goToPage(-1):(n._clearDynamicItems(),n._render(),_body_performResize()))}},_convertValuesToParameters:function(n){for(var i=0,t;i<n.length;)t=n[i],t.ReadOnly=!0,t.Name.match("PrimaryKey")?Array.removeAt(n,i):(t.Name="Parameters_"+t.Name,i++)},_actionConfirmed:function(t){var i=this,o=i._createArguments(t),f=o.Values,h=i._validateFieldValues(f,t.causesValidation==null||t.causesValidation),s;if(h){var r=i.get_confirmContext(),u=i.get_parentDataView(),e=n.find(t.commandArgument);e?($(f).each(function(){this.Name="Parameters_"+this.Name}),e._externalFilter=f,e.sync()):r&&u?(s=u._paramValues=o.Values,i._convertValuesToParameters(s),u._confirmDataViewId=i.get_id(),u._lookupActionProcessing(!1),u.executeAction(r.scope,r.actionIndex,r.rowIndex,r.groupIndex,!0,r.action),u._lookupActionProcessing(!0)):i._survey&&i.cancel()}},executeCommand:function(u){var f=this,d=!!f._skipInvoke,o=n.rules[f._controller],l,g=u.path,c,s=u.commandName,e=u.commandArgument,a,nt,rt,ut,v,p,h,ot,ct,b,ft,k;if(!f._isBusy){if(!d&&(o&&(s in o?(o=o[s],e&&e in o&&(o=o[e])):g&&(c=g.split(/\//),c[0]in o&&(o=o[c[0]]),c.length>1&&c[1]in o&&(o=o[c[1]]))),typeof o=="function"&&o(f,u)===!1&&(l=!0),l||(o=new it(f),o.before(u),o.canceled()&&(o.dispose(),l=!0)),l))return f._valid=s==="Calculate",f._valid;a=f._persist;a&&a.command===s&&(nt=f.values(),n.ensureJSONCompatibility(nt),(a.scope==="user"?n.userVar:n.sessionVar)("persist_"+f._controller+"_"+f._viewId,et(nt)));switch(s){case"Select":case"":f.set_lastCommandName(s);f.set_lastCommandArgument(e);f.get_lookupField()&&e===""?f._processSelectedLookupValues():(y(e)?f._render():(f._savePosition(),f.get_showModalForms()&&f.get_isForm(e)?f._showModal(u):f.goToView(e)),__designer()&&__designer_notifySelected(f));break;case"BatchEdit":f.batchEdit(e);break;case"Edit":case"New":case"Duplicate":if(t||(f._allowModalAutoSize(),f._fixHeightOfRow(!1),s==="Edit"?f._savePosition():f._restorePosition()),s==="Duplicate"&&(rt=f.get_selectedRow(),rt)){for(ut=[],i=0;i<f._allFields.length;i++)v=f._allFields[i],v.OnDemand||Array.add(ut,{name:v.Name,value:rt[v.Index],duplicated:!0});f._ditto=ut}if(t&&s==="Edit"&&f.get_isGrid()&&(!e||e===f.get_viewId()))f.inlineEditing()?t.edit.activate():$(document).trigger($.Event("inlineeditingmode.dataview.app",{dataView:f,inlineEditing:!0,editor:!0}));else{if(p=f._get_focusedCell(),h=f.extension(),s==="New"||s==="Duplicate"){if(t&&f.get_isGrid()&&(!e||e===f.get_viewId())){t.notify("Not implemented.");return}r(e)&&(e=u.commandArgument=f.get_viewId());h&&h.clearSelection?h.clearSelection(!0,s):f._forgetSelectedRow(!1,p);s==="New"&&f._copyExternalLookupValues()}ot=s==="Edit"&&e===f.get_viewId()&&!f.editing();f.set_lastCommandName(s);f.set_lastCommandArgument(e);f._clearDynamicItems();y(e)||ot?h&&h.stateChanged?h.stateChanged():(f.get_isModal()&&(f._container.style.height=""),f.get_isDataSheet()&&!f._pendingChars&&f._startInputListenerOnCell(f._selectedRowIndex,p==null?0:p.colIndex),f._render()):t||f.get_showModalForms()&&f.get_isForm(e)&&!f.get_isModal()?f._showModal(u):f.goToView(e);__designer()&&__designer_notifySelected(f)}break;case"Navigate":f.navigate(e);break;case"Cancel":f.cancel();break;case"Confirm":f._actionConfirmed(u);break;case"Back":history.go(r(e)?-1:tt(e));break;case"Report":case"ReportAsPdf":case"ReportAsImage":case"ReportAsExcel":case"ReportAsWord":f.executeReport(u);break;case"ExportCsv":case"ExportRowset":case"ExportRss":f.executeExport(u);break;case"_ViewDetails":f._viewDetails(e);break;case"ClientScript":kt();eval(e);break;case"SelectModal":case"EditModal":f.set_lastCommandName(null);f.set_lastCommandArgument(null);f._render();var lt=s.match(/^(\w+)Modal$/),w=e.split(","),at=w.length===1?f.get_controller():w[0],st=w.length===1?e:w[1],ht=[];for(i=0;i<f.get_selectedKey().length;i++)Array.add(ht,{Name:f._keyFields[i].Name,Value:f.get_selectedKey()[i]});ct=n.showModal(f,at,st,lt[1],st,f.get_baseUrl(),f.get_servicePath(),ht);ct._parentDataViewId=f.get_id();break;case"Import":t?n.import("upload",{dataView:f,view:e}):f._showImport(e);break;case"DataSheet":f.writeContext("GridType","DataSheet");f._forceFocusDataSheet=!0;f.changeViewType("DataSheet");f.refreshAndResize();break;case"Grid":f.writeContext("GridType","Grid");f.changeViewType("Grid");f.refreshAndResize();break;case"Status":f._changeStatus(u);break;case"Search":f._executeSearch(g);break;case"None":return!0;default:b=null;ft=e.match(/^view:(.+)$/);s==="Insert"&&ft&&(b=ft[1],Array.clear(f._selectedKey),f.updateSummary(),f.set_lastCommandName("New"),f.set_lastCommandArgument(b));k=f._createArguments(u,b);f._valid=f._validateFieldValues(k.Values,u.causesValidation!==!1);f._valid&&(d?f._invokeArgs=f._valid?k:f._validationError:f._execute(k))}if(!d)return o.after(u),o.dispose(),!o.canceled()}},_forgetSelectedRow:function(n,t){t||(t=this._get_focusedCell());this.get_isDataSheet()&&t&&(t.colIndex=0);this._lastSelectedRowIndex=!this._ignoreSelectedKey&&this._selectedKey.length>0&&this._rowIsSelected(this._selectedRowIndex)?this._selectedRowIndex:-1;this._ignoreSelectedKey=!1;Array.clear(this._selectedKey);this.updateSummary();n&&this.raiseSelected()},_changeStatus:function(n){var r,i,t,u;(!n.causesValidation||(r=this._collectFieldValues(),n.values&&(r=Array.clone(n.values)),this._validateFieldValues(r,!0)))&&(i=this.findField("Status"),i)&&(this.editing()?(t=this._get("_Item",i.Index),t||(t=document.createElement("input"),t.type="hidden",t.id=String.format("{0}_Item{1}",this._id,i.Index),this._container.appendChild(t)),t.value=n.commandArgument):(u=this.get_selectedRow(),u[i.Index]=n.commandArgument),this._updateVisibility())},_notifyDesigner:function(n){if(__designer()&&n){var t=this._lastArgs;external.ExplorerNodeChanged(this.get_controller(),this.get_viewId(),t.CommandName,t.CommandArgument,ot(t.Values))}},goBack:function(t){n._navigated=!0;this._notifyDesigner(t);var i=location;i.href.match(/_explorerNode=/)?i.replace(i.href):history.go(-1)},_viewDetails:function(t){var i=this.findField(t),o,u,s,f,e,h;if(i){if(o=i.Name,i.ItemsDataController==this.get_controller())for(u=0;u<this._allFields.length;u++)if(this._allFields[u].IsPrimaryKey){o=this._allFields[u].Name;break}if(s=this.get_contextFilter(i),__designer()){for(f=String.format("{0}&{1}={2}",i.ItemsDataController,r(i.ItemsDataValueField)?o:i.ItemsDataValueField,this.get_selectedRow()[i.Index]),u=0;u<s.length;u++)e=s[u],f=String.format("{0}&{1}={2}",f,e.Name,e.Value);f=this.resolveClientUrl(String.format("~/Details.{0}?l={1}",__designer()?"htm":"aspx",encodeURIComponent(f)));location.href=f;n._navigated=!1}else e=[{Name:r(i.ItemsDataValueField)?o:i.ItemsDataValueField,Value:this.fieldValue(i.Name)}],Array.addRange(e,s),h=n.showModal(this,i.ItemsDataController,"editForm1","Select","editForm1",this.get_baseUrl(),this.get_servicePath(),e,{useCase:"ObjectRef"}),h.set_showSearchBar(this.get_showSearchBar()),h._parentDataViewId=this.get_id(),h._closeViewDetails=!0}},changeViewType:function(n){this.cancelDataSheet();this._viewTypes||(this._viewTypes=[]);this._viewTypes[this.get_viewId()]=n;this._clearCache()},_parseLocation:function(n,t,i){var e,o,c,s;if(t||(t=this.get_selectedRow()),!n)return null;n=this.resolveClientUrl(n);for(var h=/([\s\S]*?)\{(\w+)?\}/g,u="",f=-1,r=h.exec(n);r;){if(u+=r[1],i&&this._lastArgs){for(e=0;e<i.length;e++)if(o=i[e],o.Name==r[2]){u+=this._lastArgs.CommandName.match(/Insert/i)?o.NewValue:o.OldValue;break}}else c=r[2].match(/^\d+$/)?this.get_fields()[tt(r[2])]:this.findField(r[2]),c&&(s=t[c.Index],s!=null&&(u+=r.index==0?s:encodeURIComponent(s)));f=h.lastIndex;r=h.exec(n)}return f!=-1&&(n=u+(f<n.length?n.substr(f):"")),n.startsWith("?")&&(n=location.pathname+n),n},_parseText:function(n,t){var i=this,u,f;if(t||(t=i.get_selectedRow()),!n)return null;var e=i.get_parentDataView(i),o=e._selectedKeyList,s=o?o.length:0;!s&&e._selectedKey&&e._selectedKey.length&&s++;o&&Array.indexOf(o,"null")!==-1&&s--;n=n.replace(/\{\$\s*count\}/gi,e._totalRowCount);n=n.replace(/\{\$\s*selected\}/gi,s);for(var c=/([\s\S]*?)\{(\w+)?\}/g,l="",h=-1,r=c.exec(n);r;)l+=r[1],u=r[2].match(/^\d+$/)?i.get_fields()[tt(r[2])]:i.findField(r[2]),u&&(u=i._allFields[u.AliasIndex],f=t[u.Index],f!=null&&(f=u.format(f),l+=f)),h=c.lastIndex,r=c.exec(n);return h!==-1&&(n=l+(h<n.length?n.substr(h):"")),n},_showImport:function(n){n||(n=this.get_viewId());this._importView=n;this._importElement=document.createElement("div");this._importElement.id=this.get_id()+"$Import";this._importElement.className="Import";var t=new Sys.StringBuilder,i=String.format("<a href=\"javascript:\" onclick=\"$find('{0}')._downloadImportTemplate('{1}');return false;\">{2}<\/a>",this.get_id(),n,s.Import.DownloadTemplate);t.appendFormat('<div id="{0}$ImportStatus" class="Status"><span>{1}<\/span> {2}<\/div>',this.get_id(),s.Import.UploadInstruction,i);t.appendFormat('<div id="{0}$ImportMap" class="Map" style="display:none"><\/div>',this.get_id());t.appendFormat('<iframe src="{1}?parentId={0}&controller={2}&view={3}" frameborder="0" scrolling="no" id="{0}$ImportFrame" class="Import"><\/iframe>',this.get_id(),this.resolveClientUrl(this.get_appRootPath()+"Import.ashx"),this.get_controller(),n);t.appendFormat('<div class="Email">{1}:<br/><input type="text" id="{0}$ImportEmail"/><\/div>',this.get_id(),s.Import.Email);t.appendFormat('<div class="Buttons"><button id="{0}$StartImport" onclick="$find(\'{0}\')._startImportProcessing();return false" style="display:none">{1}<\/button><button id="{0}$CancelImport" onclick="$find(\'{0}\')._closeImport();return false">{2}<\/button><\/div>',this.get_id(),s.Import.StartButton,ft.CancelButton);this._importElement.innerHTML=t.toLocaleString();this._appendModalPanel(this._importElement);this._importPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"$ImportPopup",PopupControlID:this._importElement.id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this._container.getElementsByTagName("a")[0]);this._saveTabIndexes();this._importPopup.show()},_closeImport:function(){this._disposeImport();this._restoreTabIndexes()},_disposeImport:function(){this._importElement&&(this._importPopup.hide(),this._importPopup.dispose(),this._importPopup=null,this._importElement.parentNode.removeChild(this._importElement),delete this._importElement)},_disposePendingUploads:function(){$(this._pendingUploads).each(function(){this.files=null;this.form=null});this._pendingUploads=null;$(this._container).find(".app-drop-box").each(function(){n.upload("destroy",{container:this})})},_downloadImportTemplate:function(n){this.executeExport({commandName:"ExportTemplate",commandArgument:String.format("{0},{1}",this.get_controller(),n)})},_initImportUpload:function(n){var t=n.createElement("div");t.innerHTML=String.format('<form method="post" enctype="multipart/form-data"><input type="file" id="ImportFile" name="ImportFile" style="font-size:8.5pt;font-family:tahoma;padding:2px 0px 4px 0px;" onchange="parent.window.$find(\'{0}\')._startImportUpload(this.value);this.parentNode.submit()"/><\/form>',this.get_id());n.body.appendChild(t);Sys.UI.DomElement.setFocus(n.getElementById("ImportFile"))},_get_importStatus:function(){return $get(this.get_id()+"$ImportStatus")},_get_importFrame:function(){return $get(this.get_id()+"$ImportFrame")},_startImportUpload:function(n){var t=n.split(/\\/);this._importFileName=t[t.length-1];Sys.UI.DomElement.setVisible(this._get_importFrame(),!1);$(this._get_importStatus()).addClass("Wait");this._get_importStatus().innerHTML=s.Import.Uploading},_finishImportUpload:function(t){var h,l,i,r,a,f,e,o,y,v;if(Sys.UI.DomElement.removeCssClass(this._get_importStatus(),"Wait"),Sys.UI.DomElement.addCssClass(this._get_importStatus(),"Ready"),h=t.getElementById("Errors"),h)this._get_importStatus().innerHTML=h.value;else{var w=t.getElementById("FileName"),p=t.getElementById("NumberOfRecords"),u=t.getElementById("AvailableImportFields").value.trim().split(/\r?\n/),c=t.getElementById("FieldMap").value.trim().split(/\r?\n/);for(this._get_importStatus().innerHTML=String.format(s.Import.MappingInstruction,p.value,this._importFileName),this._importFileName=t.getElementById("FileName").value,l=$get(this.get_id()+"$StartImport"),Sys.UI.DomElement.setVisible(l,!0),Sys.UI.DomElement.setFocus(l),i=new Sys.StringBuilder,i.append("<table>"),r=0;r<c.length;r++){for(a=c[r].match(/^(.+?)=(.+?)?$/),i.appendFormat('<tr><td>{2}<\/td><td><select id="{0}$ImportField{1}"><option value="">{3}<\/option>',this.get_id(),r,n.htmlEncode(a[1]),s.Import.AutoDetect),f=0;f<u.length;f++)e=u[f].split("="),e[0]==a[2]&&(i.appendFormat('<option value="{0}"',e[0]),i.append(' selected="selected"'),i.appendFormat(">{0}<\/option>",n.htmlEncode(e[1])));i.append("<\/select><\/td><\/tr>")}i.append("<\/table>");o=$get(this.get_id()+"$ImportMap");Sys.UI.DomElement.setVisible(o,!0);o.innerHTML=i.toString();y=$(o).find("select").change(function(){v()});v=function(){var i=Array.clone(c),t=[],n=0;y.each(function(){$(this).css("width","auto");this.value!=""&&Array.add(t,this.value)}).each(function(){var r=this,n,i;for($(r).find("option").filter(function(){return r.value!=this.value&&this.value!=""}).remove(),n=0;n<u.length;n++)i=u[n].split("="),Array.contains(t,i[0])||$(this).append($("<option>",{value:i[0]}).text(i[1]))}).each(function(){var t=$(this).outerWidth();t>n&&(n=t)}).css("width",n)};v()}this._importPopup.show();this._get_importFrame().parentNode.removeChild(this._get_importFrame())},_startImportProcessing:function(){var r=$get(this.get_id()+"$ImportEmail"),u=r.value.replace(/;/g,","),n,t,i;if(y(u)&&!confirm(s.Import.EmailNotSpecified)){Sys.UI.DomElement.setFocus(r);return}for(n=new Sys.StringBuilder,n.appendFormat("{0};{1};{2};{3};",this._importFileName,this.get_controller(),this._importView,u),t=0;;){if(i=$get(this.get_id()+"$ImportField"+t),!i)break;n.append(i.value);n.append(";");t++}this.executeCommand({commandName:"ProcessImportFile",commandArgument:n.toString()});this._closeImport();alert(s.Import.Processing);this.refresh()},navigate:function(n,t){var r,i;for(this.set_selectedValue(this.get_selectedKey()),kt(),n=this._parseLocation(n,null,t),i=0;i<this.get_views().length;i++)if(this.get_views()[i].Id==n){r=this.get_views()[i];break}r?this.goToView(n):this._navigate(n)},_navigate:function(i,r){n._navigated=!0;var u=i.match(n.LocationRegex),f=u?u[2]:i;typeof __dauh!="undefined"?u?this.encodePermalink(u[2],u[1],r):this.encodePermalink(i):t&&f.indexOf("http")!=-1&&(!u||u[1]=="_internal")?(n._navigated=!1,t.openExternalUrl(f,!1)()):u?(n._navigated=!1,open(u[2],u[1],r?r:"")):window.location.href=i},get_contextFilter:function(n,t){var e=[],o,f,i,c,s,a;if(!r(n.ContextFields))for(var h=t?t:this._collectFieldValues(!0),l=/(\w+)(\s*=\s*(.+?)){0,1}\s*(,|$)/g,u=l.exec(n.ContextFields);u;){if(o=r(u[3])?u[1]:u[3],f=o.match(/^\'(.+)\'$/),f||(f=o.match(/^(\d+)$/)),f){for(i=0;i<e.length;i++)if(e[i].Name==u[1]){e[i].Value+='\0='+f[1];f=null;break}f&&Array.add(e,{Name:u[1],Value:f[1],Literal:!0})}else if(c=this.findField(o),c)for(i=0;i<h.length;i++)if(h[i].Name==c.Name){s=h[i];a=s.Modified?s.NewValue:s.OldValue;Array.add(e,{Name:u[1],Value:a});break}u=l.exec(n.ContextFields)}return e},showLookup:function(n){var t,e,i,r,f;this.get_enabled()&&(t=this._allFields[n],t._lookupModalBehavior?t._lookupDataControllerBehavior._render():(e=$get(this.get_id()+"_Item"+t.Index+"_ShowLookupLink"),e&&(i=t._lookupModalPanel=document.createElement("div"),this._appendModalPanel(i),i.className="ModalPanel",i.id=this.get_id()+"_ItemLookupPanel"+t.Index,i.innerHTML=String.format('<table style="width:100%;height:100%"><tr><td valign="middle" align="center"><table cellpadding="0" cellspacing="0"><tr><td class="ModalTop"><div style="height:1px;font-size:1px"><\/div><\/td><td><div style="height:1px;font-size:1px"><\/div><\/td><\/tr><tr><td align="left" valign="top" id="{0}_ItemLookupPlaceholder{1}"  class="ModalPlaceholder"><\/td><td class="RightSideShadow"><\/td><\/tr><tr><td colspan="2"><div class="BottomShadow"><\/div><\/td><\/tr><\/table><\/td><\/tr><\/table>',this.get_id(),t.Index),t._lookupModalBehavior=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"_ItemLookup"+t.Index,PopupControlID:i.id,BackgroundCssClass:"ModalBackground"},null,null,e))),r=this.get_contextFilter(t),f=!0,t._lookupDataControllerBehavior?r.length>0&&(t._lookupDataControllerBehavior.set_externalFilter(r),t._lookupDataControllerBehavior.goToPage(-1),f=!0):(f=!1,t._lookupDataControllerBehavior=$create(Web.DataView,{id:this.get_id()+"_LookupView"+n,baseUrl:this.get_baseUrl(),pageSize:t.ItemsPageSize?t.ItemsPageSize:b.PageSizes[0],showFirstLetters:t.ItemsLetters,servicePath:this.get_servicePath(),controller:t.ItemsDataController,viewId:t.ItemsDataView,showActionBar:u.Lookup.ShowActionBar,lookupField:t,externalFilter:r,filterSource:r.length>0?"Context":null,showSearchBar:this.get_showSearchBar(),searchOnStart:this.get_showSearchBar()&&t.SearchOnStart,description:t.ItemsDescription},null,null,$get(this.get_id()+"_ItemLookupPlaceholder"+t.Index))),this._saveTabIndexes(),t._lookupModalBehavior.show(),f&&t._lookupDataControllerBehavior._focusQuickFind(!0),$addHandler(document.body,"keydown",t._lookupDataControllerBehavior._bodyKeydownHandler),t._lookupDataControllerBehavior._adjustLookupSize(),this._lookupIsActive=!0)},changeLookupValue:function(n,t,i){var u=this._allFields[n],r=this;r._focusedFieldName=u.Name;setTimeout(function(){var f,o,e;r._restoreTabIndexes();f=r.get_id()+"_Item"+n;o=r.get_id()+"_Item"+u.AliasIndex;Sys.UI.DomElement.setVisible($get(f+"_ClearLookupLink"),!0);e=$get(f+"_ShowLookupLink");e.innerHTML=r.htmlEncode(u,i);Sys.UI.DomElement.setFocus(e);t&&(t=u.format(t));$get(f).value=t;f!=o&&($get(o).value=i);$(e).closest("table").css("width","");r._updateLookupInfo(t,i);r._valueChanged(n);r._adjustModalHeight()},0);r._closeLookup(u)},clearLookupValue:function(n){var t=this._allFields[n],i=this.get_id()+"_Item"+n,s=this.get_id()+"_Item"+t.AliasIndex;if(Sys.UI.DomElement.setVisible($get(i+"_ClearLookupLink"),!1),$get(i+"_ShowLookupLink").innerHTML=u.Lookup.SelectLink,$get(i).value="",$get(s).value="",!r(t.Copy)){for(var e=[],o=/(\w+)=(\w+)/g,f=o.exec(t.Copy);f;)f[2]=="null"&&Array.add(e,{name:f[1],value:null}),f=o.exec(t.Copy);e.length>0&&this.refresh(!0,e)}this._updateLookupInfo("",u.Lookup.SelectLink);$get(i+"_ShowLookupLink").focus();this._valueChanged(n);this._adjustModalHeight()},_updateLookupInfo:function(n,t){var i=$get(this.get_id()+"_Text0"),r,u;i&&(i.value=t,i.name=i.id,r=$get(this.get_id()+"_Item0"),r.value=n,r.name=r.id,this.get_lookupPostBackExpression()&&(u=Sys.WebForms.PageRequestManager.getInstance(),u?eval("Sys.WebForms.PageRequestManager.getInstance()._doPostBack"+this.get_lookupPostBackExpression().match(/\w+(.+)/)[1]):eval(this.get_lookupPostBackExpression())))},createNewLookupValue:function(t){var i=this._newLookupValueField=this._allFields[t],r=this._createNewView=n.showModal(this,i.ItemsDataController,i.ItemsNewDataView,"New",i.ItemsNewDataView,this.get_baseUrl(),this.get_servicePath(),this.get_contextFilter(i));r._parentDataViewId=this.get_id();r.add_executed(Function.createDelegate(this,this._saveNewLookupValueCompleted));r.set_showSearchBar(this.get_showSearchBar());this._lookupIsActive=!0},_saveNewLookupValueCompleted:function(t,u){var f,h,o;if(!(u.result.Errors.length>0)){u.handled=!0;n.hideMessage();var c=null,e=this._newLookupValueField,s=e.ItemsDataValueField;for(r(s)&&(s=t._keyFields[0].Name),u.result.Values.length==0&&(u.result.Values=t._lastArgs.Values),f=0;f<u.result.Values.length;f++)if(u.result.Values[f].Name==s){c=u.result.Values[f].NewValue;break}for(h=null,o=e.ItemsDataTextField,r(o)&&(o=t._fields[0].Name),i=0;i<t._lastArgs.Values.length;i++)if(t._lastArgs.Values[i].Name==o){h=t._lastArgs.Values[i].NewValue;break}this._createNewView.endModalState("Cancel");this._copyLookupValues(null,e,t._lastArgs.Values);this.changeLookupValue(e.Index,c,h);this._lookupIsActive=!1}},hideLookup:function(n){var i=n?this._allFields[n]:this.get_lookupField(),t=this.get_lookupField()._dataView;t._closeLookup(i);t._restoreTabIndexes();$get(t.get_id()+"_Item"+i.Index+"_ShowLookupLink").focus()},closeLookupAndCreateNew:function(){this.hideLookup();var n=this.get_lookupField();n._dataView.createNewLookupValue(n.Index)},htmlEncode:function(t,i){var r=this._allFields[t.AliasIndex];return r.HtmlEncode?r.Type=="String"?n.htmlEncode(i):i:i},filterIsExternal:function(n){var t,r,u,i;if(this._externalFilter.length==0)return!1;for(t=0;t<this._filter.length;t++){if(r=this._filter[t].match(/(\w+):/)[1],u=!1,!n||n==r)for(i=0;i<this._externalFilter.length;i++)if(this._externalFilter[i].Name==r){u=!0;break}if(!u)return!1}return!0},updateSummary:function(){var n,e,i,v,f,c,l,o,s,a,h;if(this.get_showInSummary()&&!t&&(n=null,this._summaryId||(e=$getSideBar(),e?(this._summaryId="PageSummary_"+this.get_id(),n=$get("PageSummaryBox"),n||(n=document.createElement("div"),n.id="PageSummaryBox",n.className="TaskBox Summary",n.innerHTML=String.format('<div class="Inner"><div class="Summary">{0}<\/div><\/div>',u.Menu.Summary),e.insertBefore(n,e.childNodes[e._hasActivators?1:0]),n._numberOfVisibleSummaries=0),i=$get(this._summaryId),i||(i=document.createElement("div"),i.id=this._summaryId,n.childNodes[0].appendChild(i))):this._summaryId=""),this._summaryId)){if(n||(n=$get("PageSummaryBox")),!this._rows||this._rows.length==0){this._filterSource||Sys.UI.DomElement.setVisible(n,!1);return}v=this.get_selectedRow();i=$get(this._summaryId);var r=new Sys.StringBuilder,y=this._lastCommandName,p=this.get_view().Type;if(this.get_view().Type="Grid",this._lastCommandName=null,f=!0,this._selectedKey.length>0)for(c=!0,l=0,o=0;o<this._allFields.length;o++)if(s=this._allFields[o],s.ShowInSummary&&(f=!1,r.append('<div class="Field">'),c?c=!1:r.append('<div class="Divider"><\/div>'),r.appendFormat('<div class="Label">{0}<\/div>',String.trimLongWords(this._allFields[s.AliasIndex].Label)),r.append('<div class="Value">'),this._renderItem(r,s,v,!1,!1,!1,!1,!0),r.append("<\/div><\/div>"),l++,this.get_summaryFieldCount()>0&&l>=this.get_summaryFieldCount()))break;Sys.UI.DomElement.setVisible(i,!f);f&&this._summaryIsVisible?n._numberOfVisibleSummaries--:(f||this._summaryIsVisible)&&(f||this._summaryIsVisible!=null)||n._numberOfVisibleSummaries++;this._summaryIsVisible=!f;Sys.UI.DomElement.setVisible(n,n._numberOfVisibleSummaries>0);a=r.toString();i.innerHTML=a;h=this._lastArgs!=this._lastClearArgs&&this._lastArgs.CommandName==="Delete";t||f&&!h||this.get_filterSource()!=null||typeof Web.Membership=="undefined"||(h&&(this._lastClearArgs=this._lastArgs),Web.Membership._instance.addPermalink(String.format("{0}&_controller={1}&_commandName=Select&_commandArgument=editForm1",this.get_keyRef(),this.get_controller()),h?null:String.format('<div class="TaskBox" style="width:{2}px"><div class="Inner"><div class="Summary">{0}<\/div>{1}<\/div><\/div>',document.title,a,i.offsetWidth==0?135:i.offsetWidth)));r.clear();this._lastCommandName=y;this.get_view().Type=p}},hasDetails:function(){var n=this,t=n._hasDetails;return t||$(n._allFields).each(function(){if(this.Type==="DataView")return t=!0,!1}),!n.odp&&!!t&&!n._doneCallback},get_hasDetails:function(){return!!this._hasDetails},get_hasParent:function(){return this._hasParent===!0},add_selected:function(n){var t=this;t._dataViewFieldName||(t._hasDetails=!0);t.get_events().addHandler("selected",n)},remove_selected:function(n){this.get_events().removeHandler("selected",n)},raiseSelected:function(){var i,r;n._navigated||(i=t?t.edit._pending:null,i&&i.direction!=="enter"&&i.direction)||(r=this.get_events().getHandler("selected"),r&&r(this,Sys.EventArgs.Empty),this.multiSelect()||this.set_selectedValue(this.get_selectedKey()))},add_executed:function(n){this.get_events().addHandler("executed",n)},remove_executed:function(n){this.get_events().removeHandler("executed",n)},raiseExecuted:function(n){var t=this.get_events().getHandler("executed");t&&t(this,n)},_closeLookup:function(n){if($closeHovers(),n&&n._lookupModalBehavior&&(n._lookupModalBehavior.hide(),$removeHandler(document.body,"keydown",n._lookupDataControllerBehavior._bodyKeydownHandler)),this._lookupIsActive=!1,window.event){var t=new Sys.UI.DomEvent(event);t.stopPropagation();t.preventDefault()}},_collectFieldValues:function(t){var l,p,h,k,f,o,s,g,rt,e,c,a,w,nt,d,tt,b,v;if(t=!0,k=this.extension(),k&&k.collect)return k.collect();if(h=this.inserting(),l=[],p=this.get_selectedRow(),!p&&!h)return l;for(f=0;f<this._allFields.length;f++){var i=this._allFields[f],it=i.ItemsStyle=="RadioButtonList",u=this._get("_Item",f);if(i.ReadOnly&&!t)u=null;else if(it)for(o=0,s=$get(this.get_id()+"_Item"+f+"_"+o);s;){if(s.checked){u=s;break}else u=null;o++;s=$get(this.get_id()+"_Item"+f+"_"+o)}else if(i.ItemsStyle=="CheckBoxList"&&u&&(o=0,s=$get(this.get_id()+"_Item"+f+"_"+o),s))for(u.value="";s;)s.checked&&(u.value.length>0&&(u.value+=","),u.value+=s.value),o++,s=$get(this.get_id()+"_Item"+f+"_"+o);i.ClientEditor&&u?i.ClientEditor=="Web$DataView$RichText"&&(g=n.EditorFactories[i.ClientEditor.replace(".","$")],g.persist&&g.persist(u)):i.Editor&&u&&(rt=$get(u.id+"$Frame"),rt&&(editor=n.Editors[i.EditorId],editor&&(u.value=editor.GetValue())));e=u?u.value:null;e&&(i.Type.startsWith("Date")?(c=Date.tryParseFuzzyDate(e,i.DataFormatString),c!=null&&u.type=="text"&&(e=u.value=i.DateFmtStr?String.format(i.DateFmtStr,c):i.format(c))):!y(i.DataFormatString)&&i.isNumber()&&(a=Number.tryParse(e),a!=null&&(i.DataFormatString.match(/\{0:p\}/i)&&a>1&&(a=a/100),e=u.value=i.format(a))));i.TimeFmtStr&&(w=this._get("_Item$Time",f),w&&(c=Date.tryParseFuzzyTime(w.value),c!=null&&(w.value=String.localeFormat(i.TimeFmtStr,c),e+=" "+w.value)));!i.OnDemand&&(u||i.IsPrimaryKey||!i.ReadOnly||t)&&(nt=!0,d=!1,this._lastCommandName=="BatchEdit"&&(tt=$get(String.format("{0}$BatchSelect{1}",this.get_id(),i.Index)),d=i.TextMode==4||i.Hidden||i.ReadOnly,nt=i.IsPrimaryKey||d||tt&&tt.checked),nt&&Array.add(l,{Name:i.Name,OldValue:h?null:p[i.Index],NewValue:u&&e!=null?i.Type=="Boolean"&&e.length>0?e=="true":e.length==0?null:e:!h&&(i.TextMode==4||i.Hidden||i.ReadOnly)?p[i.Index]:null,Modified:u!=null&&!(!h&&i.Type=="String"&&r(e)&&r(p[i.Index]))||it&&h&&!i.AllowNulls,ReadOnly:i.ReadOnly&&!(i.IsPrimaryKey&&h)||d}))}for(f=0;f<this._externalFilter.length;f++)for(b=this._externalFilter[f],o=0;o<l.length;o++)if(v=l[o],v.Name.toLowerCase()==b.Name.toLowerCase()&&v.NewValue==null){v.NewValue=typeof b.Value=="string"?this.convertStringToFieldValue(this.findField(v.Name),b.Value):b.Value;v.Modified=!0;break}return l},_enumerateExpressions:function(n,t,i){var f=[],u,r;if(this._expressions)for(u=0;u<this._expressions.length;u++)r=this._expressions[u],r.Scope==t&&(n==Web.DynamicExpressionType.Any||r.Type==Web.DynamicExpressionType.RegularExpression)&&r.Target==i&&Array.add(f,r);return f},_prepareJavaScriptExpression:function(n){var t,f,u,e;if(!n._variables){for(var i=[],o=/(\[(\w+)\])|(\$row\.(\w+))/gm,r=o.exec(n.Test);r;){for(t=r[2]||r[4],f=!1,u=0;u<i.length;u++)if(i[u].name==t){f=!0;break}f||(e=this.findField(t),e&&Array.add(i,{name:t,regex:new RegExp("(\\["+t+"\\])|(\\$row\\."+t+")","g"),replace:String.format("this._javaScriptRowValue({0})",e.Index)}));r=o.exec(n.Test)}n._variables=i;n.Test=n.Test.replace(/\[(\w+)\.(\w+)\]/gi,"this.fieldValue('$2','$1')")}},_javaScriptRowValue:function(n){var u=this,o=u._javaScriptRow[n],r,l,s,f,e,h,c,i;return t?(r=u._allFields[n],r.Type=="DataView"?(i=u._javaScriptValues[r.Name],i||(l=r._dataViewId,l?(i={_ready:!0,_selected:!1},f=p(r._dataViewId),h=f._selectedKey,h.length&&(s=f.extension(),s&&(e=s.commandRow(),e&&e.length&&(f._allFields.forEach(function(n){i[n.Name]=e[n.Index]}),i._selected=h[0]!==undefined)))):i={_ready:!1,_selected:!1},u._javaScriptValues[r.Name]=i)):i=o,i):u._javaScriptRowConvert?(r=u._allFields[n],c={Name:r.Name,NewValue:o,Modified:!0},u._validateFieldValues([c],!1,!1,!1)?c.NewValue:null):o},_evaluateJavaScriptExpressions:function(t,i,r){for(var e=this,o=r?"":null,h,c,l,u,f,s=0;s<t.length;s++)if(u=t[s],u.Type==Web.DynamicExpressionType.ClientScript){if(e._prepareJavaScriptExpression(u),f=u._script,!f){for(f=u.Test,h=0;h<u._variables.length;h++)c=u._variables[h],f=f.replace(c.regex,c.replace);u._script=n.functions[f];u._script||(u._script=n.functions[f]=eval("(function(){return "+f+"})"));u._script==null?u._script=f:f=u._script}if(f)if(e._javaScriptValues={},e._javaScriptRow=i,e._javaScriptRowConvert=e.editing(),l=typeof f=="string"?eval(f):f.call(this),r)l&&(o==null?o=u.Result:o+=" "+u.Result);else return u.Result==null?l:u.Result}return o},_validateFieldValueFormat:function(n,t){var f=null,i,u;switch(n.Type){case"SByte":case"Byte":case"Int16":case"Int32":case"UInt32":case"Int64":case"Single":case"Double":case"Decimal":case"Currency":i=t.NewValue;typeof i!="number"&&(i=Number.tryParse(i));isNaN(i)||i==null?f=g.NumberIsExpected:(i!=null&&n.Type.match(/int|byte/i)&&(i=Math.round(i)),t.NewValue=i);break;case"Boolean":try{t.NewValue=d(String,t.NewValue)?Boolean.parse(t.NewValue):t.NewValue}catch(e){f=g.BooleanIsExpected}break;case"Date":case"DateTime":typeof t.NewValue=="string"?(u=n.DataFormatString,i=r(u)?Date.parse(t.NewValue):Date.parseLocale(t.NewValue,u.match(/\{0:([\s\S]*?)\}/)[1]),!i&&u&&(i=Date.parse(t.NewValue),i=isNaN(i)?null:new Date(i)),!i&&n.DateFmtStr&&n.TimeFmtStr&&(i=Date.tryParseFuzzyDateTime(t.NewValue,u)),i||(i=Date.tryParseFuzzyDate(t.NewValue,u)),!i&&n.TimeFmtStr&&(i=Date.tryParseFuzzyTime(t.NewValue)),i?t.NewValue=i:f=g.DateIsExpected):isNaN(t.NewValue.getTime())&&(f=g.DateIsExpected)}return f},validate:function(n){for(var t=0;t<n.length;t++)if(n[t].Error)return!1;return!0},_validateFieldValues:function(i,r,u,f){for(var d=this,h=!0,v=new Sys.StringBuilder,w,nt,e,s,o,ft,tt,b,l,it,rt,ut,c,a,k,p=0;p<i.length;p++)if(e=i[p],w=e.NewValue,nt=e.OldValue,s=this.findField(e.Name),s&&(!u||s.ColIndex===u.colIndex)){if(o=null,s.ReadOnly&&s.IsPrimaryKey)w==null&&nt!=null&&(e.NewValue=nt);else if(e.Modified){if(s.AllowNulls||s.HasDefaultValue&&!g.EnforceRequiredFieldsWithDefaultValue||!y(w)||s.Hidden||s.isReadOnly()||(o=g.RequiredField),!o&&y(w)&&(e.NewValue=null),o||e.NewValue==null||s.IsMirror||s.Hidden&&!e.Modified||(ft=this._validateFieldValueFormat(s,e,f),s.isReadOnly()||(o=ft)),!o)for(tt=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,e.Name),b=0;b<tt.length;b++){l=tt[b];it=e.NewValue?e.NewValue:"";try{rt=new RegExp(l.Test);ut=rt.exec(it);l.Result.match(/\$(\d|\'\`)/)?ut&&(e.NewValue=it.replace(rt,l.Result)):ut||(o=o?o+=l.Result:l.Result)}catch(et){}}e.Modified=s.Type.startsWith("DateTime")?(e.NewValue==null?null:e.NewValue.toString())!=(e.OldValue==null?null:e.OldValue.toString()):e.NewValue!=e.OldValue}if(e.Error=o,t)o&&r&&h&&(!t||n.input.visible(s)?(this._focus(s.Name,o),h=!1):t&&(o=null,e.Error=null));else{if(c=$get(this.get_id()+"_Item"+s.Index+"_Error"),c&&r)for(Sys.UI.DomElement.setVisible(c,!1),c.innerHTML=o,o!=null&&h&&this._showFieldError(s,o),a=c.parentNode;a&&a.tagName!="BODY";){if(!$common.getVisible(a)){c=null;break}a=a.parentNode}o&&r&&(h&&(k=this._lastFocusedCell,k&&(this._focusCell(-1,-1,!1),this._focusCell(k.rowIndex,k.colIndex,!0),this._lastFocusedCell=null),this._focus(s.Name)),h=!1,c||v.append(n.formatMessage("Attention",s.Label+": "+o)))}}return h&&n.upload()&&$(this._allFields).each(function(){var i=this,u;if(i.OnDemand&&(u=n.upload("validate",{container:yi(d,i),dataViewId:d._id,fieldName:i.Name}),!i.AllowNulls&&!u&&r))return h=!1,o=g.Required,t?d._focus(i.Name,o):v.appendFormat("<b>{0}<\/b>: {1}",i.Label,o),!1}),r||(h=!0),h||(this._skipInvoke?this._validationError=v.toString():n.showMessage(v.toString())),v.clear(),h},_fieldIsInExternalFilter:function(n){return this._findExternalFilterItem(n)!=null},_findExternalFilterItem:function(n){for(var i,t=0;t<this._externalFilter.length;t++)if(i=this._externalFilter[t],n.Name.toLowerCase()===i.Name.toLowerCase())return i;return null},_internalFocus:function(){var n=$get(this._focusId);if(n)try{n.value="";n.value=this._focusText;Sys.UI.DomElement.setCaretPosition(n,this._focusText.length)}catch(t){}},_showFieldError:function(t,i){var r=this._get("_Item",t.Index+"_Error"),f,h,u,o;if(r&&(Sys.UI.DomElement.setVisible(r,i!=null),i))if(this._skipErrorReset=!0,r.style.marginLeft="0px",r.style.marginTop="0px",r.innerHTML=String.format('{0} <a href="javascript:" onclick="Sys.UI.DomElement.setVisible(this.parentNode, false);$find(\'{2}\')._focus(\'{3}\');return false" class="Close" title="{1}"><span>&nbsp;<\/span><\/a>',i,ft.Close,this.get_id(),t.Name),this.get_isForm())f=$common.getPaddingBox(r.previousSibling?r.previousSibling:r),r.style.marginLeft=f.left+"px",r.style.marginTop="1px";else{var c=n.scrolling(),l=$common.getClientBounds(),s=$common.getBounds(r),e=s.x+s.width-(c.x+l.width);for(e<0&&(e=0),h=$common.getBounds(r.parentNode),f=$common.getPaddingBox(r.parentNode),u=r.nextSibling;u&&u.nodeType!=1;)u=u.nextSibling;o=$common.getBounds(u?u:r);r.style.marginLeft=-(o.x-h.x+1+e)+"px";r.style.marginTop=o.height+f.bottom+"px"}},_focus:function(i,u){var f,o,e,v,c,s,y,h,k,p,a;if(!this._skipFocus){if(t){this.extension().focus(i,u);return}if(u)for(f=0;f<this.get_fields().length;f++)this._showFieldError(this.get_fields()[f]);if(o=this._get_focusedCell(),o&&this.editing()&&this._id===n._activeDataSheetId){if(!r(i)){for(e=null,v=!1,f=0;f<this._fields.length;f++)if(e=this._fields[f],e.Name===i){this._focusCell(o.rowIndex,o.colIndex,!1);v=o.colIndex!==f;o={rowIndex:this._selectedRowIndex,colIndex:f};this._continueAfterScript||(this._saveAndNew=!1);break}!r(u)&&e&&(v&&(this._focusCell(o.rowIndex,o.colIndex,!0),this.refresh(!0)),this._showFieldError(e,u))}if(c=this._focusCell(o.rowIndex,o.colIndex,!0),c){for(s=c.getElementsByTagName("input"),y=!1,f=0;f<s.length;f++)if(s[f].type!=="hidden"){y=!0;break}for(y||(s=c.getElementsByTagName("textarea")),s.length||(s=c.getElementsByTagName("select")),s.length||(s=c.getElementsByTagName("a")),f=0;f<s.length;f++)if(h=s[f],h.tagName!=="INPUT"||h.type!=="hidden"){(h.tagName==="INPUT"||h.tagName==="TEXTAREA")&&this._pendingChars!=null?(this._focusText=this._pendingChars,this._focusId=h.id,k=this,setTimeout(function(){k._internalFocus()},50)):Sys.UI.DomElement.setFocus(h);break}}this._pendingChars=null;return}for(r(i)&&!r(this._focusedFieldName)&&(e=this.findField(this._focusedFieldName),e&&(i=e.Name)),this._focusedFieldName=i,f=0;f<this.get_fields().length;f++)if(e=this.get_fields()[f],p=e.ItemsStyle==="AutoComplete"&&(e.Name===i||e.AliasName===i||r(i)),!e.ReadOnly&&(i==null||e.Name===i||p)){a=this.get_id()+"_Item"+(p?e.AliasIndex:e.Index);switch(e.ItemsStyle){case"RadioButtonList":case"CheckBoxList":a+="_0";break;case"Lookup":a+="_ShowLookupLink"}var w=$get(a),b=$(w).data("focus"),d=$get(String.format("{0}_ItemContainer{1}",this.get_id(),e.Index)),g=this._categories[e.CategoryIndex],l=Array.indexOf(this._tabs,g.Tab);if(i&&l>=0&&this.set_categoryTabIndex(l),this._toggleCategoryVisibility(e.CategoryIndex,!0),w&&(!d||Sys.UI.DomElement.getVisible(d)||b)&&(i||l===this.get_categoryTabIndex()||!this._tabs.length)){l>=0&&this.set_categoryTabIndex(l);try{u&&this._showFieldError(e,u);b?b():Sys.UI.DomElement.setFocus(w)}catch(nt){}break}}}},_serverFocus:function(n,t){this._focus(n,t);this.get_isDataSheet()&&(this.refresh(!0),this._focus(n,t))},_saveTabIndexes:function(){var t,u,i,r;for(this._lastSavedTabIndexes=this._savedTabIndexes,this._savedTabIndexes=[],t=0;t<n._tagsWithIndexes.length;t++)for(u=document.getElementsByTagName(n._tagsWithIndexes[t]),i=0;i<u.length;i++)r=u[i],r&&Array.add(this._savedTabIndexes,{element:r,tabIndex:r.tabIndex})},_restoreTabIndexes:function(){if(this._savedTabIndexes){for(var n=0;n<this._savedTabIndexes.length;n++)this._savedTabIndexes[n].element.tabIndex=this._savedTabIndexes[n].tabIndex,delete this._savedTabIndexes[n].element;Array.clear(this._savedTabIndexes)}this._savedTabIndexes=this._lastSavedTabIndexes;this._lastSavedTabIndexes=null},_selectKeyByRowIndex:function(n){this._selectKeyByRow(this._rows[n])},_selectKeyByRow:function(n){var i,t,r;if(n){for(this._selectedRow=n,i=this._selectedKey,this._selectedKey=[],this._selectedKeyFilter=[],t=0;t<this._keyFields.length;t++)r=this._keyFields[t],Array.add(this._selectedKey,n[r.Index]),Array.add(this._selectedKeyFilter,r.Name+":="+this.convertFieldValueToString(r,n[r.Index])),i&&(i.length<t||i[t]!=this._selectedKey[t])&&(i=null);this.updateSummary();i||this._raiseSelectedDelayed||this.raiseSelected()}},_showWait:function(n){var r,i,f;t||(r=u.Common.WaitHtml,this.get_fields()==null||n?(this._container.innerHTML=this.get_isModal()||this.get_lookupField()?r:'<div class="dataview-busy-whitespace"><\/div>',$(this._container).find(".Wait").addClass("dataview")):(i=$get(this.get_id()+"_Wait"),i&&(this._oldWaitHTML=i.innerHTML,i.innerHTML=r)),f=this.extension(),f&&f.wait())},_hideWait:function(){if(this._oldWaitHTML!=null){var n=$get(this.get_id()+"_Wait");n&&(n.innerHTML=this._oldWaitHTML)}},_get_colSpan:function(){return this.get_isForm()?2:this.get_fields().length+(this.multiSelect()?1:0)+(this.get_showIcons()?1:0)+(this.get_isDataSheet()?1:0)+(this._actionColumn?1:0)},_renderCreateNewBegin:function(n,t){r(t.ItemsNewDataView)||n.append('<table cellpadding="0" cellspacing="0"><tr><td>')},_renderCreateNewEnd:function(n,t){r(t.ItemsNewDataView)||(n.append("<\/td><td>"),this.get_enabled()&&n.appendFormat('<a href="#" class="CreateNew" onclick="$find(\'{0}\').createNewLookupValue({1});return false" id="{0}_Item{1}_CreateNewLookupLink" title="{2}"{3}>&nbsp;<\/a>',this.get_id(),t.Index,String.format(u.Lookup.NewToolTip,t.Label),String.format(' tabindex="{0}"',$nextTabIndex())),n.append("<\/td><\/tr><\/table>"))},_raisePopulateDynamicLookups:function(){var t=this;t._hasDynamicLookups&&t.editing()&&t._skipPopulateDynamicLookups!==!0&&(t._survey?n.survey("populateItems",{dataView:t,callback:function(n){var i={Values:[]};$(t._allFields).each(function(){var t=this,r;$(n).each(function(){if(this.Name===t.Name)return r=!0,!1});t.ItemsAreDynamic&&r&&i.Values.push({Name:t.Name,NewValue:t.Items})});t._populateDynamicLookups(i)}}):t.executeCommand({commandName:"PopulateDynamicLookups",commandArgument:"",causesValidation:!1}));t._skipPopulateDynamicLookups=!1},_raiseCalculate:function(n,t){this.executeCommand({commandName:"Calculate",commandArgument:n.Name,causesValidation:!1,trigger:t.Name})},get_currentRow:function(){var n=this;return n.inserting()?t?n.editRow():n._newRow?n._newRow:[]:n.get_selectedRow()},fieldValue:function(n,i){var f=this,r,e,u,o=null,s;return n==="_wizard"?(s=$("#"+f._id+" [data-layout]").data("wizard-config"),o=s?s.active:0):(r=!i||!i.length?f:i.match(/^master$/i)?f.get_master():$find(i),r&&r._allFields&&(e=r.findField(n),e&&(t?u=r.editRow():(u=r._clonedRow,u||(u=r._cloneChangedRow())),o=u?u[e.Index]:null))),o},_useLEVs:function(n){var r,t,e,u;if(n&&this._allowLEVs&&(r=this._get_LEVs(),r.length>0))for(i=0;i<r[0].length;i++)if(t=r[0][i],f=this.findField(t.Name),f&&f.AllowLEV){if(this._lastCommandName==="New"&&t.Modified&&t.NewValue!=null){for(e=!0,u=0;u<this._externalFilter.length;u++)if(this._externalFilter[u].Name.toLowerCase()===t.Name.toLowerCase()){e=!1;break}e&&(n[f.Index]=t.NewValue)}f._LEV=t.Modified?t.NewValue:null}},_configure:function(n){var u,t,f,i,e,o;if(this._requiresConfiguration&&(n||(n=this.get_currentRow()),n))for(u=0;u<this._allFields.length;u++)if(t=this._allFields[u],!r(t.Configuration))for(f=/\s*(\w+)=(\w+)\s*?($|\n)/g,i=f.exec(t.Configuration);i;)e=this.findField(i[2]),e&&(o=n[e.Index],o&&(t[i[1]]=o)),i=f.exec(t.Configuration)},_focusQuickFind:function(n){if(!this._quickFindFocused||n===!0){this._lostFocus=!0;try{Sys.UI.DomElement.setFocus(this.get_quickFindElement())}catch(t){}this._quickFindFocused=!0}},_restoreEmbeddedViews:function(){var t,n;if(this._embeddedViews){for(t=0;t<this._embeddedViews.length;t++)n=this._embeddedViews[t],n.parent.appendChild(n.view._element),delete n.parent,n.view=null;Array.clear(this._embeddedViews)}},_incorporateEmbeddedViews:function(){var n;if(this._embeddedViews)for(n=0;n<this._embeddedViews.length;n++){var t=this._embeddedViews[n],r=$get("v_"+t.view.get_id()),i=t.view._element;t.parent=i.parentNode;r.appendChild(i)}},raiseSelectedDelayed:function(){this._raiseSelectedDelayed&&(this._raiseSelectedDelayed=!1,this.raiseSelected(),this._forceChanged=!1)},refreshChildren:function(){var n=this.get_parentDataView(this);n._forceChanged=!0;n._raiseSelectedDelayed=!0;n._isBusy||n.refresh(!0)},_render:function(i){var r=this,f,e,u;if(t)try{i&&r._refreshExtension();r.get_parentDataView(r).raiseSelectedDelayed()}catch(o){t.notify(o)}else r._restoreEmbeddedViews(),r._detachBehaviors(),r._disposeSearchBarExtenders(),r._useLEVs(),r._configure(),r._internalRender(),r._viewMessages&&r.showViewMessage(r._viewMessages[r.get_viewId()]),r._raisePopulateDynamicLookups(),!r.get_modalAnchor()&&r.get_lookupField()&&r._focusQuickFind(),r.raiseSelectedDelayed(),r._scrollIntoView&&(r._scrollIntoView=!1,f=$common.getBounds(r._element),e=n.scrolling(),f.y<e.y&&r._element.scrollIntoView(!0)),r._incorporateEmbeddedViews(),r.get_isModal()&&r._adjustModalPopupSize(),r.get_searchOnStart()&&r.get_isGrid()&&(r._focusSearchBar(),r.set_searchOnStart(!1)),r.get_isDataSheet()&&(u=r._get_focusedCell(),r.inserting()&&!u?r._startInputListenerOnCell(0,0):u&&r._id===n._activeDataSheetId&&(r._skipCellFocus=!0,r._focusCell(-1,-1,!0))),r.get_isGrid()&&r._synced&&(r._synced=!1,r._selectedRowIndex==null&&(r._forgetSelectedRow(!0),r.refresh(!0))),r._syncKeyFilter()},_syncKeyFilter:function(){var i=this.get_selectedKey(),n,t;if(i.length>0&&this._selectedKeyFilter.length==0)for(n=0;n<this._keyFields.length;n++)t=this._keyFields[n],Array.add(this._selectedKeyFilter,t.Name+":="+this.convertFieldValueToString(t,i[n]))},_mergeRowUpdates:function(n){var u,f,i,r,t;if(this._lastCommandName=="BatchEdit"&&(u=this._batchEdit=[],f=this._allFields,$(this._element).find(".BatchSelect input:checkbox:checked").each(function(){var n=this.id.match(/BatchSelect(\d+)$/),t;n&&(t=f[tt(n[1])],Array.add(u,t.Name))})),this._originalRow=null,this._useLEVs(n),this.editing()&&this._ditto){for(this._originalRow=Array.clone(n),i=0;i<this._ditto.length;i++)r=this._ditto[i],t=this.findField(r.name),!t||t.ReadOnly&&t.IsPrimaryKey||(n[t.Index]=r.value);delete this._ditto}this._configure(n);this._mergedRow=n},_removeRowUpdates:function(){var t=this._mergedRow,n;if(t){if(this._originalRow)for(n=0;n<this._originalRow.length;n++)t[n]=this._originalRow[n];this._mergedRow=null}},_internalRender:function(){var o,t,s,i,r,h,f,e,v;if(this._multipleSelection=null,this._dynamicActionButtons=!1,o=this.get_viewType(),t=new Sys.StringBuilder,this.get_mode()==Web.DataViewMode.Lookup)i=this._fields[0],r=this.get_lookupText(),r==null&&(r=u.Lookup.SelectLink),h=i.format(r),this._renderCreateNewBegin(t,i),t.appendFormat('<table cellpadding="0" cellspacing="0" class="DataViewLookup"><tr><td><a href="javascript:" onclick="$find(\'{0}\').showLookup({1});return false" class="Select" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{7}"{8}>{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{5}" tabindex="{7}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Text{1}" value="{6}"/>',this.get_id(),i.Index,this.htmlEncode(i,h),String.format(resourcesLookup.SelectToolTip,i.Label),this.get_lookupValue(),String.format(u.Lookup.ClearToolTip,i.Label),n.htmlAttributeEncode(h),$nextTabIndex(),this.get_enabled()?"":' disabled="true" class="Disabled"'),this._renderCreateNewEnd(t,i),this.get_element().appendChild(this._container),this._container.innerHTML=t.toString(),this.get_lookupValue()!=""&&this.get_enabled()||($get(this.get_id()+"_Item0_ClearLookupLink").style.display="none");else{if(s=o=="Form",t.appendFormat('<table class="DataView {1}_{2}{3}{4} {5}Type" cellpadding="0" cellspacing="0"{0}>',this.get_isModal()?String.format(' style="width:{0}px"',this._container.offsetWidth-20):"",this.get_controller(),this.get_viewId(),this._numberOfColumns>0?" MultiColumn":"",this._tabs.length>0?" Tabbed":"",o),s?this._renderFormView(t):this._renderGridView(t),t.append("<\/table>"),this._mergedRow){var c=this._get_focusedCell(),l=this.inserting(),a=this.get_isDataSheet();for(f=0;f<this._allFields.length;f++)e=this._allFields[f],v=c&&f!=this._fields[c.colIndex].Index,(e.Hidden&&(!e.IsPrimaryKey||l)||v||!c&&l&&a)&&(r=this._mergedRow[f],(r!=null||a&&!l)&&t.appendFormat('<input id="{0}_Item{1}" type="hidden" value="{2}"/>',this.get_id(),f,n.htmlAttributeEncode(r!=null?e.format(r):"")))}this._container.innerHTML=t.toString();this._multipleSelection!=null&&this._multipleSelection==!0&&($get(this.get_id()+"_ToggleButton").checked=!0);this._attachBehaviors();this._updateVisibility();this.editing()&&(this._lastCommandName=="BatchEdit"&&$(this._element).find("div.BatchSelect input:checkbox:checked").each(function(){n._updateBatchSelectStatus(this,s)}),this._focus())}t.clear();this._updateChart();this._updateSearchBar();this._removeRowUpdates();this._fixWidthOfColumns();this._fixHeightOfRow(!0);this._refreshExtension()},_refreshExtension:function(){var n=this.extension(),t=this._lastExtension;n!=t&&(t&&t.hide(),n&&n.show(),this._lastExtension=n);n&&n.refresh()},_get_headerRowElement:function(){for(var t=this._container.childNodes[0].childNodes[0].childNodes,n=0;n<t.length;){if(Sys.UI.DomElement.containsCssClass(t[n],"HeaderRow"))return t[n];n++}return null},_fixWidthOfColumns:function(){var t,i,n,u,f,h,e;if((this.get_isDataSheet()||this.get_isGrid())&&!this.extension()&&(t=this._get_headerRowElement(),t)){if(this._viewColumnSettings||(this._viewColumnSettings=[]),i=this._viewColumnSettings[this.get_viewId()],!i){for(i=[],$(t).addClass("Fixed"),n=0;n<t.childNodes.length;n++){if(u=t.childNodes[n],f=$common.getBounds(u),f.width==0){Sys.UI.DomElement.removeCssClass(t,"Fixed");return}var o=$common.getPaddingBox(u),s=$common.getBorderBox(u),r={w:f.width-o.horizontal-s.horizontal,h:f.height-o.vertical-s.vertical};Array.add(i,r)}for(h=$common.getBounds(t),n=0;n<i.length;n++)i[n].h=h.height;this._viewColumnSettings[this.get_viewId()]=i;Sys.UI.DomElement.removeCssClass(t,"Fixed")}for(n=0;n<t.childNodes.length;n++)r=i[n],r&&(e=t.childNodes[n],e.style.height=r.h+"px",e.style.width=r.w+"px")}},_fixHeightOfRow:function(n){var i,e,f,r,t,u,o;if((this.get_isDataSheet()||this.get_isGrid())&&(!n||this.editing())){if(i=this._get_headerRowElement(),!i)return;if(e=this._get_focusedCell(),f=this.get_isGrid()?this._selectedRowIndex:e.rowIndex,f>=0){for(r=i.parentNode,t=0;t<r.childNodes.length;t++)if(r.childNodes[t]==i)break;u=r.childNodes[t+f+1];u&&(n?this._selectedRowHeight&&(u.style.height=this._selectedRowHeight+"px"):(o=$common.getBounds(u),this._selectedRowHeight=o.height))}}},_updateChart:function(){var t,i,n,u,r;this.get_isChart()&&(t=this._get("$Chart"),i=t.offsetWidth,i<100&&(i=t.parentNode.offsetWidth),n=this._createParams(),delete n.LookupContextFieldName,delete n.LookupContextController,delete n.LookupContextView,delete n.LookupContext,delete n.LastCommandName,delete n.LastCommandArgument,delete n.Inserting,delete n.DoesNotRequireData,u=ot(n),r=this,r._chartHeight&&(t.style.height=r._chartHeight+"px"),$(t).one("load",function(){try{r._chartHeight=$(this).height()}catch(n){}}).attr("src",String.format("{0}ChartHost.aspx?c={1}_{2}&w={3}&r={4}",this.get_baseUrl(),this.get_controller(),this.get_viewId(),i,encodeURIComponent(u))))},_toggleCategoryVisibility:function(n,t){var r=$get(String.format("{0}$Category${1}",this.get_id(),n)),f,i;r&&(f=this.get_categories()[n],t||(t=!Sys.UI.DomElement.getVisible(r)),$(r).css("display",t?"":"none"),i=$get(String.format("{0}$CategoryButton${1}",this.get_id(),n)),f.Collapsed=!t,t?(Sys.UI.DomElement.removeCssClass(i,"Maximize"),i.childNodes[0].title=u.Form.Minimize):($(i).addClass("Maximize"),i.childNodes[0].title=u.Form.Maximize),_body_performResize())},_processTemplatedText:function(n,t){var e,r,i,u,f,o,s;if(t||(t=""),e=/\{(\w+)\}/g,r=e.exec(t),!r)return t;for(i=new Sys.StringBuilder,u=0;r;)i.append(t.substring(u,r.index)),f=r[1],u=r.index+f.length+2,o=this.findField(f),o?(i.append('<span class="FieldPlaceholder">'),this._renderItem(i,o,n,!1,!1,!1,!1,!1,!0),i.append("<\/span>")):i.appendFormat("[{0}]",f),r=e.exec(t);return s=t.length-1,u<s&&i.append(t.substring(u,s)),i.toString().replace(/ (id|for)=\".+?\"/g,"")},_get_selectedTab:function(){return this._tabs.length>0?this._tabs[this.get_categoryTabIndex()]:null},_renderFormView:function(t){var it=this.editing(),o,h,p,tt,w,a,b,y,e,l,d,g,s,nt;if(this._renderStatusBar(t),this._renderViewDescription(t),u.Form.ShowActionBar&&this._renderActionBar(t),o=this.get_currentRow(),this._mergeRowUpdates(o),this._updateVisibility(o),this.inserting()&&this._expressions)for(i=0;i<this._expressions.length;i++)h=this._expressions[i],h.Scope==Web.DynamicExpressionScope.DefaultValues&&h.Type==Web.DynamicExpressionType.ClientScript&&(f=this.findField(h.Target),f&&o[f.Index]==null&&(r(h.Test)?o[f.Index]=h.Result:(p=eval(h.Test),p&&(o[f.Index]=r(h.Result)?p:h.Result))));for(tt=0,i=0;i<this._allFields.length;i++)this._allFields[i].Hidden||tt++;if(w=o!=null,w&&this._renderActionButtons(t,"Top","Form"),a=this._get_selectedTab(),this._tabs.length>0){for(t.appendFormat('<tr class="TabsRow"><td colspan="{0}" class="TabsBar{1}">',this._get_colSpan(),w?"":" WithMargin"),t.append('<table cellpadding="0" cellspacing="0" class="Tabs"><tr>'),i=0;i<this._tabs.length;i++)t.appendFormat('<td id="{2}_Tab{3}" class="Tab{1}" onmouseover="$hoverTab(this,true)" onmouseout="$hoverTab(this,false)"><span class="Outer"><span class="Inner"><span class="Tab"><a href="javascript:" onclick="$find(&quot;{2}&quot;).set_categoryTabIndex({3});return false;" onfocus="$hoverTab(this,true)" onblur="$hoverTab(this,false)" tabindex="{4}">{0}<\/a><\/span><\/span><\/span><\/td>',n.htmlEncode(this._tabs[i]),i==this.get_categoryTabIndex()?" Selected":"",this.get_id(),i,$nextTabIndex());t.append("<\/tr><\/table><\/td><\/tr>")}if(o)if(b=this._get_template(),b)t.appendFormat('<tr class="CategoryRow"><td valign="top" class="Fields" colspan="{0}">',this._get_colSpan()),this._renderTemplate(b,t,o,!0,!1),t.append("<\/td><\/tr>");else{var v=this.get_categories(),c=this.get_fields(),k=this._numberOfColumns;if(k>0){for(t.appendFormat('<tr class="Categories"><td class="Categories" colspan="{0}"><table class="Categories"><tr class="CategoryRow">',this._get_colSpan()),y=0;y<k;y++){for(y>0&&t.append('<td class="CategorySeparator">&nbsp;<\/td>'),t.appendFormat('<td class="CategoryColumn" valign="top" style="width:{0}%">',100/k),i=0;i<v.length;i++)if(e=v[i],e.ColumnIndex==y||this._ignoreColumnIndex){for(this.get_isModal()&&(e.Collapsed=!1),t.appendFormat('<div id="{0}_Category{1}" class="Category {3}" style="display:{2}">',this.get_id(),i,!a||a==e.Tab?"block":"none",e.Id),l=this._processTemplatedText(o,e.Description),d=this._formatViewText(u.Views.DefaultCategoryDescriptions[l],!0,l),t.appendFormat('<table class="Category {8}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText"><span class="Text">{0}<\/span><a href="javascript:" class="MinMax{6}" onclick="$find(\'{2}\')._toggleCategoryVisibility({3});return false;" id="{2}$CategoryButton${3}" style="{5}"><span title="{4}"><\/span><\/a><div style="clear:both;height:1px;margin-top:-1px;"><\/div><\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}" style="display:{7}">{1}<\/td><\/tr><\/table>',e.HeaderText,d,this.get_id(),i,e.Collapsed?u.Form.Maximize:u.Form.Minimize,v.length>1&&!this.get_isModal()?"":"display:none",e.Collapsed?" Maximize":"",r(d)?"none":"block",e.Id),g=!0,j=0;j<c.length;j++)if(s=c[j],!s.Hidden&&s.CategoryIndex==e.Index){g=!1;break}if(!g){if(t.appendFormat('<table class="Fields" id="{0}$Category${1}" style="{2}"><tr class="FieldsRow"><td class="Fields" valign="top" width="100%">',this.get_id(),i,e.Collapsed?"display:none":""),r(e.Template))for(j=0;j<c.length;j++)s=c[j],s.Hidden||s.CategoryIndex!=e.Index||(nt=s.Name.match(/^(_[A-Za-z_]+)\d/),t.appendFormat('<table cellpadding="0" cellspacing="0" class="FieldWrapper {0}"><tr class="FieldWrapper"><td class="Header" valign="top">',nt?nt[1]:s.Name),this._renderItem(t,s,o,!0,!1,!1,!0),t.appendFormat('<\/td><td class="Item{0}" valign="top">',it&&!s.isReadOnly()?"":" ReadOnly"),this._renderItem(t,s,o,!0),t.append("<\/td><\/tr><\/table>"));else this._renderTemplate(e.Template,t,o,!0,!1);t.append("<\/td><\/tr><\/table>")}t.append("<\/div>")}t.append("<\/td>")}t.append("<\/tr><\/table><\/td><\/tr>")}else for(i=0;i<v.length;i++){if(e=v[i],l=this._processTemplatedText(o,e.Description),t.appendFormat('<tr class="CategoryRow {5}" id="{2}_Category{3}" style="display:{4}"><td valign="top" class="Category {5}"><table class="Category {5}" cellpadding="0" cellspacing="0"><tr><td class="HeaderText">{0}<\/td><\/tr><tr><td class="Description" id="{2}$CategoryDescription${3}">{1}<\/td><\/tr><\/table><\/td><td valign="top" class="Fields {5}">',e.HeaderText,this._formatViewText(u.Views.DefaultCategoryDescriptions[l],!0,l),this.get_id(),i,!a||a==e.Tab?"":"none",e.Id),r(e.Template))for(j=0;j<c.length;j++)s=c[j],s.Hidden||s.CategoryIndex!=e.Index||this._renderItem(t,s,o,!0);else this._renderTemplate(e.Template,t,o,!0,!1);t.append("<\/td><\/tr>")}}else this._renderNoRecordsWhenNeeded(t);o&&this._renderActionButtons(t,"Bottom","Form")},_updateTabbedCategoryVisibility:function(){var i,n,t,r;if(this._tabs&&this._tabs.length>0){for(i=this._tabs[this.get_categoryTabIndex()],n=0;n<this._tabs.length;n++)t=this._get("_Tab",n),t&&(n==this.get_categoryTabIndex()?$(t).addClass("Selected"):$(t).removeClass("Selected"));for(n=0;n<this._categories.length;n++)r=this._categories[n],t=this._get("_Category",n),t&&Sys.UI.DomElement.setVisible(t,r.Tab==i);this._updateVisibility()}this._adjustModalHeight()},_renderItem:function(t,i,f,e,o,c,l,a,v){var d=this.get_isForm()||o,p=f[i.Index],wt,yt,pt,oi,bt,ni,ti,kt,tt,rt,vt,ft,et,ot,g,nt,li,ri,ai,b,vi,yi,dt,ui,gt,fi,ht;p!=null&&(p=p.toString());var it=null,st=i.ItemsStyle=="CheckBoxList",ut=this.editing(),lt=i.Index!=i.AliasIndex,ei=lt&&!i.ItemsStyle;if(ut&&i.ItemsStyle=="CheckBox"&&i.Items.length==2&&(wt=i.Items[0][0],yt=i.Items[1][0],wt=="true"&&(wt="false",yt="true"),p==null&&(p=i.Items[0][0]),it=String.format('<input type="checkbox" id="{0}_Item{1}"{2} tabindex="{3}" value="{4}" onclick="this.value=this.checked?\'{6}\':\'{5}\';$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{7}"/>',this.get_id(),i.Index,yt&&(p=="true"||p==yt)?" checked":"",$nextTabIndex(),p,wt,yt,i.ToolTip)),pt=i.isReadOnly(),d){if(oi=String.format('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),i.Index),l||t.appendFormat('<div class="Item {2}" id="{0}_ItemContainer{1}">',this.get_id(),i.Index,i.Name),bt=(ut&&ei?this.findFieldUnderAlias(i):this._allFields[i.AliasIndex]).HeaderText,it&&l&&!(ut&&pt)){t.append('<div class="Header">&nbsp;<\/div>');return}if(bt.length>0&&(v&&it&&this._numberOfColumns>0?t.append('<div class="Header">&nbsp;<\/div>'):t.appendFormat('<div class="Header {5}">{3}<label for="{0}_Item{1}">{2}{4}<\/label><\/div>',this.get_id(),i.Index,bt,this._numberOfColumns>0||v?"":it,ut&&!i.AllowNulls&&!it&&!pt&&u.Form.RequiredFieldMarker?u.Form.RequiredFieldMarker:"",i.Name)),l)return;(it==null||this._numberOfColumns>0)&&t.append('<div class="Value">')}if(ni=!ut&&!r(i.ItemsDataController)&&!st&&!c&&p&&this._disableObjectRef!=!0&&!i.tagged("lookup-details-hidden"),ni&&!d&&t.append('<table width="100%" cellpadding="0" cellspacing="0" class="ObjectRef"><tr><td>'),ut&&e&&!pt){ei&&(i=this.findFieldUnderAlias(i));ti=i;i._LEV!=null&&t.append('<table cellpadding="0" cellspacing="0"><tr><td>');!d&&it&&t.append(it);var si=!r(i.ItemsStyle),ii=i.ItemsStyle=="Lookup",hi=!r(i.ContextFields),at=i.ItemsStyle=="AutoComplete",k=i.DynamicItems?i.DynamicItems:i.Items,ci=si&&!ii&&!at;if(ci&&k.length==0&&!st&&hi)k=[],(i.AllowNulls||p==null||hi)&&Array.add(k,["",w]),p!=null&&Array.add(k,[p,f[i.AliasIndex]]);else if(i.DynamicItems&&!st){for(kt=!1,tt=0;tt<k.length;tt++)if(k[tt][0]==p){kt=!0;break}kt||(p=null);!i.AllowNulls&&kt||r(k[0][0])||Array.insert(k,0,["",w])}else ci&&!i.AllowNulls&&p==null&&!st&&k.length&&k[0][0]!=null&&(k=k.slice(0),k.splice(0,0,["",w]));if(it!=null)(this._numberOfColumns>0||v)&&(t.append(it),t.appendFormat('<label for="{0}_Item{1}" title="{3}">{2}<\/label>',this.get_id(),i.Index,bt,i.ToolTip));else if(k.length>0||st||si&&!ii&&!at)if(i.ItemsStyle=="RadioButtonList"){for(t.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',i.ToolTip),rt=i.Columns==0?1:i.Columns,vt=Math.floor(k.length/rt)+(k.length%rt>0?1:0),ft=0;ft<vt;ft++){for(t.append("<tr>"),et=0;et<rt;et++)ot=et*vt+ft,ot<k.length?(g=k[ot],nt=g[0]==null?"":g[0].toString(),p==null&&(p=""),t.appendFormat('<td class="Button"><input type="radio" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}" onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),i.Index,ot,nt,nt==p?" checked":"",this.htmlEncode(i,g[1]),$nextTabIndex())):t.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');t.append("<\/tr>")}t.append("<\/table>")}else if(st)if(li=p?p.split(","):[],ri=!r(i.ContextFields)&&!i.DynamicItems,t.appendFormat('<input type="hidden" id="{0}_Item{1}" name="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,ri?p:""),ri)t.append(h.Loading);else{for(t.appendFormat('<table cellpadding="0" cellspacing="0" class="RadioButtonList" title="{0}">',i.ToolTip),rt=i.Columns==0?1:i.Columns,vt=Math.floor(k.length/rt)+(k.length%rt>0?1:0),ft=0;ft<vt;ft++){for(t.append("<tr>"),et=0;et<rt;et++)ot=et*vt+ft,ot<k.length?(g=k[ot],nt=g[0]==null?"":g[0].toString(),p==null&&(p=""),t.appendFormat('<td class="Button"><input type="checkbox" id="{0}_Item{1}_{2}" name="{0}_Item{1}" value="{3}"{4} tabindex="{6}"  onclick="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"/><\/td><td class="Option"><label for="{0}_Item{1}_{2}">{5}<label><\/td>',this.get_id(),i.Index,ot,nt,Array.indexOf(li,nt)!=-1?" checked":"",this.htmlEncode(i,g[1]),$nextTabIndex())):t.append('<td class="Button">&nbsp;<\/td><td class="Option"><\/td>');t.append("<\/tr>")}t.append("<\/table>")}else{for(t.appendFormat('<select id="{0}_Item{1}" size="{2}" tabindex="{3}" onchange="$find(&quot;{0}&quot;)._valueChanged({1});" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{4}">',this.get_id(),i.Index,i.ItemsStyle=="ListBox"?i.Rows==0?5:i.Rows:"1",$nextTabIndex(),i.ToolTip),p==null&&(p=""),p=p.toString(),tt=0;tt<k.length;tt++)g=k[tt],nt=g[0],ai=nt==null&&!i.AllowNulls?u.Lookup.SelectLink:g[1],nt==null&&(nt=""),nt=nt.toString(),t.appendFormat('<option value="{0}"{1}>{2}<\/option>',nt,nt==p?" selected":"",this.htmlEncode(i,ai));t.append("<\/select>")}else!r(i.ItemsDataController)&&ii?(p=f[i.AliasIndex],p==null&&(p=u.Lookup.SelectLink),b=this._allFields[i.AliasIndex].format(p),this._renderCreateNewBegin(t,i),t.appendFormat('<table cellpadding="0" cellspacing="0" class="Lookup"><tr><td><a href="#" onclick="$find(\'{0}\').showLookup({1});return false" id="{0}_Item{1}_ShowLookupLink" title="{3}" tabindex="{5}">{2}<\/a><a href="#" class="Clear" onclick="$find(\'{0}\').clearLookupValue({1});return false" id="{0}_Item{1}_ClearLookupLink" title="{7}" tabindex="{6}" style="display:{8}">&nbsp;<\/a><\/td><\/tr><\/table><input type="hidden" id="{0}_Item{1}" value="{4}"/><input type="hidden" id="{0}_Item{9}" value="{2}"/>',this.get_id(),i.Index,this.htmlEncode(i,b),r(i.ToolTip)?String.format(u.Lookup.SelectToolTip,i.Label):i.ToolTip,f[i.Index],$nextTabIndex(),$nextTabIndex(),String.format(u.Lookup.ClearToolTip,i.Label),f[i.Index]!=null?"display":"none",i.AliasIndex),this._renderCreateNewEnd(t,i)):i.OnDemand?this._renderOnDemandItem(t,i,f,e,d):i.Editor?(vi=i.Editor,t.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,n.htmlAttributeEncode(p)),t.appendFormat('<iframe src="{0}?id={1}_Item{2}&control={3}" frameborder="0" scrolling="no" id="{1}_Item{2}$Frame" class="FieldEditor {3}" tabindex="{4}"><\/iframe>',this.resolveClientUrl(this.get_appRootPath()+"ControlHost.aspx"),this.get_id(),i.Index,vi,$nextTabIndex())):i.Rows>1?(t.appendFormat('<textarea id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});" title="{3}" style="',this.get_id(),i.Index,$nextTabIndex(),i.ToolTip),i.TextMode!=3||r(p)||t.append("display:none;"),d?t.appendFormat('" cols="{0}"',i.Columns>0?i.Columns:50):t.append('display:block;width:100%;"'),t.appendFormat(' rows="{0}"',i.Rows),n.supportsPlaceholder&&!r(i.Watermark)&&t.appendFormat(' placeholder="{0}"',n.htmlAttributeEncode(i.Watermark)),t.append(">"),t.append(i.HtmlEncode?this.htmlEncode(i,p):p),t.append("<\/textarea>"),i.TextMode!=3||r(p)||t.appendFormat("<div>{2}<div><a href=\"javascript:\" onclick=\"var o=$get('{0}_Item{1}');o.style.display='block';o.focus();this.parentNode.parentNode.style.display='none';return false;\">{3}<\/a> | <a href=\"javascript:\" onclick=\"if(!confirm('{5}'))return;$get('{0}_Item{1}').value='';this.parentNode.parentNode.parentNode.parentNode.style.display='none';return false;\">{4}<\/a><\/div><\/div>",this.get_id(),i.Index,this.htmlEncode(i,p).replace(/((\r\n*)|\n)/g,"<br/>"),s.NoteEditLabel,s.NoteDeleteLabel,s.NoteDeleteConfirm)):(rt=i.Columns>0?i.Columns:50,yi=i.ToolTip,at&&(!lt||ut)&&(p=f[i.Index],t.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,n.htmlAttributeEncode(p)),i=this._allFields[i.AliasIndex]),i.TimeFmtStr&&t.append('<table cellpadding="0" cellspacing="0" class="DateTime"><tr><td class="Date">'),t.appendFormat('<input type="{3}" id="{0}_Item{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),i.Index,$nextTabIndex(),i.TextMode!=1?"text":"password"),d?t.appendFormat(' size="{0}"',rt):t.append(' style="display:block;width:90%;"'),i.Len>0&&t.appendFormat(' maxlength="{0}"',i.Len),at&&t.appendFormat(' title="{0}"',yi),p=f[i.Index],p==null?b=at?w:"":lt?b=p.toString():(i.DateFmtStr&&(typeof p=="string"&&(p=Date.parseLocale(p,i.DataFormatString.match(/\{0:([\s\S]*?)\}/)[1])),i.DataFormatString=i.DateFmtStr),b=i.format(p),i.DateFmtStr&&(i.DataFormatString=i.DataFmtStr)),t.appendFormat(' value="{0}" {1}',n.htmlAttributeEncode(b),d?' class="TextInput"':String.format('class="TextInput {0}Type"',i.Type)),t.appendFormat(' title="{0}"',i.ToolTip),n.supportsPlaceholder&&!r(i.Watermark)&&t.appendFormat(' placeholder="{0}"',n.htmlAttributeEncode(i.Watermark)),t.append("/>"),i.Type.startsWith("DateTime")&&d&&u.Form.ShowCalendarButton&&!i.TimeFmtStr&&t.appendFormat('<a id="{0}_Item{1}_Button" href="#" onclick="return false" class="Calendar">&nbsp;<\/a>',this.get_id(),i.Index),i.TimeFmtStr&&(t.appendFormat('<\/td><td class="Time"><input type="text" id="{0}_Item$Time{1}" tabindex="{2}" onchange="$find(&quot;{0}&quot;)._valueChanged({1})" onfocus="$find(&quot;{0}&quot;)._valueFocused({1});"',this.get_id(),i.Index,$nextTabIndex()),d?t.appendFormat(' size="{0}"',rt):t.append(' style="display:block;width:90%;"'),p==null?b=at?w:"":lt?b=p.toString():(i.DataFormatString=i.TimeFmtStr,b=i.format(p),i.DataFormatString=i.DataFmtStr),t.appendFormat(' value="{0}" {1}/><\/td><\/table>',n.htmlAttributeEncode(b),d?"":'class="TimeType"')));i._LEV!=null&&(dt=this._allFields[i.AliasIndex]._LEV,dt==null&&(dt=""),t.appendFormat('<\/td><td class="UseLEV"><a href="javascript:" onclick="$find(\'{0}\')._applyLEV({1});return false" tabindex="{2}" title="{3}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),i.Index,$nextTabIndex(),n.htmlAttributeEncode(String.format(s.UseLEV,this._allFields[i.AliasIndex].format(dt)))));this._lastCommandName=="BatchEdit"&&t.appendFormat('<div class="BatchSelect"><table cellpadding="0" cellspacing="0"><tr><td><input type="checkbox" id="{0}$BatchSelect{1}" onclick="$app._updateBatchSelectStatus(this,{3})"{4}/><\/td><td><label for="{0}$BatchSelect{1}">{2}<\/a><\/td><\/tr><\/table><\/div>',this.get_id(),ti.Index,s.BatchUpdate,d==!0,this._batchEdit&&Array.contains(this._batchEdit,ti.Name)?' checked="checked"':"")}else if(i.OnDemand)this._renderOnDemandItem(t,i,f,e,d);else{if(p=this.htmlEncode(i,f[i.AliasIndex]),ut&&pt&&e&&(ui=f[i.Index],t.appendFormat('<input type="hidden" id="{0}_Item{1}" value="{2}"/>',this.get_id(),i.Index,ui!=null?n.htmlAttributeEncode(this._allFields[i.AliasIndex].format(ui)):"")),gt=i.DynamicItems?i.DynamicItems:i.Items,gt.length==0)i.Type=="String"&&p!=null&&p.length>s.MaxReadOnlyStringLen&&!(i.TextMode==3||i.TextMode==2)&&(p=p.substring(0,s.MaxReadOnlyStringLen)+"..."),p&&i.TextMode==3&&(p=p.replace(/\r?\n/g,"<br/>")),b=y(p)?d?w:ct:this._allFields[i.AliasIndex].format(p);else if(st){for(k=p?p.split(","):[],fi=!0,tt=0;tt<gt.length;tt++)g=gt[tt],nt=g[0]==null?"":g[0].toString(),Array.contains(k,nt)&&(fi?fi=!1:t.append(", "),t.append(n.htmlEncode(g[1])));b=k.length==0?w:""}else lt&&!e?b=p:(g=this._findItemByValue(i,lt?f[i.Index]:p),b=g[1],d||b!=w||(b=ct));r(i.HyperlinkFormatString)||p==null||(ht=this._parseLocation(i.HyperlinkFormatString,f),b=ht&&ht.match(/^mailto\:/)?String.format('<a href="{0}" title="{2}">{1}<\/a>',ht,b,i.ToolTip):ht.match(/^javascript\:/)?String.format('<a href="javascript:" onclick="{0};return false;" title="{2}">{1}<\/a>',ht.substring(11),b,i.ToolTip):String.format('<a href="javascript:" onclick="$find(\'{2}\')._navigate(\'{0}\');" title="{3}">{1}<\/a>',ht,b,this.get_id(),i.ToolTip));i.TextMode==1&&(b="**********");i.Type!="Byte[]"||i.OnDemand||(b=n.toHexString(b));a==!0&&(b=String.trimLongWords(b));__designer()&&typeof b=="string"&&(b=b.replace(/\^\w+\^/g,""));t.append(b)}ni&&(d||t.append('<\/td><td align="right">'),t.appendFormat('<span class="ObjectRef" title="{0}" onclick="$find(&quot;{1}&quot;).executeCommand({{commandName: &quot;_ViewDetails&quot;, commandArgument: &quot;{2}&quot;}})">&nbsp;<\/span>',String.format(u.Lookup.DetailsToolTip,n.htmlAttributeEncode(this._allFields[i.AliasIndex].HeaderText)),this.get_id(),i.Name),d||t.append("<\/td><\/tr><\/table>"));d&&((it==null||this._numberOfColumns>0)&&t.append("<\/div>"),t.append(oi),r(i.FooterText)||t.appendFormat('<div class="Footer">{0}<\/div>',i.FooterText),t.append("<\/div>"))},_renderOnDemandItem:function(t,i,r,u,f){var e=r[i.Index],c=e!=null?e.toString().match(/^null\|(.+)$/):null,o=c!=null||e==null,h;c&&(e=c[1]);o&&!u&&i.OnDemandStyle==1?t.append(f?w:ct):(h=this.resolveClientUrl(this.get_appRootPath()+s.BlobHandler),u&&!o&&t.appendFormat('<a href="{0}?{1}=o|{2}" title="{3}" onclick="$find(&quot;{4}&quot;)._showDownloadProgress();open(this.href, &quot;_blank&quot;,&quot;height={5},width={6},resizable=yes&quot;);return false">',h,i.OnDemandHandler,e,s.BlobDownloadHint,this.get_id(),rt.height()/2,rt.width()/2),i.OnDemandStyle==1?o?t.append(f?w:ct):t.append(u?s.BlobDownloadLink:s.BlobDownloadLinkReadOnly):o?t.append(f?w:ct):t.appendFormat('<img src="{0}?{1}=t|{2}" class="Thumbnail"/>',h,i.OnDemandHandler,e),u&&!o&&t.append("<\/a>"),!i.ReadOnly&&this.editing()&&u&&(n.upload()?t.appendFormat('<div class="drop-box-{0}"><\/div>',i.Index):t.appendFormat('<iframe src="{0}?{1}=u|{2}&owner={3}&index={4}" frameborder="0" scrolling="no" id="{3}_Frame{4}" tabindex="{6}"><\/iframe><div style="display:none" id="{3}_ProgressBar{4}" class="UploadProgressBar">{5}<\/div>',h,i.OnDemandHandler,e,this.get_id(),i.Index,"Uploading...",$nextTabIndex())))},_showUploadProgress:function(n,t){var f=$get(String.format("{0}_Frame{1}",this.get_id(),n)),i=$get(String.format("{0}_ProgressBar{1}",this.get_id(),n)),e,u,c,r;if(f!=null&&i!=null){e=$(t).find("input:file");u=e.val().split(/(\\|\/)/);u=u.length>0?u[u.length-1]:null;var l=this.inserting(),o=$(i).show().text(u).focus(),s=$common.getPaddingBox(i),h=$common.getBorderBox(i);i.style.width=f.offsetWidth-s.horizontal-h.horizontal+"px";i.style.height=f.offsetHeight-s.vertical-h.vertical+"px";c=$(f).hide();l?(r=this._pendingUploads,r||(r=this._pendingUploads=[]),r.push({form:t,progress:i}),o.find("a").button("destroy"),o.addClass("dataview-insert").append($(String.format("<a>{0}<\/a>",vt)).button({icons:{primary:"ui-icon-close"},text:!1}).click(function(){o.hide();c.show();for(var n=0;n<r.length;n++)if(r[n].form==t){Array.removeAt(r,n);break}e.replaceWith(e.clone(!0))}))):(this._showDownloadProgress(),t.submit())}},_internalRenderActionButtons:function(n,t,i,u){var f,e,o;for(u||(u=this._actionButtonsInScope(i)),this._clonedRow=this._cloneChangedRow(),f=0;f<u.length;f++)action=u[f],this._isActionAvailable(action)&&(e=r(action.CssClass)?"":action.CssClass,action.HeaderText&&action.HeaderText.length>10&&(e.length>0&&(e+=" "),e+="AutoWidth"),o=action.CommandName=="None",n.appendFormat('<button onclick="{6}$find(\'{0}\').executeAction(\'{5}\', {1},-1);return false" tabindex="{3}" class="{8}{4}"{7}>{2}<\/button>',this.get_id(),f,action.HeaderText,$nextTabIndex(),e,i,o?"return false;":"",o?' disabled="disabled"':"",action.CssClassEx)),action.WhenClientScript&&(this._dynamicActionButtons=!0);this._clonedRow=null},_actionButtonsInScope:function(n){var t=this.get_actions(n),r,i;if(t.length!=0){if(n=="Row"){for(r=!1,i=0;i<t.length;i++)if(this._isActionAvailable(t[i])){r=!0;break}if(!r)return null}return t}},_renderActionButtons:function(n,t,i){var o,s,h,c;if(this.get_showActionButtons().indexOf(t)!=-1&&(o=this._actionButtonsInScope(i),o)){if(s=this._get_colSpan(),h="",i=="Row"&&this._actionColumn&&(s--,h='<td class="ActionColumn">&nbsp;<\/td>'),n.appendFormat('<tr class="ActionButtonsRow {0}ButtonsRow {2}Scope">{3}<td colspan="{1}" class="ActionButtons {2}ActionButtons">',t,s,i,h),n.append('<table style="width:100%" cellpadding="0" cellspacing="0" class="ActionButtons"><tr>'),c=String.format(' id="{0}$ActionButtons${1}"',this.get_id(),t),i=="Form"){var r=this._position,l=r&&r.count>1&&!this.inserting(),a=r&&r.index>0,v=r&&r.index<r.count-1,f=this._get_specialAction("Print"),e=this.get_isModal()?this._get_specialAction("Annotate"):null;n.appendFormat('<td class="Left"><table class="FormNav"><tr><td class="Previous{5}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(-1);return false;" title="{3}"><span><\/span><\/a><\/td><td class="Next{6}{7}"><a href="javascript:" onclick="$find(\'{2}\')._advance(1);return false;" title="{4}"><span><\/span><\/a><\/td><td class="Print{9}"><a href="javascript:" onclick="{10};return false;" title="{8}"><span><\/span><\/a><\/td><td class="Annotate{12}"><a href="javascript:" onclick="{13};return false;" title="{11}"><span><\/span><\/a><\/td><td class="Instruction" id="{0}_Wait" align="left">{1}<\/td><\/tr><\/table><\/td><td class="Right" align="right"{14}>&nbsp;',t=="Bottom"?this.get_id():"",this.editing()&&u.Form.RequiredFieldMarker?u.Form.RequiredFiledMarkerFootnote:"",this.get_id(),b.Previous,b.Next,a?"":" Disabled",v?"":" Disabled",l?"":" Hidden",f?f.text:"",f?"":" Hidden",f?f.script:null,e?e.text:"",e?"":" Hidden",e?e.script:null,c)}else n.appendFormat("<td{0}>",c);this._internalRenderActionButtons(n,t,i,o);this._lastActionButtonsScope=i;n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},_isActionMatched:function(t,i){var r=t.WhenClientScript,u=r;return typeof r=="string"&&(r=r.trim(),r&&(r=n.functions[r],r||(r=n.functions[u]=t.WhenClientScript=eval("(function(){return "+this._prepareJavaScriptExpressionEx(u)+"})")))),(!t.WhenViewRegex||t.WhenViewRegex.exec(this.get_viewId())!=null===t.WhenViewRegexResult)&&(!t.WhenTagRegex||t.WhenTagRegex.exec(this.get_tag())!=null===t.WhenTagRegexResult)&&(!t.WhenHRefRegex||t.WhenHRefRegex.exec(location.pathname)!=null===t.WhenHRefRegexResult)&&(i||!r||!!r.call(this))},_isActionAvailable:function(n,t){var i=this,u=n.CommandName,h=n.WhenLastCommandName,r=h?h:"",e,o,f,s;if(r==="Any"&&(r=i.get_lastCommandName()),e=n.WhenLastCommandArgument?n.WhenLastCommandArgument:"",o=!r.length||r===i.get_lastCommandName()&&(!e.length||e===i.get_lastCommandArgument()),o){if(f=i.editing(),u==="DataSheet")return!f&&i.get_isGrid()&&i.get_viewType()!=="DataSheet"&&i._isActionMatched(n);if(u==="Grid")return!f&&i.get_isGrid()&&i.get_viewType()!=="Grid"&&i._isActionMatched(n);if(u==="BatchEdit")return i.get_showMultipleSelection()&&i._selectedKeyList&&i._selectedKeyList.length>1&&i._isActionMatched(n);if(f)return s=i._rowIsSelected(t==null?i._selectedRowIndex:t),s?(r==="New"||r==="Edit"||r==="BatchEdit"||r==="Duplicate")&&i._isActionMatched(n):s||t!=null||r!=="New"&&r!=="Duplicate"?!r.length&&t!=null&&i._isActionMatched(n):i._isActionMatched(n)}return o&&(!n.WhenKeySelected||n.WhenKeySelected&&i._selectedKey&&i._selectedKey.length>0)&&i._isActionMatched(n)&&(u!=="New"||i._hasKey())},_hasKey:function(){return this._keyFields&&this._keyFields.length>0},_rowIsSelected:function(n){var t=this,i=t._rowIsSelectedCached,r;return i!=null?i:t._hasKey()?(r=t._rows[n],t.rowIsSelected(r)):t.get_isModal()&&t.get_isForm()},rowIsSelected:function(n){var f=this,e=f._keyFields,o=f._selectedKey,t;if(n&&e.length===o.length&&e.length){if(n===f._mergedRow)return!0;for(t=0;t<e.length;t++){var s=e[t],i=o[t],u=n[s.Index];if(s.Type.startsWith("DateTime")){if(!(i||u))return!1;i=i.toString();u=u.toString()}if(i!=u&&!(u==null&&r(i)))return!1}return!0}return f._inlineEditor?!0:!1},rowIsTemplate:function(n){var t,u;n||(n=this.extension().commandRow());var i=this._keyFields,f=this._selectedKey,r=!0;if(n&&n.length&&i.length){for(t=0;t<i.length;t++)if(u=i[t],n[u.Index]!=null){r=!1;break}}else r=!1;return r},_get_template:function(n){return this.get_isDataSheet()?null:$get(this.get_controller()+"_"+this.get_viewId()+(n?"_"+n:""))},_renderTemplate:function(t,i,r,u,f){for(var o=typeof t=="string"?t:t.innerHTML,l=/([\s\S]*?)\{([\w\d]+)(\:([\S\s]+?)){0,1}\}/g,c=0,e=l.exec(o),s,h;e;)c=e.index+e[0].length,i.append(e[1]),s=this.findField(e[2]),s?e[4]&&e[4].length>0?i.appendFormat("{0:"+e[4]+"}",r[s.Index]):this._renderItem(i,s,r,u,f,null,null,null,!0):(h=n.find(e[2]),h&&(this._embeddedViews||(this._embeddedViews=[]),Array.add(this._embeddedViews,{view:h}),i.appendFormat('<div id="v_{0}" class="EmbeddedViewPlaceholder"><\/div>',h.get_id()))),e=l.exec(o);c<o.length&&i.append(o.substring(c))},_renderNewRow:function(n){var e,o,s,u,t;if(this.inserting()){var r=this.get_isDataSheet(),l=this._actionColumn&&!r,f=this._get_focusedCell();if(f||(f={colIndex:0}),e=r?null:this._gridTemplates.New,n.appendFormat('<tr class="Row Selected{0}{1}">',e?" InlineFormRow":"",r?" Inserting":""),o=this.multiSelect(),o&&n.append('<td class="Cell Toggle First">&nbsp;<\/td>'),s=this.get_showIcons(),s&&n.appendFormat('<td class="Cell Icons{0}"><span>&nbsp;<\/span><\/td>',o?"":" First"),this.get_isDataSheet()&&n.appendFormat('<td class="Cell Gap"><div class="Icon"><\/div><\/td>',!o&&!s?" First":""),l&&n.append('<td class="Cell ActionColumn">&nbsp;<\/td>'),u=this._newRow?this._newRow:[],this._mergeRowUpdates(u),this._updateVisibility(u),e)n.appendFormat('<td class="Cell" colspan="{0}">',this.get_fields().length),this._renderTemplate(e,n,u,!0,!0),n.append("<\/td>");else for(t=0;t<this._fields.length;t++){var i=this._fields[t],h=this._allFields[i.AliasIndex],c="";r&&(this._editing=f&&f.colIndex==i.ColIndex,this._editing||(c=String.format(" onclick=\"$find('{0}')._dataSheetCellFocus(event,-1,{1})\"",this.get_id(),t)));n.appendFormat('<td class="Cell {0} {1}Type{2}{3}"{4}>',h.Name,h.Type,t==0?" FirstColumn":"",t==this._fields.length-1?" LastColumn":"",c);i.ReadOnly||n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),i.Index);this._renderItem(n,i,u,!i.OnDemand,null);this._editing=null;n.append("<\/td>")}n.append("<\/tr>");r||this._renderActionButtons(n,"Bottom","Row")}},_iconClicked:function(n){this.get_isDataSheet()||this.get_lookupField()!=null||this._icons&&this._icons[n]=="Attachment"&&(this._lastClickedIcon="Attachment",this.set_autoSelectFirstRow(!0),this._autoSelect(n))},_renderRows:function(n,t,i){var a=this.get_lookupField()!=null,v=this.get_isDataSheet(),it=!a&&this._actionColumn&&!v,pt=it?this.get_actionGroups("ActionColumn",!0):null,wt=this._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,this.get_viewId()),k,rt,d,r,u,y,o,g,et,nt,tt,p,w,yt;for(n.append('<tr class="HeaderRow">'),k=this.get_showIcons(),i&&(n.appendFormat('<th class="Toggle First"><input type="checkbox" onclick="$find(&quot;{0}&quot;).toggleSelectedRow()" id="{0}_ToggleButton"/><\/th>',this.get_id()),this._multipleSelection=!1),k&&n.appendFormat('<th class="Icons{0}">&nbsp;<\/th>',i?"":" First"),v&&n.appendFormat('<th class="Gap{0}">&nbsp;<\/th>',!i&&!k?" First":""),it&&n.appendFormat('<th class="FieldHeaderSelector ActionColumn"><span>{0}<\/span><\/th>',this._actionColumn),rt=this.get_sortExpression(),d=rt?rt.match(/^\s*(\w+)((\s+(asc|desc))|(\s*(,|$)))/i):null,r=0;r<this._fields.length;r++)u=this._fields[r],y=u.Name,u=this._allFields[u.AliasIndex],u.Name==y&&(y=""),n.appendFormat('<th class="FieldHeaderSelector {4} {0} {1}Type{2}{3}"',u.Name,u.Items.length>0?"String":u.Type,r==0?" FirstColumn":"",r==this._fields.length-1?" LastColumn":"",y),(u.AllowSorting||u.AllowQBE)&&n.appendFormat(' onmouseover="$showHover(this,\'{0}$FieldHeaderSelector${1}\',\'FieldHeaderSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()"',this.get_id(),r),n.append(">"),u.AllowSorting?(n.appendFormat('<a href="#" onclick="$find(\'{0}\').sort(\'{1}\');$preventToggleHover();return false" title="{3}" onfocus="$showHover(this,\'{0}$FieldHeaderSelector${4}\',\'FieldHeaderSelector\',1)" onblur="$hideHover(this)" tabindex="{5}">{2}<\/a>',this.get_id(),u.Name,u.HeaderText,String.format(h.SortBy,u.HeaderText),r,$nextTabIndex()),d&&d[1]==u.Name&&n.append(String.format('<span class="{0}">&nbsp;<\/span>',d[4]?d[4].toLowerCase()=="asc"?"SortUp":"SortDown":"SortUp")),this.filterOf(u)!=null&&n.append('<span class="Filter">&nbsp;<\/span>')):n.appendFormat("<span>{0}<\/span>",u.HeaderText),n.append("<\/th>");n.append("<\/tr>");var e=this._get_focusedCell(),s=this.editing(),ot=this.inserting(),ut=this._lastSelectedRowIndex;this._gridTemplates||(o={Default:this._get_template(),Edit:this._get_template("edit"),New:this._get_template("new")},o.Default&&(o.Default=o.Default.innerHTML),o.Edit=o.Edit?o.Edit.innerHTML:o.Default,o.New=o.New?o.New.innerHTML:o.Default,this._gridTemplates=o);var ft=v?null:this._gridTemplates.Edit,st=v?null:this._gridTemplates.Default,c=null;this._registerRowSelectorItems();var bt=this.get_showRowNumber(),ht=!1;for(r=0;r<this.get_rows().length;r++){var b=this.get_rows()[r],ct=" "+this._evaluateJavaScriptExpressions(wt,b,!0),f=this._rowIsSelected(r);if(f&&(ht=!0),f&&(this._selectedRowIndex=r),g=null,et="",i&&(nt=Array.indexOf(this._selectedKeyList,this._createRowKey(r))!=-1,nt&&(this._multipleSelection=!0),g=String.format('<td class="Cell Toggle First"><input type="checkbox" id="{0}_CheckBox{1}" onclick="$find(&quot;{0}&quot;).toggleSelectedRow({1})"{2} class="MultiSelect{3}"/><\/td>',this.get_id(),r,nt?' checked="checked"':null,nt?" Selected":""),nt&&(et=" MultiSelectedRow")),tt=k?String.format('<td class="Cell Icons {0}{1}"><span onclick="$find(\'{3}\')._iconClicked({4});">{2}<\/span><\/td>',this._icons?this._icons[r]:"",i?"":" First",bt?this.get_pageSize()*this.get_pageIndex()+r+1+(this._pageOffset?this._pageOffset:0):"&nbsp;",this.get_id(),r):"",v&&(tt+=String.format('<td class="Cell Gap{2}" onclick="$find(\'{0}\')._dataSheetCellFocus(event,{1},-1)"><div class="Icon"><\/div><\/td>',this.get_id(),r,!i&&!k?" First":"")),it&&(tt+=this._renderActionColumnCell(b,r,f,pt)),s&&f&&(this._mergeRowUpdates(b),this._updateVisibility(b)),f&&(s&&ft||st))n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3} Selected{7}">{5}{6}<td class="Cell" colspan="{4}">',this.get_id(),r,r%2==0?"":"Alternating"," InlineFormRow",this.get_fields().length,g,tt,s?" Editing":""),this._renderTemplate(s&&ft?ft:st,n,b,!0,!0),n.append("<\/td>");else for(n.appendFormat('<tr id="{0}_Row{1}" class="{2}Row{3}{4}{7}" {6}>',this.get_id(),r,r%2==0?"":"Alternating",f?" Selected"+ct:ct,et,t?"":" ReadOnlyRow",v&&!a?"":"onmouseover=\"$(this).addClass('Highlight');\" onmouseout=\"$(this).removeClass('Highlight')\"",f&&s?" Editing":""),g&&n.append(g),n.append(tt),j=0;j<this._fields.length;j++){u=this._fields[j];p=this._allFields[u.AliasIndex];y=u.Name==p.Name?"":u.Name;e&&(this._editing=s&&e.rowIndex==r&&e.colIndex==u.ColIndex);w=j==0&&t;w&&(c=l.HoverMonitor.Families[String.format("{0}$RowSelector${1}",this.get_id(),r)],c&&c.items.length!=0||(w=!1));var lt=j==0?" FirstColumn":"",at=String.format(" onclick=\"$find('{0}')._{3}CellFocus(event,{1},{2})\"",this.get_id(),r,j,v&&!a?"dataSheet":"gridView"),vt=j==this._fields.length-1?" LastColumn":"";w&&!a||f&&s||u.OnDemand&&f?n.appendFormat('<td class="Cell {5} {0} {1}Type{2}{4}"{3}>',p.Name,u.Items.length>0?"String":p.Type,lt,f&&s&&(!v||e&&e.colIndex==u.ColIndex)?"":at,vt,y):n.appendFormat('<td class="Cell {7} {2} {3}Type{4}{6}" style="cursor:default;"{5}>',this.get_id(),r,p.Name,p.Type=="Byte[]"?"Binary":u.Items.length>0?"String":p.Type,lt,at,vt,y);f&&s&&!u.ReadOnly&&n.appendFormat('<div class="Error" id="{0}_Item{1}_Error" style="display:none"><\/div>',this.get_id(),u.Index);w&&(!a&&c&&c.items.length>1&&n.appendFormat('<div id="{0}_RowSelector{1}" class="RowSelector" onmouseover="$showHover(this, \'{0}$RowSelector${1}\', \'RowSelector\')" onmouseout="$hideHover(this)" onclick="$toggleHover()">',this.get_id(),r),f&&s||(yt=a||!c||c.items.length==1?"":String.format(" onfocus=\"$showHover(this, '{0}$RowSelector${1}', 'RowSelector', 1)\" onblur=\"$hideHover(this)\" ",this.get_id(),r),a?n.appendFormat('<a href="javascript:" onclick="return false" tabindex="{0}">',$nextTabIndex()):n.appendFormat('<a href="#" onclick="$hoverOver(this, 2);$find(\'{0}\').executeAction(\'Grid\',-1,{1});$preventToggleHover();return false" tabindex="{2}"{3}>',this.get_id(),r,$nextTabIndex(),yt)));this._renderItem(n,u,b,f,null,w);w&&!s&&(f&&s||n.append("<\/a>"),!a&&c&&c.items.length>1&&n.append("<\/div>"));n.append("<\/td>");e&&(this._editing=null)}n.append("<\/tr>");f&&e==null&&this._renderActionButtons(n,"Bottom","Row");ot&&ut==r&&(ut=-2,this._renderNewRow(n));this._syncFocusedCell&&e&&f&&(e.rowIndex=r)}ot&&ut!=-2&&this._renderNewRow(n);this._saveAndNew&&(this._saveAndNew=!1,this._syncFocusedCell?this.newDataSheetRow():(e=this._get_focusedCell(),e&&(e.colIndex=0,this._moveFocusToNextRow(e,this.get_pageSize()))));this._syncFocusedCell=!1;ht||(this._selectedRowIndex=null)},_renderActionColumnCell:function(t,i,r,u){var l,a,f,h,e,c,o,s,v;for(this._clonedRow=t,r||(l=this.get_lastCommandName(),a=this.get_lastCommandArgument(),this.set_lastCommandName("Select"),this.set_lastCommandArgument(null)),f=new Sys.StringBuilder,f.append('<td class="Cell ActionColumn">'),h=!0,e=0;e<u.length;e++)for(c=u[e],o=0;o<c.Actions.length;o++)s=c.Actions[o],this._isActionAvailable(s)&&(h?h=!1:f.append('<span class="Divider">&nbsp;<\/span>'),f.appendFormat('<a href="javascript:" onclick="var dv=$find(\'{0}\');dv.executeAction(\'ActionColumn\',{2},{4},{3});return false;" class="{6}"><span class="Outer"><span class="Inner"><span class="Self" title="{5}">{1}<\/span><\/span><\/span><\/a>',this.get_id(),n.htmlEncode(s.HeaderText),o,e,i,n.htmlEncode(s.Description),s.CssClass));return h&&f.append("&nbsp;"),f.append("<\/td>"),v=f.toString(),f.clear(),this._clonedRow=null,r||(this.set_lastCommandName(l),this.set_lastCommandArgument(a)),v},extension:function(){var i=null,t=this,f=n.Extensions,o;if(f){var r=t.get_viewType(),u=t._altViewType,e=t._extensions;e==null&&(e=t._extensions={});r&&u==null&&(u=t._altViewType=t.tagged("view-type-inline-editor")?"Form":"");u&&(r=u);i=e[r];i==null&&(o=f?f[r]:null,i=t._extensions[r]=o?new o(this):0,i&&i.initialize())}return i},_renderGridView:function(n){var o,t,r,i,u,f,e;if(this._renderViewDescription(n),this._renderActionBar(n),this._renderSearchBar(n),o=this.get_showPager(),t=this.extension(),this._renderPager(n,"Top"),this.get_isChart()){for(this._renderInfoBar(n),this._sortingDisabled=!1,r=!1,i=0;i<this._fields.length;i++)u=this._fields[i],u.Aggregate!=0?this._sortingDisabled=!0:r||(r=!0,this.set_sortExpression(null),this.set_sortExpression(u.Name));t||n.appendFormat('<tr class="ChartRow"><td colspan="{1}" class="ChartCell"><img id="{0}$Chart" class="Chart" onload="if(this.readyState==\'complete\'){{this.style.height=\'\';_body_performResize()}}"/><\/td><\/tr>',this.get_id(),this._get_colSpan())}else f=this._hasKey(),e=this.multiSelect()&&f,this.get_searchOnStart()||(this._renderInfoBar(n),t||this._renderRows(n,f,e)),t||(this._renderAggregates(n,e),this._renderNoRecordsWhenNeeded(n));t||this._renderPager(n,"Bottom")},_renderAggregates:function(n,t){var e=this.get_aggregates(),f,i,r,u,o;if(this._totalRowCount!=0&&e!=null){for(n.append('<tr class="AggregateRow">'),t&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_showIcons()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this.get_isDataSheet()&&n.append('<td class="Aggregate">&nbsp;<\/td>'),this._actionColumn&&n.append('<td class="Aggregate">&nbsp;<\/td>'),f=0;f<this.get_fields().length;f++)i=this.get_fields()[f],i.Aggregate==0?n.append('<td class="None">&nbsp;<\/td>'):(r=e[i.Index],r=r==null?ct:i.format(r),u=this._allFields[i.AliasIndex],u.IsMirror&&(r=e[i.AliasIndex]),o=k.Aggregates[Web.DataViewAggregates[i.Aggregate]],n.appendFormat('<td class="Aggregate {0} {1}Type" title="',u.Name,u.Type),n.appendFormat(o.ToolTip,u.HeaderText),n.append('">'),n.appendFormat(o.FmtStr,r),n.append("<\/td>"));n.append("<\/tr>")}},_renderSearchBar:function(n){this.get_showSearchBar()&&__tf==4&&(this._searchBarInitialized=!1,n.appendFormat('<tr class="SearchBarRow" id="{0}$SearchBar" style="{2}"><td colspan="{1}" class="SearchBarCell" id="{0}$SearchBarContent">Search bar goes here.<br/><br/><br/><br/><\/td><\/tr>',this.get_id(),this._get_colSpan(),this.get_searchBarIsVisible()?"":"display:none"))},_renderNoRecordsWhenNeeded:function(n){if(this._totalRowCount==0){var t=this.get_isDataSheet()&&this._keyFields.length>0&&this.executeActionInScope(["Row","ActionBar"],"New",null,null,!0)?String.format(' <a href="javascript:" class="NewRowLink" onclick="$find(\'{0}\').newDataSheetRow();return false;" title="{2}">{1}<\/a>',this.get_id(),k.NewRowLink,u.Lookup.GenericNewToolTip):"";n.appendFormat('<tr class="Row NoRecords"><td colspan="{0}" class="Cell">{1}{2}<\/td><\/tr>',this._get_colSpan(),s.NoRecords,t)}},_attachBehaviors:function(){if(!t){this._detachBehaviors();this._attachFieldBehaviors();var n=this.get_quickFindElement();n&&$addHandlers(n,this._quickFindHandlers,this)}},_get:function(n,t){return t==null?$get(this.get_id()+n):$get(this.get_id()+n+t)},_attachTimeOptions:function(t,i){var f=$create(Web.AutoComplete,{completionInterval:500,contextKey:"",delimiterCharacters:"",id:this.get_id()+"_AutoComplete$Time"+t.Index,minimumPrefixLength:t.AutoCompletePrefixLength,typeCssClass:"AutoComplete"},null,null,i),r,e,u,s;if(Sys.UI.DomElement.addCssClass(f._completionListElement,"Time"),r=null,e=t.DataFormatString&&t.DataFormatString.replace(/\W/g,"_")||"Default",t.Type=="TimeSpan"){if(n._timeSpanOptions||(n._timeSpanOptions={}),r=n._timeSpanOptions[e],!r){for(r=[],u=new Date,s=t.DataFormatString||"{0:HH:mm}",u.setHours(0,0,0,0);r.length<96;)Array.add(r,String.localeFormat(s,u)),u.setMinutes(u.getMinutes()+15);n._timeSpanOptions[e]=r}}else if(r=n._timeOptions,!r){for(r=[],u=new Date,u.setHours(u.getHours(),0,0,0);r.length<48;)Array.add(r,String.localeFormat("{0:"+o.ShortTimePattern+"}",u)),u.setMinutes(u.getMinutes()+30);n._timeOptions=r}return(f._cache=[])["%"]=r,f},_executeClientEditorFactories:function(t,i,u){var c=i==null?t.Editor:t.ClientEditor,o,e,h,l;if(!r(c))for(o=c.split(n._simpleListRegex),e=0;e<o.length;e++){var a=o[e],s=a.replace(/\W/g,"$"),f=n.EditorFactories[s];if(f==null){try{f=eval(String.format('typeof {0}!="undefined"?new {0}():""',s))}catch(v){f=""}n.EditorFactories[s]=f}if(i==null)return f!="";if(f!=""){if(!u&&Array.indexOf(n._customInputElements,i.id)<0)return;if(h=this.get_viewType(),l=u?f.attach(i,h):f.detach(i,h),l)return u?Array.add(n._customInputElements,i.id):Array.remove(n._customInputElements,i.id),!0}}return!1},_attachFieldBehaviors:function(){var l=this,o,h,c,e;if(l.editing())for(o=0;o<this.get_fields().length;o++){var t=this.get_fields()[o],i=this._get("_Item",t.Index),u=null;if(!i||t.ReadOnly||this._executeClientEditorFactories(t,i,!0))t.OnDemand&&(e=$(this._container).find(".drop-box-"+t.Index),e.length&&(t._dropBox?(t._dropBoxInput.insertAfter(e),t._dropBox.insertAfter(e),e.remove(),t._dropBoxInput=null,t._dropBox=null):n.upload("create",{container:e,dataViewId:l._id,fieldName:t.Name})));else{if(i.tagName=="TEXTAREA"&&t.Len>0&&(i.setAttribute("maxlength",t.Len),$addHandler(i,"keyup",this._checkMaxLengthHandler),$addHandler(i,"blur",this._checkMaxLengthHandler)),!r(t.Mask)){var f=Sys.CultureInfo.CurrentCulture,s=f.dateTimeFormat.ShortDatePattern.toUpperCase().split(f.dateTimeFormat.DateSeparator),a=$create(AjaxControlToolkit.MaskedEditBehavior,{CultureAMPMPlaceholder:f.dateTimeFormat.AMDesignator+";"+f.dateTimeFormat.PMDesignator,CultureCurrencySymbolPlaceholder:f.numberFormat.CurrencySymbol,CultureDateFormat:s[0].substring(0,1)+s[1].substring(0,1)+s[2].substring(0,1),CultureDatePlaceholder:f.dateTimeFormat.DateSeparator,CultureDecimalPlaceholder:f.numberFormat.NumberDecimalSeparator,CultureName:f.name,CultureThousandsPlaceholder:f.numberFormat.NumberGroupSeparator,CultureTimePlaceholder:f.dateTimeFormat.TimeSeparator,DisplayMoney:t.DataFormatString=="{0:c}",Mask:t.Mask,MaskType:t.MaskType,ClearMaskOnLostFocus:t.MaskType>0,id:this.get_id()+"_MaskedEdit"+t.Index},null,null,i);t.MaskType==2&&a.set_InputDirection(1);Array.add(t.Behaviors,a)}t.Type.startsWith("Date")?(u=$create(AjaxControlToolkit.CalendarBehavior,{id:this._get("_Calendar",t.Index)},null,null,i),u.set_format((t.DateFmtStr?t.DateFmtStr:t.DataFormatString).match(/\{0:([\s\S]*?)\}/)[1]),h=$get(i.id+"_Button"),h&&u.set_button(h),t.TimeFmtStr&&(i=this._get("_Item$Time",t.Index),i&&(Array.add(t.Behaviors,u),u=this._attachTimeOptions(t,i)))):t.Type=="TimeSpan"?u=this._attachTimeOptions(t,i):i.type=="text"&&t.AutoCompletePrefixLength>0?u=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("{0},{1},{2}",this.get_controller(),this.get_viewId(),t.Name),delimiterCharacters:",;",id:this.get_id()+"_AutoComplete"+t.Index,minimumPrefixLength:t.AutoCompletePrefixLength,serviceMethod:"GetCompletionList",servicePath:this.get_servicePath(),useContextKey:!0,typeCssClass:"AutoComplete"},null,null,i):t.ItemsStyle=="AutoComplete"&&(c=this._allFields[t.AliasIndex],i=this._get("_Item",c.Index),i&&i.type=="text"&&(u=$create(Web.AutoComplete,{completionInterval:500,contextKey:String.format("Field:{0},{1}",this.get_id(),c.Name),delimiterCharacters:"",id:this.get_id()+"_AutoComplete"+t.Index,minimumPrefixLength:t.AutoCompletePrefixLength==0?1:t.AutoCompletePrefixLength,serviceMethod:"GetPage",servicePath:this.get_servicePath(),useContextKey:!0,fieldName:t.Name,enableCaching:!1,typeCssClass:"Lookup"},null,null,i)));u&&Array.add(t.Behaviors,u)}}},_detachBehaviors:function(){var o,r,u,e,f;if(!t&&(o=this.get_quickFindElement(),o&&$clearHandlers(o),this.get_fields()!=null))for(i=0;i<this.get_fields().length;i++)if(r=this.get_fields()[i],u=this._get("_Item",r.Index),!u||!this._executeClientEditorFactories(r,u,!1)){for(r.Len>0&&r.Rows>1&&u&&u.tagName=="TEXTAREA"&&u._events&&($removeHandler(u,"keyup",this._checkMaxLengthHandler),$removeHandler(u,"blur",this._checkMaxLengthHandler)),r._lookupModalBehavior!=null&&(r._lookupModalBehavior.dispose(),r._lookupModalPanel.parentNode.removeChild(r._lookupModalPanel),delete r._lookupModalPanel,r._lookupModalBehavior=null),r._lookupDataControllerBehavior!=null&&(r._lookupDataControllerBehavior.dispose(),r._lookupDataControllerBehavior=null),e=0;e<r.Behaviors.length;e++)r.Behaviors[e].dispose();Array.clear(r.Behaviors);r.Editor&&(n.Editors[r.EditorId]=null);r.OnDemand&&(f=$(this._container).find(".drop-box-"+r.Index),f.length&&f.is(".app-drop-box")&&!f.is(".app-drop-box-destroyed")&&(r._dropBoxInput=f.next().detach(),r._dropBox=f.detach()))}},_registerDataTypeFilterItems:function(n,t,i,r,u){for(var f,o,e=null,s=0;s<i.length;s++)if(f=i[s],f){if(!f.Hidden&&(!u.SearchOptions||Array.indexOf(u.SearchOptions,f.Function)>=0)&&(e=new Web.Item(n,f.Prompt?f.Text+"...":f.Text),t.addChild(e),f.List?this._registerDataTypeFilterItems(n,e,f.List,r,u):f.Prompt?e.set_script('$find("{0}").showFieldFilter({1},"{2}","{3}")',this.get_id(),u.Index,f.Function,f.Text):e.set_script('$find("{0}").applyFieldFilter({1},"{2}")',this.get_id(),u.Index,f.Function),r&&f.Function==r))for(o=e;o;)o.set_selected(!0),o=o.get_parent()}else u.SearchOptions||(e=new Web.Item(n),t.addChild(e))},_registerFieldHeaderItems:function(n,t,i,u){var ut=n==null?0:n,ft=n==null?this.get_fields().length-1:n,p=this.get_sortExpression(),w,b,k,g,nt,f,d,tt,a,it;for(p&&(p=p.match(/^(\w+)\s+(asc|desc)/)),w=ut;w<=ft;w++){var o=null,s=[],l=t?t:String.format("{0}$FieldHeaderSelector${1}",this.get_id(),w),v=this.get_fields()[w],e=this._allFields[v.AliasIndex];if(!u||e.Aggregate==0){if(e.AllowSorting||e.AllowQBE){b=h.GenericSortAscending;k=h.GenericSortDescending;switch(e.FilterType){case"Text":b=h.StringSortAscending;k=h.StringSortDescending;break;case"Date":b=h.DateSortAscending;k=h.DateSortDescending}if(g=e.AllowSorting&&!this._sortingDisabled,g&&(nt=p&&p[1]==e.Name,f=new Web.Item(l,b),nt&&p[2]=="asc"?f.set_selected(!0):f.set_cssClass("SortAscending"),f.set_script('$find("{0}").sort("{1} asc")',this.get_id(),e.Name),Array.add(s,f),f=new Web.Item(l,k),nt&&p[2]=="desc"?f.set_selected(!0):f.set_cssClass("SortDescending"),f.set_script('$find("{0}").sort("{1} desc")',this.get_id(),e.Name),Array.add(s,f)),e.AllowQBE&&(o=this.filterOf(e),g&&Array.add(s,new Web.Item),f=new Web.Item(l,String.format(h.ClearFilter,e.HeaderText)),f.set_cssClass("FilterOff"),o||f.set_disabled(!0),f.set_script('$find("{0}").applyFilterByIndex({1},-1)',this.get_id(),v.AliasIndex),Array.add(s,f),d=null,__designer()||(tt=st[e.FilterType],e.Items.length==0&&(f=new Web.Item(l,tt.Text),Array.add(s,f),d=this.get_fieldFilter(e,!0),this._registerDataTypeFilterItems(l,f,tt.List,d,e)),e.FilterType!="Boolean"&&(!e.SearchOptions||Array.indexOf(e.SearchOptions,"$in")>=0)&&e.AllowMultipleValues!=!1&&(f=new Web.Item(l,h.CustomFilterOption),o&&o.match(/\$(in|out)\$/)?f.set_selected(!0):f.set_cssClass("CustomFilter"),f.set_script('$find("{0}").showCustomFilter({1})',this.get_id(),v.AliasIndex),Array.add(s,f))),v.AllowSamples!=!1))if(v._listOfValues)for(o&&o.startsWith("=")&&(o=o.substring(1),o.endsWith('\0')&&(o=o.substring(0,o.length-1))),a=0;a<v._listOfValues.length;a++){a==0&&Array.add(s,new Web.Item);var y=v._listOfValues[a],rt=!1,c=y;y==null?c=h.EmptyValue:e.Items.length>0?(f=this._findItemByValue(e,y),c=f[1]):e.Type=="String"&&y.length==0?c=h.BlankValue:r(e.DataFormatString)||(c=e.Type.startsWith("DateTime")?String.localeFormat("{0:d}",y):e.format(y));y=this.convertFieldValueToString(e,y);rt=d=="="&&o&&y==o;c.length>h.MaxSampleTextLen&&(c=c.substring(0,h.MaxSampleTextLen)+"...");typeof c!="string"&&(c=c.toString());f=new Web.Item(l,c);rt&&f.set_selected(!0);f.set_script("$find('{0}').applyFilterByIndex({1},{2});",this.get_id(),v.AliasIndex,a);f.set_group(1);Array.add(s,f)}else(!e.SearchOptions||Array.indexOf(e.SearchOptions,"=")>=0)&&(f=new Web.Item(l,h.Loading),f.set_dynamic(!0),f.set_script('$find("{0}")._loadListOfValues("{1}","{2}","{3}")',this.get_id(),l,v.Name,e.Name),Array.add(s,f))}if(t){for(f=new Web.Item(t,e.HeaderText),Array.add(i,f),a=0;a<s.length;a++)it=s[a],f.addChild(it);it.get_selected()&&f.set_selected(!0);o&&f.set_selected(!0)}else $registerItems(l,s,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}}},_get_specialAction:function(n){if(!this._specialActions)return null;var i=this._specialActions[n+"Text"],t=this._specialActions[n+"Script"];return r(t)?null:{text:i,script:t}},_registerSpecialAction:function(n,t,i,r){var f=this,e=f.get_id(),o=n.CommandName,s=n.HeaderText,u=f._specialActions;if(!u.PrintText&&o&&o.match(/^Report/)){if(r!==!0&&!f._isActionAvailable(n))return;u.PrintText=s;u.PrintScript=String.format("$find('{0}').executeAction('ActionBar',{1},-1,{2})",e,i,t)}else if(n.CssClass==="AttachIcon"){if(r!==!0&&!f._isActionAvailable(n))return;u.AnnotateText=s;u.AnnotateScript=String.format("$find('{0}').executeAction('ActionBar',{1},0,{2})",e,i,t)}},_registerActionBarItems:function(){var s=this.get_actionGroups("ActionBar"),h=this.get_isChart(),u,f,i,e,n,t,o;for(h&&!this.get_showViewSelector()&&(u=String.format("{0}${1}$ActionGroup$Chart",this.get_id(),this.get_viewId()),f=[],this._registerFieldHeaderItems(null,u,f,!0),$registerItems(u,f,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.None)),this._specialActions={PrintText:null,PrintScript:null,AnnotateText:null,AnnotateScript:null},i=0;i<s.length;i++)if(e=s[i],u=String.format("{0}${1}$ActionGroup${2}",this.get_id(),this.get_viewId(),i),e.Flat)for($unregisterItems(u),n=0;n<e.Actions.length;n++)this._registerSpecialAction(e.Actions[n],i,n);else{for(f=[],n=0;n<e.Actions.length;n++)t=e.Actions[n],this._isActionAvailable(t)&&(o=new Web.Item(u,t.HeaderText,t.Description),o.set_cssClass(t.CssClassEx+(r(t.CssClass)?t.CommandName+"LargeIcon":t.CssClass)),Array.add(f,o),o.set_script(String.format("$find('{0}').executeAction('ActionBar',{1},null,{2})",this.get_id(),n,i)),this._registerSpecialAction(t,i,n,!0));$registerItems(u,f,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Left,Web.ItemDescriptionStyle.Inline)}Array.clear(s)},_registerViewSelectorItems:function(){for(var t,i,r=[],n=this,u=n.get_id()+"$ViewSelector",f=0;f<n.get_views().length;f++)t=n.get_views()[f],(t.Type!="Form"&&t.ShowInSelector||t.Id==n.get_viewId())&&(i=new Web.Item(u,t.Label),t.Id==this.get_viewId()&&i.set_selected(!0),i.set_script(function(t){n.executeCommand({commandName:"Select",commandArgument:t.Id})}),i.context(t),Array.add(r,i));n.get_isChart()&&(Array.add(r,new Web.Item),n._registerFieldHeaderItems(null,u,r,!0));$registerItems(u,r,Web.HoverStyle.ClickAndStay,Web.PopupPosition.Right,Web.ItemDescriptionStyle.None)},_registerRowSelectorItems:function(){var u=this.get_actions("Grid"),n,f,o,i,t,e;if(u&&u.length>0)for(n=0;n<this._rows.length;n++){for(f=[],o=String.format("{0}$RowSelector${1}",this.get_id(),n),i=0;i<u.length;i++)t=u[i],this._isActionAvailable(t,n)&&(e=new Web.Item(o,t.HeaderText,t.Description),e.set_cssClass(t.CssClassEx+(r(t.CssClass)?t.CommandName+"Icon":t.CssClass)+(f.length==0?" Default":"")),Array.add(f,e),e.set_script(String.format('$find("{0}").executeAction("Grid", {1},{2})',this.get_id(),i,n)));$registerItems(o,f,Web.HoverStyle.Click,Web.PopupPosition.Right,Web.ItemDescriptionStyle.ToolTip)}else for(n=0;n<this._rows.length;n++)$unregisterItems(String.format("{0}$RowSelector${1}",this.get_id(),n))},_get_searchBarSettings:function(){var o,i,l,t,tt,f,it,u,w,g,r,s,h,e,a,v,b,y,nt;if(this._searchBarSettings||(this._searchBarSettings=[]),o=this._searchBarSettings[this.get_viewId()],!o){var d=[],c=[],p=this.get_filter();if(p.length>0&&!this.filterIsExternal())for(i=0;i<p.length;i++)(l=p[i].match(n._fieldFilterRegex),t=this.findField(l[1]),t&&!this._fieldIsInExternalFilter(t))&&(tt=this._allFields[t.AliasIndex],f=l[2].match(n._filterRegex),l[2].startsWith("~")||(t._renderedOnSearchBar=!0,it=this._findItemByValue(t,f[3]),u=f[3],u=="null"&&(u=""),w=u.match(/^([\s\S]+?)\0?$/),w&&(u=w[1]),g=t.Items.length==0?f[1]:"$in",r=n.filterDef(st[t.FilterType].List,t.FilterType=="Boolean"&&f[3].length>1?f[3]=="%js%true"?"$true":"$false":g),r&&(s=u.match(/^(.+?)\$and\$(.+?)$/),Array.add(c,{Index:t.Index,Function:String.format("{0},{1}",r.Function,r.Prompt?"true":"false"),Value:s?s[1]:u,Value2:s?s[2]:""}))));for(h=!1,i=0;i<this._allFields.length;i++)if(t=this._allFields[i],h=t.Search==Web.FieldSearchMode.Required||t.Search==Web.FieldSearchMode.Suggested,h)break;for(i=0;i<this._allFields.length;i++)if(e=this._allFields[i],t=this._allFields[e.AliasIndex],t.AllowQBE&&t.Search!=Web.FieldSearchMode.Forbidden&&(!e.Hidden||e.Search!=Web.FieldSearchMode.Default)){if(a=!h&&c.length<k.VisibleSearchBarFields||h&&(e.Search==Web.FieldSearchMode.Required||e.Search==Web.FieldSearchMode.Suggested),!t._renderedOnSearchBar){for(v=t.Items.length==0||t.FilterType=="Boolean"?null:"$in",t.SearchOptions&&(v=t.SearchOptions[0]),b=st[t.FilterType].List,y=0;y<b.length;y++)if(r=b[y],r!=null&&(v==null||r.Function==v))break;nt={Index:t.Index,Function:String.format("{0},{1}",r.Function,r.Prompt?"true":"false")};(a||this.findFieldUnderAlias(t)==t||t.VisibleOnSearchBar==null)&&Array.add(a?c:d,nt);t.VisibleOnSearchBar=a}t._renderedOnSearchBar=!1}o={visibleFields:c,availableFields:d};this._searchBarSettings[this.get_viewId()]=o}return o},_lookupActionProcessing:function(n){return n!=null&&(this._standardActionProcessing=!n),this._standardActionProcessing!==!0},search:function(n){function o(n){return d(Date,n)&&(n=new Date(n-n.getTimezoneOffset()*6e4)),String.format("%js%{0}",ot(n))}var t=this,i=n.filter,r=[],u,f,e,s;if(n){if(n.sortExpression&&(t._sortExpression=n.sortExpression,u=t.readContext("vitals"),u&&(u.SortExpression=n.sortExpression)),n._filter&&(t._filter=n._filter.slice(0)),i){if(!d(Array,i)){for(f in i)e=i[f],r.push({name:f,operator:d(Array,e)?"in":"",value:e});i=r;r=[]}$(i).each(function(){var n=this,t=n.value==null?n.values:n.value,i=n.operator||"=",u;i.match(/\w/)&&(i="$"+i+"$");d(Array,t)?(u=[],$(t).each(function(n){n>0&&u.push(i==="$between$"?"$and$":"$or$");u.push(o(this))}),t=u.join("")):t=o(t);r.push(String.format("{0}:{1}{2}",n.name||n.field,i,t))});t._filter=r}n._init||t.sync()}else return t._lookupActionProcessing(!1),s=t._hasSearchAction&&t.executeActionInScope(["ActionBar","Form"],"Search",null,-1),t._lookupActionProcessing(!0),s},_toggleSearchBar:function(){this._hasSearchShortcut&&this.search()||(this.set_searchBarIsVisible(!this.get_searchBarIsVisible()),this._updateSearchBar(),this.get_searchBarIsVisible()&&(this.get_lookupField()&&this._adjustLookupSize(),this._focusSearchBar()),_body_performResize())},_renderSearchBarFieldNameOptions:function(t,i,r){var u,f,e;if(i.Search!=Web.FieldSearchMode.Required)for(u=0;u<r.availableFields.length;u++)f=r.availableFields[u],e=this._allFields[f.Index],t.appendFormat('<option value="{0}">{1}<\/option>',u,n.htmlEncode(e.HeaderText))},_renderSearchBarFunctionOptions:function(t,i,r,u,f){for(var e,s,o=0;o<r.length;o++)if(e=r[o],e)if(e.List)this._renderSearchBarFunctionOptions(t,i,e.List,u);else if(f==null||e.Function==f){var h=String.format("{0},{1}",n.htmlAttributeEncode(e.Function),e.Prompt?"true":"false"),l=h==u.Function?' selected="selected"':"",c=String.format('<option value="{0}"{1}>{2}{3}<\/option>',h,l,e.Prompt?"":ut.Equals+" ",e.Function.match(n._keepCapitalization)?e.Text:e.Text.toLowerCase());i.SearchOptions?(s=Array.indexOf(i.SearchOptions,e.Function),s>=0&&(i.SearchOptionSet[s]=c)):t.append(c)}},_renderSearchBarField:function(t,i,f){var v=i.visibleFields[f],e=this._allFields[v.Index],tt=e.Items.length==0||e.FilterType=="Boolean"?null:"$in",y=v.Function.match(/^(.+?),(true|false)$/),s,l,a,g,c,nt,w,p;if(t.appendFormat('<tr id="{0}$SearchBarField${1}"><td class="Control"><select id="{0}$SearchBarName${1}" tabindex="{3}" onchange="$find(\'{0}\')._searchBarNameChanged({1})"><option value="{1}" selected="selected">{2}<\/option>',this.get_id(),f,n.htmlEncode(e.HeaderText),$nextTabIndex()),this._renderSearchBarFieldNameOptions(t,e,i),t.append("<\/select><\/td>"),t.appendFormat('<td class="Control"><select id="{0}$SearchBarFunction${1}" class="Function" tabindex="{2}" onchange="$find(\'{0}\')._searchBarFuncChanged({1})">',this.get_id(),f,$nextTabIndex()),e.SearchOptions&&(e.SearchOptionSet=[]),this._renderSearchBarFunctionOptions(t,e,st[e.FilterType].List,v,tt),e.SearchOptions)for(s=0;s<e.SearchOptionSet.length;s++)t.append(e.SearchOptionSet[s]);t.append("<\/select><\/td>");var b=e.Type.startsWith("DateTime")?'<a class="Calendar" href="javascript:" onclick="return false">&nbsp;<\/a>':"",d=y[1]=="$in"||y[1]=="$notin",o=v.Value;if(d){if(l=new Sys.StringBuilder,a=!r(o),l.appendFormat('<table class="FilterValues{3}" cellpadding="0" cellspacing="0" onmouseover="$app.highlightFilterValues(this,true,\'Active\')" onmouseout="$app.highlightFilterValues(this,false,\'Active\')"><tr><td class="Values" valign="top"><div><a class="Link" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false;" tabindex="{4}" href="javascript:" onfocus="$app.highlightFilterValues(this,true,\'Focused\')" onblur="$app.highlightFilterValues(this,false,\'Focused\')" title="{5}">',this.get_id(),e.Index,f,a?"":" Empty",$nextTabIndex(),ut.FilterToolTip),a)for(g=o.split(/\$or\$/),s=0;s<g.length;s++)s>0&&l.append('<span class="Highlight">, <\/span>'),c=g[s],String.isJavaScriptNull(c)?c=h.EmptyValue:(c=this.convertStringToFieldValue(e,c),nt=this._findItemByValue(e,c),c=nt?nt[1]:e.format(c)),l.append(c);else l.append(u.Lookup.SelectLink);l.appendFormat('<\/a><\/div><\/td><td class="Button{5}" valign="top"><a href="javascript:" onclick="$find(\'{0}\')._showSearchBarFilter({1},{2});return false" title="{3}" tabindex="{4}" onfocus="$app.highlightFilterValues(this,true,\'Focused\')" onblur="$app.highlightFilterValues(this,false,\'Focused\')" >&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),a?-1:e.Index,f,a?vt:ut.FilterToolTip,$nextTabIndex(),a?" Clear":"");b=l.toString()}else r(o)||(o=o.split(/\$or\$/)[0]);y[2]=="true"?(typeof o!="string"||d||(o=e.format(this.convertStringToFieldValue(e,o))),t.appendFormat('<td class="Control"><input id="{0}$SearchBarValue${1}" type="{6}" class="{2} {7}" value="{3}" tabindex="{4}"/>{5}<\/td>',this.get_id(),f,e.FilterType,n.htmlAttributeEncode(o=="null"?h.EmptyValue:o),$nextTabIndex(),b,d?"hidden":"text",e.AllowAutoComplete!=!1?" AutoComplete":"")):t.append("<td>&nbsp;<\/td>");w=$nextTabIndex();y[1]=="$between"&&(w=$nextTabIndex());t.appendFormat('<td class="FieldAction"><a href="javascript:" tabindex="{1}" title="{2}" class="Remove" onclick="$find(\'{0}\')._searchBarNameChanged({3}, true)"><span><\/span<\/a><\/td>',this.get_id(),w,k.RemoveCondition,f);t.append("<\/tr>");e.FilterType!="Text"&&y[1]=="$between"&&(p=v.Value2,typeof p=="string"&&(p=e.format(this.convertStringToFieldValue(e,p))),t.appendFormat('<tr><td colspan="2" class="Control AndLabel">{4}<\/td><td><input id="{0}$SearchBarValue2${1}" type="text" class="{2}" value="{3}" tabindex="{5}"/>{6}<\/td><td>&nbsp;<\/td><\/tr>',this.get_id(),f,e.FilterType,n.htmlAttributeEncode(p),ut.And,w-1,b))},_focusSearchBar:function(n){var f=n!=null,i,t,u;f||(n=0);i=this._get_searchBarControl("Function",n);i||(n=0,i=this._get_searchBarControl("Function",0));t=this._get_searchBarControl("Value",n);t?t.type=="hidden"?(u=t.parentNode.getElementsByTagName("a")[0],u.focus(),f&&this._searchBarVisibleIndex==null&&r(t.value)&&u.click()):Sys.UI.DomElement.setFocus(t):i&&i.focus()},_searchBarNameChanged:function(n,t){var i,u,f,r;this._saveSearchBarSettings();i=this._get_searchBarSettings();u=i.visibleFields[n];t?Array.removeAt(i.visibleFields,n):(f=this._get_searchBarControl("Name",n),r=tt(f.value),i.visibleFields[n]=i.availableFields[r],Array.removeAt(i.availableFields,r));Array.insert(i.availableFields,0,u);this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarFuncChanged:function(n){this._saveSearchBarSettings();var t=this._get_searchBarSettings(),i=t.visibleFields[n],r=this._get_searchBarControl("Function",n);i.Function=r.value;this._renderSearchBarControls(!0);this._focusSearchBar(n)},_searchBarAddField:function(){this._saveSearchBarSettings();var n=this._get_searchBarSettings();Array.add(n.visibleFields,n.availableFields[0]);Array.removeAt(n.availableFields,0);this._renderSearchBarControls(!0);this._focusSearchBar(n.visibleFields.length-1)},_createSearchBarFilter:function(n){for(var c,i,r,a,u,f,e,o,v,p,w=Array.clone(this._filter),l=this._get_searchBarSettings(),s=[],h=!0,t=0;t<l.visibleFields.length;t++)if(c=l.visibleFields[t],i=this._allFields[c.Index],this.removeFromFilter(i),r=c.Function.match(/^(.+?),(true|false)$/),a=[],r[2]=="true"){if(u=this._get_searchBarControl("Value",t),f=this._get_searchBarControl("Value2",t),y(u.value)&&(!f||y(f.value))&&i.Search!=Web.FieldSearchMode.Required)continue;if(r[1]=="$in"||r[1]=="$notin"){Array.add(s,{Index:i.Index,Function:r[1],Values:[u.value]});continue}if(y(u.value)){if(n)continue;else alert(g.RequiredField),Sys.UI.DomElement.setFocus(u),h=!1;break}if(e={NewValue:u.value.trim()},o=this._validateFieldValueFormat(i,e),o)if(n)continue;else{alert(o);Sys.UI.DomElement.setFocus(u);h=!1;break}else Array.add(a,i.Type.startsWith("DateTime")?u.value.trim():e.NewValue);if(r[1]=="$between"){if(y(f.value)){if(n)continue;else alert(g.RequiredField),Sys.UI.DomElement.setFocus(f),h=!1;break}if(e={NewValue:f.value.trim()},o=this._validateFieldValueFormat(i,e),o)if(n)continue;else{alert(o);Sys.UI.DomElement.setFocus(f);h=!1;break}else Array.add(a,i.Type.startsWith("DateTime")?f.value.trim():e.NewValue)}Array.add(s,{Index:i.Index,Function:r[1],Values:a})}else Array.add(s,{Index:i.Index,Function:r[1],Values:null});if(!h)return null;for(t=0;t<l.availableFields.length;t++)c=l.availableFields[t],i=this._allFields[c.Index],this.removeFromFilter(i);for(t=0;t<s.length;t++)v=s[t],this.applyFieldFilter(v.Index,v.Function,v.Values,!0);return p=this._filter,this._filter=w,p},_executeSearch:function(i){var r=this,o=r.get_action(i),s,f,u,e,h;if(!o||o.Confirmation&&o.Confirmation.match(/_controller\s*=/))r._clearSelectedKey(),r._cancelConfirmation(),t?r._syncKey=!0:r.refreshAndResize();else for(s=Sys.Application.getComponents(),f=0;f<s.length;f++)u=s[f],d(n,u)&&u._hasSearchAction&&(e=u.get_action(u._hasSearchAction),e&&e.Confirmation&&(h=e.Confirmation.match(/_controller\s*=\s*(\w+)/),h&&h[1]===r._controller&&u.search()))},_performSearch:function(){if(!this._isBusy){this._saveSearchBarSettings();var n=this._createSearchBarFilter(!1);n&&(this.set_filter(n),this.refreshData(),this._setFocusOnSearchBar=!0);this._forgetSelectedRow(!0)}},_resetSearchBar:function(){this._isBusy||(this.clearFilter(),this._searchBarSettings[this.get_viewId()]=null,this._renderSearchBarControls(!0),this._focusSearchBar())},_get_searchBarControl:function(n,t){return $get(String.format("{0}$SearchBar{1}${2}",this.get_id(),n,t))},_saveSearchBarSettings:function(){for(var r=this._get_searchBarSettings(),n=0;n<r.visibleFields.length;n++){var t=r.visibleFields[n],f=this._get_searchBarControl("Function",n),i=this._get_searchBarControl("Value",n),u=this._get_searchBarControl("Value2",n);t.Function=f.value;i&&(i.value==h.EmptyValue?"null":i.value,t.Value=this._formatSearchField(i,t.Index));u&&(t.Value2=this._formatSearchField(u,t.Index))}},_formatSearchField:function(n,t){var i=this._allFields[t],r,u;return i.Type.startsWith("Date")?(r=Date.tryParseFuzzyDate(n.value,i.DataFormatString),r!=null&&(n.value=i.format(r))):i.Type!="String"&&(u=Number.tryParse(n.value,i.DataFormatString),u!=null&&(n.value=i.format(u))),n.value},_renderSearchBarControls:function(n){var s,i,u,t,f,h,e,r,o,l;if(!this._searchBarInitialized||n){for(s=$get(this.get_id()+"$SearchBarContent"),this._searchBarInitialized=!0,i=new Sys.StringBuilder,i.append('<table class="SearchBarFrame">'),u=this._get_searchBarSettings(),t=0;t<u.visibleFields.length;t++)this._renderSearchBarField(i,u,t);for(u.availableFields.length>0&&i.appendFormat('<tr><td colspan="3" class="AddConditionText"><a href="javascript:" onclick="$find(\'{0}\')._searchBarAddField();return false;">{3}<\/a><\/td><td class="FieldAction"><a href="javascript:" class="Add" tabindex="{1}" title="{2}" onclick="$find(\'{0}\')._searchBarAddField();return false;"><span><\/span><\/a><\/td>',this.get_id(),$nextTabIndex(),k.AddCondition,k.AddConditionText),i.appendFormat('<tr><td><div id="{0}$SearchBarNameStub" class="Stub"><\/div><\/td><td><div id="{0}$SearchBarFuncStub" class="Stub"><\/div><\/td><td><\/td><\/tr>',this.get_id()),i.append("<\/table>"),i.appendFormat('<div class="SearchButtons"><button onclick="$find(\'{0}\')._performSearch();return false" tabindex="{3}" class="Search">{1}<\/button><br/><button onclick="$find(\'{0}\')._resetSearchBar();return false" tabindex="{4}" class="Reset">{2}<\/button><\/div>',this.get_id(),ti,vt,$nextTabIndex(),$nextTabIndex()),s.innerHTML=i.toString(),i.clear(),f=$get(this.get_id()+"$SearchBarNameStub"),f.style.width=f.offsetWidth+"px",f=$get(this.get_id()+"$SearchBarFuncStub"),f.style.width=f.offsetWidth+"px",h=s.getElementsByTagName("select"),t=0;t<h.length;t++)h[t].style.width="100%";for(this._searchBarExtenders||(this._searchBarExtenders=[]),t=0;t<u.visibleFields.length;t++){var a=u.visibleFields[t],v=this._allFields[a.Index],c=this._get_searchBarControl("Value",t);if(c)if(a.Function.match(/\$(in|notin),/)==null)e=this._createFieldInputExtender("SearchBar",v,c,t),e&&Array.add(this._searchBarExtenders,e);else{for(r=c;r&&r.tagName!="TR";)r=r.parentNode;for(o=0;o<r.childNodes.length;o++)r.childNodes[o].vAlign="top"}l=this._get_searchBarControl("Value2",t);l&&(e=this._createFieldInputExtender("SearchBar",v,l,t+"$2"),e&&Array.add(this._searchBarExtenders,e))}}},_updateSearchBar:function(){var r=this._get("$SearchBar"),n,t,u,i;r&&(n=this.get_searchBarIsVisible(),t=this._get("$SearchBarActivator"),t&&(n?Sys.UI.DomElement.addCssClass(t,"Activated"):Sys.UI.DomElement.removeCssClass(t,"Activated")),Sys.UI.DomElement.setVisible(r,n),n&&this._renderSearchBarControls(r),t&&(Sys.UI.DomElement.setVisible(this._get("$QuickFind"),!n),u=this._get("$SearchToggle"),u.title=this._hasSearchAction&&this._hasSearchShortcut?ti:this.get_searchBarIsVisible()?k.HideAdvancedSearch:k.ShowAdvancedSearch),i=this._get("$InfoRow"),i&&(n?Sys.UI.DomElement.addCssClass(i,"WithSearchBar"):Sys.UI.DomElement.removeCssClass(i,"WithSearchBar")),this._setFocusOnSearchBar&&(this._setFocusOnSearchBar=!1,this._focusSearchBar()))},_renderSearchBarActivator:function(n){this.get_showSearchBar()&&(this.get_showQuickFind()||!this.get_searchOnStart())&&(n.appendFormat('<td class="SearchBarActivator{1}" id="{0}$SearchBarActivator"><a href="javascript:" onclick="$find(\'{0}\')._toggleSearchBar();return false;" id="{0}$SearchToggle"><span><\/span><\/a><\/td>',this.get_id(),this._hasSearchAction&&this._hasSearchShortcut?" Search":""),this.get_showQuickFind()||n.append('<td class="Divider"><div><\/div><\/td>'))},_internalRenderActionBar:function(t){var h=this.get_actionGroups("ActionBar"),c,l,a,o,e,s,v,f,i;if(t.append('<table cellpadding="0" cellspacing="0" class="Groups"><tr>'),c=this.get_isGrid(),c&&this._renderSearchBarActivator(t),c&&this.get_showQuickFind()?(l=this.get_quickFindText(),t.appendFormat('<td class="QuickFind" title="{2}" id="{0}$QuickFind"><div class="QuickFind"><table cellpadding="0" cellspacing="0"><tr><td><input type="text" id="{0}_QuickFind" value="{1}" class="{3}" tabindex="{4}"/><\/td><td class="Button"><a href="#" onclick="$find(\'{0}\').quickFind();return false;"><span>&nbsp;<\/span><\/a><\/td><\/tr><\/table><\/div><\/td>',this.get_id(),n.htmlAttributeEncode(l),k.QuickFindToolTip,l==k.QuickFindText?"Empty":"NonEmpty",$nextTabIndex()),t.append('<td class="Divider"><div><\/div><\/td>'),this.get_lookupField()&&!r(this.get_lookupField().ItemsNewDataView)&&t.appendFormat('<td class="QuickCreateNew"><a href="javascript:" onclick="$find(\'{0}\').closeLookupAndCreateNew();return false;" class="CreateNew" title="{1}" tabindex="{2}><span class="Placeholder"><\/span><\/a><\/td>',this.get_id(),u.Lookup.GenericNewToolTip,$nextTabIndex())):(h.length==0||this.get_lookupField())&&t.append('<td class="Divider"><div style="visibility:hidden"><\/div><\/td>'),!this.get_lookupField())for(this._registerActionBarItems(),a=this.get_isChart()&&!this.get_showViewSelector(),a&&t.appendFormat('<td class="Group Main" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup$Chart&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{3}" onclick="$hoverOver(this, 2);return false;">{2}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),n.htmlEncode(this.get_view().Label),$nextTabIndex()),o=0;o<h.length;o++)if((o>0||a)&&t.append('<td class="Divider"><div><\/div><\/td>'),e=h[o],e.Flat){for(s=-1,v=-1,f=0;f<e.Actions.length;f++)i=e.Actions[f],i._isAvailable=this._isActionAvailable(i)&&!r(i.HeaderText),i._isFirst=!1,i._isLast=!1,i._isAvailable&&(s==-1&&(s=f),v=f);for(s>=0&&(e.Actions[s]._isFirst=!0,e.Actions[v]._isLast=!0),f=0;f<e.Actions.length;f++)i=e.Actions[f],i._isAvailable&&t.appendFormat('<td class="{7}Group FlatGroup{6}{8}{9}" onmouseover="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="if(this._skip)this._skip=null;else $find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2})" title="{10}"><span class="Outer">{5}<a href="javascript:" tabindex="{4}" onclick="this.parentNode.parentNode._skip=true;$find(\'{0}\').executeAction(\'ActionBar\',{1},null,{2});return false;" onfocus="$showHover(this,&quot;{0}${2}$ActionGroup${1}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)">{3}<\/a><\/span><\/td>',this.get_id(),f,o,n.htmlEncode(i.HeaderText),$nextTabIndex(),r(i.CssClass)?"":String.format('<span class="FlatGroupIcon {0}">&nbsp;<\/span>',n.cssToIcon(i.CssClass)),r(i.CssClass)?"":" FlatGroupWithIcon",i.CssClassEx,i._isFirst?" First":"",i._isLast?" Last":"",i.Description)}else t.appendFormat('<td class="{5}Group" onmouseover="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><a href="javascript:" onfocus="$showHover(this,&quot;{0}${1}$ActionGroup${2}&quot;,&quot;ActionGroup&quot;,2)" onblur="$hideHover(this)" tabindex="{4}" onclick="$hoverOver(this, 2);return false;">{3}<\/a><\/span><\/td>',this.get_id(),this.get_viewId(),o,e.HeaderText,$nextTabIndex(),e.CssClassEx);t.append("<\/tr><\/table>")},_renderActionBar:function(t){if(!this.get_showActionBar()){this._registerActionBarItems();return}t.appendFormat('<tr class="ActionRow"><td colspan="{0}"  class="ActionBar">',this._get_colSpan());t.appendFormat('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="width:100%" id="{0}$ActionBar">',this.get_id());this._internalRenderActionBar(t);this._registerViewSelectorItems();t.append('<\/td><td class="ViewSelectorControl">');this.get_showViewSelector()&&(t.appendFormat('<table cellpadding="0" cellspacing="0"><tr><td class="ViewSelectorLabel">{0}:<\/td><td>',u.ActionBar.View),t.appendFormat('<span class="ViewSelector" onmouseover="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;)" onmouseout="$hideHover(this)" onclick="$toggleHover()"><span class="Outer"><span class="Inner"><a href="javascript:" class="Link" tabindex="{2}" onfocus="$showHover(this,&quot;{0}$ViewSelector&quot;,&quot;ViewSelector&quot;,3)" onblur="$hideHover(this)">{1}<\/a><\/span><\/span><\/span>',this.get_id(),n.htmlEncode(this.get_view().Label),$nextTabIndex()),t.append("<\/td><\/tr><\/table>"));t.append("<\/td><\/tr><\/table>");t.append("<\/td><\/tr>")},get_statusBar:function(){var n=this,t=n._statusBar||n._statusBarAuto;return t||!n._isWizard||n.tagged("status-bar-disabled")||(t=n._statusBarAuto=n._controller+"."+n._viewId+"._wizard: 0\n"+h.Loading+">\n"),t},_renderStatusBar:function(n){n.appendFormat('<tr class="StatusBarRow" style="display:none"><td colspan="{1}" class="StatusBar" id="{0}$StatusBar"><\/td><\/tr>',this.get_id(),this._get_colSpan())},statusBar:function(){var v=this.get_statusBar(),o,f,t,s,u,e,h,c,i;if(!r(v))for(f=/((\w+)\.)?((\w+)\.)?(\w+):\s*(.+?)\s*\n\s*(((.+?)\s*>\s*)+)/g,t=f.exec(v);t;){if(s=this.fieldValue(t[5]),s==null&&(s="null"),(t[6]==s||t[6]=="*")&&(r(t[2])||t[2]==this.get_controller())&&(r(t[3])||t[4]==this.get_viewId())){for(f=/(\[)?\s*(.+?)\s*(\])?\s*>\s*/g,u=[],e=f.exec(t[7]);e;)Array.add(u,{Text:e[2],Current:e[1]=="["&&e[3]=="]"}),e=f.exec(t[7]);if(u.length>0&&!(__tf!=4)){for(o=new Sys.StringBuilder('<ul class="StatusBar">'),h=!1,c=!0,i=0;i<u.length;i++)if(u[i].Current){h=!0;c=!1;break}for(i=0;i<u.length;i++){var l=u[i],a=l.Current?"Current":h?"Past":c?"Future":"",y=i<u.length-1?u[i+1]:null,p="";y&&(y.Current?p=a+"ToCurrent":l.Current&&(p=y.Current?a+"ToCurrent":a+"ToFuture"));l.Current&&(h=!1,c=!0);o.appendFormat('<li class="Segment {1}{2}{3} {4}"><span class="Outer"><span class="Inner"><span class="Self">{0}<\/span><\/span><\/span><\/li>',n.htmlEncode(l.Text),a,i==0?" First":"",i==u.length-1?" Last":"",p)}o.append("<\/ul>")}break}t=f.exec(v)}return o?o.toString():null},_updateStatusBar:function(){var i=this.get_statusBar(),t,n;r(i)||(n=$(this._get("$StatusBar")),n.length&&(t=this.statusBar(),t?n.html(t).parent().show():n.parent().hide()))},filterByFirstLetter:function(n){var t=this._firstLetters[0],i=this._firstLetters[n];this.applyFieldFilter(this.findField(t).Index,"$beginswith",[i])},_renderViewDescription:function(t){var v=this._firstLetters&&this._firstLetters.length>2,l=this.get_showDescription(),e,s,o,h,a,i,f,y,c;if(l||v){if(e=l?this.get_description():"",s=null,v){for(o=new Sys.StringBuilder,o.append('<div class="Letters">'),h=this.findField(this._firstLetters[0]),a=null,i=0;i<this._filter.length;i++)if(f=this._filter[i].match(n._fieldFilterRegex),f&&f[1]==h.Name){f=f[2].match(/^\$beginswith\$(.+?)\0$/);f&&(a=this.convertStringToFieldValue(h,f[1]));break}for(y=String.format("{0} {1} ",n.htmlAttributeEncode(h.Label),st.Text.List[2].Text.toLowerCase()),i=1;i<this._firstLetters.length;i++)c=this._firstLetters[i],o.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').filterByFirstLetter({1});return false;" class="Letter{5}" title="{3}{4}">{2}<\/a> ',this.get_id(),i,c,y,n.htmlAttributeEncode(c),a==c?" Selected":"");o.append("<\/div>");s=o.toString();o.clear()}l&&r(e)&&(e=this.get_view().HeaderText);(!r(e)||this.get_lookupField()||s)&&(t.appendFormat('<tr class="HeaderTextRow"><td colspan="{0}" class="HeaderText">',this._get_colSpan()),this.get_lookupField()!=null&&t.append('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td style="padding:0px">'),t.appendFormat('<div id="{0}$HeaderText">',this.get_id()),t.append(this._formatViewText(u.Views.DefaultDescriptions[e],!0,e)),t.append("<\/div>"),s&&t.append(s),this.get_lookupField()!=null&&t.appendFormat('<\/td><td align="right" style="padding:0px"><a href="javascript:" class="Close" onclick="$find(\'{0}\').hideLookup();return false" tabindex="{2}" title="{1}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),ft.Close,$nextTabIndex()),t.append("<\/td><\/tr>"))}},_renderInfoBar:function(n){var i=this.get_filter(),t;i.length>0&&!this.filterIsExternal()&&(t=new Sys.StringBuilder,this.get_viewType()!="Form"&&this._renderFilterDetails(t,i),this.get_viewType()=="Form"||t.isEmpty()||(n.appendFormat('<tr class="InfoRow {2}" id="{0}$InfoRow"><td colspan="{1}">',this.get_id(),this._get_colSpan(),this.get_viewType()),n.append(t.toString()),n.append("<\/td><\/tr>")),t.clear())},_renderFilterDetails:function(i,r,f){function yt(n){for(var t=b+1;t<r.length;){if(r[t].match(/^(_match_|_donotmatch)/))break;t++}return t-b>2?ht[n+"PastTense"]:n.startsWith("DoNot")?ht.DidNotMatch:ht.Matched}function lt(n,t,i){return n.getHours&&(n.getHours()==0&&n.getMinutes()==0&&n.getSeconds()==0||i&&n.getHours()==23&&n.getMinutes()==59&&n.getSeconds()==59)?String.format("{0:d}",n):t}for(var ot=!1,c=this,p,nt,ct=c.viewProp&&c.viewProp("deepSearchInfo"),k=0,tt,w,a,o,v,et,g,b=0;b<r.length;b++){var l=r[b].match(n._fieldFilterRegex),it=l[1]=="_quickfind_",e=it?c._fields[0]:c.findField(l[1]),d;if(!e&&l[1].match(/\,/)&&ct){tt++>0&&i.append("; ");i.append(ct[l[1].replace(/\W/g,"_")+(k-1)]);continue}if(!e||this._fieldIsInExternalFilter(e)){l[1]=="_match_"?d="Match":l[1]=="_donotmatch_"&&(d="DoNotMatch");d&&(d+=l[2]=="$all$"?"All":"Any",k>0&&i.append(". "),i.append(yt(d)),i.append(": "),k++,tt=0);continue}ot||(f!=!1&&i.appendFormat('<a href="javascript:" onclick="$find(\'{0}\').clearFilter(true);return false" class="Close" tabindex="{3}" title="{2}">&nbsp;<\/a><span class="Details"><span class="Information">&nbsp;<\/span>{1} ',this.get_id(),u.InfoBar.FilterApplied,ft.Close,$nextTabIndex()),ot=!0);for(var at=e&&this._allFields[e.AliasIndex],s=n._filterIteratorRegex.exec(l[2]),rt=!0;s&&(s[1].startsWith("~")||!(e.Index==e.AliasIndex&&e.IsPrimaryKey&&e.Hidden));){if(rt?i.appendFormat('<span class="FilterElement" onclick="$find(\'{0}\').removeFromFilterByIndex({1})" title="{2}">',this.get_id(),it?-1:e.Index,it?vt:n.htmlAttributeEncode(String.format(h.ClearFilter,e.Label))):i.append(", "),s[1].startsWith("~"))i.appendFormat(String.format('{0} <b class="String">{1}<\/b>',u.InfoBar.QuickFind,this.convertStringToFieldValue(e,s[3]))),p=t&&c.viewProp("quickFindHint"),p&&(p=p.split(";"),i.append(" "+ht.In+" "),p[0]?i.append(c.get_view().Label):nt=!0,$(t._pages).each(function(){var r=this,n=r.dataView,t;n&&c._id==n._filterSource&&(t=p.indexOf(n._controller+"."+n._viewId+"."+n._filterFields),t!=-1&&(nt?nt=!1:t==p.length-1?i.append(" "+ut.And+" "):i.append(", "),i.append(n.get_view()&&n.get_view().Label||r.text)))}));else if(tt++>0&&i.append("; "),i.appendFormat('<span class="Highlight">{0}<\/span>',c._fieldNameHint&&c._fieldNameHint[at.Name]||at.HeaderText),w=n.filterDef(st[e.FilterType].List,e.FilterType=="Boolean"&&s[3].length>1?s[3]=="%js%true"?"$true":"$false":s[1]),w)if(w.Prompt){if(i.appendFormat(" {0} ",w.Text.toLowerCase()),o=s[3],v=o.split(n._listRegex),String.isJavaScriptNull(v[0])&&(v[0]=u.InfoBar.Empty),!String.isJavaScriptNull(s[2]))for(et=v[0].match(/^([\s\S]+?)\0?$/),et&&(v[0]=et[1]),o=this.convertStringToFieldValue(e,v[0]),a=this._findItemByValue(e,o),i.appendFormat("<b>{0}<\/b>",String.htmlEncode(a?a[1]:lt(o,e.format(o)))),g=1;g<v.length;g++)if(i.appendFormat("{0} ",s[1]=="$between$"?" "+ut.And:", "),o=this.convertStringToFieldValue(e,v[g]),o==null?o=h.EmptyValue:(a=this._findItemByValue(e,o),o=a?a[1]:lt(o,e.format(o),!0)),i.appendFormat('<b class="{1}">{0}<\/b>',String.htmlEncode(o)),g>5){i.append(", ..");break}}else i.appendFormat(" {0} <b>{1}<\/b>",ut.Equals,w.Function.match(n._keepCapitalization)?w.Text:w.Text.toLowerCase());else{switch(s[1]){case"=":i.append(String.isJavaScriptNull(s[2])?u.InfoBar.Empty:u.InfoBar.EqualTo);break;case"<":i.append(u.InfoBar.LessThan);break;case"<=":i.append(u.InfoBar.LessThanOrEqual);break;case">":i.append(u.InfoBar.GreaterThan);break;case">=":i.append(u.InfoBar.GreaterThanOrEqual);break;case"*":i.append(s[2].startsWith("%")?u.InfoBar.Like:u.InfoBar.StartsWith)}a=this._findItemByValue(e,this.convertStringToFieldValue(e,s[3]));o=a==null?s[3]:a[1];o=String.isJavaScriptNull(s[3])||y(o)?u.InfoBar.Empty:this.convertStringToFieldValue(e,o);i.appendFormat("<b>{0}<\/b>",String.htmlEncode(o))}s=n._filterIteratorRegex.exec(l[2]);rt=!1}rt||k||c._fieldNameHint||i.append(".");i.append("<\/span> ")}k&&i.append(". ");i.append("<\/span>")},_findItemByValue:function(n,i){var u=n.DynamicItems||n.Items,r=n.ItemCache;return u.length?(r||(r=n.ItemCache={},$(u).each(function(){var n=this;r[n[0]]=n})),n.ContextFields?[i,i]:r[i]||[null,this.get_isForm()||t?w:ct]):null},_renderPager:function(n,t){var c,u,f,e,o,s,h,l;if(this.get_showPager().indexOf(t)!==-1){if(c=this.get_isChart(),n.appendFormat('<tr class="FooterRow {2}PagerRow"><td colspan="{0}" class="Footer"><table cellpadding="0" cellspacing="0" style="width:100%"><tr><td align="left" class="Pager PageButtons{1}">',this._get_colSpan(),c?" Print":"",t),u=this.get_pageCount(),f=this.get_pageSize(),c&&(u=1,f=this._totalRowCount,e=this._get_specialAction("Print"),e&&n.appendFormat('<a href="javascript:" onclick="{1};return false;" title="{0}" class="Print"><span><\/span><\/a><\/td><td>',e.text,e.script)),u>1){var r=this._firstPageButtonIndex,a=this.get_pagerButtonCount(),v=a;for(this.get_pageIndex()>0?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()-1,this.get_id(),b.Previous,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',b.Previous),n.appendFormat(" | {0}: ",b.Page),r>0&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage(0,true);return false" class="PaddedLink" tabindex="{2}">1<\/a><a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">...<\/a>',r-1,this.get_id(),$nextTabIndex(),$nextTabIndex());v>0&&r<u;)r==this.get_pageIndex()?n.appendFormat('<span class="Selected">{0}<\/span>',r+1):n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',r,this.get_id(),r+1,$nextTabIndex()),r++,v--;r<=u-1&&n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{2}">...<\/a><a href="#" onclick="$find(\'{1}\').goToPage({3}-1,true);return false" class="PaddedLink" tabindex="{4}">{3}<\/a>',this._firstPageButtonIndex+a,this.get_id(),$nextTabIndex(),u,$nextTabIndex());n.append(" | ");this.get_pageIndex()<u-1?n.appendFormat('<a href="#" onclick="$find(\'{1}\').goToPage({0},true);return false" class="PaddedLink" tabindex="{3}">{2}<\/a>',this.get_pageIndex()+1,this.get_id(),b.Next,$nextTabIndex()):n.appendFormat('<span class="Disabled">{0}<\/span>',b.Next)}if(n.append('<\/td><td align="right" class="Pager PageSize">&nbsp;'),o=this.get_showPageSize(),s=this._pageSizes,o&&this._totalRowCount>f){for(n.append(b.ItemsPerPage),i=0;i<s.length;i++)i>0&&n.append(", "),f==s[i]?n.appendFormat("<b>{0}<\/b>",f):n.appendFormat('<a href="#" onclick="$find(\'{0}\').set_pageSize({1},true);return false" tabindex="{2}">{1}<\/a>',this.get_id(),s[i],$nextTabIndex());n.append(" | ")}this._totalRowCount>0&&(h=(this.get_pageIndex()+1)*f,h>this._totalRowCount&&(h=this._totalRowCount),o&&n.appendFormat(b.ShowingItems,this.get_pageIndex()*f+1,h,this._totalRowCount),l=this.multiSelect(),l&&(n.appendFormat('<span id="{0}$SelectionInfo">',this.get_id()),this._selectedKeyList.length>0&&n.appendFormat(b.SelectionInfo,this._selectedKeyList.length),n.append("<\/span>")),(o||l)&&n.append(" | "));n.appendFormat('<\/td><td align="center" class="Pager Refresh" id="{0}_Wait">',this.get_id());this.get_searchOnStart()||n.appendFormat('<a href="#" onclick="$find(\'{0}\').{3}();return false" tabindex="{2}" title="{1}"><span>&nbsp;<\/span><\/a>',this.get_id(),b.Refresh,$nextTabIndex(),this._hasSearchAction?"search":"sync");n.append("<\/td><\/tr><\/table>");n.append("<\/td><\/tr>")}},refreshAndResize:function(){this.cancelDataSheetEdit();this.goToPage(-1);delete this._viewColumnSettings},refreshData:function(){var n=this;n._busy()||(n._clearCache(),n.set_pageIndex(-2),n._loadPage())},_dittoCollectedValues:function(n,t){var r,i,f,s;if(this.editing()){var e=t?new RegExp(String.format("^{0}(Length|ContentType|FileName|FullFileName)?$",t)):null,o=this._collectFieldValues(!0),u=[];for(r=0;r<o.length;r++)i=o[r],e&&i.Name.match(e)||Array.add(u,{name:i.Name,value:i.Modified?i.NewValue:i.OldValue});if(n)for(r=0;r<n.length;r++){for(i=n[r],f=0;f<u.length;f++)if(s=i.Name?i.Name:i.name,u[f].name==s){Array.removeAt(u,f);break}Array.add(u,i.Name?{name:i.Name,value:i.NewValue}:i)}this._ditto=u}},refresh:function(n,i,r){var u=this,f;u._dittoCollectedValues(i,r);u._lastSelectedCategoryTabIndex=u.get_categoryTabIndex();n?u._render():t?(f=u.get_parentDataView(this),f==u?u.sync():f._syncKey=f.get_selectedKey()):(u.goToView(u.get_viewId()),u._ditto=null)},_cname:function(n){var t=this.get_viewId();return t==null&&(t="grid1"),String.format("{0}${1}${2}",this._id,t,n)},readContext:function(n){return Web.PageState.read(this._cname(n))},writeContext:function(n,t){Web.PageState.write(this._cname(n),t)},_saveViewVitals:function(){this.writeContext("vitals",{PageIndex:this.get_pageIndex(),PageSize:this.get_pageSize(),Filter:this.get_filter(),SortExpression:this.get_sortExpression(),Tag:this.get_tag()})},_restoreViewVitals:function(n){var t,u,i,r,e,h,o;if(!(n.PageIndex>=0)&&(t=this.readContext("vitals"),t!=null)&&(n.RequiresRowCount=!0,n.RequiresMetaData=!0,n.PageIndex==-1&&t.Filter&&n.Filter)){if(n.Tag=t.Tag,n.PageIndex=t.PageIndex,n.PageSize=t.PageSize,n.FilterIsExternal){for(u=n.Filter,i=0;i<t.Filter.length;i++){var f=t.Filter[i],c=f.substring(0,f.indexOf(":")),s=!1;for(r=0;r<n.Filter.length;r++)if(e=n.Filter[r],h=e.substring(0,e.indexOf(":")),h==c){s=!0;break}s||Array.add(u,f)}n.Filter=Array.clone(u)}else(n.Filter==null||n.Filter.length==0)&&(n.Filter=Array.clone(t.Filter));n.SortExpression=t.SortExpression;this.get_isDataSheet()&&this._get_focusedCell()||(o=this.readContext("GridType"),o!=null&&this.changeViewType(o))}},paramValue:function(n,t){this._paramValues||(this._paramValues=[]);this._paramValues.push({Name:n,Value:t})},_useSearchParams:function(n){var t=this._paramValues,r,i,u;if(t?(this._searchParamValues=t,this._paramValues=null):t=this._searchParamValues,t){for(r=Array.clone(n.ExternalFilter),i=0;i<t.length;i++)u=t[i],Array.add(r,{Name:u.Name,Value:u.NewValue});n.ExternalFilter=r}},_forceSync:function(){var n=this;n._skipSync||t&&n.get_isForm()?n._skipSync=!1:n._syncKey=n.get_selectedKey()},sync:function(n){var t=this,i,r;if(t._clearCache(),n){for(d(Array,n)||(n=[n]),r=[],i=0;i<t._keyFields.length;i++)r[t._keyFields[i].Index]=n[i];t._raiseSelectedDelayed=!0;t._pendingSelectedEvent=!0;t._selectKeyByRow(r)}t._forceSync();t.refreshAndResize();t._synced=!0},_sync:function(){var n=this,t=n._viewColumnSettings;n._viewColumnSettings=[];n.sync();n._viewColumnSettings=t},combinedFilter:function(){return this._combinedFilter(this.get_filter())},dataSignature:function(){var n=this.combinedFilter();return ot(n)},_combinedFilter:function(n){var r=this,i;return t&&r.asearch("active")&&(i=r.asearch("filter"),i&&i.length&&($(n).each(function(){if(this.startsWith("_quickfind_"))return n.splice(n.indexOf(this),1),!1}),n=(n||[]).concat(i))),n},_createParams:function(i){var u=this,o=u.get_lookupContext(),a=u.get_viewType(),y=u.extension(),w=u._lookupInfo,v,h=p(u._dataViewFieldOwnerId),c;if(r(a)&&(a=u.readContext("GridType")),u.get_searchOnStart()&&w&&w.value!=null&&u.set_searchOnStart(!1),h&&(c=h.findField(u._dataViewFieldName),c&&c.ContextFields)){var l=u.get_externalFilter(),b={},d=h.values();$(l).each(function(){var n=this;b[n.Name]=n});$(h.get_contextFilter(c,d)).each(function(){var n=this,t=n.Value==null,i=b[n.Name];i?t?l.splice(l.indexOf(i)):i.Value=n.Value:t||l.push(n);t&&u.removeFromFilter(n.Name)});u.applyExternalFilter(!0)}var k=u.get_confirmContext(),s=u._api,f={PageIndex:u.get_pageIndex(),PageSize:u.get_pageSize(),PageOffset:u.get_pageOffset(),SortExpression:u.get_sortExpression(),GroupExpression:u.get_groupExpression(),Filter:u._combinedFilter(u.get_filter()),ContextKey:u.get_id(),FilterIsExternal:u._externalFilter.length>0,LookupContextFieldName:o?o.FieldName:null,LookupContextController:o?o.Controller:null,LookupContextView:o?o.View:null,LookupContext:o,Inserting:u.inserting(),LastCommandName:u.get_lastCommandName(),LastCommandArgument:u.get_lastCommandArgument(),ExternalFilter:u.get_externalFilter(),DoesNotRequireData:u.get_searchOnStart(),LastView:u.get_lastViewId(),Tag:u.get_tag(),RequiresFirstLetters:u.get_showFirstLetters(),ViewType:a,SupportsCaching:e.agent!=e.InternetExplorer||e.version>7||n.host!=null||n.embedded,SystemFilter:y?y.systemFilter():null,RequiresRowCount:u._requiresRowCount==!0,QuickFindHint:t?u.viewProp("quickFindHint"):null,RequiresPivot:u._requiresPivot==!0,PivotDefinitions:u._pivotDefinitions?u._pivotDefinitions:null};return s&&(u._distinctValues&&(f.Distinct=!0),f.SupportsCaching=!1,s.DoesNotRequireData&&(f.DoesNotRequireData=!0),f.MetadataFilter=s.metadataFilter,f.FieldFilter=s.fieldFilter,s.requiresAggregates==!1&&(f.DoesNotRequireAggregates=!0),s.inserting&&(f.Inserting=!0)),u.tagged("inline-editing")&&(f.DoesNotRequireAggregates=!0),k&&(v=Array.clone(f.ExternalFilter),Array.addRange(v,k.Values),f.ExternalFilter=v),u._useSearchParams(f),u._position&&(u._position.changing&&(f.PageIndex=u._position.index,f.PageSize=1,f.Filter=u._position.filter,f.SortExpression=u._position.sortExpression,f.RequiresMetaData=!0),i&&(f.Filter=u._selectedKeyFilter)),f.SyncKey=u._syncKey,u.useCase("$app")&&(f.RequiresMetaData=!0),f},_createArguments:function(n,t,i){var r,u,f;if(i||(i=this._collectFieldValues()),t||(t=this.get_viewId()),n.values&&(i=Array.clone(n.values)),this._paramValues&&(i=Array.clone(i),Array.addRange(i,this._paramValues),delete this._paramVlaues),r={CommandName:n.commandName,CommandArgument:n.commandArgument,Path:n.path,LastCommandName:this.get_lastCommandName(),Values:i,ContextKey:this.get_id(),Controller:this.get_controller(),View:t,LastView:this.get_lastViewId(),Tag:this.get_tag(),Trigger:n.trigger},r.Filter=this._combinedFilter(this.get_filter()),r.SortExpression=this.get_sortExpression(),r.GroupExpression=this.get_groupExpression(),r.SelectedValues=this.get_selectedValues(),r.ExternalFilter=Array.clone(this.get_externalFilter()),n.commandName==="PopulateDynamicLookups")for(u=0;u<this._allFields.length;u++)f=this.get_contextFilter(this._allFields[u],i),f.length>0&&Array.addRange(r.ExternalFilter,f);return r.SaveLEVs=this._allowLEVs==!0,r},_loadPage:function(){var n=this,t=n._survey,f=n._skipInvoke,i,r,u;(n._isBusy&&n._cancelWSRequest(),n._delayedLoading=!1,n._source)||(n.get_mode()!=Web.DataViewMode.View?(n._allFields=[{Index:0,Label:"",DataFormatString:"",AliasIndex:0,ItemsDataController:n.get_controller(),ItemsNewDataView:n.get_newViewId(),ItemsDataView:n.get_viewId(),_dataView:n,Behaviors:[],format:_field_format,isReadOnly:_field_isReadOnly,isNumber:_field_isNumber,lov:_field_lov}],n._fields=n._allFields,n._render()):(f||(n._busy(!0),n._detachBehaviors(),n._showWait()),i=n._createParams(),f?n._invokeArgs=i:(n._restoreViewVitals(i),r={controller:n.get_controller(),view:n.get_viewId(),request:i},u=new it(n),u.before({commandName:"Select",commandArgument:r.view}),u.dispose(),t&&t.result?(n._onGetPageComplete(t.result,null),t.result=null):n._startPage?(n._onGetPageComplete(n._startPage,null),n._startPage=null):n._invoke("GetPage",r,Function.createDelegate(n,n._onGetPageComplete)))))},_cancelWSRequest:function(){var n=this._wsRequest;n&&(this._wsRequest=null,n.get_executor&&!n.completed()&&(!e.agent==e.InternetExplorer||e.version>9)&&n.get_executor().abort())},_invoke:function(i,r,u,f,e){function y(){n.logout(function(){n.alert(Web.MembershipResources.Bar.UserIdle,function(){location.reload()})})}function a(t,l,v){if(!n._navigated){var p=t.get_statusCode();p?p===401&&i!=="Login"?h&&h.refresh_token?n.refreshUserToken(h,function(){o._invoke(i,r,u,f,e)},y):y():p>0&&(o._onMethodFailed(t,l,v),e&&e()):n.confirm(s.ConnectionLost,function(){o._wsRequest=Sys.Net.WebServiceProxy.invoke(c,i,!1,r,u,a,f)},function(){o._onMethodFailed(t,l,v)})}}var o=this,c=o.get_servicePath(),l=n.ensureJSONCompatibility,h=n.AccountManager.current(),v={};h&&h.access_token&&i!=="Login"&&(v.Authorization="Bearer "+h.access_token);o._autoRefresh(!0);r.args&&l(r.args.Values);r.request&&r.request.Filter&&l(r.request.Filter);r.request&&r.request.ExternalFilter&&l(r.request.ExternalFilter);c.match(/\.asmx/)?o._wsRequest=Sys.Net.WebServiceProxy.invoke(c,i,!1,r,function(n,t,i){n&&n.ExceptionType?o._onMethodFailed({get_timedOut:function(){return!1},get_exceptionType:function(){return n.ExceptionType},get_message:function(){return n.Message},get_stackTrace:function(){return n.StackTrace},get_statusCode:function(){return"HSR"}},null,f):u(n,t,i)},a,f):n.odp.invoke(o,{url:c+"/"+i,method:"POST",cache:!1,dataType:"text",headers:v,data:r}).done(function(r){var s=typeof r=="string",h,e;t&&i==="GetPage"&&s&&(o.tagged("system-replacegetpagetemplate")?(h=o.get_parentDataView(o),h.session("getPageTemplate",r)):o.session("getPageTemplate")||o.session("getPageTemplate",r));e=s?n.parseJSON(r):r;e&&e.RedirectUrl?location.href=e.RedirectUrl:e&&e.ExceptionType?o._onMethodFailed({get_timedOut:function(){return!1},get_exceptionType:function(){return e.ExceptionType},get_message:function(){return e.Message},get_stackTrace:function(){return e.StackTrace},get_statusCode:function(){return"HSR"}},null,f):u(e,f)}).fail(function(n,t,r){a({get_statusCode:function(){return n.status},get_timedOut:function(){return!1},get_exceptionType:function(){return t},get_message:function(){return r.message},get_stackTrace:function(){return r.stack}},n,i)})},_disposeFields:function(){var n,t;if(this._allFields)for(n=0;n<this._allFields.length;n++)t=this._allFields[n],t._dataView=null,t._listOfValues&&Array.clear(t._listOfValues)},_formatViewText:function(n,t,i){var u=this._views.length>0?this._views[0].Label:this._view?this._view.Label:"";return r(n)?i:String.format(n,t==!0?u.toLowerCase():u)},_autoRefresh:function(n){if(this._refreshInterval>0&&(this._riTimeout&&(clearTimeout(this._riTimeout),this._riTimeout=null),!n)){var t=this;this._riTimeout=setTimeout(function(){t.get_isForm()||t.sync()},this._refreshInterval*1e3)}},_clearCache:function(n){var t=this._cachedPages,r,f=$.Event("reset.dataview.app"),i,u;if(t){for(i=0;i<t.length;i++)u=t[i],Array.clear(u.rows),delete u.rows;Array.clear(t);delete this._cachedPages}r=this.extension();r&&r.reset(n==null||n==!0);f.dataView=this;$(document).trigger(f)},_supportsCaching:function(n){return n=="DataSheet"||n=="Grid"&&t},_cacheResult:function(n){var s=n.PageSize,o=n.PageSize<n.Rows.length,l=this.get_viewType(),t,p,e,i,f,v,r,u,y;if(o||l||(l=this.readContext("GridType")),o||(o=this._supportsCaching(l)),!o&&!l&&n.Views)for(t=0;t<n.Views.length;t++)if(p=n.Views[t],p.Id==n.View){o=this._supportsCaching(p.Type);break}if(o&&n.SupportsCaching){e=n.Rows;n.Rows=[];i=this._cachedPages;i||(i=this._cachedPages=[]);var a=n.PageIndex,h=0,c=s-1;for(a>0&&(e.length<=s*2?(h=s,c=e.length-1):(h+=s,c+=s)),f={index:a,rows:[]},t=h;t<=c;t++)v=e[t],v&&(n.Rows.push(v.slice(0)),f.rows.push(v));if(r=null,h>0)for(r={index:a-1,rows:[]},t=0;t<h;t++)r.rows.push(e[t]);if(u=null,c<e.length-1)for(u={index:a+1,rows:[]},t=c+1;t<e.length;t++)u.rows.push(e[t]);for(t=0;t<i.length;)y=i[t],f!=null&&y.index==f.index?(i[t]=f,f=null):r!=null&&y.index==r.index?(i[t]=r,r=null):u!=null&&y.index==u.index?(i[t]=u,u=null):t++;(f||r||u)&&(i.length>100&&i.splice(0,3),f&&i.push(f),r&&i.push(r),u&&i.push(u))}},_onGetPageComplete:function(i){var e=this,hi=i.NewRow,d=hi,a=i.Fields||[],o,at,eu,vt,pt,cu,ci,f,kt,li,dt,gt,lu,ai,tt,or,au,vu,sr,ui,hr,cr,ft,l,yu,vi,lr,c,ar,yi,pu,vr,pi,ot,yr,wi,bi,pr,ki,v,ht,wr,h,fi,nr,p,ut,b,w,br,kr,ir,dr,gr,nu,rr,tu,et,iu,ru,uu,ei,ur,fr,ku,du,fu;if(e._syncKey&&(e._syncKey=null),e._busy(!1),e._completeCallback){eu=e._completeCallback;e._completeCallback=null;eu.call(this,i);e._completeConfig=null;return}if(ri(i,di,[]),Sys.Services&&Sys.Services.AuthenticationService&&Sys.Services.AuthenticationService.get_isLoggedIn&&Sys.Services.AuthenticationService.get_isLoggedIn()&&!i.IsAuthenticated){location.replace(n.unanchor(location.href));return}if(e._fields||(e._viewId=i.View),e._containerIsHidden&&(Sys.UI.DomElement.setVisible(e._container,!0),e._containerIsHidden=!1),e.set_tag(i.Tag),i.FirstLetters!=""&&(e._firstLetters=i.FirstLetters?i.FirstLetters.split(/,/):null),vt=e._position&&e._position.changed,e._cacheResult(i),e._pageIndex<0||vt){if(this._pageIndex==-1||vt){if(it.reset(e._controller),e._disposeFields(),at=e._expressions=i.Expressions,e._detachBehaviors(),e._allFields=a,e._mapOfAllFields={},e._fields=[],pt=[],e._keyFields&&this._selectedKey.length>0){for(o=0;o<e._keyFields.length;o++)pt[o]={name:this._keyFields[o].Name,value:e._selectedKey[o]};e._selectedKey=[]}e._keyFields=[];var ou=!1,wt=!1,su=[],hu=0,er;if($(i.Views).each(function(){var n=this;i.View==n.Id&&(n.HeaderText=i.ViewHeaderText,e.tagged("view-type-inline-editor")?(n.Type="Form",n.HeaderText=null,e._inlineEditor=!0,e.tag("modal-fit-content")):n.Layout=i.ViewLayout,er=n.Type);n.ShowInSelector==null&&(n.ShowInSelector=!0)}),e._views=i.Views,er=="Form"){for(o=0;o<a.length;o++)if(a[o].IsPrimaryKey){cu=!0;break}cu||a.push({Name:"sys_pk_",ReadOnly:!0,Type:"Int32",IsPrimaryKey:!0,Hidden:!0})}for(o=0,$(a).each(function(){var n=this;e._mapOfAllFields[n.Name]=n;n.OriginalIndex=n.Index=o++;ii(n);n.Name=="Status"&&(ou=!0)}),ou||(e._mapOfAllFields.Status=a[a.length]={Name:"Status",ReadOnly:!0,Type:"String",AllowNulls:!0,Hidden:!0,Index:a.length,_system:!0}),ci=n._commandLine.match(/\W_display=(.+?)(&|$)/),o=0;o<a.length;o++){if(f=a[o],kt=f.Index,dt=f.Name,li=f.DataViewFilterSource,f.tagged=_field_tagged,f.is=_field_is,f.tag=_field_tag,gt=r(f.AliasName)?null:this.findField(f.AliasName),f.AliasIndex=gt?gt.Index:o,gt&&(gt.OriginalIndex=kt),f.ItemsDataController&&!f.ItemsTargetController&&(f.AliasName||f._autoAlias||f.ItemsDataValueField==f.ItemsDataTextField||er!="Form"||(f._autoAlias=!0),f._autoAlias&&(tt={Name:dt+"_auto_alias_",ReadOnly:!0,Type:"String",Index:a.length,Label:f.Label,AllowNulls:!0,Items:[],htmlEncode:!0,Hidden:!0},ii(tt),tt.AliasIndex=tt.Index,f.AliasIndex=tt.Index,a.push(tt),e._mapOfAllFields[tt.Name]=tt,f.Items&&d&&(or=d[kt],or&&$(f.Items).each(function(n,t){t[0]==or&&(d[tt.Index]=t[1])})))),(!f.Hidden||ci)&&this._fieldIsInExternalFilter(f)&&this.get_hideExternalFilterFields()){if(au=f.Hidden,f.Hidden=!0,f.Copy)while(lu=n._fieldMapRegex.exec(f.Copy))ai=this.findField(lu[1]),ai&&ai.ReadOnly&&(ai.Hidden=!0);ci&&Array.indexOfCaseInsensitive(ci[1].split(","),dt)!=-1&&(au||(f.Hidden=!1),this.inserting()&&(vu=new RegExp(String.format("\\W{0}=(.*?)(&|$)",dt)),sr=n._commandLine.match(vu),sr&&(d||(d=[]),d[o]=decodeURIComponent(sr[1]))))}li&&f.Type=="DataView"&&(hr=i.View,cr="!$row."+li+"._ready||$row."+li+"._selected",at||(at=this._expressions=[]),$(at).each(function(){var n=this;return n.Scope==3&&n.Target==f.Name&&n.ViewId==hr&&(ui=n),!!ui}),ui?ui.Test=cr+"&&("+ui.Test+")":at.push({Type:1,Scope:3,Target:dt,ViewId:hr,Test:cr}));f.Behaviors=[];ft=f.is("persist");ft&&(f._persist=ft,kt!=f.AliasIndex&&(a[f.AliasIndex]._persist=ft))}if(n.newValues&&(this._ditto||(this._ditto=[]),this._ditto=this._ditto.concat(n.newValues),n.newValues=null),d&&this._ditto)for(o=0;o<a.length;o++)if(f=a[o],d[o]!=null)for(l=0;l<this._ditto.length;l++)if(this._ditto[l].name==f.Name&&!this._ditto[l].duplicated){Array.removeAt(this._ditto,l);break}for(this._ignoreNewRow=!0,this._hasDynamicLookups=!1,this._requiresConfiguration=!1,yu=0,o=0;o<a.length;o++){if(f=a[o],f._dataView=this,f.Hidden||Array.add(this._fields,f),f.IsPrimaryKey)for(Array.add(this._keyFields,f),l=0;l<pt.length;l++)if(pt[l].name==f.Name){Array.add(this._selectedKey,pt[l].value);break}f.FilterType="Number";switch(f.Type){case"Time":case"String":f.FilterType="Text";break;case"Date":case"DateTime":case"DateTimeOffset":f.FilterType="Date";break;case"Boolean":f.FilterType="Boolean"}if(f.OnDemand&&(vi=f.Name,lr=e.findField(vi+"Length")||e.findField(vi+"LENGTH")||e.findField(vi+"length")||e.findField("Length")||e.findField("LENGTH")||e.findField("length"),lr&&(lr._smartSize=!0),f.OnDemandStyle!=0||this.inserting()||(e._headerImageField||(e._headerImageField=f),f.tagged("header-image")&&(e._headerImageField=f))),c=f.SearchOptions,c&&(c=c.replace(/\$quickfind(\w+)?\s*/gi,"")),y(c)||__tf!=4)f.SearchOptions=null;else{for(c=c.replace(/\s+/g,",").split(/,/),f.AllowAutoComplete=!Array.contains(c,"$disableautocomplete"),f.AllowAutoComplete||Array.remove(c,"$disableautocomplete"),f.AllowSamples=!Array.contains(c,"$disablesamples"),f.AllowSamples||Array.remove(c,"$disablesamples"),f.AllowMultipleValues=!Array.contains(c,"$disablemultiplevalues"),f.AllowMultipleValues||Array.remove(c,"$disablemultiplevalues"),f.AutoCompleteAnywhere=Array.contains(c,"$autocompleteanywhere"),f.AutoCompleteAnywhere&&(Array.remove(c,"$autocompleteanywhere"),a[f.AliasIndex].AutoCompleteAnywhere=!0),l=0,ar=!1;l<c.length;)yi=c[l]=c[l].trim(),yi=="*"&&(ar=!0),yi.length>0&&yi!="*"?l++:Array.removeAt(c,l);ar&&c.length>0&&(pu=st[f.FilterType],this._enumerateMissingSearchOptions(c,pu.List));Array.contains(c,"$in")&&!Array.contains(c,"$notin")&&Array.add(c,"$notin");f.SearchOptions=c.length==0?null:c;f.SearchOptions&&t&&f.OriginalIndex!=f.Index&&(a[f.OriginalIndex].SearchOptions=f.SearchOptions)}f.format=_field_format;f.isReadOnly=_field_isReadOnly;f.isNumber=_field_isNumber;f.lov=_field_lov;f.text=_field_text;f.trim=_field_trim;f.htmlEncode=_field_htmlEncode;_field_prepareDataFormatString(this,f);var nt=f.ItemsStyle,rt=f.Items,wu=f.ItemsDataController;f.Type=="Boolean"&&(rt.length==0?(rt=f.Items=Array.clone(f.AllowNulls?s.BooleanOptionalDefaultItems:s.BooleanDefaultItems),nt||(nt=f.ItemsStyle=s.BooleanDefaultStyle)):$(rt).each(function(){var n=this[0];typeof n=="string"&&(this[0]=n.length?n==="true":null)}));rt&&rt.length>0&&(f.AllowNulls&&!f.ItemsTargetController||nt=="DropDownList"&&!wu)&&!r(rt[0][0])&&nt!="CheckBoxList"&&!f.tagged("lookup-null-value-none")&&si(f,rt);nt&&(f.ContextFields&&nt!="Lookup"&&nt!="AutoComplete"&&wu?(this._hasDynamicLookups=!0,f.ItemsAreDynamic=!0):nt=="UserNameLookup"?(f.ItemsStyle="Lookup",f.ItemsDataController="aspnet_Membership",f.ItemsDataTextField="UserUserName",f.ItemsDataValueField="UserUserName",f.ItemsValueSyncDisabled=!0,oi()?f.ItemsNewDataView="createForm1":(f.ItemsDataView="lookup",f.ItemsDataTextField="UserName",f.ItemsDataValueField="UserName",f.Tag="lookup-details-hidden")):nt=="UserIdLookup"&&(f.ItemsStyle="Lookup",f.ItemsDataController="aspnet_Membership",f.ItemsDataTextField="UserUserName",f.ItemsDataValueField="UserId",oi()?f.ItemsNewDataView="createForm1":(f.ItemsDataView="lookup",f.ItemsDataTextField="UserName",f.Tag="lookup-details-hidden")),e._inlineEditor&&t.pointer("mouse")&&(nt=="RadioButtonList"||nt=="ListBox")&&(f.OriginalItemsStyle=nt,f.ItemsStyle="DropDownList"));r(f.ToolTip)||(f.ToolTip=n.htmlAttributeEncode(f.ToolTip));f.Watermark||f.AllowNulls||rt&&rt.length||(f.Watermark=g.Required);r(f.Configuration)||(this._requiresConfiguration=!0);f.AllowLEV&&(this._allowLEVs=!0);f.TextMode==2&&r(f.Editor)&&(t||(Sys.Extended.UI.HtmlEditorExtenderBehavior||typeof CKEDITOR!="undefined"?f.ClientEditor="Web$DataView$RichText":f.Editor="RichEditor"),f.HtmlEncode=!1);f.Editor&&(this._executeClientEditorFactories(f)?(f.ClientEditor=f.Editor,f.Editor=null):f.EditorId=String.format("{0}_Item{1}",this.get_id(),kt));f.ColIndex=f.Hidden?-1:yu++;vr=n.Geo;f.tagged("header-text")&&(e._headerField=f);f.tagged("modified-","created-")&&f.tagged("modified-latitude","modified-longitude","modified-coords","created-latitude","created-longitude","created-coords")&&(f._geocode=!0,pi=n.GeoQueue,bt=n.host?n.host.geolocation:navigator.geolocation,bt&&(pi||(pi=n.GeoQueue=[]),(!f.tagged("created-")||e.inserting())&&(e._geoCookie||(e._geoCookie=(new Date).getTime()),pi.push({dv:e._id,field:f.Name,cookie:e._geoCookie})),f.TextMode=4,yt==null&&(yt=bt.watchPosition(gi,function(n){vr.error=n;vr.acquired=!1}))));wt||(f.tagged("map-")&&!f.tagged("map-none")?wt=!0:(ot=f.Name.match(/\b(address|city|state|region|postal(.*?)code|zip(.*?)code|zip|country)\b/i),ot&&!f.tagged("map-none")&&(ot=ot[1].toLowerCase(),su.push({field:f,tag:ot}),ot.match(/address|city/)&&hu++)))}for(e._fields.length||(e._fields.push(a[0]),a[0].Hidden=!1),this.untag("supports-view-style-map"),wt||hu!=2||(wt=!0,$(su).each(function(){this.field.tag("map-"+this.tag);this.tag=="address"&&this.field.tag("action-location")})),wt&&this.tag("supports-view-style-map"),i.LEVs&&this._recordLEVs(i.LEVs),yr=e.get_view().Tags,yr&&e.tag(yr),e.tagged("header-image-none")&&(e._headerImageField=null),wi=e.tagged(/\bpersist\-(session|user)-(\w+)\b/),e._persist=wi?{scope:wi[1],command:wi[2]}:null,e._view=null,this._lastViewId||this.get_isForm()||(this._lastViewId=i.View),e._actionGroups=i.ActionGroups?i.ActionGroups:[],e._statusBar=i.StatusBar,bi=/^(true|false)\:(.+)$/,pr=0,e._actionColumn=null,ki=e._dynamicActions={},o=0;o<this._actionGroups.length;o++)for(v=this._actionGroups[o],v.maxTextLength=0,v.groupText=[],ht=ni[v.Scope],ht&&ht._Self&&(wr=ht._Self[v.HeaderText],wr&&(v.HeaderText=wr.HeaderText)),v.Scope=="ActionColumn"&&(this._actionColumn=r(v.HeaderText)?k.ActionColumnHeaderText:v.HeaderText),v.Id||(v.Id="auto"+pr++),v.CssClassEx=String.format("Actions-g-{0} ",v.Id),l=0;l<v.Actions.length;l++)h=v.Actions[l],fi=h.CommandName||"",h.Id||(h.Id="auto"+pr++),h.CausesValidation==null&&(h.CausesValidation=!0),h.Path=String.format("{0}/{1}",v.Id,h.Id),nr=h.Confirmation,fi==="Search"&&(this._hasSearchAction=h.Path,this._hasSearchShortcut=nr&&nr.match(/_shortcut\s*=\s*true/)),h.CssClassEx=String.format("Actions-g-{0}-a-{1} ",v.Id,h.Id),ht&&r(h.HeaderText)&&(p=ht[fi],p?(p.CommandArgument&&(ut=p.CommandArgument[h.CommandArgument],ut&&(p=ut)),p.WhenLastCommandName&&(ut=p.WhenLastCommandName[h.WhenLastCommandName],ut&&(p=ut)),p.Controller&&(ut=p.Controller[this._controller],ut&&(p=ut)),fi=="Confirm"&&e._confirmContext&&e._confirmContext.action.CommandName=="Search"?(h.HeaderText=ti,h.Key="Enter"):h.HeaderText=p.HeaderText,h._autoHeaderText=!0,!r(p.HeaderText)&&p.HeaderText.indexOf("{")>=0&&(h.HeaderText=p.VarMaxLen!=null&&i.Views[0].Label.length>p.VarMaxLen?p.HeaderText2:this._formatViewText(p.HeaderText)),r(h.Description)&&(h.Description=this._formatViewText(p.Description)),r(nr)&&(h.Confirmation=p.Confirmation),h.Notify||(h.Notify=p.Notify)):h.HeaderText=fi),r(h.WhenView)?h.WhenViewRegex=null:(b=bi.exec(h.WhenView),h.WhenViewRegex=new RegExp(b?b[2]:h.WhenView),h.WhenViewRegexResult=b?b[1]!="false":!0),r(h.WhenTag)?h.WhenTagRegex=null:(b=bi.exec(h.WhenTag),h.WhenTagRegex=new RegExp(b?b[2]:h.WhenTag),h.WhenTagRegexResult=b?b[1]!="false":!0),r(h.WhenHRef)?h.WhenHRefRegex=null:(b=bi.exec(h.WhenHRef),h.WhenHRefRegex=new RegExp(b?b[2]:h.WhenHRef),h.WhenHRefRegexResult=b?b[1]!="false":!0),h.HeaderText&&(v.maxTextLength=Math.max(h.HeaderText.length,v.maxTextLength),v.groupText.push(h.HeaderText)),h.WhenClientScript&&(ki[v.Scope]=1,ki[v.Id]=1,ki[h.Path]=1);var tr=1,bu=!1,ct=this._categories=i.Categories;for(this._tabs=[],o=0;o<ct.length;o++)if(w=ct[o],w.Index=o,w.Tab==null&&(w.Tab=""),r(w.Tab)||Array.contains(this._tabs,w.Tab)||Array.add(this._tabs,w.Tab),w.Flow=="NewColumn"&&(o>0&&tr++,bu=!0),w.ColumnIndex=tr-1,w.Id&&(br=$get(String.format("{0}_{1}_{2}",i.Controller,i.View,w.Id)),br&&(w.Template=br.innerHTML)),w.Floating&&r(w.Template)){for(kr=new Sys.StringBuilder('<div class="FloatingCategoryHeader"><\/div>'),l=0;l<this._allFields.length;l++)ir=this._allFields[l],ir.Hidden||o!=ir.CategoryIndex||kr.appendFormat('<div class="FieldPlaceholder">{{{0}}}<\/div>',ir.Name);w.Template=kr.toString()}if(this._tabs.length>0){for(o=0;o<ct.length;o++)w=ct[o],r(w.Tab)&&(r(ct[0].Tab)?(w.Tab=u.Form.GeneralTabText,this._tabs[0]!=u.Form.GeneralTabText&&Array.insert(this._tabs,0,u.Form.GeneralTabText)):w.Tab=ct[0].Tab),w.ColumnIndex=0;this._lastSelectedCategoryTabIndex!=null?(dr=this._focusedFieldName,this.set_categoryTabIndex(!(this._lastSelectedCategoryTabIndex>=0)||dr&&dr.startsWith("_Annotation_")?this._tabs.length-1:0),delete this._lastSelectedCategoryTabIndex):this.set_categoryTabIndex(0);gr=this.get_parentDataView(this);gr._lastClickedIcon=="Attachment"&&this.set_categoryTabIndex(this._tabs.length-1);gr._lastClickedIcon=null;tr=1}else this.set_categoryTabIndex(-1);this._numberOfColumns=bu&&!this._get_template()?tr:0}this._filter=i.Filter;this._sortExpression=i.SortExpression;this._groupExpression=i.GroupExpression;this._updatePageCount(i,vt);nu=this.get_pagerButtonCount(!0);this._firstPageButtonIndex=Math.floor(i.PageIndex/nu)*nu;n.odp&&n.odp.verify(e)}else this._requiresRowCount&&(this._requiresRowCount=!1,this._updatePageCount(i,!1));for(o=0;o<a.length;o++)f=a[o],rr=a[f.AliasIndex],f.AllowAutoComplete==!1&&(rr.AllowAutoComplete=!1),f.AllowSamples==!1&&(rr.AllowSamples=!1),f.AllowMultipleValues==!1&&(rr.AllowMultipleValues=!1);if(e._icons=i.Icons,!e.inserting()){if(tu=!1,e._rows){for((e._rows.length==0||i.Rows.length==0)&&delete e._viewColumnSettings,o=0;o<e._rows.length;o++)Array.clear(e._rows[o]);Array.clear(e._rows);tu=e.get_isGrid()}if(e._rows=i.Rows,tu)for(e._selectedRowIndex=null,o=0;o<e._rows.length;o++)if(e._rowIsSelected(o)){e._selectedRowIndex=o;break}}if(e._newRow=d=d?d:[],i.Aggregates&&(e._aggregates=i.Aggregates),e.get_isForm()&&e._selectedRowIndex==null&&e._totalRowCount>0&&(e._selectedRowIndex=0,e._selectKeyByRowIndex(0)),vt&&(e._position.changed=!0,e._selectKeyByRowIndex(0)),t){if(ru=e._allFields,uu=e._persist,e.inserting()?et=d:e.editing()&&(et=e._rows[0]),et)for(o=0;o<ru.length;o++)f=ru[o],ft=f._persist,ft&&et[o]==null&&(iu||(iu=(ft==="user"?n.userVar:n.sessionVar)("persistVars")||{}),ur=et[o]=iu[f.Name],ur!=null&&(e._showClearAll=!0));uu&&(ei=(uu.scope==="user"?n.userVar:n.sessionVar)("persist_"+e._controller+"_"+e._viewId),ei&&(ei=lt.deserialize(ei),$(ei).each(function(){var n=this,t=e.findField(n.Name);t&&n.Modified&&et[t.Index]==null&&(ur=et[t.Index]=n.NewValue,ur!=null&&(e._showClearAll=!0))})));e.get_isGrid()&&(fr=n.controllerSyncMap[e._controller],fr||(fr=n.controllerSyncMap[e._controller]={}),fr[e._id+"_"+e._viewId]=!1,e._autoSelect())}hi&&e.odp&&e.set_selectedKey(e.odp.key(e));e._render(!0);t||(e.get_lookupField()&&e._adjustLookupSize(),e._isInInstantDetailsMode()&&(ku=$common.getClientBounds(),du=$common.getContentSize(document.body),resizeBy(0,du.height-ku.height)),e._saveViewVitals(),e._pendingSelectedEvent&&(e._pendingSelectedEvent=!1,e.updateSummary()),e._registerFieldHeaderItems(),_body_resize());e._executeSecondCommand();e._autoRefresh();t||e._autoSelect();r(i.ClientScript)||eval(i.ClientScript);fu=new it(e);fu.after({commandName:hi?"New":"Select",commandArgument:i.View,view:i.View});fu.dispose();hi&&e.odp&&e.raiseSelected()},_updatePageCount:function(n,t){this._totalRowCount=n.TotalRowCount;this._position&&this._position.count==-1&&(this._position.count=n.TotalRowCount);this._pageIndex=n.PageIndex;t||(this._pageSize=n.PageSize,this._pageCount=Math.floor(n.TotalRowCount/n.PageSize),n.TotalRowCount%n.PageSize!=0&&this._pageCount++)},_autoSelect:function(n){var i=null,o=null,s,c=!1,u,f,e,h;if(this.get_autoHighlightFirstRow()&&(this.set_autoHighlightFirstRow(!1),i="Select",s="highlight"),this.get_autoSelectFirstRow()&&(this.set_autoSelectFirstRow(!1),s="select",u=this.get_actionGroups("Grid"),u.length>0))for(f=0;f<u[0].Actions.length;f++)if(e=u[0].Actions[f],e.CommandName){i=e.CommandName;o=e.CommandArgument;c=!r(o)&!this.get_showModalForms()&&n==null;break}i&&this.get_viewType()!="Form"&&this._rows.length>0&&(c&&this._hideContainer(),h=this.extension(),h?h._autoSelect={row:this._rows[n||0],action:s}:this.executeRowCommand(n||0,i,o));(!this._tryFocusDataSheet||this._forceFocusDataSheet)&&(this._tryFocusDataSheet=!0,this.get_isDataSheet()&&!this.get_lookupField()&(!this.get_filterSource()||this._forceFocusDataSheet)&&this._rows.length>0&&!t&&this.executeRowCommand(this.get_selectedKey().length>0?null:0,"Select"),this._forceFocusDataSheet=!1)},_hideContainer:function(){this._containerIsHidden=!0;this._container.style.display="none"},_enumerateMissingSearchOptions:function(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i&&!i.Hidden&&(i.List?this._enumerateExpressions(n,t):Array.contains(n,i.Function)||Array.add(n,i.Function))},_executeSecondCommand:function(t){var i,r;t?(i=n._commandLine.match(/_commandName2=(\w+)(.*?_commandArgument2=(.*?)(&|$))?/),i&&this.executeActionInScope([this.get_viewType(),"ActionBar"],i[1],i[3])):this._trySecondCommand&&(this._trySecondCommand=!1,(this.get_viewType()!="Form"||this._totalRowCount>0)&&(r=this,setTimeout(function(){r._executeSecondCommand(!0)},50)))},_skipNextInputListenerClickEvent:function(){(e.agent!=e.InternetExplorer||e.version>=9)&&(this._skipClickEvent=!0)},_gridViewCellFocus:function(n,t){try{var r=new Sys.UI.DomEvent(n),i=r.target;if((i.tagName==="A"||i.parentNode.tagName==="A")&&!this.get_lookupField()||Sys.UI.DomElement.containsCssClass(i,"RowSelector")||i.tagName==="SPAN"&&i.className==="ObjectRef")return!1;this.get_lookupField()&&(r.stopPropagation(),r.preventDefault());this._skipNextInputListenerClickEvent()}catch(u){}return this.executeRowCommand(t,"Select"),!0},_dataSheetCellFocus:function(n,t,i){var r=this._get_focusedCell(),u=this.inserting(),f;if(u&&t!=-1&&(t=-1),i==-1&&(i=r!=null?r.colIndex:0),this.editing()&&r){this._focusCell(-1,-1,!1);this._focusCell(t,i);f=t==r.rowIndex||u&&t==-1;(f||this._updateFocusedRow(r))&&this._updateFocusedCell(r)?f&&t!=this._selectedRowIndex&&!u&&this.cancelDataSheetEdit():(this._focusCell(t,i,!1),this._focusCell(r.rowIndex,r.colIndex));this._skipNextInputListenerClickEvent();return}if(n){if(!this._gridViewCellFocus(n,t,i))return}else this._skipNextInputListenerClickEvent();r==null||r.rowIndex!=t||r.colIndex!=i||this.editing()||this.get_lookupField()?this._startInputListenerOnCell(t,i):(document.selection&&document.selection.clear(),this._skipEditOnClick!=!0&&this._allowEdit()&&this.editDataSheetRow(r.rowIndex));this._skipEditOnClick=!1},_startInputListenerOnCell:function(t,i){if(this._startInputListener(),this._focusCell(-1,-1,!1),this._focusCell(t,i),!this.get_lookupField()){if(n._activeDataSheetId!=this.get_id()){var r=$find(n._activeDataSheetId);r&&r.cancelDataSheet();n._activeDataSheetId=this.get_id()}this._lostFocus=!1}},_startInputListener:function(){this._stopInputListener();this._inputListenerKeyDownHandler||(this._inputListenerKeyDownHandler=Function.createDelegate(this,this._inputListenerKeyDown),this._inputListenerKeyPressHandler=Function.createDelegate(this,this._inputListenerKeyPress),this._inputListenerClickHandler=Function.createDelegate(this,this._inputListenerClick),this._inputListenerDblClickHandler=Function.createDelegate(this,this._inputListenerDblClick),this._focusedCell=null);$addHandler(document,"keydown",this._inputListenerKeyDownHandler);$addHandler(document,"keypress",this._inputListenerKeyPressHandler);$addHandler(document,"click",this._inputListenerClickHandler);$addHandler(document,"dblclick",this._inputListenerDblClickHandler);this._trackingInput=!0},_stopInputListener:function(){this._trackingInput&&($removeHandler(document,"keydown",this._inputListenerKeyDownHandler),$removeHandler(document,"keypress",this._inputListenerKeyPressHandler),$removeHandler(document,"click",this._inputListenerClickHandler),$removeHandler(document,"dblclick",this._inputListenerDblClickHandler),this._lostFocus=!0,this._trackingInput=!1)},_allowEdit:function(){return this._findActionsByCommandName("Edit").length>0},_allowNew:function(){return this._findActionsByCommandName("New").length>0},get_interactiveActionGroups:function(){var n=this.get_actionGroups("Grid");return Array.addRange(n,this.get_actionGroups("ActionBar")),Array.addRange(n,this.get_actionGroups("Form")),Array.addRange(n,this.get_actionGroups("ActionColumn")),n},_findActionsByCommandName:function(n){for(var t,r,u=[],f=this.get_interactiveActionGroups(),i=0;i<f.length;i++)for(actions=f[i].Actions,t=0;t<actions.length;t++)r=actions[t],r.CommandName==n&&Array.add(u,r);return u},isDynamicAction:function(n){return!!this._dynamicActions[n]},findAction:function(n){if(n){n=n.split(/\s*\\|\/\s*/g);for(var o=this,e=o._actionGroups,r,u,f,s=n[0],h=n[1],i,t=0;t<e.length;t++)if(r=e[t],r.Id==s)for(u=r.Actions,i=0;i<u.length;i++)if(f=u[i],f.Id==h)return f}return null},_inputListenerKeyPress:function(n){var t,i;if((!n.rawEvent||n.rawEvent.charCode!=0)&&!this._lostFocus){if(this.editing()){this._pendingChars&&(this._pendingChars+=String.fromCharCode(n.charCode));return}this._isBusy||(t=this._get_focusedCell(),t!=null)&&((i=this._fields[t.colIndex],i.ReadOnly)||this._allowEdit()&&(this.executeRowCommand(t.rowIndex,"Select"),i.isReadOnly()||(this._pendingChars=String.fromCharCode(n.charCode),this.editDataSheetRow(t.rowIndex))))}},cancelDataSheet:function(){this.get_isDataSheet()&&(this._focusCell(-1,-1,!1),this._stopInputListener(),this.set_ditto(null),n._activeDataSheetId=null,this.cancelDataSheetEdit(),this._lostFocus=!1,this._focusedCell=null)},_inputListenerKeyDown:function(n){var i,e,f,s;if(!this._lookupIsActive&&!this._lostFocus&&!l.HoverMonitor._instance.get_isOpen()){if(this._isBusy){if(this._pendingChars)return;n.preventDefault();n.stopPropagation();return}if(!this._isBusy&&(i=this._get_focusedCell(),i!=null)){var t={rowIndex:i.rowIndex,colIndex:i.colIndex},r=!1,o=!1,u=this.get_pageSize();this._rows.length<u&&(u=this._rows.length);switch(n.keyCode){case 83:case Sys.UI.Key.enter:if(n.keyCode==83&&!n.ctrlKey)return;if(this.editing()){if(e=n.target&&n.target.tagName,(e=="TEXTAREA"||e=="A")&&!n.ctrlKey)return;r=!0;this._updateFocusedRow(i);n.preventDefault();n.stopPropagation();return}n.ctrlKey&&!this.editing()||this.get_lookupField()?(r=!0,this.executeRowCommand(i.rowIndex,"Select")):n.shiftKey?t.rowIndex>0&&t.rowIndex--:this._moveFocusToNextRow(t,u)&&(r=!0);break;case Sys.UI.Key.down:if(this.editing()||n.ctrlKey)return;this._moveFocusToNextRow(t,u)&&(r=!0);break;case Sys.UI.Key.up:if(this.editing()||n.ctrlKey)return;t.rowIndex>0?t.rowIndex--:(this._pageOffset==0&&this.get_pageIndex()==0?(this._pageOffset=null,r=!0):this._pageOffset==null?this.get_pageIndex()>0&&(this._pageOffset=-1):this._pageOffset--,r=!0,this._pageOffset==-u?(this._pageOffset=null,this.get_pageIndex()>0&&this.goToPage(this.get_pageIndex()-1)):this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.tab:case Sys.UI.Key.right:case Sys.UI.Key.left:if(f=!0,(n.keyCode==Sys.UI.Key.right||n.keyCode==Sys.UI.Key.left)&&this.editing())return;if(!n.shiftKey&&n.target.parentNode.className=="Date")return;if(n.shiftKey&&n.target.id&&n.target.id.match(/\$Time\d+/))return;if(s=this._pageOffset,n.shiftKey||n.keyCode==Sys.UI.Key.left)if(t.colIndex>0){if(t.colIndex--,n.keyCode==Sys.UI.Key.tab)while(t.colIndex>0&&this._fields[t.colIndex].isReadOnly())t.colIndex--}else this.editing()&&(r=!0);else if(t.colIndex<this._fields.length-1){if(t.colIndex++,n.keyCode==Sys.UI.Key.tab)while(t.colIndex<this._fields.length-1&&this._fields[t.colIndex].isReadOnly())t.colIndex++}else{if(this.editing()){if(this._updateFocusedRow(i,n.keyCode==Sys.UI.Key.tab))f=!1;else{n.preventDefault();n.stopPropagation();return}r=!0}f&&this._moveFocusToNextRow(t,u)&&(r=!0);(t.rowIndex!=i.rowIndex||this._pageOffset!=s)&&(t.colIndex=0,r=!1)}f&&this.editing()&&(o=!0);break;case Sys.UI.Key.home:if(this.editing())return;n.ctrlKey?this.get_pageIndex()>0?(r=!0,this._pageOffset=0,this.goToPage(0),i.rowIndex=0,i.colIndex=0):(t.rowIndex=0,t.colIndex=0):t.colIndex=0;break;case Sys.UI.Key.end:if(this.editing())return;n.ctrlKey?(r=!0,i.colIndex=this._fields.length-1,i.rowIndex=this._totalRowCount%this.get_pageSize()-1,i.rowIndex<0&&(i.rowIndex=this.get_pageSize()),this._pageOffset=null,this.goToPage(this.get_pageCount()-1)):t.colIndex=this._fields.length-1;break;case Sys.UI.Key.pageUp:if(this.editing())return;r=!0;this.get_pageIndex()>0?this.goToPage(this.get_pageIndex()-1):this._pageOffset!=null&&(this._pageOffset=null,this.goToPage(this.get_pageIndex()));break;case Sys.UI.Key.pageDown:if(this.editing())return;r=!0;this.get_pageIndex()<this.get_pageCount()-1&&this.goToPage(this.get_pageIndex()+1);break;case Sys.UI.Key.esc:this.cancelDataSheetEdit()||this.cancelDataSheet();r=!0;break;case Sys.UI.Key.del:if(this.editing()||n.shiftKey||n.altKey)return;r=!0;n.ctrlKey?this.deleteDataSheetRow():(this._pendingChars="",this.editDataSheetRow(i.rowIndex));break;case 45:this.editing()||(r=!0,this._allowNew()&&this.newDataSheetRow());break;case 32:if(n.ctrlKey&&this.multiSelect()&&!this.inserting())r=!0,this.toggleSelectedRow(i.rowIndex);else return;break;case 113:if(this.editing())return;r=!0;this._allowEdit()&&this.editDataSheetRow(i.rowIndex)}i.rowIndex==t.rowIndex&&i.colIndex==t.colIndex||r||(this._focusCell(i.rowIndex,i.colIndex,!1),this._focusCell(t.rowIndex,t.colIndex,!0),r=!0);r&&(n.preventDefault(),n.stopPropagation());o&&(this._updateFocusedCell(i)||(this._focusCell(t.rowIndex,t.colIndex,!1),this._focusCell(i.rowIndex,i.colIndex,!0)))}}},_updateFocusedCell:function(n){var u=this._collectFieldValues(),e=this._validateFieldValues(u,!0,n),t=this._fields[n.colIndex],f,r,i;if(e)f=!0,t.Index<u.length&&u[t.Index].Modified&&(f=!this._performValueChanged(t.Index)),f&&this.refresh(!0);else if(t.Behaviors)for(r=0;r<t.Behaviors.length;r++)i=t.Behaviors[r],d(AjaxControlToolkit.CalendarBehavior,i)&&i.get_isOpen()&&(i.hide(),i.show());return e},_updateFocusedRow:function(t,i){return n.showMessage(),this._syncFocusedCell=this.inserting(),this._lastFocusedCell=t,this._skipSync=!0,this.executeRowCommand(t.rowIndex,this._syncFocusedCell?"Insert":"Update",null,!0),this._valid&&(this._saveAndNew=i),this._valid},_get_selectedDataRowIndex:function(n){return this.get_pageIndex()*this.get_pageSize()+this.get_pageOffset()+(n!=null?n:this._selectedRowIndex)},executeActionInScope:function(n,t,i,u,f){var s,a,h,e,c,o,l;for(u==null&&(u=this._selectedRowIndex),s=0;s<n.length;s++)if(a=n[s],h=this.get_actionGroups(a),h)for(e=0;e<h.length;e++)if(c=h[e].Actions,c)for(o=0;o<c.length;o++)if(l=c[o],l.CommandName==t&&(r(i)||l.CommandArgument==i)&&this._isActionAvailable(l,u))return f!=!0&&this.executeAction(a,o,u,e),!0;return!1},newDataSheetRow:function(){var n=this;setTimeout(function(){n.executeCommand({commandName:"New",commandArgument:n.get_viewId()})},100)},editDataSheetRow:function(n){this.get_isDataSheet()&&this.executeRowCommand(n,"Edit","",!1)},deleteDataSheetRow:function(){var n=this._get_focusedCell(),t;n&&(this.executeRowCommand(n.rowIndex,"Select"),t=this,setTimeout(function(){t.executeActionInScope(["Row","ActionBar"],"Delete",null,n.rowIndex)},100))},_moveFocusToNextRow:function(n,t){var i=!1,r=this._get_selectedDataRowIndex(n.rowIndex),u=this._pageOffset;return n.rowIndex<t-1?n.rowIndex++:this._get_selectedDataRowIndex(n.rowIndex)<this._totalRowCount-1&&(this._pageOffset==null?this._pageOffset=1:this._pageOffset++,i=!0,this._pageOffset==t?(this._pageOffset=null,this.goToPage(this.get_pageIndex()+1)):this.goToPage(this.get_pageIndex())),r==this._get_selectedDataRowIndex(n.rowIndex)&&!this.editing()&&this._allowNew()&&(this._ignoreSelectedKey=!0,this.newDataSheetRow(),i=!0),i},_scrollToRow:function(){return},cancelDataSheetEdit:function(){if(this.editing()){var n=this._get_focusedCell();return n!=null&&this.executeRowCommand(n.rowIndex,"Cancel",null,!1),!0}return!1},_inputListenerClick:function(n){if(this._skipClickEvent){this._skipClickEvent=!1;return}if(!this._lookupIsActive){for(var t=n.target,r=!1,i=!1,u=!0;t!=null;){if(t==this._container){r=!0;break}t.className!=null&&(t.className.match(/Cell|Group|InfoRow|FieldHeaderSelector|Toggle|FooterRow|ActionRow\s*/)?i=!0:t.className.match(/QuickFind|SearchBarFrame\s*/)&&(u=!1));t=t.parentNode}r?(this._lostFocus=u?!i:!0,this._skipEditOnClick=!0,i||this.cancelDataSheetEdit()):this.cancelDataSheet()}},_inputListenerDblClick:function(){if(!this._lostFocus){var n=this._get_focusedCell();n&&!this.editing()&&this._allowEdit()&&(document.selection&&document.selection.clear(),this.editDataSheetRow(n.rowIndex))}},_get_focusedCell:function(){return this._focusedCell},_focusCell:function(t,i,r){var k,p,c,f,s,a,u,v,g,y;if(!this.get_isDataSheet())return this._focusedCell=null,null;if(k=this.inserting(),r==null&&(r=!0),t==-1&&i==-1){if(!this._focusedCell)return null;t=this._focusedCell.rowIndex;i=this._focusedCell.colIndex}for(t>=this._rows.length&&(t=this._rows.length-1),i>=this._fields.length&&(i=this._fields.length-1),p=this._container.childNodes[0].rows,c=-1,f=0;f<p.length;f++)if(s=p[f],(Sys.UI.DomElement.containsCssClass(s,"Row")||Sys.UI.DomElement.containsCssClass(s,"AlternatingRow"))&&c++,k){if(Sys.UI.DomElement.containsCssClass(s,"Inserting"))break}else if(c===t)break;if(c<0)return null;for(a=-1,f=0;f<s.childNodes.length;f++)if(u=s.childNodes[f+this.get_sysColCount()],u&&Sys.UI.DomElement.containsCssClass(u,"Cell")&&a++,a===i)break;if(a<0)return null;var d=u.parentNode.childNodes[this.get_sysColCount()-1],w=this._get_headerRowElement(),h=w.childNodes[i+this.get_sysColCount()];if(r===!0){if(v=$common.getBounds(h),Sys.UI.DomElement.addCssClass(u,"Focused"),Sys.UI.DomElement.addCssClass(d,"CrossHair"),Sys.UI.DomElement.addCssClass(h,"CrossHair"),!this._skipCellFocus){var l=n.scrolling(),b=$common.getClientBounds(),o=$common.getBounds(u);l.y>o.y?(c?u:h).scrollIntoView(!0):l.y+b.height<=o.y+o.height?u.scrollIntoView(!1):(l.x>o.x||l.x+b.width-1<=o.x||l.x+b.width-1<=o.x+o.width)&&u.scrollIntoView(!1);e.agent==e.InternetExplorer&&(g=$common.getBounds(w),w.style.height=g.height+"px")}y=$common.getBounds(h);(v.width!==y.width||v.x!==y.x||v.y!==y.y)&&Sys.UI.DomElement.addCssClass(h,"Narrow");this._skipCellFocus=!1}else Sys.UI.DomElement.removeCssClass(u,"Focused"),Sys.UI.DomElement.removeCssClass(u,"Narrow"),Sys.UI.DomElement.removeCssClass(d,"CrossHair"),Sys.UI.DomElement.removeCssClass(h,"CrossHair");return this._focusedCell={rowIndex:t,colIndex:i},u},_initializeModalPopup:function(){var u;Sys.UI.DomElement.addCssClass(this.get_element(),"ModalPlaceholder");var r=$common.getClientBounds(),n=r.width/5*4,i=ft.MaxWidth,t=this.get_confirmContext();t&&t.MaxWidth>0&&t.MaxWidth<n&&(i=t.MaxWidth);n>i&&(n=i);u=r.height/5*4;this._container.style.overflowX!=null?(this._container.style.overflowY="auto",this._container.style.overflowX="hidden"):this._container.style.overflow="auto";this._container.style.height=u+"px";this._container.style.width=n+"px";this._saveTabIndexes();this._modalPopup=$create(AjaxControlToolkit.ModalPopupBehavior,{id:this.get_id()+"ModalPopup"+Sys.Application.getComponents().length,PopupControlID:this.get_element().id,DropShadow:!0,BackgroundCssClass:"ModalBackground"},null,null,this.get_modalAnchor());this._modalPopup.show()},_resizeContainerBounds:function(){this._modalPopup||(this._container.style.height="");var n=$common.getBounds(this._container),i=$common.getClientBounds(),t=Math.ceil(i.height/5*4);return n.height>t&&(this._container.style.height=t+"px",n.skipResizing=!0),n},_adjustModalPopupSize:function(){var s=this.get_confirmContext(),f,o,r,u,h,v;Sys.UI.DomElement.removeCssClass(this._element,"EmptyModalDialog");var t=new Sys.StringBuilder,i=[],a=this._container.getElementsByTagName("table");for(f=a.length-1;f>=0;f--)o=a[f],o.className=="ActionButtons"&&(t.isEmpty()&&(t.append('<table class="DataView" cellSpacing=0 cellPadding=0><tr class="ActionButtonsRow BottomButtonsRow">'),t.append(o.parentNode.parentNode.innerHTML),t.append("<\/tr><\/table>")),Array.add(i,o.parentNode.parentNode));while(i.length>0)i[0].parentNode.removeChild(i[0]),delete i[0],Array.removeAt(i,0);r=this._container.childNodes[0];r.style.width="";r.style.height="";u=$common.getContentSize(r);u.height+=e.agent===e.InternetExplorer&&e.version<8?3:1;this._buttons?this._modalAutoSized||(this._container.style.width="auto",this._modalAutoSized=!0):(this._buttons=document.createElement("div"),this.get_element().appendChild(this._buttons),this._buttons.style.width=u.width+"px",Sys.UI.DomElement.addCssClass(this._buttons,"FixedButtons"),this._title=document.createElement("div"),Sys.UI.DomElement.addCssClass(this._title,"FixedTitle"),this.get_element().insertBefore(this._title,this._container),__designer()||$(this._element).draggable({handle:this._title,drag:function(n,t){var i=rt,f=i.width(),e=i.height(),r=t.offset.left-i.scrollLeft(),u=t.offset.top-i.scrollTop(),o=t.helper.outerWidth();if(r+o<50||u<5||r>f-50||u>e-75)return!1}}));this._buttons.innerHTML=t.toString();t.clear();h=this._resizeContainerBounds();h.height>u.height&&!h.skipResizing&&(v=$common.getBorderBox(r),u.width+=v.horizontal,$common.setContentSize(this._container,u));r.style.width=this._title.offsetWidth+"px";this._buttons.style.width=this._title.offsetWidth+"px";Sys.UI.DomElement.setVisible(this.get_element(),!0);var y=$common.getBounds(this._container),c=$common.getPaddingBox(this._title),l=$common.getBorderBox(this._title);this._title.style.width=y.width-c.horizontal-l.horizontal+"px";c=$common.getPaddingBox(this._buttons);l=$common.getBorderBox(this._buttons);this._buttons.style.width=y.width-c.horizontal-l.horizontal+"px";this._title.innerHTML=String.format('<table style="width:100%" cellpadding="0" cellspacing="0"><tr><td><div class="Text">{1}<\/div><\/td><td align="right"><a href="javascript:" class="Close" onclick="$find(\'{0}\').endModalState(\'Cancel\');return false" tabindex="{3}" title="{2}">&nbsp;<\/a><\/td><\/tr><\/table>',this.get_id(),s&&s.WindowTitle?s.WindowTitle:n.htmlEncode(this.get_view().Label),ft.Close,$nextTabIndex());this._modalPopup.show();this._modalAutoSized&&!this._modalWidthFixed&&(this._modalWidthFixed=!0,this._container.style.width=this._container.offsetWidth+"px");this._adjustModalHeight(!0)},_adjustModalHeight:function(n){var t=this._container,o,s,i,u,r,h,f,c;if(this._modalPopup&&this.get_viewType()=="Form")if(n)this._lastContainerHeight=$(t).height();else if(this._lastContainerHeight!=null){for(o=t.style.height,s=t.scrollTop,t.style.height="",i=null,u=t.getElementsByTagName("tr"),r=0;r<u.length;r++)if(u[r].className=="Categories"){i=u[r].childNodes[0];break}i&&(i.style.paddingBottom="");containerBounds=$common.getBounds(t);this._lastContainerHeight>containerBounds.height?i&&(h=$common.getPaddingBox(i),f=this._lastContainerHeight-containerBounds.height-h.bottom,e.agent==e.InternetExplorer&&f++,i.style.paddingBottom=f+"px"):(c=$common.getClientBounds(),c.height*.8<=containerBounds.height?(t.style.height=o,t.scrollTop=s):this._lastContainerHeight=containerBounds.height)}},_allowModalAutoSize:function(){this._modalWidthFixed=!1;this._modalAutoSized=!1},_disposeModalPopup:function(){if(this._modalPopup){this._modalPopup.hide();this._modalPopup.dispose();__designer()||$(this._element).draggable("destroy");delete this._buttons;delete this._title;delete this._modalAnchor;var n=this.get_element();n.parentNode.removeChild(n);this._restoreTabIndexes()}},endModalState:function(n){var i=this.get_parentDataView(),r,u;if(this.get_isModal()&&(r=this.get_exitModalStateCommands(),r))for(u=0;u<r.length;u++)if(n==r[u])return i&&(i._lookupIsActive=!1,i._skipClickEvent=!0),t?t.endModalState(i,this):this.dispose(),!0;return i&&!this.get_confirmContext()&&(t||i.refresh()),kt(),!1},_adjustLookupSize:function(){if(this.get_lookupField()&&this.get_pageSize()>3){var i=n.scrolling(),r=$common.getClientBounds(),t=$common.getBounds(this.get_element());t.height+t.y>r.height+i.y&&this.set_pageSize(Math.ceil(this.get_pageSize()*.66))}},_onMethodFailed:function(t){(this._busy(!1),n._navigated)||(n.showMessage(String.format('<pre style="word-wrap:break-word;white-space:pre-wrap;margin:0px">Component: {4}\r\nController: {5}; View: {6}; Timed out: {0}; Status Code: {7};\r\nException: {1}\r\nMessage: {2}\r\nStack:\r\n{3}<\/pre>',t.get_timedOut(),t.get_exceptionType(),t.get_message(),t.get_stackTrace(),this.get_id(),this.get_controller(),this.get_viewId(),t.get_statusCode())),$(this.get_element()).css("border","1px red solid"))},_createArgsForListOfValues:function(n){var i=this.get_lookupContext(),r=this._searchBarVisibleIndex==null?this.get_filter():this._createSearchBarFilter(!0),u={FieldName:n,Controller:this.get_controller(),View:this.get_viewId(),Filter:this._combinedFilter(r.length==1&&r[0].match(/(\w+):/)[1]==n?null:r),ExternalFilter:this.get_externalFilter(),LookupContextFieldName:i?i.FieldName:null,LookupContextController:i?i.Controller:null,LookupContextView:i?i.View:null,Tag:this.get_tag(),QuickFindHint:t?this.viewProp("quickFindHint"):null};return this._useSearchParams(u),{controller:this.get_controller(),view:this.get_viewId(),request:u}},_loadListOfValues:function(n,t,i,r){this._busy(!0);this._invoke("GetListOfValues",this._createArgsForListOfValues(i),Function.createDelegate(this,this._onGetListOfValuesComplete),{family:n,fieldName:t,callback:r})},_onGetListOfValuesComplete:function(t,i){this._busy(!1);var r=this.findField(i.fieldName);r._listOfValues=t;t[t.length-1]==null&&(Array.insert(t,0,t[t.length-1]),Array.removeAt(t,t.length-1));i.callback?i.callback():(this.get_isChart()?(this.get_showViewSelector()?this._registerViewSelectorItems():this._registerActionBarItems(),l.HoverMonitor._instance._tempOpenDelay=100):this._registerFieldHeaderItems(Array.indexOf(this.get_fields(),r)),$refreshHoverMenu(i.family),n._resized=!0)},get_parentDataView:function(n){var t=n;return this._parentDataViewId&&(t=p(this._parentDataViewId)),t},get_selectedValues:function(){var t=this.get_parentDataView(this),n=t?t.get_selectedValue():[],i;return n=n.length==0?[]:t.multiSelect()?n.split(";"):[n],i=Array.indexOf(n,"null"),i!=-1&&n.splice(i,1),n},_execute:function(n){this._busy(!0);this._showWait();this._lastArgs=n;this._invoke("Execute",{controller:n.Controller,view:n.View,args:n},Function.createDelegate(this,this._onExecuteComplete))},_populateDynamicLookups:function(i){for(var u=this,o,e,r,f=0;f<i.Values.length;f++)e=i.Values[f],r=u.findField(e.Name),r&&(o=r.DynamicItems=e.NewValue,r.requiresDynamicNullItem&&r.ItemsStyle.match(/^(ListBox|RadioButtonList|DropDownList)$/)&&!r.ItemsTargetController&&si(r,o),r.Items=[],r.ItemCache=null);t?n.input.execute({dataView:u,values:i.Values,populateDynamicLookups:!1}):(u._skipPopulateDynamicLookups=!0,u.refresh(!0),u._focus())},_updateCalculatedFields:function(n){var i,t,r;for(this._displayActionErrors(n),i=[],t=0;t<n.Values.length;t++)r=n.Values[t],Array.add(i,{name:r.Name,value:r.NewValue});this.refresh(!0,i);this._focus()},_get_LEVs:function(){for(var t,i=0;i<n.LEVs.length;i++)if(t=n.LEVs[i],t.controller==this.get_controller())return t.records;return t={controller:this.get_controller(),records:[]},Array.add(n.LEVs,t),t.records},_recordLEVs:function(n){var t,r,i;if(this._allowLEVs&&(n||this._lastArgs.CommandName.match(/Insert|Update/))&&(this._lastArgs||n)){for(n||(n=this._lastArgs.Values),t=this._get_LEVs(),r=!0,i=0;i<n.length;i++)if(n[i].Modified){r=!1;break}r||(t.length>0&&Array.removeAt(t,t.length-1),Array.insert(t,0,n))}},_applyLEV:function(n){for(var t,r=this._allFields[n],e=this._allFields[r.AliasIndex],u=[],f=this._get_LEVs()[0],i=0;i<f.length;i++)t=f[i],(t.Name==r.Name||t.Name==e.Name)&&Array.add(u,{name:t.Name,value:t.NewValue});this.refresh(!0,u)},_notifyMaster:function(){var u=this,n,r,i,f;if(u.get_hasParent())if(t){if(n=u,i=n._dataViewFieldName,!(n._filterSource&&i))while(n&&!i)n=n.get_parentDataView(),n&&(i=n._dataViewFieldName);n&&i&&(n=p(n._filterSource),r=n.findField(i),r&&r.CausesCalculate&&(n==t.dataView()?n._raiseCalculate(r,r):t.pageInfo(n).calculate=i))}else f=p(u.get_filterSource()),f&&f._updateDynamicValues("controller:"+u.get_controller())},_clearSelectedKey:function(n){var t=this._lookupInfo?this:this.get_parentDataView(this),i=t._selectedKey,r;i&&i.length&&(r=t._selectedKeyList.indexOf(i.join(";")),r!==-1&&t._selectedKeyList.splice(r,1));t._selectedKey=[];t._selectedKeyFilter=[];t._selectedRowIndex=null;t._position=null;n!==!1&&(t._raiseSelectedDelayed=!0);t._selectedRow=null},_refreshSelectedKey:function(n){var t=this,i,u=[],s=[],f,e,r,o;for(!n.length&&t._lastArgs&&(n=t._lastArgs.Values),e=0;e<t._keyFields.length;e++)for(f=t._keyFields[e],r=0;r<n.length;r++)if(n[r].Name===f.Name){if(o=n[r],o.NewValue==null){t._clearSelectedKey();return}Array.add(u,o.NewValue);Array.add(s,f.Name+":="+t.convertFieldValueToString(f,o.NewValue));break}i=t.get_parentDataView(t);i.editing()||(u.length>0?(i._selectedKey=u,i._selectedKeyFilter=s,i._selectedKeyList=[u.join(";")],i._raiseSelectedDelayed=!0):i._selectedKeyList=[])},_cancelConfirmation:function(){if(this._confirmDataViewId){var n=p(this._confirmDataViewId);n&&(this._confirmDataViewId=null,n.cancel())}},_findKeyValue:function(n){for(var t,r=this._keyFields[0],i=0;i<n.length;i++)if(t=n[i],r.Name===t.Name)return t.Modified?t.NewValue:t.OldValue;return null},_onExecuteComplete:function(i,u){var f=this,wt=f.get_isForm(),b=f.extension(),k=f._lastArgs,e=k.CommandName,o=i.Values,a,h,ft,bt,et,p,w,c,y,ot,kt,d,g,st,nt,ht,ct,v,lt,at,vt,dt,tt,rt,yt,s,l,gt,ut,pt;if(f._busy(!1),f._hideWait(),t&&(et=t.notify(f)),p=!i.Errors.length,w=f._pendingUploads,w&&w.length>0&&p&&e.match(/^(Insert|Update)$/)){c=w[0];ot="1";Array.removeAt(w,0);h=f._findKeyValue(o);h==null&&(h=f._findKeyValue(k.Values));c.files?(y=f.findField(c.fieldName),kt="name:"+y.Name,f._allFields.forEach(function(n){n._blobField===kt&&(ot="2")}),y.Name.match(/_Annotation_Attachment/)&&(h=y._dataView._controller+","+y.Name+"|"+h),n.upload("execute",{container:yi(f,y),files:c.files,url:String.format("{0}Blob.ashx?{1}=u|{2}&_v={3}",__baseUrl,y.OnDemandHandler,h,ot),success:function(){f._stopWaiting=!0},error:function(){w.push(c);f._stopWaiting=!0}})):c.form.action=c.form.action.replace(/=u\|&/,String.format("=u|{0}&",h));f._pendingExecuteComplete={result:i,context:u};f._showDownloadProgress();c.form&&c.form.submit();return}if(d=f._lastFocusedCell,e==="PopulateDynamicLookups"){f._populateDynamicLookups(i);return}if(e==="Calculate"){t?n.input.execute({dataView:f,values:o,raiseCalculate:!1}):f._updateCalculatedFields(i);i.ClientScript&&eval(i.ClientScript);f._pendingPopulate&&(f._pendingPopulate=!1,f._raisePopulateDynamicLookups());return}if(g=!1,st=e==="Custom",p&&t&&(nt=n.controllerSyncMap[f._controller],nt))for(h in nt)nt[h]=!0;if(f._confirmDataViewId&&t){t.pageShown(function(){f._onExecuteComplete(i,u)});f._cancelConfirmation();return}if(f._cancelConfirmation(),ht={result:i,context:u,handled:!1},f.raiseExecuted(ht),!ht.handled){if(i.ClearSelection&&(f._clearSelectedKey(),f._selectedKeyList=[]),ct=!e.match(/Insert/),e.match(/Delete/i)&&i.RowsAffected>0)b=f.get_parentDataView(f).extension(),b&&b.clearSelection?b.clearSelection(!0):f._clearSelectedKey();else if(e.match(/Custom|SQL|Email/))g=!st&&f.editing(),o.length>0?(t?n.input.execute({dataView:f,values:o}):f.refresh(!0,o),st&&!i.ClientScript&&(i.ClientScript="void(0)"),f._refreshSelectedKey(o,p)):g||e!=="SQL"||(f._raiseSelectedDelayed=!0,f._forceChanged=!0);else if(ct)for(v=0;v<o.length;v++)lt=o[v],at=f.findField(lt.Name),at&&(f.get_currentRow()[at.Index]=lt.NewValue);else t&&(n.input.execute({dataView:f,values:o}),wt&&(a=f.get_parentDataView(null),a&&a!==f&&(vt=[],dt=f.editRow(),$(f._allFields).each(function(){var n=this,t=a.findField(n.Name),i=dt[n.Index];t&&(vt[t.Index]=i)}),a.extension()._commandRow=vt))),f._refreshSelectedKey(o,p);if(p)if(f._forceSync(),a=f.get_parentDataView(),a&&a._forceSync(),f.tag(i.Tag),f._requestedFilter=i.Filter,f._requestedSortExpression=i.SortExpression,f._autoRefresh(),f.multiSelect()&&(i.KeepSelection?f._keepKeyList=!0:(f._selectedKeyList=[],f.set_selectedValue(""))),f._recordLEVs(),f.updateSummary(),f._continueAfterScript=!0,i.ClientScript&&(f._continueAfterScript=!1,i.ClientScript=f.resolveClientUrl(i.ClientScript),eval(i.ClientScript),ft=f._continueAfterScript),f._lastFocusedCell=null,tt=k.CommandArgument,rt=new it(f),rt.after({commandName:e,commandArgument:tt}),(rt.canceled()||i.Canceled&&!ft&&!e.match(/Update|Insert|Delete/))&&(f._continueAfterScript=!1),rt.dispose(),f._continueAfterScript){if(i.NavigateUrl&&(i.NavigateUrl=f.resolveClientUrl(i.NavigateUrl),bt=!ft,f.navigate(i.NavigateUrl,ct?k.Values:o)),!bt&&!f._closeInstantDetails()&&!f.endModalState(e))if(f.get_backOnCancel()||!r(f._replaceTriggerViewId))f.goBack(!0);else{for(f._notifyDesigner(!0),et!=null&&t.notify({text:et,force:!0}),yt=f.get_actions(f._get_lastActionScope(),!0),gt=f._lastArgs.Values,v=0;v<yt.length;v++)if(s=yt[v],s.WhenLastCommandName===e&&(!s.WhenLastCommandArgument||s.WhenLastCommandArgument===tt)&&f._isActionMatched(s)){ut=s.CommandName;pt=s.CommandArgument;t&&(l=f.delegateCommand(ut,pt));l||(l=f);(!s.WhenKeySelected||(l.get_selectedKey()||[]).length)&&(l.set_lastCommandName(e),l.set_lastCommandArgument(tt),l.executeCommand({commandName:ut,commandArgument:pt,path:s.Path,causesValidation:s.CausesValidation,values:e.match(/Insert|Custom/)?gt:null}),l._pendingSelectedEvent=ut.match(/^(Edit|Select)/)!=null,l._notifyMaster());return}g||(f._pendingSelectedEvent=e.match(/Update|Custom|SQL/),f.set_lastCommandName(null),f.get_isModal()&&(!f.get_isForm(f._lastViewId)||f._inlineEditor||f._closeViewDetails)?f.endModalState("Cancel"):(t&&f._viewId===f._lastViewId&&t.syncWithOdp(t.dataView()),t&&wt?f._doneCallback?f._doneCallback(f):location.replace(location.href):f.goToView(f._lastViewId)))}f._notifyMaster()}else t&&t.edit.sync({reset:!0});else d&&(f._focusCell(-1,-1,!1),f._focusCell(d.rowIndex,d.colIndex,!0),f._lastFocusedCell=null,f._saveAndNew=!1),i.ClientScript&&(i.ClientScript=f.resolveClientUrl(i.ClientScript),eval(i.ClientScript)),f._displayActionErrors(i)}},_get_lastActionScope:function(){var f=this._lastArgs?this._lastArgs.Path:null,i,r,n,u,t;if(f&&(i=f.match(/^(\w+)\//),i))for(r=this._actionGroups,n=0;n<r.length;n++)if(u=r[n],u.Id===i[1])return u.Scope;return t=this.get_viewType(),t.match(/DataSheet|Tree/)&&(t="Grid"),t},_displayActionErrors:function(i){if(i.Errors.length){for(var u=new Sys.StringBuilder,r=0;r<i.Errors.length;r++)u.append((r?"\n":"")+n.formatMessage("Attention",i.Errors[r]));t&&t.edit.sync({reset:!0});n.showMessage(u.toString());u.clear()}},_busy:function(i){var u=this,p=u._api,e,a,y,c,b,k;if(i==null)return u._isBusy;if(!p||!p.background){u._isBusy=i;u._enableButtons(!i);var v=u._busyInterval,f=!t&&(u.get_isModal()||u.get_lookupField()!=null||!this._controller)||t!=null||this.get_useCase()==="$app",d=t?t.toolbar():f?document.body:u._container,h=$(d),l=$(u._container),s;if(t&&!t.toolbar().is(":visible")){t.wait(i);return}if(t){arguments.length&&t.busy(i);clearTimeout(n._busyIndicatorTimeout);s=n._busyIndicator;s||(s=n._busyIndicator=$('<div class="dataview-busy-indicator"><\/div>').appendTo(document.body),n._busyCount=0);i?(n._busyCount||(n._busyTime=+new Date,s.removeClass("dataview-busy-indicator-done").css({top:0,"animation-duration":Math.max(1e3,rt.width())*3+"ms"}),s.addClass("dataview-busy-indicator-animate")),n._busyCount++):n._busyCount&&(n._busyCount==1&&(+new Date-n._busyTime>500?(s.toggleClass("dataview-busy-indicator-animate dataview-busy-indicator-done"),setTimeout(function(){s.removeClass("dataview-busy-indicator-done")},1550)):s.removeClass("dataview-busy-indicator-animate dataview-busy-indicator-done")),n._busyCount--);return}if(i&&!v){t||l.is(".dataview-loaded")||l.addClass("dataview-loading");e=h.outerWidth()/5;e>200&&(e=200);var r=u._$busy=$(String.format('<div class="dataview-busy-indicator{0}"><\/div>',f?" modal":"")).css({position:"absolute",width:e,"z-index":f?t?5e3:3e6:0}),o=-e,w=f?0:r.height();r.hide().appendTo(document.body);a=0;this._busyInterval=setInterval(function(){if(a!=null)if(a++>(t?35:75))a=null,y=!0;else return;if(o+=Math.ceil(e/30),y?(f&&n._busyIndicator?(c=!0,r.hide()):(n._busyIndicator=!0,r.show()),y=!1):c&&!n._busyIndicator&&(c=!1,n._busyIndicator=!0,r.show()),o>=0){var i=h.outerWidth();o>=i-e&&o<i?r.width(i-o):o>=i&&(o=-e);c||r.position({my:"left top",at:String.format("left+{0} top{1}{2}",o,f?"+":"-",f?rt.scrollTop():w),of:h})}else c||(r.width(e+o),r.position({my:"left top",at:String.format("left top{0}{1}",f?"+":"-",f?rt.scrollTop():w),of:h}))},1e3/60)}else v&&(t||l.is(".dataview-loaded")||l.removeClass("dataview-loading").addClass("dataview-loaded"),clearInterval(v),u._busyInterval=null,r=u._$busy,r&&(b=r.offset(),k=h.offset(),u._$busy=null,r.width(h.outerWidth()-(b.left-k.left)),setTimeout(function(){r.remove();f&&(n._busyIndicator=!1)},500)))}},_enableButtons:function(n){t||$("button",this._element).each(function(){$(this).toggleClass("disabled",!n)})},_bodyKeydown:function(n){var t=!1;this._customFilterField?n.keyCode==Sys.UI.Key.enter?(t=!0,this.applyCustomFilter()):n.keyCode==Sys.UI.Key.esc&&(t=!0,this.closeCustomFilter()):this.get_lookupField()&&n.keyCode==Sys.UI.Key.esc&&(t=!0,this.hideLookup());t&&(n.preventDefault(),n.stopPropagation())},_prepareJavaScriptExpressionEx:function(n){return n.replace(/\[((\w+)\.)?(\w+)\]/g,'this.fieldValue("$3","$2")').replace(/\$row\.(\w+)/gm,'this.fieldValue("$1")').replace(/\$master\.(\w+)/gm,'this.fieldValue("$1","master")')},_evaluateVisibility:function(){var n=this.get_visibleWhen();return r(n)?!0:(n=this._prepareJavaScriptExpressionEx(n),eval(n)!=!1)},_filterSourceSelected:function(i,r,u){var o,f,s,c,l,a,v,y,p,e,h;if(this._hidden=!this._evaluateVisibility(),o=this.readContext("vitals"),o){for(f=0;f<o.Filter.length;){var w=o.Filter[f],k=w.substring(0,w.indexOf(":")),b=!1;if(this._keyFields)for(s=0;s<this._keyFields.length;s++)if(this._keyFields[s].Name==k){b=!0;break}b?Array.removeAt(o.Filter,f):f++}this.writeContext("vitals",o)}for(c=[],f=0;f<this._externalFilter.length;f++)Array.add(c,this._externalFilter[f].Value),this._externalFilter[f].Value=null;for(l=!1,a=!1,d(n,i)?(this._populateExternalViewFilter(i),l=!i.get_showDetailsInListMode()&&i.get_isGrid(),i._forceChanged&&(a=!0)):this._externalFilter.length>0&&(this._externalFilter[0].Value=i.target.value),this.applyExternalFilter(t),v=!0,y=!1,f=0;f<this._externalFilter.length;f++)p=this._externalFilter[f].Value,p!=null&&(v=!1),p!=c[f]&&(y=!0);this.get_autoHide()!=Web.AutoHideMode.Nothing&&this._updateLayoutContainerVisibility(!v&&!l&&!this._hidden);(y||a)&&(u||(h=this.extension(),this.set_pageIndex(-1),h&&h.currentPageIndex&&h.currentPageIndex(null)),e=this._position,e&&(e.index=0,e.count=-1,e.key=[],e.keyFilter=[],e.filter=this.get_filter()),u||(this._selectedKey=[],this._selectedKeyFilter=[],this._selectedKeyList=[]),this._clearCache(),this.loadPage());this.raiseSelected();this.updateSummary()},_createExternalFilter:function(){var r,i,t;if(this._externalFilter=[],r=/(\w+)(,|$)/g,this.get_filterFields())for(i=this.get_filterFields().split(n._simpleListRegex),t=0;t<i.length;t++)Array.add(this._externalFilter,{Name:i[t],Value:null})},_populateExternalViewFilter:function(n){var i,r,f,t,u,e;if(n._selectedKey&&n._keyFields&&n._selectedKey.length==n._keyFields.length)for(i=0;i<this._externalFilter.length;i++){for(r=this._externalFilter[i],f=!1,t=0;t<n._keyFields.length;t++)if(u=n._keyFields[t],r.Name==u.Name){r.Value=n.convertFieldValueToString(u,n._selectedKey[t]);f=!0;break}if(!f&&this.get_controller()!=n.get_controller()&&(e=n.get_selectedRow(),e&&e.length))for(t=0;t<n._allFields.length;t++)if(u=n._allFields[t],r.Name==u.Name){r.Value=n.convertFieldValueToString(u,e[n._allFields[t].Index]);f=!0;break}!f&&n._selectedKey.length>=i&&(r.Value=n._selectedKey[i])}},_cloneChangedRow:function(){var t,n,i;if(this.editing()){var r=this._collectFieldValues(),u=this.get_currentRow(),f=u?Array.clone(u):null;for(t=0;t<r.length;t++)n=r[t],i=this.findField(n.Name),i&&(f[i.Index]=n.Modified&&"NewValue"in n?n.NewValue:n.OldValue);return f}return this.get_selectedRow()},_updateVisibility:function(n){var w,h,c,b,f,o,t,i,e,l,u,a,k,nt,y,it,s,rt,p,g;if(this._expressions&&(this._readOnlyChanged=!1,w=this.get_isForm(),h=[],n||(n=this._cloneChangedRow()),n)){for(c=!1,b=!1,f=0;f<this._expressions.length;f++)o=h[0]=this._expressions[f],o.Type==Web.DynamicExpressionType.ClientScript&&(o.Scope==Web.DynamicExpressionScope.DataFieldVisibility?(t=this.findField(o.Target),t&&(i=this._get(w?"_ItemContainer":"Item",t.Index),i&&(e=this._evaluateJavaScriptExpressions(h,n,!1),w&&(l=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.containsCssClass(i.parentNode,"FieldPlaceholder")?i=i.parentNode:Sys.UI.DomElement.containsCssClass(i.parentNode.parentNode,"FieldWrapper")&&(i=i.parentNode.parentNode.parentNode.parentNode),Sys.UI.DomElement.setVisible(i,e==!0),l!=e&&(c=!0))))):o.Scope==Web.DynamicExpressionScope.CategoryVisibility?(u=this.findCategory(o.Target),u&&(i=this._get("_Category",u.Index),i&&(u.IsVisible=this._evaluateJavaScriptExpressions(h,n,!1),e=u.IsVisible&&(r(u.Tab)||u.Tab==this._get_selectedTab()),l=Sys.UI.DomElement.getVisible(i),Sys.UI.DomElement.setVisible(i,e==!0),l!=e&&(c=!0),a=this._get("$CategoryDescription$",u.Index),a&&(k=this._processTemplatedText(n,u.Description),a.innerHTML=k,a.style.display=r(k)?"none":"block"),r(u.Tab)||(b=!0)))):o.Scope==Web.DynamicExpressionScope.ReadOnly&&(t=this.findField(o.Target),t&&(t.OriginalTextMode==null&&(t.OriginalTextMode=t.TextMode),nt=t.isReadOnly(),e=this._evaluateJavaScriptExpressions(h,n,!1),t.TextMode=e==!0?4:t.OriginalTextMode,e!=nt&&(c=!0,this._readOnlyChanged=!0))));if(b)for(f=0;f<this._tabs.length;f++){var ut=this._tabs[f],tt=!1,d=!1;for(y=0;y<this._categories.length;y++)if(u=this._categories[y],u.Tab==ut&&u.IsVisible!=null&&(tt=!0,d=u.IsVisible,d))break;tt&&Sys.UI.DomElement.setVisible(this._get("_Tab",f),d)}if(this._dynamicActionButtons&&(this._clonedRow=n,it=this._get("$ActionButtons$","Top"),it&&(s=new Sys.StringBuilder,this._internalRenderActionButtons(s,"Top",this._lastActionButtonsScope),this._newTopActionButtons=s.toString(),s.clear()),rt=this._get("$ActionButtons$","Bottom"),rt&&(s=new Sys.StringBuilder,this._internalRenderActionButtons(s,"Bottom",this._lastActionButtonsScope),this._newBottomActionButtons=s.toString(),s.clear()),p=this,setTimeout(function(){p._refreshActionButtons()},500),this._clonedRow=null),this._updateStatusBar(),c&&(this._adjustModalHeight(),this._modalPopup&&this._modalPopup.show(),_body_performResize()),this.editing()&&!this._lookupIsActive)for(g=this._get_focusedCell(),f=0;f<this._fields.length;f++)if(t=this._fields[f],!t.ReadOnly&&!t.Hidden&&t.AutoSelect&&t.ItemsStyle=="Lookup"&&(g==null||g.colIndex==t.ColIndex)&&(t.AutoSelect=!1,v=n[t.Index],v==null)){this._lookupIsActive=!0;p=this;setTimeout(function(){p.showLookup(t.Index)},100);break}}},_refreshActionButtons:function(){var t=this._get("$ActionButtons$","Top"),n;t&&this._newTopActionButtons&&(t.innerHTML=this._newTopActionButtons,this._newTopActionButtons=null);n=this._get("$ActionButtons$","Bottom");n&&this._newBottomActionButtons&&(n.innerHTML=this._newBottomActionButtons,this._newBottomActionButtons=null)},_updateDynamicValues:function(n){var i=this,e=!1,h=i._allFields,c=n&&n.Name?n.Name:n,o,u,l,s,f;if(n&&n.CausesCalculate){if(!i.editing())return i.refresh(),!0;i._raiseCalculate(n,n);e=!0}else for(o=0;o<h.length;o++)if(u=h[o],l=!r(u.ContextFields),l){for(s=/\s*([\w\:]+)\s*(=\s*(\w+)\s*)?(,|$)/g,f=s.exec(u.ContextFields);f;){if(u.ItemsAreDynamic&&(n==null||f[3]==c)){if(!i.editing())return i.refresh(),!0;i._raisePopulateDynamicLookups();e=!0}else if((u.Calculated||u.CausesCalculate)&&f[1]==c||f[1]==n||"controller:"+f[1]==n){if(t){i.extension().notify(n);return}if(!i.editing())return i.refresh(),!0;i._raiseCalculate(u,n);e=!0}if(e)break;f=s.exec(u.ContextFields)}if(e)break}return e},_valueFocused:function(t){var i=this._allFields[t];this._focusedFieldName=i.Name;n._focusedDataViewId=this._id;n._focusedItemIndex=t},_resetContextLookupValues:function(n){var t=[],i;return this._enumerateContextFieldValues(n,t,{}),i=t.length>0,i&&this.refresh(!0,t),i},_enumerateContextFieldValues:function(t,i,r,u){for(var b=this,d=t.Name,h,e,k=t.ItemsDataController,a=b._allFields,f,c,v,y,l,s,p,w,o=0;o<a.length;o++)if(f=a[o],c=f.ContextFields,c&&!r[o]&&(f.ItemsStyle||f.Type=="DataView"))for(v=/\s*(\w+)\s*(=\s*(\w+)\s*)?(,|$)/g,h=v.exec(c);h;){if(h[3]==d){if(y=f.ItemsDataController,l=!(k&&y)||k!=y,r[o]=!0,e||(e={},$(i).each(function(){e[this.name||this.Name]=!0})),e[f.Name]||i.push({name:f.Name,value:!l&&u?u[f.Index]:null}),s=a[f.AliasIndex],s==f||e[s.Name]||i.push({name:s.Name,value:!l&&u?u[s.Index]:null}),p=f.Copy,p&&l)while(w=n._fieldMapRegex.exec(p))e[w[1]]||i.push({name:w[1],value:null});f.skipPopulate||(f.DynamicItems=null,f.ItemCache=null);b._enumerateContextFieldValues(f,i,r,u)}h=v.exec(c)}},_copyStaticLookupValues:function(i){var e,h,u,o,l,a;if(!r(i.Copy)&&(i.ItemsStyle=="RadioButtonList"||i.ItemsStyle=="ListBox"||i.ItemsStyle=="DropDownList")){var v=this._collectFieldValues(),f=v[i.Index].NewValue,s=null,c=i.DynamicItems||i.Items;for(f!=null&&typeof f!="string"&&(f=f.toString()),e=0;e<c.length;e++)if(h=c[e],u=h[0],u!=null&&typeof u!="string"&&(u=u.toString()),u==f){s=h;break}if(s){for(o=[],l=2;a=n._fieldMapRegex.exec(i.Copy);)Array.add(o,{name:a[1],value:s[l++]});return t?n.input.execute({dataView:this,values:o}):this.refresh(!0,o),!0}}return!1},_replaceFieldValue:function(n){for(var t,o,r=this._enumerateExpressions(Web.DynamicExpressionType.RegularExpression,Web.DynamicExpressionScope.Field,n.Name),i=0;i<r.length;i++){t=r[i];try{if(t.Result.match(/\$(\d|\'\`)/)){var s=this._collectFieldValues(),u=s[n.Index],f=u.NewValue?u.NewValue.toString():null,h=new RegExp(t.Test),e=f.replace(h,t.Result);e!=f&&(o=[{name:n.Name,value:e}],this.refresh(!0,o))}}catch(c){}}},_valueChanged:function(t){var r=this._allFields[t],i;this._showFieldError(r,null);this._skipErrorReset=!1;i=this;i._valueChangedTimeout=setTimeout(function(){n._navigated||i._performValueChanged(t,!0)},200)},_performValueChanged:function(n,t){var i=this._allFields[n],r,u,f;if(i){if(this._skipErrorReset){this._skipErrorReset=!1;return}return this._showFieldError(i,null),this._replaceFieldValue(i),r=this._resetContextLookupValues(i),u=this._copyStaticLookupValues(i),this._updateVisibility(),f=this._updateDynamicValues(i),t&&this._readOnlyChanged&&this.editing()&&(this.refresh(!0),this._focus()),u||f||r||this._readOnlyChanged}},_quickFind_focus:function(){var n=this.get_quickFindElement();n.value==k.QuickFindText&&(n.value="");Sys.UI.DomElement.removeCssClass(n,"Empty");Sys.UI.DomElement.removeCssClass(n,"NonEmpty");n.select();this._lostFocus=!0},_quickFind_blur:function(){var n=this.get_quickFindElement();y(n.value)?(n.value=k.QuickFindText,Sys.UI.DomElement.addCssClass(n,"Empty")):Sys.UI.DomElement.addCssClass(n,"NonEmpty");this._lostFocus=!1},_executeQuickFind:function(n){var t,i;for(this._forceSync(),t=0;t<this._allFields.length;t++)this._allFields[t]._listOfValues=null;for(this.removeQuickFind(),t=0;t<this._allFields.length;t++)if(i=this._allFields[t],!i.Hidden){i=this._allFields[i.AliasIndex];r(n)?this.refreshData():this.applyFilter(i,"~",n);break}},quickFind:function(n){var t=(r(n)?this.get_quickFindElement().value:n).match(/^\s*(.*?)\s*$/),i=t[1]==k.QuickFindText?"":t[1];this.set_quickFindText(i);this._executeQuickFind(i);this._lostFocus=!1},_quickFind_keydown:function(n){if(n.keyCode==Sys.UI.Key.enter)n.preventDefault(),n.stopPropagation(),this.quickFind();else if(n.keyCode===Sys.UI.Key.down)return},encodePermalink:function(n,t,i){Sys.Net.WebServiceProxy.invoke(this.get_servicePath(),"EncodePermalink",!1,{link:n,rooted:!1},Function.createDelegate(this,this._encodePermalink_Success),Function.createDelegate(this,this._onMethodFailed),{target:t,features:i})},_encodePermalink_Success:function(n,t){t.target||t.features?open(n,t.target,t.features):location.href=n},showViewMessage:function(n){var r,u,i;t?t.notify({text:n,force:!0}):(r=this._get("$HeaderText"),r!=null&&n&&(u=String.format('<div class="MsgBox">{1} <a href="javascript:" onclick="$find(\'{0}\').hideViewMessage();return false;" class="Close" title="{2}">&nbsp;<\/a><\/div>',this.get_id(),n,ft.Close),i=this.get_view(),i.OriginalHeaderText||(i.OriginalHeaderText=i.HeaderText),i.HeaderText=u,r.innerHTML=u,this._viewMessages||(this._viewMessages={}),this._viewMessages[i.Id]=n))},hideViewMessage:function(){var i=this._get("$HeaderText"),t,n;if(i!=null){if(t=this.get_view(),n=t.OriginalHeaderText,!n)return;t.HeaderText=n;i.innerHTML=this._formatViewText(u.Views.DefaultDescriptions[n],!0,n);this._viewMessages[t.Id]=null}}};n.registerClass("Web.DataView",Sys.UI.Behavior);l.AutoComplete=function(n){Web.AutoComplete.initializeBase(this,[n])};l.AutoComplete.prototype={initialize:function(){Web.AutoComplete.callBaseMethod(this,"initialize");this._textBoxMouseOverHandler=Function.createDelegate(this,this._onTextBoxMouseOver);this._textBoxMouseOutHandler=Function.createDelegate(this,this._onTextBoxMouseOut);this._completionListItemCssClass="Item";this._highlightedItemCssClass="HighlightedItem"},dispose:function(){this._viewPage=null;this._element&&($removeHandler(this._element,"mouseover",this._textBoxMouseOverHandler),$removeHandler(this._element,"mouseout",this._textBoxMouseOutHandler));Web.AutoComplete.callBaseMethod(this,"dispose")},get_fieldName:function(){return this._fieldName},set_fieldName:function(n){this._fieldName=n},updated:function(){var n=document.createElement("div");n.className="AutoCompleteFrame "+this.get_typeCssClass();n.innerHTML=String.format('<table><tr><td class="Input"><\/td><td class="Clear" style="{2}"><span class="Clear" onclick="var e=this.parentNode.parentNode.getElementsByTagName(\'input\')[0];e.value=\'\';e.focus()" title="{1}">&nbsp;<\/span><\/td><td class="Button" onmouseover="if(!Sys.UI.DomElement.containsCssClass(this.parentNode, \'Active\'))$find(\'{0}\')._showDropDown(true)" onmouseout="$find(\'{0}\')._showDropDown(false)"><span class="Button" onclick="$find(\'{0}\')._showFullList();">&nbsp;<\/span><\/td><\/tr><\/table>',this.get_id(),vt,this.get_contextKey().match(/^(SearchBar|Filter)\:/)!=null?"":"display:none");this._element.setAttribute("autocomplete","off");this._element.parentNode.insertBefore(n,this._element);n.getElementsByTagName("td")[0].appendChild(this._element);e.agent===e.WebKit&&(n.style.marginLeft="2px");this._completionSetCount===10&&(this._completionSetCount=100);$addHandler(this._element,"mouseover",this._textBoxMouseOverHandler);$addHandler(this._element,"mouseout",this._textBoxMouseOutHandler);Web.AutoComplete.callBaseMethod(this,"updated");document.body.appendChild(this._completionListElement);this._completionListElement.className="CompletionList AutoComplete";this._completionListElement.style.display="none"},_showCachedFullList:function(){this._update("%",this._cache["%"],!1)},_showFullList:function(){var t,i,n;if(!this._webRequest&&(t=this._popupBehavior.get_visible(),this._hideCompletionList(),this._element.focus(),!t)){if(this._completionWord="%",this._cache&&this._cache["%"]){i=this;setTimeout(function(){i._showCachedFullList()},50);return}n={prefixText:this._completionWord,count:this._completionSetCount};this._useContextKey&&(n.contextKey=this._contextKey);this._ignoreCompletionWord=!0;this._invoke(n,this._completionWord)}},_showDropDown:function(n){for(var t=this._element;t.tagName!="TR";)t=t.parentNode;n?Sys.UI.DomElement.addCssClass(t,"Active"):this._textBoxHasFocus?Sys.UI.DomElement.addCssClass(t,"Active"):Sys.UI.DomElement.removeCssClass(t,"Active")},_onKeyDown:function(n){var i,t;n.keyCode==Sys.UI.Key.down&&n.altKey&&(n.preventDefault(),n.stopPropagation(),this._showFullList());i=this._popupBehavior._visible;Web.AutoComplete.callBaseMethod(this,"_onKeyDown",[n]);(n.keyCode==Sys.UI.Key.enter||n.keyCode==Sys.UI.Key.esc)&&(t=this._get_fieldDataView(!0),t&&(t.get_isDataSheet()&&i?(n.preventDefault(),n.stopPropagation()):t.get_searchBarIsVisible()&&(n.preventDefault(),n.stopPropagation(),i||setTimeout(function(){t._performSearch()},100))))},_update:function(n,t,i){var r,u,f,e;if(Web.AutoComplete.callBaseMethod(this,"_update",[n,t,i]),t){for(r=-1,u=this._currentCompletionWord().toLowerCase(),f=0;f<t.length;f++)if(e=t[f],e!=null&&(e=e.toLowerCase(),r==-1&&e.startsWith(u)&&(r=f),e==u)){r=f;break}r>=0&&r<this._completionListElement.childNodes.length&&(this._selectIndex=r,u=this._completionListElement.childNodes[r],this._highlightItem(u),this._handleScroll(u,r+5))}},_get_fieldDataView:function(t){var r=null,i=this._get_contextInfo();return i&&(i.type=="Field"||t&&i.type=="SearchBar")&&(r=n.find(i.controller)),r},_setText:function(n){var f,c,t,s,y,l,u;if(Web.AutoComplete.callBaseMethod(this,"_setText",[n]),this._updateClearButton(),f=this._get_fieldDataView(),f){var e=f.findField(this.get_fieldName()),a=this.get_element().value,o=[];if(a!=w&&(c=this._enumerateViewPageItems(a),c!=-1)){var i=this._viewPage,v=i.Rows[c],h=[];for(t=0;t<i.Fields.length;t++)s=i.Fields[t],s.Name==e.ItemsDataValueField&&Array.add(h,s);if(h.length==0)for(t=0;t<i.Fields.length;t++)if(s=i.Fields[t],s.IsPrimaryKey){Array.add(h,s);break}for(t=0;t<h.length;t++)y=v[h[0].Index],Array.add(o,y)}if($get(f.get_id()+"_Item"+e.Index).value=o.toString(),this._originalElementText=this.get_element().value,this._get_isInLookupMode()){if(!r(e.Copy)){for(o=[],l=/(\w+)=(\w+)/g,u=l.exec(e.Copy);u;){if(u[2]=="null")Array.add(o,{name:u[1],value:null});else for(t=0;t<i.Fields.length;t++)i.Fields[t].Name==u[2]&&Array.add(o,{name:u[1],value:v[t]});u=l.exec(e.Copy)}f.refresh(!0,o)}f._valueChanged(e.Index)}}},_get_isInLookupMode:function(){var n=this._get_contextInfo();return n!=null&&n.type=="Field"},_updateClearButton:function(){var n=this._element.parentNode.parentNode;y(this._element.value)?Sys.UI.DomElement.removeCssClass(n,"Filtered"):Sys.UI.DomElement.addCssClass(n,"Filtered")},_onGotFocus:function(n){if(Web.AutoComplete.callBaseMethod(this,"_onGotFocus",[n]),this._showDropDown(!0),this._updateClearButton(),this._get_isInLookupMode()){var t=this.get_element();this._originalElementText=t.value;this._originalElementText==w&&(t.value="",t.select())}},_onLostFocus:function(n){Web.AutoComplete.callBaseMethod(this,"_onLostFocus",[n]);this._showDropDown(!1);this._updateClearButton();this._get_isInLookupMode()&&this._originalElementText!=null&&(this.get_element().value=this._originalElementText)},_onTextBoxMouseOver:function(){this._showDropDown(!0)},_onTextBoxMouseOut:function(){this._showDropDown(!1)},_currentCompletionWord:function(){if(this._completionWord){var n=this._completionWord;return this._completionWord=null,n}return Web.AutoComplete.callBaseMethod(this,"_currentCompletionWord")},_onTimerTick:function(n,t){var i,r;if(this._timer.set_enabled(!1),this._servicePath&&this._serviceMethod){if(i=this._currentCompletionWord(),i.trim().length<this._minimumPrefixLength){this._currentPrefix=null;this._update("",null,!1);return}if(this._currentPrefix!==i||i==""&&this._minimumPrefixLength==0){if(this._currentPrefix=i,i!=""&&this._cache&&this._cache[i]){this._update(i,this._cache[i],!1);return}if(t=new Sys.CancelEventArgs,this.raisePopulating(t),t.get_cancel())return;r={prefixText:this._currentPrefix,count:this._completionSetCount};this._useContextKey&&(r.contextKey=this._contextKey);this._webRequest&&(this._webRequest.get_executor().abort(),this._webRequest=null);this._invoke(r,i);$common.updateFormToRefreshATDeviceBuffer()}}},_get_contextInfo:function(){var n=this.get_contextKey().match(/^(\w+)\:(\w+),(\w+)$/);return n?{type:n[1],controller:n[2],fieldName:n[3]}:null},_invoke:function(t,i){var o=this,s=o._get_contextInfo(),f,c,d,e,l,b;if(s){var u=n.find(s.controller),h=[],y=s.fieldName,k="beginswith";if(s.type=="SearchBar"?h=u._createSearchBarFilter(!0):s.type=="Filter"?h=u.get_filter():(f=u.findField(this.get_fieldName()),y=r(f.ItemsDataTextField)?f.Name:f.ItemsDataTextField),!this._ignoreCompletionWord){for(c=0;c<h.length;c++)if(d=h[c].match(/^(\w+):/),d[1]==s.fieldName){Array.removeAt(h,c);break}f||(f=u.findField(y));f&&f.AutoCompleteAnywhere&&(k="contains");Array.add(h,String.format('{0}:${1}${2}\0',y,k,this._currentCompletionWord()))}var p=null,a=null,v=null,w,g;if(s.type=="Field"){if(a=f.ItemsDataController,v=f.ItemsDataView||"grid1",w=[f.ItemsDataTextField],f.Copy)while(g=n._fieldMapRegex.exec(f.Copy))w.push(g[2]);for(e={FieldName:f.Name,Controller:u.get_controller(),View:u.get_viewId()},l=u.get_contextFilter(f),c=0;c<l.length;c++)b=l[c],Array.add(h,String.format('{0}:={1}\0',b.Name,b.Value));p={PageIndex:0,RequiresMetaData:!0,RequiresRowCount:!1,PageSize:300,FieldFilter:w,SortExpression:f.ItemsDataTextField,Filter:h,ContextKey:u.get_id(),FilterIsExternal:l.length>0,LookupContextFieldName:e?e.FieldName:null,LookupContextController:e?e.Controller:null,LookupContextView:e?e.View:null,LookupContext:e,View:u.get_viewId(),Tag:u.get_tag(),MetadataFilter:["fields"],ExternalFilter:l}}else a=u.get_controller(),v=u.get_viewId(),p={FieldName:s.fieldName,Filter:h,LookupContextFieldName:e?e.FieldName:null,LookupContextController:e?e.Controller:null,LookupContextView:e?e.View:null,AllowFieldInFilter:this._ignoreCompletionWord!=!0,Controller:a,View:v,Tag:u.get_tag(),ExternalFilter:u.get_externalFilter()};u._busy(!0);o._webRequest=u._invoke(o.get_serviceMethod(),{controller:a,view:v,request:p},function(n,t){s.type=="Field"?(u._busy(!1),o._onGetPageComplete(n,t)):(u._busy(!1),o._onGetListOfValuesComplete(n,t))},i);o._ignoreCompletionWord=!1}else o._webRequest=Sys.Net.WebServiceProxy.invoke(o.get_servicePath(),o.get_serviceMethod(),!1,t,Function.createDelegate(o,o._onMethodComplete),Function.createDelegate(o,o._onMethodFailed),i)},_onGetListOfValuesComplete:function(n,t){n.length>0&&n[0]==null&&(n[0]=h.EmptyValue);this._webRequest=null;this._update(t,n,!0)},_onGetPageComplete:function(n,t){if(this._element){this._viewPage=n;var i=this._enumerateViewPageItems();this._onGetListOfValuesComplete(i,t)}},_enumerateViewPageItems:function(n){for(var i,f,e,r=this._viewPage,s=this._get_fieldDataView(),o=s.findField(this.get_fieldName()),u=[],t=0;t<r.Fields.length;t++)i=r.Fields[t],i.Index=t,i.Type||i.Type==="String",i.Name===o.ItemsDataTextField&&Array.add(u,i);if(!u.length)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden&&i.Type==="String"){Array.add(u,i);break}if(!u.length)for(t=0;t<r.Fields.length;t++)if(i=r.Fields[t],!i.Hidden){Array.add(u,i);break}for(f=[],o.AllowNulls&&Array.add(f,w),t=0;t<r.Rows.length;t++)if(e=r.Rows[t][u[0].Index],n!=null){if(e===n)return t}else Array.add(f,e);return n!=null?-1:f},get_typeCssClass:function(){return this._typeCssClass},set_typeCssClass:function(n){this._typeCssClass=n}};n.hideMessage=function(){n.showMessage()};n.formatMessage=function(n,t){return String.format('<table cellpadding="0" cellspacing="0" ><tr><td class="{0}" valign="top">&nbsp;<\/td><td class="Message">{1}<\/td><\/tr><\/table>',n,t)};n.showMessage=function(i){var u,r,f,s,h,e,o;t?t.notify({text:i,force:!0,duration:"medium"}):(y(i)&&(i=null),u=document.getElementsByTagName("body")[0],n.MessageBar||(r=document.createElement("div"),r.id="DataView_MessageBar",u.appendChild(r),Sys.UI.DomElement.setVisible(r,!1),Sys.UI.DomElement.addCssClass(r,"MessageBar"),n.MessageBar=$create(AjaxControlToolkit.AlwaysVisibleControlBehavior,{VerticalOffset:AjaxControlToolkit.VerticalSide.Top},null,null,r),f=Sys.UI.DomElement.getBounds(u),f.y<0&&(f.y=0),n.OriginalBodyTopOffset=f.y),r=$get("DataView_MessageBar"),s=Sys.UI.DomElement.getVisible(r),r.innerHTML=i?String.format('<div>{0}<\/div><div class="Stub"><\/div>',i):"",Sys.UI.DomElement.setVisible(r,i!=null),h=Sys.UI.DomElement.getBounds(r),e=i?n.OriginalBodyTopOffset+h.height:n.OriginalBodyTopOffset,u.style.paddingTop=e+"px",o=$get("Membership_Login"),o&&(o.style.marginTop=e+"px"),Sys.UI.DomElement.getVisible(r)!==s&&_body_performResize())};n._tagsWithIndexes=["A","AREA","BUTTON","INPUT","OBJECT","SELECT","TEXTAREA","IFRAME"];n._delayedLoadingViews=[];n._performDelayedLoading=function(){for(var r=0,i=n._delayedLoadingViews,t,u,e,f;r<i.length;)t=i[r],u=t._filterSource,t.get_isDisplayed()?(Array.remove(i,t),t._delayedLoading&&(u&&(f=n.find(u),f&&f._busy()&&(e=!0)),e||t._loadPage())):r++;i.length||(clearInterval(n._delayedLoadingTimer),n._delayedLoadingTimer=null)};n.unanchor=function(n){var t=n.match(/^(.+?)#.*$/);return t?t[1]:n};n.ensureJSONProperties=["OldValue","NewValue","Value"];n.ensureJSONCompatibility=function(t){$(t).each(function(){var t=this;$(n.ensureJSONProperties).each(function(){var i=this;t[i]&&t[i].getTimezoneOffset&&(t[i]=n.stringifyDate(t[i]))})})};n.stringifyDate=function(n){var i,t;return nr(n)?(i=o.Calendar.convert,i&&(t=i.toGregorian(n.getFullYear(),n.getMonth(),n.getDate()),t&&(t.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),n=t)),Date._localTimeEnabled())?n.toISOString():String.format("{0}-{1:d2}-{2:d2}T{3:d2}:{4:d2}:{5:d2}.{6:d3}",n.getFullYear(),n.getMonth()+1,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()):n};n.isISO8601DateString=function(n){return typeof n=="string"&&n.match(/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)};n.csv={delimiter:",",toString:function(n){return n.forEach(function(t,i){if(t==null)t="";else{t=t.toString();var r;t.match(/\"/)?(r=!0,t=t.replace(/\"/g,'""')):t.match(/(\r|\n|,)/)&&(r=!0);r&&(t='"'+t+'"')}n[i]=t}),n.join(",")},toArray:function(t){return n.csv.toData(t)[0]},toData:function(t){var u=n.csv.delimiter,r=[[]],i=null,f,e,o=new RegExp("(\\"+u+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+u+"\\r\\n]*))","gi");if(t!=null&&t.length)while(i=o.exec(t))f=i[1],f.length&&f!==u&&r.push([]),e=i[2]?i[2].replace(new RegExp('""',"g"),'"'):i[3],r[r.length-1].push(e);return r}};n.addon=function(n,t,i){return $.ajax({url:__servicePath+"/Addon",data:et({type:n,method:t,args:i}),method:"POST",cache:!1})};n.resolveClientUrl=function(n,t){return t||(t=this._baseUrl||(typeof __baseUrl=="string"?__baseUrl:"")),n?n.replace(/~\x2f/g,t):null};n.execute=function(t){function u(){i.dispose();v.remove()}function f(){i._busy(!1)}function p(i){t.nativeDates===!1&&(n._deserializeDates=!0);t.success?t.success(i):l.resolve(i)}var h,e,a;t.done&&(t.success=t.done);t.fail&&(t.error=t.fail);var v=$("<p>"),c=t.externalFilter,i=$create(Web.DataView,{controller:t.controller,viewId:t.view||"grid1",servicePath:t.url||(typeof __servicePath=="string"?__servicePath:""),baseUrl:typeof __baseUrl=="string"?__baseUrl:"",useCase:"$app",tags:t.tags,externalFilter:c,filterSource:t.filterSource||(c&&c.length?"External":null)},null,null,v.get(0)),o=t.sync,r={},s,y=t.requiresNewRow,l=$.Deferred();if(t.nativeDates===!1&&(n._deserializeDates=!1),i._api=r,i.odp=t.odp===!1?!1:n.odp.get(),o&&(i._syncKey=Array.isArray(o)?o:[o]),t.requiresData===!1&&(r.DoesNotRequireData=!0),t.background&&(r.background=!0),r.requiresAggregates=t.requiresAggregates===!0,r.metadataFilter=t.metadataFilter||["fields"],t.fieldFilter&&(r.fieldFilter=t.fieldFilter),i._onMethodFailed=function(i,r){f();n._deserializeDates=!0;t.error?t.error(i,r):l.reject(i,r);u()},i._onGetPageComplete=function(n){var e=!!t.batch;e||f();var r={totalRowCount:n.TotalRowCount,pageIndex:n.PageIndex,pageSize:n.PageSize},h=r[n.Controller]=[],c=t.format,s=[],o={};if($(n.Fields).each(function(n){var t=this;t.IsPrimaryKey&&s.push(t);ii(t);t.OriginalIndex=t.AliasIndex=t.Index=n;o[t.Name]=t}),$(n.Fields).each(function(){var n=this,t;n.AliasName&&(t=o[n.AliasName],t&&(n.AliasIndex=t.Index,t.OriginalIndex=n.Index))}),$(n.Fields).each(function(){var n=this;_field_prepareDataFormatString(i,n);n.format=_field_format}),r.primaryKey=s,r.fields=n.Fields,r.map=o,y&&(n.Rows=[n.NewRow]),$(n.Rows).each(function(){var i=this,t={};h.push(t);$(n.Fields).each(function(n){var u=this,r=i[n];c&&u.DataFormatString&&u.FormatOnClient&&(u.Type.match(/^Date/)&&typeof r=="string"&&(r=Date.fromUTCString(r)),r=u.format(r));t[u.Name]=r})}),this._requiresPivot&&(r.Pivots={},$(n.Pivots).each(function(){r.Pivots[this.Name]=this})),(t.includeRawResponse||e)&&(r.rawResponse=n),e)return r;p(r);u()},t.response){i._onGetPageComplete(t.response);return}if(i._pendingExecuteComplete={},i._onExecuteComplete=function(n){var e=!!t.batch,i,r;if(e||f(),i=n?{rowsAffected:n.RowsAffected,canceled:n.Canceled,clientScript:n.ClientScript,navigateUrl:n.NavigateUrl,errors:n.Errors}:{},r=i[t.controller]={},$(t.values).each(function(){var n=this;r[n.name||n.field]="newValue"in n?n.newValue:"oldValue"in n?n.oldValue:n.value}),n&&$(n.Values).each(function(){r[this.Name]=this.Value}),i.rawResponse=n,e)return i;p(i);u()},t.batch){i._busy(!0);h=[];e=[];$(t.batch).each(function(){var t=this,i,r=!t.command||t.command==="Select";t.skipInvoke=!0;r&&(t.pageIndex==null&&(t.pageIndex=0),t.pageSize==null&&(t.pageSize=100));i=n.execute(t);r?(i.Controller=t.controller,i.View=t.view,h.push(i)):e.push(i)});h.length&&i._invoke("GetPageList",{requests:h},function(n){f();t.success&&($(n).each(function(t){var r=this;n[t]=i._onGetPageComplete(r)}),t.success(n));u()},null);e.length&&i._invoke("ExecuteList",{requests:e},function(n){f();t.success&&($(n).each(function(r){var u=this;t.controller=e[r].Controller;n[r]=i._onExecuteComplete(u)}),t.success(n));u()},null);return}if(i._collectFieldValues=function(){var i=[],r;if(Array.isArray(t.values))$(t.values).each(function(){var t=this,r,u;"Name"in t?i.push(t):(r=n.stringifyDate("oldValue"in t?t.oldValue:t.value),u=n.stringifyDate("newValue"in t?t.newValue:r),i.push({Name:t.name||t.field,NewValue:u,OldValue:r,Modified:typeof t.modified!="undefined"?t.modified===!0:r!=u,ReadOnly:t.readOnly===!0}))});else for(r in t.values)i.push({Name:r,NewValue:t.values[r],OldValue:null,Modified:!0,ReadOnly:!1});return i},i._validateFieldValues=function(){return!0},t.pageIndex!=null&&(i._pageIndex=t.pageIndex),t.pageSize==null&&(t.pageSize=100),t.sort&&(t.sortExpression=t.sort),i._pageSize=t.pageSize,t.selectedValues&&(i.SelectedValues=t.selectedValues),t.selectedKeys&&(i.multiSelect(!0),i.set_selectedValue(t.selectedKeys.join(";"))),t.lastCommand&&i.set_lastCommandName(t.lastCommand),t.lastCommandArgument&&i.set_lastCommandArgument(t.lastCommandArgument),y&&(r.inserting=!0),t._init=!0,i.search(t),t._filter&&(i._filter=t._filter),i._filterDetailsText=t.filterDetails,t.command||(t.command="Select"),t.command==="Pivot"&&(t.command="Select",i._requiresPivot=!0,t.pivotDefinitions))for(s in t.pivotDefinitions)t.pivotDefinitions[s].length>0&&(i._pivotDefinitions+=";"+s+"="+t.pivotDefinitions[s].join());return(t.requiresRowCount&&(i._requiresRowCount=!0),i._lookupContext=t.lookupContext,t.distinct&&(i._distinctValues=!0),a=t.skipInvoke,a&&(i._skipInvoke=!0),t.command==="Select"?i._loadPage():i.executeCommand({commandName:t.command,commandArgument:t.argument||"",causesValidation:!1,trigger:t.trigger}),a)?(u(),i._invokeArgs):l.promise()};n.data=function(t){var i=t.d.Controller,r=t.id;n.execute({format:t.format,response:t.d,controller:i,success:function(t){var u=t[i],f;delete t[i];t.controller=i;u._metadata=t;u._metadata.id=r;n.data[r]=u;f=n.data.objects;f||(f=n.data.objects=[]);f.push(u)}})};n.dataBind=function(t,i){n.data.objects&&t.find("[data-control]").addBack("[data-control]").each(function(){var t=$(this),a=t.data("processed"),c,l,u,s,h;if(!a){t.data("processed",!0);var f=t.data("control"),e=t.data("source"),o=t.data("field"),r=i[i.length-1];if(f=="form")c=i.concat([n.data[e]]),t.children().each(function(){n.dataBind($(this),c)});else if(f=="repeater")e&&(r=n.data[e]),t.removeAttr("data-control data-source"),l=t[0].innerHTML,t.empty(),$(r).each(function(){var r=i.slice(0),u=$(l).appendTo(t);r.push(this);n.dataBind(u,r)});else if(o)switch(f){case"label":for(u=i.length;u--;u>=0)if(s=i[u],s._metadata){$(s._metadata.fields).each(function(){if(this.Name==o)return t.text(this.Label),!1});break}break;case"field":$.isArray(r)&&(r=r[0]);h=r&&r[o];h==null?t.text(""):t.text(h)}}})};p=n.findDataView=function(t){return t&&t._controller?t:n.find(t,"Id")};n.find=function(t,i){var e,u,r,o=arguments.length===1||i==="Id",s=Sys.Application,f;if(!t)return null;if(o&&(r=s._components[t],i==="Id"))return r;if(!r){for(f=s.getComponents(),e="_"+t,u=0;u<f.length;u++)if(r=f[u],i){if(d(n,r)&&(i==="Controller"&&r._controller===t||i==="Tag"&&r.get_isTagged(t)))return r}else if(d(n,r)&&r._id.endsWith(e))return r;o&&(r=n.find(t,"Controller"))}return r};n.confirm=function(n,t,i){var r=$.Deferred();return window.confirm(n)?t?t():r.resolve():i?i():r.reject(),r};n.alert=function(n,t){var i=$.Deferred();return window.alert(n),t?t():i.resolve(),i};n.eval=function(n){if(n)for(var t=n.match(ui);t;)n=n.substring(0,t.index)+eval(t[1])+n.substring(t.index+t[0].length),t=n.match(ui);return n};n.showModal=function(i,r,u,f,e,o,s,h,c){var b=d(n,i),y=i,k,p,l,a,v,tt,it,g,rt;if(!t){if(b&&i._container&&(y=i._container.getElementsByTagName("a")[0]),!y)for(k=document.getElementsByTagName("a","input","button"),p=k.length-1;p>=0;p--)if(k[p].tabIndex>=0){y=k[p];break}if(y==null){alert("Cannot find an anchor for a modal popup.");return}kt()}if(t){if(t.busy())return;t.modalDataView()}o||(o=n._baseUrl);s||(s=n._servicePath);for(var w=this._placeholder=document.createElement("div"),ut=r.toLowerCase().replace(/\_+/g,"-"),nt=ut,ft=1;Sys.Application._components[nt];)nt=ut+ft++;return w.id=String.format("{0}_{1}_Placeholder{2}",r,u,Sys.Application.getComponents().length),b?i._appendModalPanel(w):document.body.appendChild(w),w.className="ModalPlaceholder FixedDialog EmptyModalDialog",a={id:nt,baseUrl:o,servicePath:s,controller:r,viewId:u,showActionBar:!1,modalAnchor:y,startCommandName:f,startCommandArgument:e,exitModalStateCommands:["Cancel"],externalFilter:h},c&&(c.useCase||(c.useCase=n._defaultUseCase,n._defaultUseCase=null),a.filter=c.filter,a.ditto=c.ditto,a.lastViewId=c.lastViewId,a.filterSource=c.filterSource,a.filterFields=c.filterFields,a.confirmContext=c.confirmContext,a.showSearchBar=c.showSearchBar,a.useCase=c.useCase,a.tag=c.tag,a.showActionButtons=c.showActionButtons,l=a.survey=c.survey),v=$create(Web.DataView,a,null,null,w),tt=b?i._dataText:null,b&&(it=i._id,g=i._externalFilter,t&&t.pageInfo(i._id).deleted&&(it=i._parentDataViewId,g&&g.length&&(v._externalFilter=g)),v._parentDataViewId=it,v._hasDetails=i._hasDetails),t&&tt&&(rt=t.pageInfo(v._id),rt.headerText=tt,rt.headerTextLocked=!0),t&&(t._dataText=null),l?(l.text2&&typeof l.text2=="function"&&(l.text2=l.text2.call(v)),l.text&&typeof l.text=="function"&&(l.text=l.text.call(v)),!l.text&&l.text2&&(l.text=l.text,l.text2=null),l.text2?t?l.text=[l.text,l.text2]:l.text+=" - "+l.text2:l.text=l.text,l.description&&(v.set_showDescription(!0),v.set_description(l.description)),l.compiled=function(n){t?(l.result=n,t.modalDataView(a.id,!0)):v._onGetPageComplete(n)},n.survey("compile",l)):t&&t.modalDataView(a.id,!0),v};n.alert=function(n,t){alert(n);t&&t()};n._resizeInterval=null;n._resizing=!1;n._resized=!1;n._customInputElements=[];n.contentFrameworks={bootstrap:{hasSelectors:[{name:"navbar-fixed-top",selector:".navbar-fixed-top"},{name:"navbar-fixed-bottom",selector:".navbar-fixed-bottom"},{name:"navbar-static-top",selector:".navbar-static-top"},{name:"footer",selector:"footer"}],footer:{selector:"footer,.footer",content:{html:'<footer><div class="container"><\/div><\/footer>',selector:".container"}},fixedTop:{selector:".navbar-fixed-top"},fixedBottom:{selector:".navbar-fixed-bottom"}}};n.filterDef=function(t,i){var u,r,f;for(i.endsWith("$")&&(i=i.substring(0,i.length-1)),u=0;u<t.length;u++)if(r=t[u],r)if(r.List){if(f=n.filterDef(r.List,i),f)return f}else if(r.Function==i)return r;return null};n._invoke=function(n,t,i,r){var f=$("<p>"),u=$create(Web.DataView,{servicePath:__servicePath,baseUrl:__baseUrl,useCase:"$app"},null,null,f.get(0));u._busy(!0);u._invoke(n,t,function(n){u._busy(!1);i&&i(n);u.dispose();f.remove()},null,r)};n.callWithFeedback=function(n,i){t?t.callWithFeedback(n,i):i()};n.sizeToText=pi;n.cms={contentTypes:{"sys/rules/":{survey:"cms/rules/rule-wizard",text:"Business Rule"},"sys/saas":{survey:"cms/oauth/oauth-wizard",text:"Open Authentication Registration"}},edit:function(i){var r,u;t&&(r=i.Path);for(u in at)if(r&&r.startsWith(u))return n.survey({controller:at[u].survey,context:i}),!0},"new":function(){t&&n.survey({controller:"cms/new",context:{}})},items:function(){var n=[{value:"$custom",text:"(custom)"}];for(var t in at)n.push({value:at[t].survey,text:at[t].text});return n}};at=n.cms.contentTypes;n.userName=function(){return __settings.appInfo.split("|")[1]};n.userId=function(){return __settings.appInfo.split("|")[2]};n.loggedIn=function(){return!!n.userName()};n.login=function(t,i,r,u,f){n._invoke("Login",{username:t,password:i,createPersistentCookie:n.AccountManager.enabled()?!1:r},function(t){t&&t!="false"?(t!="true"&&(r||(t.session=!0),n.AccountManager.set(t)),u&&u()):f&&f()})};n.switchUser=function(t,i,r){n._invoke("Login",{username:t.name,password:"token:"+t.refresh_token,createPersistentCookie:!1},function(u){u?(u!="true"&&n.AccountManager.set(hi(t,u)),i&&i(u)):r&&r()})};n.refreshUserToken=function(t,i,r){n._invoke("Login",{username:t.name,password:"token:"+t.refresh_token,createPersistentCookie:!1},function(u){u?(u!="true"&&n.AccountManager.set(hi(t,u)),i&&i(u)):r&&r()})};n.logout=function(t){n.AccountManager.remove(n.userName());n._invoke("Logout",{},function(){t&&t()})};n.roles=function(t){n._invoke("Roles",{},function(n){t&&t(n)})};n.configureFramework=function(t,i,r){$(n.contentFrameworks[t]).each(function(){var n=this;$(n.hasSelectors).each(function(){i.find(this.selector).length&&i.addClass("has-"+this.name)});n.footer&&!i.find(n.footer.container).find(n.footer.selector).length&&$(n.footer.content.html).appendTo(i).find(n.footer.content.selector).append($("#PageFooterBar,footer small").html());r&&r(n)})};n.borderBox=function(n){var t=$(n);return{horizontal:t.outerWidth()-t.innerWidth(),vertical:t.outerHeight()-t.innerHeight()}};n.paddingBox=function(n){var t=$(n);return{horizontal:t.innerWidth()-t.width(),vertical:t.innerHeight()-t.height()}};n.marginBox=function(n){var t=$(n);return{horizontal:t.outerWidth(!0)-t.outerWidth(),vertical:t.outerHeight(!0)-t.outerHeight()}};n.bounds=function(n){var t=$(n),i=t.offset();return{x:i.left,y:i.top,width:t.outerWidth(),height:t.outerHeight()}};n.scrolling=function(){return{x:rt.scrollLeft(),y:rt.scrollTop()}};n.clientBounds=function(){return{width:rt.width(),height:rt.height()}};c._body_hideLayoutContainers=function(){var t,i;if(n._layoutContainers)for(t=0;t<n._layoutContainers.length;t++)i=n._layoutContainers[t],i.width!="100%"&&Sys.UI.DomElement.setVisible($get(i.id),!1)};c._body_resizeLayoutContainers=function(){var u=n._layoutContainers,o,s,c,f,i,t;if(u&&u.length!=0&&(o=$get("PageContent"),o)){var h=n.bounds(o),p=n.paddingBox(o),w=n.borderBox(o),b=n.marginBox(o);for(h.width-=p.horizontal+w.horizontal+b.horizontal,s=u[u.length-1].rowIndex;s>=u[0].rowIndex;){for(c=0,f=0;f<u.length;f++)if(i=u[f],i.rowIndex==s&&!r(i.width)&&(t=$get(i.id),t)){var l=n.paddingBox(t),a=n.borderBox(t),v=n.marginBox(t),y=i.width.match(/(\d+)(%|px|)/),e=y[2]!="%"?parseFloat(y[1]):Math.floor(h.width*parseFloat(y[1])/100);c+=e;e-=l.horizontal+a.horizontal+v.horizontal;i.width!="100%"?(t.style.width=e+"px",Sys.UI.DomElement.setVisible(t,!0)):$(t).removeClass("LayoutContainer").addClass("RowContainer")}if(c<h.width)for(f=0;f<u.length;f++)i=u[f],i.rowIndex==s&&r(i.width)&&(t=$get(i.id),t&&(l=n.paddingBox(t),a=n.borderBox(t),v=n.marginBox(t),e=Math.floor((h.width-c)/i.peersWithoutWidth),e-=l.horizontal+a.horizontal+v.horizontal,e<1&&(e=1),t.style.width=e+"px",Sys.UI.DomElement.setVisible(t,!0)));s--}}};c._body_keydown=function(t){var i,r;if(t.keyCode==Sys.UI.Key.enter&&n._focusedItemIndex!=null){if(i=$find(n._focusedDataViewId),i&&i._get_focusedCell())return;r=$get(n._focusedDataViewId+"_Item"+n._focusedItemIndex);r&&r.tagName=="INPUT"&&r.type=="text"&&r==t.target&&(t.preventDefault(),t.stopPropagation(),i=$find(n._focusedDataViewId),i&&i._valueChanged(n._focusedItemIndex))}};c._body_resize=function(){$getSideBar()&&$("body,.MembershipBarPlaceholder").width("");n._resizeInterval&&clearInterval(n._resizeInterval);n._resizing||n._resized?$closeHovers():n._resizeInterval=setInterval(function(){_body_hideLayoutContainers();_body_resizeLayoutContainers();_body_performResize()},200);n._resized=!1};c._body_scroll=function(){var t=$getSideBar(),f,i,o;if(t){var r=n.scrolling(),s=$common.getClientBounds(),u=$common.getBounds(t);t._originalTop==null&&(t._originalTop=u.y);f=t._originalTop;i=0;n.MessageBar&&(o=$common.getBounds(n.MessageBar._element),f+=i=o.height);r.y>t._originalTop&&u.height+4<=s.height&&r.x==0?(t.style.width=u.width+"px",e.agent==e.InternetExplorer&&e.version<=6?(t.style.top=4+r.y+i+"px",t.style.position="absolute"):(t.style.top=4+i+"px",t.style.position="fixed")):(t.style.top="",t.style.width="",t.style.position="");$("body,.MembershipBarPlaceholder").width($("table#PageBody").outerWidth())}};c._body_createPageContext=function(t){var i=$get("PageContent");if(i){var u=$common.getBounds(i),f=$common.getPaddingBox(i),e=$common.getBorderBox(i),r={height:u.height-f.vertical-e.vertical,scrolling:n.scrolling()};return t!=!1&&(n._pageContext=r),r}};c._body_performResize=function(){var i,o,y,r,s,f,p,h,c,l,u,a;if(n._resizeInterval&&clearInterval(n._resizeInterval),n._resizeInterval=null,$closeHovers(),i=$get("PageContent"),i&&!t){if(o=$common.getClientBounds(),y=$common.getClientBounds(),n.MessageBar&&(r=n.MessageBar._element,$common.getVisible(r)&&(s=$common.getPaddingBox(r),r.style.width=y.width-s.horizontal+"px",f=r.childNodes[0],f.style.height="",p=$common.getBounds(f),h=Math.ceil(o.height*.15),p.height>h&&(f.style.height=h+"px",f.style.overflow="auto"),s=Sys.UI.DomElement.getBounds(r),c=n.OriginalBodyTopOffset+s.height,document.body.style.paddingTop=c+"px",l=$get("Membership_Login"),l&&(l.style.marginTop=c+"px"))),n._resizing=!0,u=n._pageContext,u==null?u=_body_createPageContext(!1):n._pageContext=null,a=n.scrolling(),a.y==0&&(i.style.height="10px"),_body_resizeLayoutContainers(),typeof __cothost=="undefined"){var w=n.bounds(i),b=n.paddingBox(i),k=n.borderBox(i),d=Web.Menu.MainMenuElemId?$get(Web.Menu.MainMenuElemId):null,g=d?$common.getBorderBox(d):null,nt=$get("PageFooterContent"),tt=$get("PageFooterBar"),v=a.y+o.height-w.y-(tt?tt.offsetHeight:0)-(nt?nt.offsetHeight:0)-k.vertical-b.vertical-(g?g.vertical:0);w.height<v&&e.agent==e.Opera&&(v+=k.vertical+b.vertical);!u.scrolling.y||n._numberOfContainers<2?i.style.height=document.body.offsetHeight>o.height?"":v+"px":(i.style.height=u.height+"px",scrollTo(0,u.scrolling.y))}_body_scroll();n._resizing=!1;n._resized=!0}};n._activate=function(t,i,u){var y=new RegExp("^\\s*"+u+"\\s*\\|"),f=$get(i),o,s,e,c,h,l;if(u==="SideBarTask"){for(o=f;o&&r(this.prototype.dataAttr(o,"flow"));)o=o.parentNode;for(s=o.getElementsByTagName("div"),e=0;e<s.length;e++)c=this.prototype.dataAttr(s[e],"activator"),!r(c)&&y.exec(c)&&$(s[e]).hide()}if(Sys.UI.DomElement.setVisible(f,u==="SideBarTask"?!0:!Sys.UI.DomElement.getVisible(f)),f._activated=!0,u==="SiteAction"&&f.childNodes[0].className!=="CloseSiteAction"&&(h=document.createElement("div"),h.className="CloseSiteAction",h.innerHTML=String.format("<a href=\"javascript:\" onclick=\"$app._activate(null,'{0}','SiteAction')\">{1}<\/a>",i,ft.Close),f.insertBefore(h,f.childNodes[0])),Sys.UI.DomElement.getVisible(f)){var a=$common.getBounds(f),p=$common.getClientBounds(),v=n.scrolling();(a.y<v.y||a.y>v.y+p.height)&&f.scrollIntoView(!1)}if(t){while(t&&!Sys.UI.DomElement.containsCssClass(t,"Task"))t=t.parentNode;for(e=0;e<t.parentNode.childNodes.length;e++)l=t.parentNode.childNodes[e],l.className&&Sys.UI.DomElement.removeCssClass(l,"Selected");Sys.UI.DomElement.addCssClass(t,"Selected")}_body_performResize()};n._partialUpdateBeginRequest=function(t,i){for(var u,o,c,s=i.get_request(),h=Sys.Application.getComponents(),f=[],e=0;e<h.length;e++)u=h[e],u._controller&&u._viewId&&d(n,u)&&(o=u.get_tag(),r(o)||(Array.add(f,o),Array.add(f,u.get_selectedKey())));c=ot(f);s.set_body(s.get_body()+"&"+encodeURIComponent("__WEB_DATAVIEWSTATE")+"="+encodeURIComponent(c))};n._contentFactories={"site-map":function(n){var r=n.attr("data-start-from-current-node")=="true",t=Web.Menu,i=t.Nodes[t.MainMenuId],u=ci(i),f=$('<ul class="SiteMapPlaceholder"/>').appendTo(n);li(f,r?u.children:i)}};n._load=function(){var a,i,o,ot,h,f,l,st,t,d,g,v,nt,p,ht,tt,w,ct,b,lt,at;if(!n._loaded){Sys.WebForms&&Sys.WebForms.PageRequestManager._instance&&Sys.WebForms.PageRequestManager._instance.add_beginRequest(n._partialUpdateBeginRequest);n._loaded=!0;updateACT();typeof __baseUrl=="undefined"&&(__baseUrl="../");$("#PageHeaderSideBar .PageLogo").attr("src",__baseUrl+"app_themes/_shared/placeholder.gif");n.supportsPlaceholder="placeholder"in document.createElement("input");var k=$get("PageContent"),vt,yt=[],pt=$("body");if(k){for(pt.find('div[data-app-role="page"]').each(function(){$(this).attr("data-content-framework")&&yt.push($(this).attr("id"))}).each(function(){var t=$(this),e=t.attr("id"),u=location.search.match(/_hash=(\w+)/),f=t.attr("data-content-framework"),i=t.find('> div[data-role="content"]'),r;if(i.length||(i=$('<div data-role="content"><\/div>'),t.contents().appendTo(i),i.appendTo(t)),f&&!vt&&(!u||u[1]===e)){r=$(k).closest("table");t.insertAfter(r);pt.addClass("app-min-md app-min-lg app-theme-"+__settings.ui.theme.accent.toLowerCase());vt=!0;i=t.find('> div[data-role="content"]').addClass("app-bootstrap app-content-desktop");n.configureFramework(f,i);t.css({position:"absolute",top:r.offset().top,width:"100%"});r.hide();t.find("a").each(function(){var i=$(this),n=i.attr("href"),t=n&&n.startsWith("#")&&n.length>1&&n.substring(1);t&&Array.indexOf(yt,t)!==-1&&i.attr("href","?_hash="+t)});$("#PageFooterBar").hide();return}t.remove()}),$(k).find('div[data-role="placeholder"]').each(function(){var t=$(this),i=n._contentFactories[t.attr("data-placeholder")];i&&i(t)}),a=document.body.getElementsByTagName("div"),i=0;i<a.length;i++)if(a[i].className.match(/Loading/)){Sys.UI.DomElement.removeCssClass(a[i],"Loading");break}a=k.getElementsByTagName("div");var s=[],it=0,wt=!1,rt=!1,c=null,ut=[];for(n._numberOfContainers=0,o=n.prototype.dataAttr,i=0;i<a.length;i++){var e=a[i],ft=o(e,"width"),et=o(e,"flow");if(!r(ft)||!r(et)){if($(e).find("div[data-flow]").length)continue;for(et!=="NewColumn"&&et!=="column"&&(e.style.clear="left",it++),r(e.id)&&(e.id="_lc"+s.length),Sys.UI.DomElement.addCssClass(e,"LayoutContainer"),n._numberOfContainers++,ft!=="100%"&&(e.style.overflow="hidden"),Array.add(s,{id:e.id,width:ft,rowIndex:it,peersWithoutWidth:0}),ot=e.getElementsByTagName("div"),h=[],f=0;f<ot.length;f++)l=ot[f],st=o(l,"activator"),r(st)||y(l.innerHTML)||(l.id=r(l.id)?e.id+"$a"+f:l.id,t={elem:l,activator:n.eval(st).split("|"),id:l.id},t.activator[0]=t.activator[0].trim(),t.activator.length===1&&(t.activator[1]=f.toString()),Array.add(h,t));for(f=1;f<h.length;){for(t=h[f],d=0;d<f;d++)if(g=h[d],g.activator[0]==t.activator[0]&g.activator[1]==t.activator[1]){while(t.elem.childNodes.length>0)g.elem.appendChild(t.elem.childNodes[0]);delete t.elem;Array.removeAt(h,f);t=null;break}t&&f++}if(h.length>0){for(wt=!0,v=[],nt=!0,f=0;f<h.length;f++)t=h[f],t.activator[0]==="Tab"?(v.length||(p=document.createElement("div"),p.className="TabBar",e.insertBefore(p,t.elem)),ht={title:t.activator[1],elementId:t.id,selected:v.length==0,description:o(t.elem,"description"),hidden:o(t.elem,"hidden")},Array.add(v,ht),Sys.UI.DomElement.setVisible(t.elem,ht.selected),t.elem._activated=!0,Sys.UI.DomElement.addCssClass(t.elem,"TabBody TabContainer")):t.activator[0]==="SideBarTask"?(c||(c=new Sys.StringBuilder,c.appendFormat('<div class="TaskBox TaskList"><div class="Inner"><div class="Header">{0}<\/div>',u.Menu.Tasks)),t.elem._activated=nt,nt&&(nt=!1),Sys.UI.DomElement.setVisible(t.elem,t.elem._activated),c.appendFormat("<div class=\"Task{1}\"{4}><a href=\"javascript:\" onclick=\"$app._activate(this,'{2}','SideBarTask');return false;\" title='{3}'>{0}<\/a><\/div>",t.activator[1],rt?"":" Selected",t.id,n.htmlAttributeEncode(o(t.elem,"description")),o(t.elem,"hidden")=="true"?' style="display:none"':""),rt=!0):t.activator[0]==="SiteAction"&&Web.Menu.get_siteActionsFamily()?(tt=new Web.Item(Web.Menu.get_siteActionsFamily(),t.activator[1],o(t.elem,"description")),tt.set_cssClass(o(t.elem,"cssClass")),tt.set_script('$app._activate(null,"{0}","SiteAction")',t.id),Array.add(ut,tt),Sys.UI.DomElement.setVisible(t.elem,!1)):Sys.UI.DomElement.setVisible(t.elem,!1),t.elem=null;v.length>0&&($create(Web.Menu,{id:e.id+"$ActivatorMenu",nodes:v},null,null,p),v.length<2&&!i&&Sys.UI.DomElement.addCssClass(p,"EmptyTabBar"))}}}for(wt&&n._performDelayedLoading(),rt&&c&&(w=$getSideBar(),w&&(c.append("<\/div><\/div>"),ct=document.createElement("div"),ct.innerHTML=c.toString(),c.clear(),w.insertBefore(ct,w.childNodes[0]),w._hasActivators=!0)),ut.length>0&&Web.Menu.set_siteActions(ut),b=it;s.length>0&&b>=s[0].rowIndex;){for(lt=0,at=0,i=0;i<s.length;i++)lc=s[i],lc.rowIndex==b&&(at++,r(lc.width)&&lt++);for(i=0;i<s.length;i++)lc=s[i],lc.rowIndex===b&&(lc.peersWithoutWidth=lt,at===1&&r(lc.width)&&(lc.width="100%"));b--}n._layoutContainers=s;_body_performResize();$addHandler(window,"resize",_body_resize);$addHandler(window,"scroll",_body_scroll)}n._startDelayedLoading();$addHandler(document.body,"keydown",_body_keydown)}};n._unload=function(){this._state&&(Array.clear(this._state),delete this._state);n._delayedLoadingTimer&&(clearInterval(n._delayedLoadingTimer),Array.clear(n._delayedLoadingViews),delete n._delayedLoadingViews);$get("PageContent")&&($removeHandler(window,"resize",_body_resize),$removeHandler(window,"scroll",_body_scroll));$removeHandler(document.body,"keydown",_body_keydown)};n._startDelayedLoading=function(){n._delayedLoadingViews.length>0&&!n._delayedLoadingTimer&&(n._delayedLoadingTimer=setInterval(function(){n._performDelayedLoading()},500))};n._updateBatchSelectStatus=function(n,t){for(var r=t?"Item":"Cell",i=n.parentNode;i!=null&&!Sys.UI.DomElement.containsCssClass(i,r);)i=i.parentNode;i&&(n.checked?Sys.UI.DomElement.addCssClass(i,"BatchEditFrame"):Sys.UI.DomElement.removeCssClass(i,"BatchEditFrame"))};n.highlightFilterValues=function(n,t,i){while(n&&n.tagName!=="TABLE")n=n.parentNode;n&&(t&&!n.className.match(i)?Sys.UI.DomElement.addCssClass(n,i):!t&&n.className.match(i)&&Sys.UI.DomElement.removeCssClass(n,i))};n.get_commandLine=function(){var t=n._commandLine;return t||(typeof __dacl!="undefined"&&(t=__dacl),t||(t=typeof Web.Membership!="undefined"&&Web.Membership._instance?Web.Membership._instance.get_commandLine():null,t=t?location.pathname+"?"+t:location.href),n._commandLine=n.unanchor(t)),t};n._parse=function(){(t=n.touch,this._parsed)||(this._parsed=!0,$("div[data-controller]").each(function(){var n=$(this),i=n.attr("data-controller"),t,r,u;i&&(t=n.attr("id"),t||(t=i),r={id:t,controller:i,baseUrl:__baseUrl,servicePath:__servicePath,showSearchBar:!0},u=[{name:"autoHide",aliases:["nothing","self","container"],values:[0,1,2]},{name:"autoSelectFirstRow",type:"bool"},{name:"autoHighlightFirstRow",type:"bool"},{name:"filterSource"},{name:"filterFields"},{name:"pageSize",type:"int"},{name:"refreshInterval",type:"int"},{name:"searchByFirstLetter",type:"bool",propName:"showFirstLetters"},{name:"searchOnStart",type:"bool"},{name:"selectionMode",aliases:["single","multiple"],values:["Single","Multiple"]},{name:"showActionBar",type:"bool"},{name:"showActionButtons",aliases:["","none","top","bottom","top-and-bottom"],values:["Auto","None","Top","Bottom","TopAndBottom"]},{name:"showDetailsInListMode",type:"bool"},{name:"showDescription",type:"bool"},{name:"showInSummary",type:"bool"},{name:"showModalForms",type:"bool"},{name:"showQuickFind",type:"bool"},{name:"showPageSize",type:"bool"},{name:"showPager",aliases:["none","top","bottom","top-and-bottom"],values:["None","Top","Bottom","TopAndBottom"]},{name:"showRowNumber",type:"bool"},{name:"showSearchBar",type:"bool"},{name:"showViewSelector",type:"bool"},{name:"startCommandName"},{name:"startCommandArgument"},{name:"summaryFieldCount",type:"int"},{name:"tag"},{name:"tags"},{name:"view",propName:"viewId"},{name:"visibleWhen"}],$(u).each(function(){var t=this,i=n.attr("data-"+t.name.replace(/([A-Z])/g,"-$1"));i&&(t.aliases&&(i=t.values[Array.indexOf(t.aliases,i.toString().toLowerCase())]),t.type=="bool"&&(i=i=="true"),t.type=="int"&&(i=tt(i)),r[t.propName||t.name]=i)}),n.attr("id",null),$create(Web.DataView,r,null,null,this))}))};n.DetailsRegex=/\/Details\.aspx\?/i;n.LocationRegex=/^(_.+?):(.+)$/;n.LEVs=[];n.Editors=[];n.EditorFactories={};n.dateFormatStrings={"{0:g}":o.ShortDatePattern+" "+o.ShortTimePattern,"{0:G}":o.ShortDatePattern+" "+o.LongTimePattern,"{0:f}":o.LongDatePattern+" "+o.ShortTimePattern,"{0:u}":o.SortableDateTimePattern,"{0:U}":o.UniversalSortableDateTimePattern};Sys.Application.add_load(function(){t||n._parse()});$.mobile||(Sys.Application.add_load(n._load),Sys.Application.add_unload(n._unload));c.$createDataView=function(n,t,i){var u={id:t+"Extender",controller:t,baseUrl:"./",servicePath:"Services/DataControllerService.asmx"},r;if(i)for(r=0;r<i.length;r++)u[i[r].name]=i[r].value;$create(Web.DataView,u,null,null,$get(n))};c.updateACT=function(){var i,r,t,u;Sys.Extended&&typeof AjaxControlToolkit=="undefined"&&(AjaxControlToolkit=Sys.Extended.UI);Web.AutoComplete.registerClass("Web.AutoComplete",AjaxControlToolkit.AutoCompleteBehavior);e.WebKit={};navigator.userAgent.indexOf("WebKit/")>-1&&(e.agent=e.WebKit,e.version=parseFloat(navigator.userAgent.match(/WebKit\/(\d+(\.\d+)?)/)[1]),e.name="WebKit");e.agent==e.InternetExplorer||e.agent==e.Firefox||e.agent==e.Opera||Sys.Extended||($common.old_getBounds=$common.getBounds,$common.getBounds=function(t){var r=$common.old_getBounds(t),i=n.scrolling();return(i.y||i.x)&&(r.x+=i.x,r.y+=i.y),r});i=AjaxControlToolkit.CalendarBehavior;i&&!i.prototype.old_show&&(i.prototype.old_show=i.prototype.show,i.prototype.show=function(){function i(){r.position({my:"left "+(t?"bottom":"top"),at:"left "+(t?"top":"bottom"),of:n})}this.old_show();var r=$(this._container).zIndex(100100),n=$(this._element),t=n.parent().find(".Error:visible").length||n.closest("div.Item").find(".Error:visible").length;i();setTimeout(i,10)},i.prototype.old_raiseDateSelectionChanged=i.prototype.raiseDateSelectionChanged,i.prototype.raiseDateSelectionChanged=function(){this.old_raiseDateSelectionChanged();this._element.focus()});r=AjaxControlToolkit.TabContainer;r&&!r.prototype.old_set_activeTabIndex&&(r.prototype.old_set_activeTabIndex=r.prototype.set_activeTabIndex,r.prototype.set_activeTabIndex=function(n){var t=this.get_activeTabIndex();this._headerAssigned||(this._headerAssigned=!0,Sys.UI.DomElement.addCssClass(this._element.getElementsByTagName("div")[0],"tab-header"));this.old_set_activeTabIndex(n);n!==t&&_body_performResize()});t=AjaxControlToolkit.AutoCompleteBehavior;t&&!t.prototype.old_dispose&&(t.prototype.old_dispose=t.prototype.dispose,t.prototype.dispose=function(){this.old_dispose();this._completionListElement&&(this._completionListElement.parentNode.removeChild(this._completionListElement),delete this._completionListElement)},t.prototype.old__handleFlyoutFocus=t.prototype._handleFlyoutFocus,t.prototype._handleFlyoutFocus=function(){this._completionListElement&&this.old__handleFlyoutFocus()},t.prototype.old_showPopup=t.prototype.showPopup,t.prototype.showPopup=function(){var f,r,t,u,e,o;if(this.old_showPopup(),Sys.UI.DomElement.getVisible(this._completionListElement)){if(f=n.scrolling(),this._completionListElement.style.height="",Sys.UI.DomElement.addCssClass(this._completionListElement,"CompletionList"),this._completionListElement.style.width="",this._completionListElement.style.zIndex=200100,r=$common.getClientBounds(),t=$common.getBounds(this._completionListElement),t.width>r.width/3&&(t.width=r.width/3),u=this._element,Sys.UI.DomElement.containsCssClass(u.parentNode,"Input"))while(!Sys.UI.DomElement.containsCssClass(u.parentNode,"AutoCompleteFrame"))u=u.parentNode;var i=$common.getBounds(u),s=$common.getBorderBox(this._completionListElement),h=$common.getPaddingBox(this._completionListElement);t.width<=i.width&&(this._completionListElement.style.width=i.width-s.horizontal-h.horizontal+"px");t=$common.getBounds(this._completionListElement);t.x!==i.x&&(t.x=i.x,this._completionListElement.style.left=t.x+"px");t.y!==i.y&&(t.y=i.y+i.height-1,this._completionListElement.style.top=t.y+"px");t.x+t.width>r.width&&(this._completionListElement.style.left=r.width-t.width+"px");bound=$common.getBounds(this._completionListElement);e=i.y-f.y;o=r.height-(i.y+i.height-f.y);bound.height<=o||o>=e?t.y+t.height-f.y>r.height&&(this._completionListElement.style.height=r.height-(t.y-f.y)-4+"px",this._completionListElement.style.overflow="auto"):e<t.height?(this._completionListElement.style.top=i.y-e+"px",this._completionListElement.style.height=e+"px",this._completionListElement.style.overflow="auto"):this._completionListElement.style.top=i.y-t.height+3+"px"}},u=AjaxControlToolkit.ModalPopupBehavior,u&&!u.prototype.old__attachPopup&&(u.prototype.old__attachPopup=u.prototype._attachPopup,u.prototype._attachPopup=function(){this.old__attachPopup();this._dropShadowBehavior&&(this._dropShadowBehavior.set_Width(4),(e.agent!=e.InternetExplorer||e.version>=9)&&this._dropShadowBehavior.set_Rounded(!0))}))};c.$hoverTab=function(n,t){while(n&&n.tagName!=="TD")n=n.parentNode;n&&(t?(Sys.UI.DomElement.addCssClass(n,"Active"),n.focus()):Sys.UI.DomElement.removeCssClass(n,"Active"))};c.$getSideBar=function(){var t=$get("PageContentSideBar"),n,i;if(!t)return null;for(n=0;n<t.childNodes.length;n++)if(i=t.childNodes[n],i.className==="SideBarBody")return i;return null};c.$dvget=function(t,i,r,u){for(var e,s,h,c=Sys.Application.getComponents(),l="_"+t,o=null,f=0;f<c.length;f++)if(e=c[f],e._id===t||d(n,e)&&(e._id.endsWith(l)||e._controller===t&&(!i||e.get_viewId()===i))){o=e;break}if(o){if(r){if(s=o.findField(r),s){if(u){if(element=$get(o._id+"_ItemContainer"+s.Index),element)for(f=0;f<element.childNodes.length;f++)if(h=element.childNodes[f],h.className==="Value")return h}else return $get(o._id+"_Item"+s.Index);return element}return null}return o}return null};Sys.UI.DomElement.setFocus=function(n){var t=document.selection;t&&t.type!=="Text"&&t.type!=="None"&&t.clear();n&&(n.focus(),n.select&&n.select(),document.focus&&document.focus())};Sys.UI.DomElement.getCaretPosition=function(n){var t=0,i;return document.selection?(n.focus(),i=document.selection.createRange(),i.moveStart("character",-n.value.length),t=i.text.length):(n.selectionStart||n.selectionStart==="0")&&(t=n.selectionStart),t};Sys.UI.DomElement.setCaretPosition=function(n,t){if(n.setSelectionRange)n.focus(),n.setSelectionRange(t,t);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",t);i.select()}};_field_prepareDataFormatString=function(t,i){if(i.DataFormatString&&i.DataFormatString.indexOf("{")===-1&&(i.DataFormatString="{0:"+i.DataFormatString+"}"),i.DataFormatString&&(i.DataFormatString=t.resolveClientUrl(i.DataFormatString)),i.Type.startsWith("Date"))if(i.DataFormatString){var u=i.DataFormatString.match(/{0:(g)}/i),r;u&&(i.DateFmtStr="{0:"+o.ShortDatePattern+"}",i.TimeFmtStr="{0:"+(u[1]==="g"?o.ShortTimePattern:o.LongTimePattern)+"}");r=n.dateFormatStrings[i.DataFormatString];r&&(i.DataFormatString="{0:"+r+"}");i.DateFmtStr&&(i.DataFmtStr=i.DataFormatString)}else i.DataFormatString="{0:d}"};n._tagTests={};_isTagged=n.is=function(t,i){var r,f,e=!1,u;return t&&(r=n._tagTests[i],r||(r=new RegExp("(^|\\s|,)"+RegExp.escape(i)+"(-(\\w+))?\\b"),n._tagTests[i]=r),f=t.match(r),f&&(u=f[3],u==null?e=!0:u!="none"&&(e=u))),e};_field_is=function(n){return _isTagged(this.Tag,n)};_field_tagged=function(){var i=this.Tag,r,u,f="",e=arguments,t,o;if(i)for(t=0;t<e.length;t++)if(u=e[t],r=i.indexOf(u),r>=0){for(t=r+u.length;t<i.length;)if(o=i[t].match(/\d/),o)f+=i[t++];else break;return n.tagSuffix=f,!0}return!1};_field_tag=function(n){this.Tag=(this.Tag||"")+","+n};_field_lov=function(n){var t=this,i=t.ItemsDataController;return n==="dynamic"?!!i:n==="static"?!i&&!!t.ItemsStyle:t.Items};_field_format=function(n){var t=this,u=t.FormatOnClient,i=t.DataFormatString;try{return n!=null&&t.Type=="TimeSpan"&&i&&u&&typeof n=="string"&&(n=Date.tryParseFuzzyTime(n,!1)),n==null?"null":u&&!r(i)?String.localeFormat(i,n):n.toString()}catch(f){throw new Error(String.format("\nField: {0}\nData Format String: {1}\n{2}",t.Name,i,f.message));}};_field_isReadOnly=function(){return this.TextMode===4||this.ReadOnly};_field_isNumber=function(){return Array.indexOf(["SByte","Byte","Int16","Int32","UInt32","Int64","Single","Double","Decimal","Currency"],this.Type)};_field_htmlEncode=function(){return this.HtmlEncode&&this.TextMode!==2};_field_trim=function(n){var t=this;return t.Type==="String"&&n!=null&&n.length>s.MaxReadOnlyStringLen&&!(t.TextMode===3||t.TextMode===2||!t.HtmlEncode&&n.match(/<\/?\w+>/))&&(n=n.substring(0,s.MaxReadOnlyStringLen)+"..."),n};_field_text=function(t,i){var r=this,u,o,f=w,s=r.DynamicItems||r.Items,e;return s.length?r.ItemsDataController?(u=[],t&&typeof t!="string"&&(t=t.toString()),r.ItemsTargetController||r.ItemsStyle==="CheckBoxList"?(o=(t||"").split(","),$(s).each(function(){var n=this;o.indexOf((n[0]||"").toString())!==-1&&u.push(n[1])})):$((t||"").split(",")).each(function(){var n=r._dataView._findItemByValue(r,this);n&&u.push(n[1])}),u=u.length?u.join(", "):f):t==null?u=f:(e=r._dataView._findItemByValue(r,t),u=e?e[1]:t.toString()):u=y(t)?f:r.Type!=="Byte[]"||r.OnDemand?r.format(t):n.toHexString(t),r.TextMode===1&&(u="**********"),i!==!1&&(u=r.trim(u)),u};Array.indexOfCaseInsensitive=function(n,t){t=t.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==t)return i;return-1};Number.tryParse=function(n){var t,i,u;return typeof n!="string"?null:r(n)?null:(t=Number.parseLocale(n),isNaN(t)&&(i=Sys.CultureInfo.CurrentCulture.numberFormat,i._simplifyRegex||(i._simplifyRegex=new RegExp(String.format("({0}|\\{1})",i.CurrencySymbol.replace(/(\W)/g,"\\$1"),i.CurrencyGroupSeparator),"gi")),u=n.match(/\(/)!=null,n=n.replace(i._simplifyRegex,"").replace(/\(|\)/g,""),n=n.replace(i.CurrencyDecimalSeparator,i.NumberDecimalSeparator),t=Number.parseLocale(n),isNaN(t)&&(t=Number.parseLocale(n.replace(i.PercentSymbol,"")),isNaN(t)||(t/=100))),!isNaN(t))?(u&&(t*=-1),t):null};Date.tryParseFuzzyDate=function(n,t){var i,y,u,f,c,h,l,a,e,s,v;if(r(n))return null;if(n=n.trim(),i=Date.parseLocale(n,o.ShortDatePattern),i==null&&(i=Date.parseLocale(n,o.LongDatePattern)),i!=null||r(t)||(y=t.match(/\{0:([\s\S]*?)\}/),y&&(i=Date.parseLocale(n,y[1]))),i)return i;if(i=new Date,u=n.match(/^(\w+)$/),u&&(f=Array.indexOfCaseInsensitive(o.DayNames,u[1]),f===-1&&(f=Array.indexOfCaseInsensitive(o.AbbreviatedDayNames,u[1])),f===-1&&(f=Array.indexOfCaseInsensitive(o.ShortestDayNames,u[1])),f>=0)){while(i.getDay()!=f)i.setDate(i.getDate()+1);return i}if(u=n.match(/^(\w+|\d+)[^\w\d]*(\w+|\d+)$/),u&&(c=u[1],h=u[2],c.match(/\d+/)&&(c=h,h=u[1]),u=h.match(/\d+/),h=u?u[0]:1,f=Array.indexOfCaseInsensitive(o.MonthNames,c),f==-1&&(f=Array.indexOfCaseInsensitive(o.AbbreviatedMonthNames,c)),f>=0)){for(i.setDate(1);i.getMonth()!=f;)i.setMonth(i.getMonth()+1);return i.setDate(h),i}if(u=n.match(/^(\d\d?)(\D*(\d\d?))?(\D*(\d\d\d?\d?))?$/),!u)return null;try{if(o.LogicalYearPosition||(l=o.ShortDatePattern.indexOf("m"),l<0&&(l=o.ShortDatePattern.indexOf("M")),a=o.ShortDatePattern.indexOf("d"),a<0&&(a=o.ShortDatePattern.indexOf("D")),o.LogicalYearPosition=5,o.LogicalMonthPosition=l<a?1:3,o.LogicalDayPosition=l<a?3:1),e=u[o.LogicalYearPosition],e=r(e)?i.getFullYear():Number.parseLocale(e),!isNaN(e)&&e<50&&(e+=o.Calendar.convert?1400:2e3),s=u[o.LogicalMonthPosition],r(s)?s=i.getMonth():(s=Number.parseLocale(s),s--),v=u[o.LogicalDayPosition],v=r(v)?i.getDate():Number.parseLocale(v),i=new Date(e,s,v),isNaN(i.getTime()))return null}catch(p){return null}return i};Date.tryParseFuzzyTime=function(n,t){var f,i;if(r(n))return null;if(n=n.trim(),f=null,i=n.match(/^(\d\d?)(\D*(\d\d?))?(\s*(\w+))?$/),i||(i=n.match(/^(\d\d?)(\D*(\d\d?))?(\D*(\d\d?))?(\D*(\d+))?(\s*([\S\s]+))?$/)),i){f=new Date;var u=i[1],e=i[3]||"0",s=i.length===10?i[5]:"0",h=i.length===10?i[7]:"0",c=i[i.length-1];r(u)||(u=Number.parseLocale(u),r(c)?t!==!1&&!r(o.PMDesignator)&&o.ShortTimePattern.indexOf("tt")>0&&(new Date).getHours()>=12&&(u+=12):c.toLowerCase()===o.PMDesignator.toLowerCase()?u!==12&&(u+=12):u===12&&(u=0),f.setHours(u));r(e)||f.setMinutes(Number.parseLocale(e));f.setSeconds(r(s)?0:Number.parseLocale(s));f.setMilliseconds(r(h)?0:Number.parseLocale(h))}return f};Date.tryParseFuzzyDateTime=function(n,t){var f,i,u;return(n=n.trim(),f=n.match(/([^\s]+)\s+(.+)/),f)?!r(o.AMDesignator)&&(f[2].toLowerCase()==o.AMDesignator.toLowerCase()||f[2].toLowerCase()==o.PMDesignator.toLowerCase())?Date.tryParseFuzzyTime(n):(i=Date.tryParseFuzzyDate(f[1],t),u=Date.tryParseFuzzyTime(f[2],!0),i||u?i&&!u?i:!i&&u?u:(u.setFullYear(i.getFullYear(),i.getMonth(),i.getDate()),u):null):null};Date._localTimeEnabled=function(){var i=this,n=i._lte;return typeof n!="boolean"&&(n=i._lte=t?t.settings("dates.localTime.enabled")===!0:!1),n===!0};Date._jsonRegex=new RegExp(/(\d{4})\-(\d{2})\-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})\.(\d{3})(Z)?/);Date.fromUTCString=function(n){if(Date._localTimeEnabled())return new Date(n.match(/z$/i)?n:n+"Z");var t=Date._jsonRegex.exec(n),i;return t&&(i=new Date(tt(t[1]),tt(t[2])-1,tt(t[3]),tt(t[4]),tt(t[5]),tt(t[6]),tt(t[7]))),i};n.parseJSON=function(n){return n?eval("("+ai(n)+")").d:null};lt.deserialize=function(n){var t;try{return t=ai(n),eval("("+t+")")}catch(i){throw Error.argument("data",Sys.Res.cannotDeserializeInvalidJson);}};Date.$addDays=function(n,t){return n?new Date(n.setDate(n.getDate()+t)):n};Date.$now=function(){return new Date};Date.$today=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0)};Date.$endOfDay=function(){var n=new Date;return new Date(n.getFullYear(),n.getMonth(),n.getDate(),23,59,59)};Date.$within=function(n,t){return n?n<Date.$addDays(Date.$today(),t)&&n>=Date.$today():!1};Date.$pastDue=function(n,t){return t==null&&(t=new Date),t.getHours()==0&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59)),n==null&&(n=new Date),n>t};Date.prototype.getFullYearText=function(){return o.Calendar.convert?(o.Calendar.convert.fromGregorian(this)||[this.getFullYear()])[0]:this.getFullYear()};c.__designer=function(){return typeof __designerMode!="undefined"};c.__evalEvent=function(n){var t=this.getAttribute("on"+n+"2"),i;return r(t)?!0:(i=!0,t=t.replace(/(^|;)return /g,";returnResult="),eval(t),i)};it=l.BusinessRules=function(n){this._dataView=n;this.result=new Web.BusinessRules.Result(this)};it.reset=function(n){typeof n!="string"&&(n=n._controller);var t=pt[n];t&&(t.forEach(function(n){delete it[n]}),t.splice(0))};pt=it._controllers={};it.prototype={canceled:function(){return this._canceled==!0},trigger:function(){return this._args.trigger},dispose:function(){this.reset(null);this._dataView=null;this.result._rules=null},reset:function(n){this._actionArgs=null;this._args=n},_initialize:function(){if(!this._actionArgs){var n=this._dataView;this._actionArgs=n._createArguments(this._args,null);n.editing()&&(n._validateFieldValues(this._actionArgs.Values,this._args.causesValidation,!1,!0),this._valid=n.validate(this._actionArgs.Values))}},process:function(i){var u=this,o=u._dataView,c=u._args.commandName,l,a,k,f,s,ut,d,g,v,y,ft,w,e,h,p,rt,b;if(c==="Calculate"&&o._lookupIsActive){u.preventDefault();return}if(l=n.Geo,l&&l.acquired&&(c.match(/New|Edit/)||c.match(/Update|Insert/)&&i==="Before")){for(k=this._dataView._fields,f=0;f<k.length;f++)s=k[f],s._geocode&&!s.readOnly&&(s.tagged("modified-latitude")||s.tagged("created-latitude")&&c.match(/New|Insert/)?u.updateFieldValue(s.Name,l.latitude===-1?null:l.latitude):s.tagged("modified-longitude")||s.tagged("created-longitude")&&c.match(/New|Insert/)?u.updateFieldValue(s.Name,l.longitude===-1?null:l.longitude):(s.tagged("modified-coords")||s.tagged("created-coords")&&c.match(/New|Insert/))&&u.updateFieldValue(s.Name,l.latitude===-1?null:String.format("{0},{1}",l.latitude,l.longitude)));if(a=u._newValues,a)if(t){for(ut=o.editRow(),f=0;f<a.length;)g=a[f],d=o.findField(g.Name),d&&ut[d.Index]===g.NewValue?a.splice(f,1):f++;a.length&&n.input.execute({dataView:o,values:a})}else o._updateCalculatedFields({Errors:[],Values:a});u._newValues=null}if(v=o._expressions,y=o._controller,v&&v.length){if(!u._rules)for(u._rules=[],ft=0,f=0;f<v.length;f++)if(w=v[f],w.Type===Web.DynamicExpressionType.ClientScript&&w.Scope===Web.DynamicExpressionScope.Rule&&(e=w.Result.match(/^<id>(.+?)<\/id><command>(.+?)<\/command><argument>(.*?)<\/argument><view>(.*?)<\/view><phase>(.*?)<\/phase><js>([\s\S]+?)<\/js>$/),e)){var nt=String.format("{0}_Rule_{1}",y,e[1]?e[1]:ft),et="Web.BusinessRules."+nt,tt=it[nt];if(!tt)try{tt=eval(u._parseRule(et,e[6]));pt[y]||(pt[y]=[]);pt[y].push(nt)}catch(ot){n.alert(String.format('{0}\n\ncommand: "{1}"\nargument: "{1}"\nview: "{3}"\nphase: "{4}"\n\n{5}',ot.message,e[2],e[3]||"n/a",e[4]||"n/a",e[5],(e[6]||"").trim()))}Array.add(u._rules,{commandName:e[2],commandArgument:e[3],view:e[4],phase:e[5],script:tt})}for(f=0;f<u._rules.length;f++)if((h=u._rules[f],h.phase===i)&&(p=!1,r(h.view)||(rt=o.get_viewId(),h.view===rt||rt.match(new RegExp(h.view))||(p=!0)),r(h.commandName)||(c=u._args.commandName,h.commandName===c||c.match(new RegExp(h.commandName))||(p=!0)),r(h.commandArgument)||(b=u._args.commandArgument,h.commandArgument===b||b&&b.match(new RegExp(h.commandArgument))||(p=!0)),!p)){if(u._args.causesValidation&&(u._initialize(),!u._valid)){u.preventDefault();break}if(h.script.call(u),u.canceled())break}u._newValues?(t?n.input.execute({dataView:o,values:u._newValues,raiseCalculate:c!=="Calculate"}):o._updateCalculatedFields({Errors:[],Values:u._newValues}),u._newValues=null,u._pendingFocus()):u.canceled()&&o.get_isDataSheet()&&(o._updateCalculatedFields({Errors:[],Values:[]}),u._pendingFocus())}},_pendingFocus:function(){this._focusFieldName&&(this._dataView._focus(this._focusFieldName,this._focusMessage),this._focusFieldName=null)},before:function(n){this.reset(n);this.process("Before");this.canceled()||this.process("Execute")},after:function(n){this._dataView._isBusy||(this.reset(n),this.process("After"))},_parseRule:function(n,t){var i,r;return t=vi(t),i=new Sys.StringBuilder,i.appendFormat("{0}=function(){{\n",n),r=/([\s\S]*?)(\[(\w+)(\.(\w+))?\](\s*=([^=][\s\S]+?);)?)/g,this._parseScript(i,r,t),t=i.toString(),i.clear(),this._parseScript(i,r,t),i.append("\n}"),i.toString()},_parseScript:function(n,t,i){for(var e=-1,u,f,o,s;u=t.exec(i);)n.append(u[1]),f=u[3],o=u[5],u[1].match(/\w$/)?n.append(u[2]):f.match(/^master$/i)?n.appendFormat("this.fieldValue('{0}','Master')",o):(s=this._dataView.findField(f),r(u[7])?n.appendFormat("this.fieldValue('{0}','{1}')",f,o):n.appendFormat("this.updateFieldValue('{0}',{1})",f,u[7])),e=t.lastIndex;e!=-1?n.append(e<i.length?i.substr(e):""):n.append(i)},preventDefault:function(){this._canceled=!0;this._dataView._raiseSelectedDelayed=!1;this._dataView._pendingSelectedEvent=!1},validateInput:function(){return this._initialize(),this._valid==!0},dataView:function(){return this._dataView},odp:function(n){var t=this._dataView.odp,i=t;return n&&(i=!1,t&&(i=t.is(n))),i},busy:function(){return this._dataView._busy()},arguments:function(){return this._initialize(),this._actionArgs},selectFieldValueObject:function(n){var i,t,r;for(this._initialize(),i=this._actionArgs.Values,t=0;t<i.length;t++)if(r=i[t],n==r.Name)return r;return this._dataView.findField(n)?{Name:n,Value:null}:null},selectFieldValue:function(n){var t=this.selectFieldValueObject(n);return t?t.Modified?t.NewValue:t.OldValue:null},fieldValue:function(n,t){var r,u,i;if(t=="Master"||t=="master")return r=this._dataView.get_master(),r?r.fieldValue(n):null;if(t=="context")return u=this._dataView.get_parentDataView(),u?u.fieldValue(n):null;if(!t||t=="Value")return this.selectFieldValue(n);i=this.selectFieldValueObject(n);i||this._unknownField(n);switch(t){case"NewValue":return i.NewValue;case"OldValue":return i.OldValue;case"Modified":return i.Modified;case"ReadOnly":return i.ReadOnly;case"Error":return i.Error;default:return i.OldValue}},updateFieldValue:function(n,t){var u=this.selectFieldValueObject(n),i,r;if(u){for(u.NewValue=t,u.Modified=!0,i=this._newValues,i||(i=this._newValues=[]),r=0;r<i.length;r++)if(i[r].Name==n){Array.removeAt(i,r);break}Array.add(i,u)}else this._unknownField(n)},property:function(n,t){if(n="Rules$"+n,arguments.length==1)return this._dataView.readContext(n);this._dataView.writeContext(n,t)},_unknownField:function(n){throw new Error(String.format('Unknown field "{0}" is not defined in  /controllers/{1}/views/{2}.',n,this._dataView._controller,this._dataView._viewId));}};it.Result=function(n){this._rules=n};it.Result.prototype={focus:function(n){var r=null,u,i,f;arguments.length>1&&(u=Array.clone(arguments),Array.removeAt(u,0),r=String._toFormattedString(!0,u));i=this._rules;f=i._dataView;t||(i._focusFieldName=n,i._focusMessage=r);setTimeout(function(){f._focus(n,r)})},showMessage:function(){n.showMessage(String._toFormattedString(!0,arguments))},showViewMessage:function(){this._rules._dataView.showViewMessage(String._toFormattedString(!0,arguments))},showAlert:function(){alert(String._toFormattedString(!0,arguments))},confirm:function(){return confirm(String._toFormattedString(!0,arguments))},refresh:function(n){this._rules._dataView(n==!0)},refreshChildren:function(){this._rules._dataView.refreshChildren()}};wt={fileReader:typeof FileReader!="undefined",formData:!!window.FormData,progress:"upload"in new XMLHttpRequest,dragAndDrop:"draggable"in document.createElement("span")};n.dataUrlToBlob=function(n){var i,u,r,t;for(i=n.split(",")[0].indexOf("base64")>=0?atob(n.split(",")[1]):unescape(n.split(",")[1]),u=n.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(i.length),t=0;t<i.length;t++)r[t]=i.charCodeAt(t);return new Blob([r],{type:u})};n.upload=function(i,r){function o(){var i=c.devicePixelRatio||1,n=u.find("canvas"),r,t;n.length&&(r=n.width(),n.height(r*.5),n=n.get(0),n.width=n.offsetWidth*i,n.height=n.offsetHeight*i,t=n.getContext("2d"),t.scale(i,i),u.data("signature").clear(),t.fillStyle="#ccc",t.font="20pt Arial",t.textAlign="center",t.fillText(ht.Files.Sign,r/2,r*.25))}function v(){var f=p(r.dataViewId),c=f.findField(r.fieldName),o=u.data("signature"),s=t?f.extension().commandRow():f.get_currentRow(),h=s&&s[c.Index],i=h!=null&&!h.toString().match(/^null\|/),e;return u.is(".app-signature")?(e=!o.isEmpty(),i=i||e,dt(f,r.fieldName,e?n.dataUrlToBlob(o.toDataURL("image/png",1)):null)):i=i||u.find("div").length>0,i}function h(){var n=r.multiple;u.empty().addClass("app-drop-box app-empty");wt.dragAndDrop&&(!t||t.desktop())?u.text(n?a.DropMany:a.Drop):u.text(t?n?a.TapMany:a.Tap:n?a.ClickMany:a.Click);u.attr("title",t?n?a.TapMany:a.Tap:n?a.ClickMany:a.Click)}function s(n){u.is(".app-had-blob")&&u.addClass("app-had-file");u.is(".app-clearing")?u.empty().append("<div>Value will be cleared on save. Click here to upload file.<\/div>"):n&&$('<a class="app-clear ui-btn ui-btn-icon-notext ui-icon-trash  ui-corner-all"/>').appendTo(u).text(a.Clear).attr("title",a.Clear)}function y(){var y,w;if(!u.is(".app-drop-box")){h();var e=p(r.dataViewId),c=e.findField(r.fieldName),b=e.editRow(),v=b[c.Index],i=v&&!v.match(/null\|/);if(c.OnDemandStyle==2){u.empty().attr("title",a.Sign);y=$('<canvas style="width:100%"><\/canvas>').appendTo(u).get(0);u.addClass("app-signature").data("signature",new SignaturePad(y,{backgroundColor:"white"}));$('<a class="app-clear ui-btn ui-btn-inline ui-corner-all"/>').insertAfter(u).text(a.Clear).attr("title",a.Clear).on(f,function(){if(u.data("signature").isEmpty()){t&&t.activeLink();return}u.addClass("app-dragging");n.confirm(a.ClearConfirm,function(){if(u.removeClass("app-dragging").focus(),o(),r.dataViewId){var n=p(r.dataViewId);dt(n,r.fieldName,null)}r.change&&r.change()},function(){u.removeClass("app-dragging").focus()})});t||o()}else{i&&(u.addClass("app-had-blob"),s(i));w=$('<input type="file"/>').insertAfter(u).hide().on("change",function(){var n=this.files;n.length>0&&l(n)});r.multiple&&w.attr("multiple","");u.on("dragenter",function(){return $(this).addClass("app-dragging"),!1}).on("dragover",function(){return $(this).addClass("app-dragging"),!1}).on("dragend dragleave",function(){return $(this).removeClass("app-dragging"),!1}).on("drop",function(n){$(this).removeClass("app-dragging");n.preventDefault();u.is(".app-uploading")||l(n.originalEvent.dataTransfer.files)}).on(f,function(t){if(!u.is(".app-uploading"))if($(t.target).closest(".app-clear").length)u.addClass("app-dragging"),n.confirm(u.find("div").map(function(){return $(this).text()}).get().join(", ")+"\n\n"+a.ClearConfirm,function(){if(u.removeClass("app-dragging").focus(),h(),u.next().val(""),r.dataViewId){var t=p(r.dataViewId),n=null;i&&(n=[new Blob],u.addClass("app-clearing"));dt(t,r.fieldName,n)}return r.change&&r.change(),i&&s(i),!1},function(){u.removeClass("app-dragging").focus()});else try{u.next()[0].click()}catch(f){}return!1})}}}function w(){r.change=null;u.is(".app-signature")?(u.removeData().find("canvas").off(),u.next().off().remove()):u.off().addClass("app-drop-box-destroyed").next().off().remove()}function l(n){!r.multiple&&n.length>1&&(n=[n[0]]);var f=0,i=p(r.dataViewId),e=i&&!t&&i.get_isModal()?$(i._container).height():0;u.is(":empty")||u.css("min-height",u.height());u.find("img div").off();u.empty().removeClass("app-empty");$(n).each(function(t){var o=this,h=n.length>1?(t+1).toString()+". ":"",c=pi(o.size),l=$("<div><\/div>").appendTo(u).text(h+o.name+" - "+c),s;wt.fileReader&&o.type.match(/^image\//i)&&(f++,s=new FileReader,s._fileInfo=l,s.onload=function(n){$("<img/>").attr("src",n.target.result).insertAfter(this._fileInfo).one("load",function(){r.change&&r.change()});this._fileInfo=null;--f==0&&(u.css("min-height",""),e&&$(i._container).height(e))},s.readAsDataURL(o));f||(u.css("min-height",""),r.change&&r.change())});u.removeClass("app-clearing");s(!0);i&&dt(i,r.fieldName,n)}function b(){var t=$('<progress max="100"><\/progress>');r.container.addClass("app-uploading");t.val(0).insertBefore(r.container.contents().first());n.uploadFileAjax({url:r.url,files:r.files,progress:function(n){if(n.lengthComputable){var i=n.loaded/n.total*100|0;t.val(i)}}}).then(function(){r.container.removeClass("app-uploading");r.success&&r.success()},function(){r.container.removeClass("app-uploading");t.remove();r.error&&r.error()})}var u,f,e;if(!arguments.length||!wt.formData)return wt.formData;u=$(r.container);f=t?"vclick":"click";switch(i){case"create":y();break;case"destroy":w();break;case"execute":b();break;case"resize":e=u.data("screen-width");(e==null||e!=rt.width())&&(u.is(":visible")&&u.data("screen-width",rt.width()),o());break;case"validate":return v()}};n.uploadFileAjax=function(n){var t=new FormData;return $(n.files).each(function(){this instanceof File?t.append("file",this):t.append("file",this,"_delete_")}),$.ajax({url:n.url,method:"POST",data:t,processData:!1,contentType:!1,xhr:function(){var t=new window.XMLHttpRequest;return n.progress&&t.upload.addEventListener("progress",n.progress,!1),t}})};c.Web$DataView$RichText=function(){};c.Web$DataView$RichText.prototype={attach:function(n){var o=$(n),f,t,s,i,e,h;return o.addClass("dataview-rich-text"),f=$("html").attr("lang"),r(f)&&(f=$("html").attr("xml:lang")),typeof CKEDITOR!="undefined"?($("<div><\/div>").insertAfter(o).width(o.outerWidth()).height(1),CKEDITOR.replace(n.id,{language:f,on:{instanceReady:function(t){var i=CKEDITOR.instances[n.id].getCommand("maximize");i&&(i._old_exec=i.exec,i.exec=function(n){this._old_exec(n);$(t.editor.container.$).find(".cke_maximized").css("z-index",10001)})}}})):(t=u.Editor,s=[{CommandName:"Undo",Tooltip:t.Undo},{CommandName:"Redo",Tooltip:t.Redo},{CommandName:"Bold",Tooltip:t.Bold,ElementWhiteList:{b:["style"],strong:["style"]}},{CommandName:"Italic",Tooltip:t.Italic,ElementWhiteList:{i:["style"],em:["style"]}},{CommandName:"Underline",Tooltip:t.Underline,ElementWhiteList:{u:["style"]}},{CommandName:"StrikeThrough",Tooltip:t.Strikethrough,ElementWhiteList:{strike:["style"]}},{CommandName:"Subscript",Tooltip:t.Subscript,ElementWhiteList:{sub:["style"]}},{CommandName:"Superscript",Tooltip:t.Superscript,ElementWhiteList:{sup:["style"]}},{CommandName:"JustifyLeft",Tooltip:t.JustifyLeft,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["left"]},{CommandName:"JustifyCenter",Tooltip:t.JustifyCenter,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["center"]},{CommandName:"JustifyRight",Tooltip:t.JustifyRight,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["right"]},{CommandName:"JustifyFull",Tooltip:t.JustifyFull,ElementWhiteList:{p:["align"],div:["style","align"]},AttributeWhiteList:{style:["text-align"]},align:["justify"]},{CommandName:"insertOrderedList",Tooltip:t.InsertOrderedList,ElementWhiteList:{ol:[],li:[]}},{CommandName:"insertUnorderedList",Tooltip:t.InsertUnorderedList,ElementWhiteList:{ul:[],li:[]}},{CommandName:"createLink",Tooltip:t.CreateLink,ElementWhiteList:{a:["href"]}},{CommandName:"UnLink",Tooltip:t.UnLink},{CommandName:"RemoveFormat",Tooltip:t.RemoveFormat},{CommandName:"SelectAll",Tooltip:t.SelectAll},{CommandName:"UnSelect",Tooltip:t.UnSelect},{CommandName:"Delete",Tooltip:t.Delete},{CommandName:"Cut",Tooltip:t.Cut},{CommandName:"Paste",Tooltip:t.Paste},{CommandName:"BackColor",Tooltip:t.BackColor,ElementWhiteList:{font:"style",span:"style"},AttributeWhiteList:{style:"background-color"}},{CommandName:"ForeColor",Tooltip:t.ForeColor,ElementWhiteList:{font:"color"},AttributeWhiteList:{font:"color"}},{CommandName:"FontName",Tooltip:t.FontName,ElementWhiteList:{font:["face"]},AttributeWhitList:{face:[]}},{CommandName:"FontSize",Tooltip:t.FontSize,ElementWhiteList:{font:["size"]},AttributeWhitList:{size:[]}},{CommandName:"Indent",Tooltip:t.Indent,ElementWhiteList:{blockquote:["style","dir"]},AttributeWhitList:{style:["margin","margin-right","padding","border"],dir:["ltr","rtl","auto"]}},{CommandName:"Outdent",Tooltip:t.Outdent},{CommandName:"InsertHorizontalRule",Tooltip:t.InsertHorizontalRule,ElementWhiteList:{hr:["size","width"]},AttributeWhiteList:{size:[],width:[]}},{CommandName:"HorizontalSeparator",Tooltip:""}],navigator.appVersion.match(/MSIE/)&&s.splice(0,2),i=Sys.Extended.UI.HtmlEditorExtenderBehavior,i._customized||(i.prototype.old_executeCommand=i.prototype._executeCommand,i.prototype._executeCommand=function(n){$(this._editableDiv).focus();this.old_executeCommand(n)},i._customized=!0),e=$create(i,{ToolbarButtons:s,id:n.id+"$Editor"},null,null,n),e._noEncoding=!0,e._editableDiv.tabIndex=n.tabIndex,h=$(e._topButtonContainer),h.find("nobr span").hide(),h.find("select").css({"font-family":"","font-size":""})),!0},detach:function(n){if(typeof CKEDITOR!="undefined")CKEDITOR.remove(n.id);else{var t=$find(n.id+"$Editor");t&&t.dispose()}return!0},persist:function(n){if(typeof CKEDITOR!="undefined")n.value=CKEDITOR.instances[n.id].getData();else{var t=$find(n.id+"$Editor");t&&(n.value=t._editableDiv.innerHTML)}}};n.prettyText=wi;n.surveyLibrary={};n.surveyFailedToLoad={};n.action=function(n){t&&t.executeInContext(n.icon,n.text,n.path)};n.toTags=function(t,i){var r,u,f;if(i||(i=""),t!=null){if(typeof t=="boolean")return t?i:i+"-none";if(i&&(i=i+"-"),typeof t=="string"||typeof t=="number")return i+t;r=[];for(u in t)f=n.toTags(t[u],i+u),f&&r.push(f);return r.join(" ").replace(/([A-Z])/g,"-$1").toLowerCase()}return i};n.read=function(n,t){for(var f=t.split(/\./g),e=f.length,r,u=n,i=0;i<e;i++){if(r=f[i],i==e-1)return u[r];if(u[r]!=null)u=u[r];else return null}return null};n.survey=function(i,r){function rt(t){v=t.tags||t.options&&n.toTags(t.options)||"";t.text||(v+=" page-header-none ");t.tags=v}function ut(t){return n.find(r.parent).get_baseUrl()+(t.match(/\//)?t:"/js/surveys/"+t)}function k(t){function e(){g(f);f.cache===!1&&(n.surveyLibrary[u]=null)}try{f=eval(t);var i=f.layout||"";i.match(/(#ref|\.html)$/i)?(nt(!0),$.ajax({url:ut(i=="#ref"?a+".html":i),dataType:"text",cache:!1}).done(function(n){nt(!1);f.layout=n;e()}).fail(function(){nt(!1);typeof r.create=="function"?r.create():n.alert("Unable to load survey layout for "+u+" from the server.")})):e()}catch(o){n.alert("The definiton of "+u+" survey is invalid.\n\n"+o.message+(c.location.host.match(/\localhost\b/)?"\n\n"+o.stack.replace(/\n/g,"<br/>"):""))}}function d(n){!n.topics&&n.questions&&(n.topics=[{questions:n.questions}],n.questions=null)}function g(t){var e,i,f;if(d(t),e=r.parent,i=p(e),t.controller=u,t.baseUrl=i?i.get_baseUrl():__baseUrl,t.servicePath=i?i.get_servicePath():__servicePath,t.confirmContext=r.confirmContext,t.showSearchBar=!0,t.parent=e,t.context=r.context,r.options){t.options||(t.options={});for(f in r.options)t.options[f]==null&&(t.options[f]=r.options[f])}t.submit||(t.submit=r.submit);t.submitText||(t.submitText=r.submitText);t.cancel||(t.cancel=r.cancel);t.init||(t.init=r.init);t.calculate||(t.calculate=r.calculate);n.showModal(i,u,"form1","New","",t.baseUrl,t.servicePath,[],{confirmContext:r.confirmContext,showSearchBar:t.showSearchBar,survey:t,tags:t.tags})}function s(n,t,i,r,u,f,e){var o='function(){var r=this,dv=r.dataView(),s=dv.survey(),e=$.Event("'+(typeof i=="string"?i:t)+'",{rules:r,dataView:dv,survey:s'+(e!=null?",argument:"+et(e):"")+"});"+(typeof i=="string"?"$(document).trigger(e);":"s."+t+"(e);")+(r=="Calculate"?"":"if(e.isDefaultPrevented())")+"r.preventDefault();}",s=o.match(/^function\s*\(\)\s*\{([\s\S]+?)\}\s*$/);u||(u="");n.push({Scope:6,Target:null,Type:1,Test:null,Result:"<id>r"+n.length+"<\/id><command>"+r+"<\/command><argument>"+u+"<\/argument><view>form1<\/view><phase>"+f+"<\/phase><js>"+s[1]+"<\/js>",ViewId:"form1"})}function tt(n,t,i,r,u){$(n).each(function(){var n=this;r&&r(n,t);$(n.questions).each(function(){var r=this;u&&u(r,n,t,i)});n.topics&&tt(n.topics,n,i+1,r,u)})}function w(t,i,r,u){var f=[],e=[],o=[],s=[];if($(t).each(function(t){var i=this;i.ItemsDataValueField||(i.ItemsDataValueField=n.cache[i.ItemsDataController+"_"+i.ItemsDataView+"_DataValueField"]);i.ItemsDataTextField||(i.ItemsDataTextField=n.cache[i.ItemsDataController+"_"+i.ItemsDataView+"_DataTextField"]);i.ItemsDataValueField&&i.ItemsDataTextField||o.push({controller:i.ItemsDataController,view:i.ItemsDataView,requiresData:!1,metadataFilter:["fields"],_fieldIndex:t})}),o.length){nt(!0);n.execute({batch:o,success:function(f){$(f).each(function(i){var r=t[o[i]._fieldIndex],u=this.rawResponse;r.ItemsDataValueField||$(u.Fields).each(function(){var t=this;if(t.IsPrimaryKey)return r.ItemsDataValueField=t.Name,n.cache[r.ItemsDataController+"_"+r.ItemsDataView+"_DataValueField"]=t.Name,!1});r.ItemsDataTextField||(r.ItemsDataTextField=u.Fields[0].Name,n.cache[r.ItemsDataController+"_"+r.ItemsDataView+"_DataTextField"]=r.ItemsDataTextField)});w(t,i,r,u)},error:function(){nt(!1)}});return}$(t).each(function(){var t=this,u,v=t._dataView,y=[t.ItemsDataValueField,t.ItemsDataTextField],p=t.Copy,w=t.ContextFields,b={controller:t.ItemsDataController,view:t.ItemsDataView,sortExpression:t.ItemsDataTextField,fieldFilter:y,metadataFilter:["fields"],pageSize:1e3,distinct:n.is(t.Tag,"lookup-distinct")},o,h,c,a,l;if(p)while(u=n._fieldMapRegex.exec(p))y.push(u[2]);if(w){for(o=[];u=n._fieldMapRegex.exec(w);)v?h=v.findField(u[2]):$(i).each(function(){var n=this;if(n.Name==u[2])return h=n,!1}),c=r[h.Index],a=!st(h,t),(a||c!=null)&&(c==null&&a?(t.Items=[],s.push(t)):h.ItemsTargetController||h.ItemsStyle=="CheckBoxList"?(l=n.csv.toArray(c),l.length<=1?o.push({field:u[1],value:l[0]}):o.push({field:u[1],operator:"in",values:l})):o.push({field:u[1],value:c}));o.length&&(b.filter=o)}t.skipPopulate||s.indexOf(t)!=-1||(f.push(b),e.push(t))});f.length?(nt(!0),n.execute({batch:f,done:function(n){nt(!1);$(e).each(function(t){var r=this,u=f[t],e=n[t].rawResponse,i={};$(e.Fields).each(function(n){i[this.Name]=n});r.Items=[];$(e.Rows).each(function(){for(var f=this,t=[],n=0;n<u.fieldFilter.length;n++)t.push(f[i[u.fieldFilter[n]]]);i.group_count_!=null&&t.push(f[i.group_count_]);r.Items.push(t)})});u&&u(e.concat(s))},fail:function(){nt(!1)}})):u&&s.length&&u(e)}function ft(n){var i=t.dataView(),u=i.extension();r.compiled=function(f){var o=u._disposeForm(),e;i._views[0].Layout=r.layout;e=t.createLayout(i,t.calcWidth(o.parent()));e=e.insertAfter(o);t.prepareLayout(i,f.NewRow,e);o.remove();u._skipRefresh=!0;i._pageIndex=-1;i._editRow=null;i._onGetPageComplete(f,null);u._skipRefresh=!1;u.stateChanged(!1);n&&n(e)};it()}function ot(t,i){var r=n.survey,u;return r.registrations||(r.registrations={}),u=r.registrations[t]!=!0,r.registrations[t]=!0,u&&i&&i(),u}function st(n,t){var i=n.ContextFields,r=new RegExp("=\\s*"+t.Name+"\\s*(,|$)");return!!(i&&i.match(r))}function it(){function h(n,i,r){t.Expressions.push({Scope:n,Target:i,Test:r,Type:1,ViewId:"form1"})}var i=[],v={},p=0,o=r.context,f=o&&o._initData,t={Controller:u,View:"form1",TotalRowCount:-1,Fields:[{Name:"sys_pk_",Type:"Int32",Label:"",IsPrimaryKey:!0,ReadOnly:!0,Hidden:!0,AllowNulls:!0,Columns:20}],Views:[{Id:"form1",Label:r.text,Type:"Form"}],ViewHeaderText:r.description,ViewLayout:r.layout,Expressions:[],ActionGroups:[{Scope:"Form",Id:"form",Actions:[]}],Categories:[],NewRow:[1],Rows:[]},y=r.buttons,c,l,a,e;return r.submit&&(c=r.submitKey,t.ActionGroups[0].Actions.push({Id:"submit",CommandName:"Confirm",WhenLastCommandName:"New",HeaderText:r.submitText,Confirmation:r.submitConfirmation,Key:c===!1?null:c||"Enter",CssClass:r.submitIcon})),r.cancel!=!1&&t.ActionGroups[0].Actions.push({Id:"a2",CommandName:"Cancel",WhenLastCommandName:"New"}),d(r),l=0,tt(r.topics,null,0,function(n,i,r){var u=t.Categories.length,e=n.visibleWhen,f={Id:"c"+u,Index:u,HeaderText:n.text,Description:n.description,Wizard:n.wizard,Flow:n.flow=="newColumn"||l==0?"NewColumn":n.flow=="newRow"?"NewRow":"",Wrap:n.wrap!=null?n.wrap:null,Floating:!!n.floating,Collapsed:n.collapsed==!0,Tab:n.tab};e&&h(2,f.Id,e);r>0&&(f.Depth=r);t.Categories.push(f);n._categoryIndex=u;l++},function(u,e){var a=u.type||"String",y=u.format||u.dataFormatString,tt=u.mode,p=u.columns,nt=u.rows,ut=u.options,d=ut?n.toTags(ut):u.tags,c=u.items,it,l=u.value,g=u.context,w=u.name,ft=u.visibleWhen,et=u.readOnlyWhen,ot=u.tooltip,s={Name:w,HtmlEncode:!0,AllowNulls:u.required!=!0,Label:u.text==!1?"&nbsp;":u.text||u.label||wi(u.name),Hidden:u.hidden==!0,CausesCalculate:u.causesCalculate==!0},st,rt,b,k;if(w){f&&(w in f?l=f[w]:"value"in u&&(f[w]=l,o._initVals.push({field:w,value:l})));u.causesCalculate&&(s.CausesCalculate=!0);switch(a.toLowerCase()){case"text":case"string":a="String";break;case"date":a="DateTime";y||(y="d",p==null&&(p=10));break;case"datetime":a="DateTime";p==null&&(p=20);break;case"time":a="DateTime";y||(y="t",p==null&&(p=8));break;case"number":a="Double";break;case"int":a="Int32";break;case"bool":case"Boolean":a="Boolean";!c&&u.required&&(c={style:"CheckBox"},l==null&&(l=!1));break;case"money":a="Currency";break;case"memo":a="String";nt==null&&(nt=5);break;case"blob":st={Name:"Picture",Type:"Byte[]",Label:"Picture",AllowQBE:!1,AllowSorting:!1,SourceFields:"CategoryID",AllowNulls:!0,Columns:15,OnDemand:!0,OnDemandHandler:"CategoriesPicture",ShowInSummary:!0};a="Byte[]";s.OnDemand=!0}s.Type=a;a=="String"&&(s.Len=u.length||100);a!="DateTime"||y||(y="g");a!="Currency"||y||(y="c");y&&(typeof y=="string"?s.DataFormatString=y:(rt=y.DataFormatString,rt&&(s.DataFormatString=rt,a=="DateTime"&&(s.TimeFmtStr=y.TimeFmtStr,s.DateFmtStr=y.DateFmtStr)),delete u.format));p&&(s.Columns=p);nt&&(s.Rows=nt,a=="String"&&nt>1&&(s.Len=0));u.placeholder&&(s.Watermark=u.placeholder);d&&(s.Tag=typeof d=="string"?d:d.join(","));g&&(typeof g!="string"&&(g.forEach(function(n,t){n.match(/=/)||(g[t]=n+"="+n)}),g=g.join(",")),s.ContextFields=g);u.htmlEncode==!1&&(s.HtmlEncode=!1);tt&&(tt=="password"&&(s.TextMode=1),tt=="rtf"&&(s.TextMode=2),tt=="static"&&(s.TextMode=4));(r.readOnly||u.readOnly&&typeof u.readOnly!="function")&&(s.ReadOnly=!0);s.Hidden||(s.CategoryIndex=e._categoryIndex);u.extended&&(s.Extended=u.extended);u.altText&&(s.AltHeaderText=u.altText);u.footer&&(s.FooterText=u.footer);ot&&(s.ToolTip=ot);b=c&&c.copy;b&&(typeof b!="string"&&(b=[],$(c.copy).each(function(){var n=this;b.push(n.to+"="+n.from)}),b=b.join("\n")),s.Copy=b);k=c&&c.filter;k&&(typeof k!="string"&&(k=[],$(c.filter).each(function(){var n=this;k.push(n.match+"="+n.to)}),k=k.join(",")),s.ContextFields=k);c&&(itemsStyle=c.style||(c.list?"DropDownList":"Lookup"),s.Items=[],_isTagged(d,"lookup-auto-complete-anywhere")&&(s.SearchOptions="$autocompleteanywhere"),itemsStyle=="Lookup"&&_isTagged(d,"lookup-distinct")&&(itemsStyle="AutoComplete"),itemsStyle.match(/AutoComplete|Lookup|DropDown/)&&_isTagged(d,"lookup-multiple")&&(s.ItemsTargetController="_basket",itemsStyle=="AutoComplete"&&l!=null&&(c.dataValueField==c.dataTextField?(typeof l=="string"&&(l=n.csv.toArray(l)),$(l).each(function(){var n=this;s.Items.push([n,n,null])})):i.push(s))),it=c.targetController,it&&(s.ItemsTargetController=it),l!=null&&(s.ItemsTargetController||itemsStyle=="CheckBoxList")&&(Array.isArray(l)?l=n.csv.toString(l):typeof l!="string"&&(l=l.toString())),c.list?$(c.list).each(function(){var n=this,t=n.value,i=n.text,r=n.count,u=[t,i==null?t:i];r!=null&&u.push(r);s.Items.push(u)}):c.controller&&(s.ItemsDataController=c.controller,s.ItemsDataView=c.view||"grid1",s.ItemsDataValueField=c.dataValueField,s.ItemsDataTextField=c.dataTextField,s.ItemsNewDataView=c.newView,itemsStyle.match(/AutoComplete|Lookup/)||i.push(s),c.dataValueField!=c.dataTextField&&(s._autoAlias=!0)),s.ItemsStyle=itemsStyle,c.disabled&&(s.ItemsStyle=null));ft&&h(3,w,ft);et&&h(5,w,et,5);t.Fields.push(s);v[s.Name]=s;typeof l!="function"&&(t.NewRow[t.Fields.length-1]=l)}}),t.Fields.forEach(function(t){var i=t.ContextFields;t.Index=p++;i&&$(i.split(n._simpleListRegex)).each(function(){var i=this.split(n._fieldMapRegex),r=i?v[i[2]]:null;if(r&&r.ItemsDataController==t.ItemsDataController)return t.requiresDynamicNullItem=!0,!1})}),r.init&&s(t.Expressions,"init",r.init,"New","form1","After"),r.submit&&s(t.Expressions,"submit",r.submit,"Confirm",null,"Before"),r.cancel&&s(t.Expressions,"cancel",r.cancel,"Cancel",null,"Before"),r.calculate&&s(t.Expressions,"calculate",r.calculate,"Calculate",null,"Execute"),y&&(a={form:t.ActionGroups[0]},r._handlers={},$(y).each(function(){var n=this,u=n.scope,i,f;u||(u="form");i=a[u];n.text?(f={Id:n.id,CommandName:n.id,WhenLastCommandName:"New",HeaderText:n.text,Key:n.key},n.icon&&(f.CssClass=n.icon),n.when&&(f.WhenClientScript=typeof n.when=="function"?n.when:function(){var t=$.Event(n.when,{dataView:this,argument:n.argument});return $(document).trigger(t),!t.isDefaultPrevented()}),i||(i={Scope:u[0].toUpperCase()+u.substring(1),Id:u,Actions:[]},t.ActionGroups.push(i),a[u]=i),u=="form"?i.Actions.splice(i.Actions.length-1,0,f):i.Actions.push(f),typeof n.click=="function"&&(r._handlers[n.id]=function(t){t.preventDefault();n.click.call(t.dataView,t)}),s(t.Expressions,"_handlers."+n.id,n.click,n.id,null,"Execute",n.argument)):i.Actions.push({Id:"div"+i.Actions.length,CommandName:n.id,WhenLastCommandName:"New"})})),rt(r),t.Tag=(r.tags||"")+" ignore-unsaved-changes",t.Fields.length===1&&(t.Fields[0].Hidden=!1),e=r.compiled,e&&(i.length?w(i,t.Fields,t.NewRow,function(){e(t)}):e(t),r.compiled=null),t}function b(){nt(!1);var t=r.create;t?typeof t=="string"?$(document).trigger($.Event(t,{survey:r})):t.call(r):n.alert("Unable to load survey "+u+" from the server.")}var f,l,h;typeof i!="string"&&(r=arguments[0],i="show");var a=r.controller||"survey",u=a.replace(/\W/g,"_"),v,e=r.values||r.data,o,y;if(i=="show"&&e){if(Array.isArray(e))r.data=o={},e.forEach(function(n){o[n.field]="newValue"in n?n.newValue:"oldValue"in n?n.oldValue:n.value});else{o=e;e=[];for(y in o)e.push({name:y,value:o[y]})}r.context||(r.context={});r.context._initVals=e;r.context._initData=o}if(r.external=!(r.topics||r.questions),i=="show")r.external?(f=n.surveyLibrary[u],f?k(f):(nt(!0),h=p(r.parent),r.tryLoad===!1||n.surveyFailedToLoad[u]?b({}):$.ajax({url:__servicePath+"/GetSurvey",data:et({name:a}),method:"POST",cache:!1}).done(function(t){nt(!1);t=t.d;typeof t=="string"?(n.surveyLibrary[u]=t,k(t)):(b(t),n.surveyFailedToLoad[u]=!0)}).fail(b))):g(r);else{if(i==="compile")return it();if(i==="populateItems")l=[],h=r.dataView,$(h._allFields).each(function(){var n=this;n.ItemsAreDynamic&&n.ContextFields&&!n.skipPopulate&&l.push(n)}),l.length&&w(l,h._allFields,h.row(),r.callback);else if(i=="refresh")ft(arguments[2]);else{if(i=="register")return ot(arguments[1],arguments[2]);n.alert("Unsupported survey method: "+i)}}};$(document).on("beforetouchinit.app",function(){t=n.touch}).on("batcheditsubmit.dataview.app",function(i){var e=i.rules,f;if(e.busy()){e.preventDefault();return}var r=e.dataView(),s=r.row(),h=r.survey().context,u=[],o;$(r._allFields).each(function(){var h=this,i=h.Name,f=i.match(/^(.+?)\_Batch(Edit|Keep)$/),n,e,t;if(f&&h.Type==="Boolean"&&(n=r.findField(i),n&&s[n.Index]))if(f[2]==="Keep")u.length&&u[u.length-1].newValue!=null&&u.push({name:i,value:!0});else{if(n=r.findField(f[1]),n&&(t=s[n.Index]),n.Extended&&!n.Extended.allowNulls&&t==null)return o=n,!1;if(e=n.Extended.dependency,e&&$(e).each(function(){var e=this,i=r.findField(e.Name),f=s[i.Index];if(t==null&f!=null)return o=n,!1;u.push({name:i.Name,newValue:f})}),o)return!1;u.push({name:n.Name,newValue:t})}});e.preventDefault();o?e.result.focus(o.Name,g.RequiredField):u.length&&(nt(!0),f=r.get_parentDataView(),$(f._keyFields).each(function(){var n=this;u.push({name:n.Name})}),n.confirm(fi.Confirmation).then(function(){n.execute({controller:h.controller,view:h.view,command:"Update",lastCommand:"BatchEdit",values:u,selectedKeys:f._selectedKeyList,error:function(){nt(!1)}}).done(function(n){function i(){f._clearSelectedKey();f._selectedKeyList=[];f.sync()}nt(!1);t?(t.pageShown(function(){t.notify(String.format(ht.BatchEdited,n.rowsAffected));i()}),r.cancel()):(r.cancel(),f.set_selectedValue(""),i())})}))});typeof Sys!="undefined"&&Sys.Application.notifyScriptLoaded();
/*!
    * Signature Pad v1.3.5
    * https://github.com/szimek/signature_pad
    *
    * Copyright 2015 Szymon Nowak
    * Released under the MIT license
    *
    * The main idea and some parts of the code (e.g. drawing variable width Bzier curve) are taken from:
    * http://corner.squareup.com/2012/07/smoother-signatures.html
    *
    * Implementation of interpolation using cubic Bzier curves is taken from:
    * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
    *
    * Algorithm for approximated length of a Bzier curve is taken from:
    * http://www.lemoda.net/maths/bezier-length/index.html
    *
    */
c.SignaturePad=function(n){var t=function(n,t){var r=this,i=t||{};this.velocityFilterWeight=i.velocityFilterWeight||.7;this.minWidth=i.minWidth||.5;this.maxWidth=i.maxWidth||2.5;this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2};this.penColor=i.penColor||"black";this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)";this.onEnd=i.onEnd;this.onBegin=i.onBegin;this._canvas=n;this._ctx=n.getContext("2d");this.clear();this._handleMouseEvents();this._handleTouchEvents()},i,r;return t.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor;t.clearRect(0,0,n.width,n.height);t.fillRect(0,0,n.width,n.height);this._reset()},t.prototype.toDataURL=function(){var n=this._canvas;return n.toDataURL.apply(n,arguments)},t.prototype.fromDataURL=function(n){var r=this,t=new Image,i=window.devicePixelRatio||1,u=this._canvas.width/i,f=this._canvas.height/i;this._reset();t.src=n;t.onload=function(){r._ctx.drawImage(t,0,0,u,f)};this._isEmpty=!1},t.prototype._strokeUpdate=function(n){var t=this._createPoint(n);this._addPoint(t)},t.prototype._strokeBegin=function(n){var t=this._ctx,i=this._canvas;if(this._isEmpty&&(t.fillStyle=this.backgroundColor,t.fillRect(0,0,i.width,i.height),t.fillStyle=this.penColor),this._reset(),this._strokeUpdate(n),typeof this.onBegin=="function")this.onBegin(n)},t.prototype._strokeDraw=function(n){var t=this._ctx,i=typeof this.dotSize=="function"?this.dotSize():this.dotSize;t.beginPath();this._drawPoint(n.x,n.y,i);t.closePath();t.fill()},t.prototype._strokeEnd=function(n){var i=this.points.length>2,t=this.points[0];if(!i&&t&&this._strokeDraw(t),typeof this.onEnd=="function")this.onEnd(n)},t.prototype._handleMouseEvents=function(){var t=this,i=$(t._canvas);this._mouseButtonDown=!1;i.on("mousedown",function(n){n=n.originalEvent;n.which===1&&(t._mouseButtonDown=!0,t._strokeBegin(n))});i.on("mousemove",function(n){n=n.originalEvent;t._mouseButtonDown&&t._strokeUpdate(n)});$(n).on("mouseup",function(n){n=n.originalEvent;n.which===1&&t._mouseButtonDown&&(t._mouseButtonDown=!1,t._strokeEnd(n))})},t.prototype._handleTouchEvents=function(){var t=this,i=$(t._canvas);this._canvas.style.msTouchAction="none";i.on("touchstart",function(n){n=n.originalEvent;var i=n.changedTouches[0];t._strokeBegin(i)});i.on("touchmove",function(n){n=n.originalEvent;n.preventDefault();var i=n.changedTouches[0];t._strokeUpdate(i)});$(n).on("touchend",function(n){n=n.originalEvent;var i=n.target===t._canvas;i&&t._strokeEnd(n)})},t.prototype.isEmpty=function(){return this._isEmpty},t.prototype._reset=function(){this.points=[];this._lastVelocity=0;this._lastWidth=(this.minWidth+this.maxWidth)/2;this._isEmpty=!0;this._ctx.fillStyle=this.penColor},t.prototype._createPoint=function(n){var t=this._canvas.getBoundingClientRect();return new i(n.clientX-t.left,n.clientY-t.top)},t.prototype._addPoint=function(n){var t=this.points,u,f,e,i;t.push(n);t.length>2&&(t.length===3&&t.unshift(t[0]),i=this._calculateCurveControlPoints(t[0],t[1],t[2]),u=i.c2,i=this._calculateCurveControlPoints(t[1],t[2],t[3]),f=i.c1,e=new r(t[1],u,f,t[2]),this._addCurve(e),t.shift())},t.prototype._calculateCurveControlPoints=function(n,t,r){var e=n.x-t.x,o=n.y-t.y,s=t.x-r.x,h=t.y-r.y,f={x:(n.x+t.x)/2,y:(n.y+t.y)/2},u={x:(t.x+r.x)/2,y:(t.y+r.y)/2},p=Math.sqrt(e*e+o*o),c=Math.sqrt(s*s+h*h),w=f.x-u.x,b=f.y-u.y,l=c/(p+c),a={x:u.x+w*l,y:u.y+b*l},v=t.x-a.x,y=t.y-a.y;return{c1:new i(f.x+v,f.y+y),c2:new i(u.x+v,u.y+y)}},t.prototype._addCurve=function(n){var r=n.startPoint,u=n.endPoint,t,i;t=u.velocityFrom(r);t=this.velocityFilterWeight*t+(1-this.velocityFilterWeight)*this._lastVelocity;i=this._strokeWidth(t);this._drawCurve(n,this._lastWidth,i);this._lastVelocity=t;this._lastWidth=i},t.prototype._drawPoint=function(n,t,i){var r=this._ctx;r.moveTo(n,t);r.arc(n,t,i,0,2*Math.PI,!1);this._isEmpty=!1},t.prototype._drawCurve=function(n,t,i){var l=this._ctx,p=i-t,a,y,o,r,s,h,u,c,v,f,e;for(a=Math.floor(n.length()),l.beginPath(),o=0;o<a;o++)r=o/a,s=r*r,h=s*r,u=1-r,c=u*u,v=c*u,f=v*n.startPoint.x,f+=3*c*r*n.control1.x,f+=3*u*s*n.control2.x,f+=h*n.endPoint.x,e=v*n.startPoint.y,e+=3*c*r*n.control1.y,e+=3*u*s*n.control2.y,e+=h*n.endPoint.y,y=t+h*p,this._drawPoint(f,e,y);l.closePath();l.fill()},t.prototype._strokeWidth=function(n){return Math.max(this.maxWidth/(n+1),this.minWidth)},i=function(n,t,i){this.x=n;this.y=t;this.time=i||(new Date).getTime()},i.prototype.velocityFrom=function(n){return this.time!==n.time?this.distanceTo(n)/(this.time-n.time):1},i.prototype.distanceTo=function(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))},r=function(n,t,i,r){this.startPoint=n;this.control1=t;this.control2=i;this.endPoint=r},r.prototype.length=function(){for(var e=10,o=0,t,i,r,s,h,u,f,n=0;n<=e;n++)t=n/e,i=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),n>0&&(u=i-s,f=r-h,o+=Math.sqrt(u*u+f*f)),s=i,h=r;return o},r.prototype._point=function(n,t,i,r,u){return t*(1-n)*(1-n)*(1-n)+3*i*(1-n)*(1-n)*n+3*r*(1-n)*n*n+u*n*n*n},t}(document);n.storage={set:function(n,t){var i=c.localStorage,r,u,f,e;if(i)try{if(n.match(/\*$/)){n=n.substring(0,n.length-1);r=[];for(u in i)u.indexOf(n)==0&&r.push(u);t=JSON.parse(t);r.forEach(function(n){for(f in t)if(n.endsWith("_"+f)){e=t[f];e==null?i.removeItem(n):i[n]=e;break}})}else t==null?i.removeItem(n):i[n]=t}catch(o){}},get:function(n){var t=c.localStorage;if(t)try{return t[n]}catch(i){return null}else return null},remove:function(n){this.set(n,null)},lock:function(){},unlock:function(){}};n.AccountManager={enabled:function(){return t&&t.settings("membership.enabled")!=!1&&t.settings("membership.accountManager.enabled")!=!1},current:function(){if(this.enabled()){var n=this.list(!0);return n[$app.userName()]}},session:function(n){try{if(arguments.length==1)n!=null?sessionStorage.setItem("AccountManager_Id",et(n)):sessionStorage.removeItem("AccountManager_Id");else{var t=sessionStorage.getItem("AccountManager_Id");if(t)return JSON.parse(t)}}catch(i){}return null},set:function(t){var r,i;this.enabled()?(r=this.list(),t.session?(delete r[t.name],delete r._lastUser,this.session(t)):(r[t.name]=t,r._lastUser=t.name),n.storage.set("identities",et(r))):t.picture&&(i=n.storage.get("userProfilePictures"),i=i?JSON.parse(i):{},this._pictureMap=i,i[t.name]=t.picture,n.storage.set("userProfilePictures",et(i)))},count:function(){var t=this.list(),n=0;for(var i in t)i!="_lastUser"&&n++;return n},list:function(i){var r,u;return t?(r=n.storage.get("identities"),r=r?JSON.parse(r):{},i&&(u=this.session(),u&&(r[u.name]=u)),r):{}},remove:function(i,r){if(t){var u=this.list();u.hasOwnProperty(i)?r?delete u[i]:(u[i].access_token=null,u[i].refresh_token=null):this.session(null);delete u._lastUser;n.storage.set("identities",et(u))}},avatar:function(t,i){var u,f,e,r,o;this.enabled()?(f=this.list(),f&&(e=f[t],u=e&&e.picture)):(r=this._pictureMap,r||(o=n.storage.get("userProfilePictures"),r=this._pictureMap=o?JSON.parse(o):{}),r&&(u=r[t]));u&&i.css("background-image",'url("'+u+'")').parent().addClass("app-has-avatar-with-picture")}}})();